{"parse":{"title":"User:D41D8CD98F/common.js","pageid":214495,"wikitext":{"*":"(function() {\n$(function() { $('#mw-content-text').off('copy') });\nlocalStorage.widgetTalkToc = 'disable';\nif ($('link[href*=\"site.styles\"]')[0]) $.each($('link[href*=\"site.styles\"]')[0].sheet.cssRules, function(i, v) {\n\tif (v.selectorText)\n\t\tv.selectorText = v.selectorText.replace(/^body:not\\(\\.ns--1\\).*\\.mw-collapsible.*$/, 'ignored')\n})\n\nfunction withElem(s) {\n\treturn $(s)[0] ? Promise.resolve($(s)) : new Promise(function(r) {\n\t\tnew MutationObserver(function(rec,self) {\n\t\t\t$.each(rec, function(i,v) {\n\t\t\t\tvar t = $(v.addedNodes).filter(s);\n\t\t\t\tif (t.length) self.disconnect(), r(t)\n\t\t\t})\n\t\t}).observe(document.body, {childList: true, subtree: true})\n\t})\n}\n\n$('body').on('error', 'img[src*=\"//static.mengniang.org\"]', function() { this.src = this.src.replace('//static.mengniang.org','//img.acg.moe') });\n$('img').each(function() { this.src = this.src });\n\nif (mw.config.get('wgIsMainPage')) withElem('.mainpage-newsbox > .mainpage-1stcontent').then(function(a) {\n\tfunction p(t) {\n\t\treturn $.get('/api.php', { format: 'json', formatversion: 2, action: 'parse', text: t })\n\t}\n\tvar date = new Date();\n\tvar b = $('<ul class=\"hlist\" style=\"text-align:center\">');\n\tfunction c(d,e) {\n\t\tb.append($('<li>').append($('<a>').text(d)).on('click', e))\n\t}\n\tfunction f(g) {\n\t\treturn function() {\n\t\t\tdate.setDate(date.getDate() + g);\n\t\t\tp('{{\u9996\u9875/\u4e13\u9898/\u65b0\u756a\u4e13\u9898/' + date.toLocaleDateString('zh-CN',{weekday: 'long'}) + '}}').then(function(data) {\n\t\t\t\ta.empty().append(data.parse.text)\n\t\t\t});\n\t\t}\n\t}\n\tc('\u524d\u4e00\u5929', f(-1));\n\tc('\u5b8c\u6574\u5217\u8868', function() {\n\t\t$.when(p('{{' + /(\u65e5\u672c\\d{4}\u5e74.\u5b63\u52a8\u753b)\u4e13\u9898/.exec(a.text())[1] + '}}'), mw.loader.using('jquery.makeCollapsible')).then(function(data) {\n\t\t\t$(data[0].parse.text).find('.mw-collapsible').makeCollapsible().end().insertAfter(b)\n\t\t})\n\t});\n\tc('\u540e\u4e00\u5929', f(1));\n\ta.after(b)\n});\n\nif (['edit', 'submit'].includes(mw.config.get('wgAction'))) withElem('#wpPreview').then(function(a) {\n\tvar select = $('<select name=\"variant\">').insertBefore(a);\n\t[ ['zh', '\u4e0d\u8f6c\u6362'], ['zh-hans', '\u7b80\u4f53'], ['zh-hant', '\u7e41\u9ad4'], ['zh-cn', '\u5927\u9646\u7b80\u4f53'], ['zh-tw', '\u53f0\u7063\u7e41\u9ad4'] ].forEach(function(v) {\n\t\tselect.append('<option value=\"' + v[0] + '\"' + (v[0] == mw.config.get('wgPreferredVariant') ? ' selected' : '') + '>' + v[1] + '</option>')\n\t});\n\t[ ['mobile', '\u624b\u673a\u7248'], ['desktop', '\u684c\u9762\u7248'] ].forEach(function(v) {\n\t\ta.after('<input class=\"' + a.attr('class') + '\" id=\"D4-editpreview-' + v[0] + '\" name=\"wpPreview\" type=\"submit\" formaction=\"' + $('form#editform').attr('action') + '&useformat=' + v[0] + '\" value=\"\u5728' + v[1] + '\u89c6\u56fe\u9884\u89c8\" />')\n\t});\n\t// a.css('display', 'none')\n});\n\nmw.hook('wikipage.diff').add(function(t) {\n\tt.find('.diff-deletedline > div, .diff-addedline > div').contents().each(function() {\n\t\tif (this.nextSibling && !this.nextSibling.textContent.match(/^([\\x00-\\x7f]|\\xA0 )/))\n\t\t\tthis.textContent = this.textContent.replace(/ $/, '');\n\t});\n});\n})();"}}}