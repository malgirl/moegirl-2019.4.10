{"parse":{"title":"MediaWiki:Gadget-twinkleblock.js","pageid":164862,"wikitext":{"*":"//\u672cjs\u5f15\u81ea\u4e2d\u6587\u7ef4\u57fa\u767e\u79d1[[zhwiki:Special:Permalink/39584592]]\n// <pre>\n!function(a){var c,b=new mw.Api;Twinkle.block=function(){Morebits.userIsInGroup(\"sysop\")&&mw.config.get(\"wgRelevantUserName\")&&Twinkle.addPortletLink(Twinkle.block.callback,\"\u5c01\u7981\",\"tw-block\",\"\u5c01\u7981\u76f8\u5173\u7528\u6237\")},Twinkle.block.callback=function(){var a,b,c,d;(mw.config.get(\"wgRelevantUserName\")!==mw.config.get(\"wgUserName\")||confirm(\"\u60a8\u5373\u5c06\u5c01\u7981\u81ea\u5df1\uff01\u786e\u8ba4\u8981\u7ee7\u7eed\u5417\uff1f\"))&&(a=new Morebits.simpleWindow(650,530),a.setTitle(\"\u5c01\u7981\u6216\u5411\"+mw.config.get(\"wgRelevantUserName\")+\"\u53d1\u51fa\u5c01\u7981\u6a21\u677f\"),a.setScriptName(\"Twinkle\"),a.addFooterLink(\"\u5c01\u7981\u6a21\u677f\",\"Wikipedia:\u6a21\u677f\u6d88\u606f/\u7528\u6236\u8a0e\u8ad6\u540d\u5b57\u7a7a\u9593#.E5.B0.81.E7.A6.81\"),a.addFooterLink(\"\u5c01\u7981\u65b9\u9488\",\"WP:BLOCK\"),a.addFooterLink(\"Twinkle\u5e2e\u52a9\",\"WP:TW/DOC#block\"),Twinkle.block.currentBlockInfo=void 0,Twinkle.block.field_block_options={},Twinkle.block.field_template_options={},b=new Morebits.quickForm(Twinkle.block.callback.evaluate),c=b.append({type:\"field\",label:\"\u64cd\u4f5c\u7c7b\u578b\"}),c.append({type:\"checkbox\",name:\"actiontype\",event:Twinkle.block.callback.change_action,list:[{label:\"\u5c01\u7981\u7528\u6237\",value:\"block\",tooltip:\"\u7528\u9009\u62e9\u7684\u9009\u9879\u5c01\u7981\u76f8\u5173\u7528\u6237\u3002\",checked:!0},{label:\"\u6dfb\u52a0\u5c01\u7981\u6a21\u677f\u5230\u7528\u6237\u5bf9\u8bdd\u9875\",value:\"template\",tooltip:\"\u5982\u679c\u6267\u884c\u5c01\u7981\u7684\u7ba1\u7406\u5458\u5fd8\u8bb0\u53d1\u51fa\u4fdd\u62a4\u6a21\u677f\uff0c\u6216\u4f60\u5c01\u7981\u4e86\u7528\u6237\u800c\u6ca1\u6709\u7ed9\u5176\u53d1\u51fa\u6a21\u677f\uff0c\u5219\u4f60\u53ef\u4ee5\u7528\u6b64\u6765\u53d1\u51fa\u5408\u9002\u7684\u6a21\u677f\u3002\",checked:!0}]}),b.append({type:\"field\",label:\"\u9884\u8bbe\",name:\"field_preset\"}),b.append({type:\"field\",label:\"\u6a21\u677f\u9009\u9879\",name:\"field_template_options\"}),b.append({type:\"field\",label:\"\u5c01\u7981\u9009\u9879\",name:\"field_block_options\"}),b.append({type:\"submit\",label:\"\u63d0\u4ea4\u301c\u5de5\u5177\u6d4b\u8bd5\u4e2d\uff0c\u8bf7\u68c0\u67e5\u6267\u884c\u7ed3\u679c\uff01\u301c\"}),d=b.render(),a.setContent(d),a.display(),d.root=d,Twinkle.block.fetchUserInfo(function(){Twinkle.block.transformBlockPresets();var a=document.createEvent(\"Event\");a.initEvent(\"change\",!0,!0),d.actiontype[0].dispatchEvent(a)}))},Twinkle.block.fetchUserInfo=function(d){b.get({format:\"json\",action:\"query\",list:\"blocks|users|logevents\",letype:\"block\",lelimit:1,bkusers:mw.config.get(\"wgRelevantUserName\"),ususers:mw.config.get(\"wgRelevantUserName\"),letitle:\"User:\"+mw.config.get(\"wgRelevantUserName\")}).then(function(a){var b=a.query.blocks[0],e=a.query.users[0];return Twinkle.block.isRegistered=!!e.userid,c=Twinkle.block.isRegistered?\"User:\"+mw.config.get(\"wgRelevantUserName\"):mw.config.get(\"wgRelevantUserName\"),b&&(b.disabletalk=void 0===b.allowusertalk,b.hardblock=void 0===b.anononly,Twinkle.block.currentBlockInfo=b),Twinkle.block.hasBlockLog=!!a.query.logevents.length,\"function\"==typeof d?d():void 0},function(b){Morebits.status.init(a('div[name=\"currentblock\"] span').last()[0]),Morebits.status.warn(\"\u6293\u53d6\u7528\u6237\u4fe1\u606f\u51fa\u9519\",b)})},Twinkle.block.callback.saveFieldset=function(b){Twinkle.block[a(b).prop(\"name\")]={},a(b).serializeArray().forEach(function(c){Twinkle.block[a(b).prop(\"name\")][c.name]=c.value})},Twinkle.block.callback.change_action=function(b){var d,e,f,h,i,j,k,g=a(b.target.form);Twinkle.block.callback.saveFieldset(a(\"[name=field_block_options]\")),Twinkle.block.callback.saveFieldset(a(\"[name=field_template_options]\")),g.find(\"[name=actiontype][value=block]\").is(\":checked\")&&(d=new Morebits.quickForm.element({type:\"field\",label:\"\u9884\u8bbe\",name:\"field_preset\"}),d.append({type:\"select\",name:\"preset\",label:\"\u9009\u62e9\u9884\u8bbe\uff1a\",event:Twinkle.block.callback.change_preset,list:Twinkle.block.callback.filtered_block_groups()}),f=new Morebits.quickForm.element({type:\"field\",label:\"\u5c01\u7981\u9009\u9879\",name:\"field_block_options\"}),f.append({type:\"div\",name:\"hasblocklog\",label:\" \"}),f.append({type:\"div\",name:\"currentblock\",label:\" \"}),f.append({type:\"select\",name:\"expiry_preset\",label:\"\u8fc7\u671f\u65f6\u95f4\uff1a\",event:Twinkle.block.callback.change_expiry,list:[{label:\"\u81ea\u5b9a\u4e49\",value:\"custom\",selected:!0},{label:\"\u65e0\u9650\u671f\",value:\"infinity\"},{label:\"3\u5c0f\u65f6\",value:\"3 hours\"},{label:\"12\u5c0f\u65f6\",value:\"12 hours\"},{label:\"24\u5c0f\u65f6\",value:\"24 hours\"},{label:\"31\u5c0f\u65f6\",value:\"31 hours\"},{label:\"36\u5c0f\u65f6\",value:\"36 hours\"},{label:\"48\u5c0f\u65f6\",value:\"48 hours\"},{label:\"60\u5c0f\u65f6\",value:\"60 hours\"},{label:\"72\u5c0f\u65f6\",value:\"72 hours\"},{label:\"1\u5468\",value:\"1 week\"},{label:\"2\u5468\",value:\"2 weeks\"},{label:\"1\u6708\",value:\"1 month\"},{label:\"3\u6708\",value:\"3 months\"},{label:\"6\u6708\",value:\"6 months\"},{label:\"1\u5e74\",value:\"1 year\"},{label:\"2\u5e74\",value:\"2 years\"},{label:\"3\u5e74\",value:\"3 years\"}]}),f.append({type:\"input\",name:\"expiry\",label:\"\u81ea\u5b9a\u4e49\u8fc7\u671f\u65f6\u95f4\",tooltip:\"\u60a8\u53ef\u4ee5\u4f7f\u7528\u76f8\u5bf9\u65f6\u95f4\uff0c\u5982\u201c1 minute\u201d\u6216\u201c19 days\u201d\uff1b\u6216\u7edd\u5bf9\u662f\u95f4\uff0c\u201cyyyymmddhhmm\u201d\uff08\u5982\u201c200602011405\u201d\u662f2006\u5e742\u67081\u65e514:05 UTC\u3002\uff09\",value:Twinkle.block.field_block_options.expiry||Twinkle.block.field_template_options.template_expiry}),h=[{checked:Twinkle.block.field_block_options.nocreate,label:\"\u7981\u6b62\u521b\u5efa\u5e10\u6237\",name:\"nocreate\",value:\"1\"},{checked:Twinkle.block.field_block_options.noemail,label:\"\u7535\u5b50\u90ae\u4ef6\u505c\u7528\",name:\"noemail\",value:\"1\"},{checked:Twinkle.block.field_block_options.disabletalk,label:\"\u4e0d\u80fd\u7f16\u8f91\u81ea\u5df1\u7684\u8ba8\u8bba\u9875\",name:\"disabletalk\",value:\"1\"}],Twinkle.block.isRegistered?h.push({checked:Twinkle.block.field_block_options.autoblock,label:\"\u81ea\u52a8\u5c01\u7981\",name:\"autoblock\",value:\"1\"}):h.push({checked:Twinkle.block.field_block_options.hardblock,label:\"\u963b\u6b62\u767b\u5f55\u7528\u6237\u4f7f\u7528\u8be5IP\u5730\u5740\u7f16\u8f91\",name:\"hardblock\",value:\"1\"}),h.push({checked:Twinkle.block.field_block_options.watchuser,label:\"\u76d1\u89c6\u8be5\u7528\u6237\u7684\u7528\u6237\u9875\u548c\u8ba8\u8bba\u9875\",name:\"watchuser\",value:\"1\"}),f.append({type:\"checkbox\",name:\"blockoptions\",list:h}),f.append({type:\"textarea\",label:\"\u7406\u7531\uff08\u4e3a\u4e86\u5c01\u7981\u65e5\u5fd7\uff09\uff1a\",name:\"reason\",value:Twinkle.block.field_block_options.reason}),Twinkle.block.currentBlockInfo&&f.append({type:\"hidden\",name:\"reblock\",value:\"1\"})),g.find(\"[name=actiontype][value=template]\").is(\":checked\")&&(e=new Morebits.quickForm.element({type:\"field\",label:\"\u6a21\u677f\u9009\u9879\",name:\"field_template_options\"}),e.append({type:\"select\",name:\"template\",label:\"\u9009\u62e9\u5bf9\u8bdd\u9875\u6a21\u677f\uff1a\",event:Twinkle.block.callback.change_template,list:Twinkle.block.callback.filtered_block_groups(!0),value:Twinkle.block.field_template_options.template}),e.append({type:\"input\",name:\"article\",display:\"none\",label:\"\u6761\u76ee\u94fe\u63a5\",value:\"\",tooltip:\"\u53ef\u4ee5\u968f\u901a\u77e5\u94fe\u63a5\u6761\u76ee\uff0c\u6bd4\u5982\u6270\u4e71\u7684\u4e3b\u76ee\u6807\u3002\u6ca1\u6709\u6761\u76ee\u9700\u8981\u94fe\u63a5\u5219\u8bf7\u7559\u7a7a\u3002\"}),g.find(\"[name=actiontype][value=block]\").is(\":checked\")||e.append({type:\"input\",name:\"template_expiry\",display:\"none\",label:\"\u5c01\u7981\u671f\u9650\uff1a\",value:\"\",tooltip:\"\u5c01\u7981\u65f6\u957f\uff0c\u598224\u5c0f\u65f6\u30012\u5468\u3001\u65e0\u9650\u671f\u7b49\u3002\"}),e.append({type:\"input\",name:\"block_reason\",label:\"\u201c\u7531\u4e8e\u2026\u60a8\u5df2\u88ab\u5c01\u7981\u201d\",display:\"none\",tooltip:\"\u53ef\u9009\u7684\u7406\u7531\uff0c\u7528\u4e8e\u66ff\u6362\u9ed8\u8ba4\u7406\u7531\u3002\u53ea\u5728\u5e38\u89c4\u5c01\u7981\u6a21\u677f\u4e2d\u6709\u6548\u3002\",value:Twinkle.block.field_template_options.block_reason}),g.find(\"[name=actiontype][value=block]\").is(\":checked\")&&e.append({type:\"checkbox\",name:\"blank_duration\",list:[{label:\"\u4e0d\u5728\u6a21\u677f\u4e2d\u5305\u542b\u5c01\u7981\u671f\u9650\",checked:Twinkle.block.field_template_options.blank_duration,tooltip:\"\u6a21\u677f\u5c06\u4f1a\u663e\u793a\u201c\u4e00\u6bb5\u65f6\u95f4\u201d\u800c\u4e0d\u662f\u5177\u4f53\u65f6\u957f\"}]}),i=a('<a id=\"twinkleblock-preivew-link\">\u9884\u89c8</a>'),i.off(\"click\").on(\"click\",function(){Twinkle.block.callback.preview(g[0])}),i.css({cursor:\"pointer\"}),e.append({type:\"div\",id:\"blockpreview\",label:[i[0]]}),e.append({type:\"div\",id:\"twinkleblock-previewbox\",style:\"display: none\"})),d?(j=g.find('fieldset[name=\"field_preset\"]')[0],j.parentNode.replaceChild(d.render(),j)):g.find('fieldset[name=\"field_preset\"]').hide(),f?(j=g.find('fieldset[name=\"field_block_options\"]')[0],j.parentNode.replaceChild(f.render(),j)):g.find('fieldset[name=\"field_block_options\"]').hide(),e?(j=g.find('fieldset[name=\"field_template_options\"]')[0],j.parentNode.replaceChild(e.render(),j),b.target.form.root.previewer=new Morebits.wiki.preview(a(b.target.form.root).find(\"#twinkleblock-previewbox\").last()[0])):g.find('fieldset[name=\"field_template_options\"]').hide(),Twinkle.block.hasBlockLog&&(k=a('<a target=\"_blank\" href=\"'+mw.util.getUrl(\"Special:Log\",{action:\"view\",page:mw.config.get(\"wgRelevantUserName\"),type:\"block\"})+'\">\u5c01\u7981\u65e5\u5fd7</a>)'),Morebits.status.init(a('div[name=\"hasblocklog\"] span').last()[0]),Morebits.status.warn(\"\u6b64\u7528\u6237\u66fe\u5728\u8fc7\u53bb\u88ab\u5c01\u7981\",k[0])),Twinkle.block.currentBlockInfo?(Morebits.status.init(a('div[name=\"currentblock\"] span').last()[0]),Morebits.status.warn(c+\"\u5df2\u88ab\u5c01\u7981\",\"\u63d0\u4ea4\u8bf7\u6c42\u6765\u7528\u7ed9\u5b9a\u7684\u9009\u9879\u91cd\u65b0\u5c01\u7981\"),Twinkle.block.callback.update_form(b,Twinkle.block.currentBlockInfo)):g.find(\"[name=actiontype][value=template]\").is(\":checked\")&&(g.find(\"[name=actiontype][value=block]\").is(\":checked\")?Twinkle.block.callback.change_preset(b):Twinkle.block.callback.change_template(b))},Twinkle.block.blockPresetsInfo={\"blocked proxy\":{expiry:\"2 years\",forAnonOnly:!0,nocreate:!0,nonstandard:!0,reason:\"{{blocked proxy}}\",sig:null},checkuserblock:{expiry:\"infinity\",nonstandard:!0,reason:\"{{checkuserblock}}\",sig:\"~~\"+\"~\"},\"checkuserblock-account\":{forRegisteredOnly:!0,expiry:\"1 month\",nonstandard:!0,reason:\"{{checkuserblock-account}}\",sig:\"~~\"+\"~\"},schoolblock:{forAnonOnly:!0,nocreate:!0,nonstandard:!0,reason:\"{{schoolblock}}\",sig:\"~~\"+\"~\"},\"uw-3block\":{autoblock:!0,expiry:\"24 hours\",nocreate:!0},\"uw-ablock\":{autoblock:!0,expiry:\"31 hours\",forAnonOnly:!0,nocreate:!0,reasonParam:!0},\"uw-bblock\":{forRegisteredOnly:!0},\"uw-block1\":{autoblock:!0,forRegisteredOnly:!0,nocreate:!0,reasonParam:!0},\"uw-block2\":{autoblock:!0,expiry:\"1 week\",forRegisteredOnly:!0,nocreate:!0,reasonParam:!0},\"uw-block3\":{autoblock:!0,expiry:\"infinity\",forRegisteredOnly:!0,nocreate:!0,reasonParam:!0},\"uw-dblock\":{autoblock:!0,nocreate:!0},\"uw-sblock\":{autoblock:!0,nocreate:!0},\"uw-ublock\":{expiry:\"infinity\",forRegisteredOnly:!0},\"uw-ublock|\u8bef\u5bfc\":{expiry:\"infinity\",reason:\"{{uw-ublock|\u8bef\u5bfc}}\",forRegisteredOnly:!0},\"uw-ublock|\u5ba3\u4f20\":{expiry:\"infinity\",reason:\"{{uw-ublock|\u5ba3\u4f20}}\",forRegisteredOnly:!0},\"uw-ublock|\u653b\u51fb|\u6216\u4fae\u8fb1\u6027\":{expiry:\"infinity\",reason:\"{{uw-ublock|\u653b\u51fb|\u6216\u4fae\u8fb1\u6027}}\",forRegisteredOnly:!0},\"uw-ublock|\u6df7\u6dc6\":{expiry:\"infinity\",reason:\"{{uw-ublock|\u6df7\u6dc6}}\",forRegisteredOnly:!0},\"uw-vblock\":{autoblock:!0,expiry:\"31 hours\",nocreate:!0}},Twinkle.block.transformBlockPresets=function(){a.each(Twinkle.block.blockPresetsInfo,function(a,b){b.summary=b.summary||b.reason,b.sig=void 0!==b.sig?b.sig:\"yes\",b.indefinite=b.indefinite||\"infinity\"===b.expiry||\"indefinite\"===b.expiry||\"never\"===b.expiry,b.expiry=!Twinkle.block.isRegistered&&b.indefinite?\"31 hours\":b.expiry||\"31 hours\",Twinkle.block.blockPresetsInfo[a]=b}),a.each(Twinkle.block.blockGroups,function(b,c){a.each(c.list,function(a,b){var d=b.value,e=b.label,f=d+\":\"+e;Twinkle.block.blockPresetsInfo[f]=jQuery.extend(!0,{},Twinkle.block.blockPresetsInfo[d]),Twinkle.block.blockPresetsInfo[f].template=d,c.meta?Twinkle.block.blockPresetsInfo[f].forRegisteredOnly=!1:e&&(Twinkle.block.blockPresetsInfo[f].reason=e),b.value=f})})},Twinkle.block.blockGroups=[{meta:!0,label:\"\u5c01\u7981\u6a21\u677f\",list:[{label:\"\u5c42\u7ea71\u5c01\u7981\",value:\"uw-block1\"},{label:\"\u5c42\u7ea72\u5c01\u7981\",value:\"uw-block2\"},{label:\"\u5c42\u7ea73\u5c01\u7981\",value:\"uw-block3\"},{label:\"\u533f\u540d\u5c01\u7981\",value:\"uw-ablock\"}]},{label:\"\u4e00\u822c\u7684\u5c01\u7981\u7406\u7531\",list:[{label:\"[[WP:VAN|\u7834\u574f]]\",value:\"uw-vblock\"},{label:\"[[WP:VAN#LANG|\u7e41\u7b80\u7834\u574f]]\",value:\"uw-block1\"},{label:\"\u8de8\u7ef4\u57fa\u9879\u76ee\u7834\u574f\",value:\"uw-block1\"},{label:\"[[WP:VOA|\u7eaf\u7834\u574f\u7528\u6237]]\",value:\"uw-block3\"},{label:\"[[WP:SOAP|\u6563\u53d1\u5e7f\u544a\u6216\u5ba3\u4f20]]\",value:\"uw-sblock\"},{label:\"\u4ec5[[WP:SOAP|\u6563\u53d1\u5e7f\u544a/\u5ba3\u4f20]]\u7684\u7528\u6237\",value:\"uw-block3\"},{label:\"\u8fdd\u53cd[[WP:3RR|\u56de\u9000\u4e0d\u8fc7\u4e09\u539f\u5219]]\",value:\"uw-3block\"},{label:\"\u65e0\u793c\u7684\u884c\u4e3a\u3001[[WP:NPA|\u653b\u51fb\u522b\u4eba]]\",value:\"uw-block1\"},{label:\"[[WP:\u9a9a\u6270|\u9a9a\u6270\u7528\u6237]]\",value:\"uw-block1\"},{label:\"[[WP:\u6270\u4e71|\u6270\u4e71]]\",value:\"uw-block1\"},{label:\"[[WP:GAME|\u6e38\u620f\u7ef4\u57fa\u89c4\u5219]]\",value:\"uw-block1\"},{label:\"\u786e\u8ba4\u4e3a[[WP:SOCK|\u5080\u5121]]\u6216[[WP:MEAT|\u771f\u4eba\u5080\u5121]]\",value:\"uw-block3\"},{label:\"\u6ee5\u7528[[WP:SOCK|\u5080\u5121]]\",value:\"uw-block1\"},{label:\"\u5c61\u6b21\u589e\u52a0\u4e0d\u5b9e\u8d44\u6599\",value:\"uw-block1\"},{label:\"\u5728\u6761\u76ee\u4e2d\u589e\u52a0\u65e0\u610f\u4e49\u6587\u5b57\",value:\"uw-block1\"},{label:\"\u65e0\u6545\u5220\u9664\u6761\u76ee\u5185\u5bb9\",value:\"uw-dblock\"},{label:\"\u591a\u6b21\u52a0\u5165[[WP:COPYVIO|\u4fb5\u72af\u7248\u6743]]\u7684\u5185\u5bb9\",value:\"uw-block1\"},{label:\"\u673a\u5668\u4eba\u53d1\u751f\u6545\u969c\u5e76\u5fc5\u987b\u7d27\u6025\u505c\u6b62\",value:\"uw-bblock\"}]},{label:\"\u7528\u6237\u540d\u5c01\u7981\",list:[{label:\"\",value:\"uw-ublock|\u8bef\u5bfc\"},{label:\"\",value:\"uw-ublock|\u5ba3\u4f20\"},{label:\"\",value:\"uw-ublock|\u653b\u51fb|\u6216\u4fae\u8fb1\u6027\"},{label:\"\",value:\"uw-ublock|\u6df7\u6dc6\"}]},{label:\"\u5176\u4ed6\u6a21\u677f\",list:[{label:\"\",value:\"uw-ublock\"},{label:\"\",value:\"schoolblock\"},{label:\"\",value:\"blocked proxy\"},{label:\"\",value:\"checkuserblock\"},{label:\"\",value:\"checkuserblock-account\"}]}],Twinkle.block.callback.filtered_block_groups=function(b){return a.map(Twinkle.block.blockGroups,function(c){if(b||!c.meta){var d=a.map(c.list,function(a){var c,d,e;if(Twinkle.block.currentBlockInfo||\"uw-talkrevoked\"!==a.value)return c=Twinkle.block.blockPresetsInfo[a.value],d=c.forRegisteredOnly?Twinkle.block.isRegistered:c.forAnonOnly?!Twinkle.block.isRegistered:!0,c.templateName&&b||!d?void 0:(e=c.templateName||c.template||a.value,{label:(b?\"{{\"+e+\"}}: \":\"\")+(a.label||\"{{\"+e+\"}}\"),value:a.value,data:[{name:\"template-name\",value:e}],selected:!!a.selected})});return d.length?{label:c.label,list:d}:void 0}})},Twinkle.block.callback.change_preset=function(a){var b=a.target.form.preset.value;b&&(a.target.form.template.value=Twinkle.block.blockPresetsInfo[b].templateName||b,a.target.form.template.value=b,Twinkle.block.callback.update_form(a,Twinkle.block.blockPresetsInfo[b]),Twinkle.block.callback.change_template(a))},Twinkle.block.callback.change_expiry=function(a){var b=a.target.form.expiry;\"custom\"===a.target.value?Morebits.quickForm.setElementVisibility(b.parentNode,!0):(Morebits.quickForm.setElementVisibility(b.parentNode,!1),b.value=a.target.value)},Twinkle.block.callback.update_form=function(b,d){var e=b.target.form,f=d.expiry;d.useInitialOptions||(Date.parse(f)?(f=new Date(f).toGMTString(),e.expiry_preset.value=\"custom\"):e.expiry_preset.value=d.expiry||\"custom\",e.expiry.value=f,\"custom\"===e.expiry_preset.value?Morebits.quickForm.setElementVisibility(e.expiry.parentNode,!0):Morebits.quickForm.setElementVisibility(e.expiry.parentNode,!1)),d.disabletalk=void 0!==d.disabletalk?d.disabletalk:!1,d.hardblock=void 0!==d.hardblock?d.hardblock:!1,Twinkle.block.isRegistered&&c.search(/bot$/i)>0&&(d.autoblock=!1),a(e.field_block_options).find(\":checkbox\").each(function(b,c){if(!d.useInitialOptions||void 0!==d[c.name]){var e=\"\"===d[c.name]||!!d[c.name];a(c).prop(\"checked\",e)}}),e.reason.value=d.prependReason&&d.reason?d.reason+\"; \"+e.reason.value:d.reason||\"\"},Twinkle.block.callback.change_template=function(b){var c=b.target.form,d=c.template.value,e=Twinkle.block.blockPresetsInfo[d];a(c).find(\"[name=actiontype][value=block]\").is(\":checked\")?Morebits.quickForm.setElementVisibility(c.blank_duration.parentNode,!e.indefinite&&!e.nonstandard):(e.indefinite||e.nonstandard?(null===Twinkle.block.prev_template_expiry&&(Twinkle.block.prev_template_expiry=c.template_expiry.value||\"\"),c.template_expiry.parentNode.style.display=\"none\",c.template_expiry.value=\"indefinite\"):\"none\"===c.template_expiry.parentNode.style.display&&(null!==Twinkle.block.prev_template_expiry&&(c.template_expiry.value=Twinkle.block.prev_template_expiry,Twinkle.block.prev_template_expiry=null),c.template_expiry.parentNode.style.display=\"block\"),Twinkle.block.prev_template_expiry&&(c.expiry.value=Twinkle.block.prev_template_expiry),Morebits.quickForm.setElementVisibility(c.notalk.parentNode,!e.nonstandard)),Morebits.quickForm.setElementVisibility(c.article.parentNode,!!e.pageParam),Morebits.quickForm.setElementVisibility(c.block_reason.parentNode,!!e.reasonParam),c.block_reason.value=e.reason||\"\",c.root.previewer.closePreview()},Twinkle.block.prev_template_expiry=null,Twinkle.block.prev_block_reason=null,Twinkle.block.prev_article=null,Twinkle.block.prev_reason=null,Twinkle.block.callback.preview=function(a){var b={article:a.article.value,blank_duration:a.blank_duration?a.blank_duration.checked:!1,disabletalk:a.disabletalk.checked||(a.notalk?a.notalk.checked:!1),expiry:a.template_expiry?a.template_expiry.value:a.expiry.value,hardblock:Twinkle.block.isRegistered?a.autoblock.checked:a.hardblock.checked,indefinite:/indef|infinity|never|\\*|max/.test(a.template_expiry?a.template_expiry.value:a.expiry.value),reason:a.block_reason.value,template:a.template.value.split(\":\",1)[0]},c=Twinkle.block.callback.getBlockNoticeWikitext(b);a.previewer.beginRender(c)},Twinkle.block.callback.evaluate=function(c){var i,d=a(c.target),e=d.find(\"[name=actiontype][value=block]\").is(\":checked\"),f=d.find(\"[name=actiontype][value=template]\").is(\":checked\"),g={},h={};if(Twinkle.block.callback.saveFieldset(d.find(\"[name=field_block_options]\")),Twinkle.block.callback.saveFieldset(d.find(\"[name=field_template_options]\")),g=Twinkle.block.field_block_options,h=Twinkle.block.field_template_options,h.disabletalk=!(!h.disabletalk&&!g.disabletalk),h.hardblock=!!g.hardblock,delete g.expiry_preset,h.summary=h.summary||g.reason,h.expiry=h.template_expiry||g.expiry,e){if(!g.expiry)return alert(\"\u8bf7\u63d0\u4f9b\u8fc7\u671f\u65f6\u95f4\uff01\");if(!g.reason)return alert(\"\u8bf7\u63d0\u4f9b\u5c01\u7981\u7406\u7531\uff01\");g.reason+=Twinkle.getPref(\"deletionSummaryAd\"),Morebits.simpleWindow.setButtonsEnabled(!1),Morebits.status.init(c.target),i=new Morebits.status(\"\u6267\u884c\u5c01\u7981\"),g.action=\"block\",g.user=mw.config.get(\"wgRelevantUserName\"),g.anononly=g.hardblock?void 0:!0,g.allowusertalk=g.disabletalk?void 0:!0,\"infinity\"===g.expiry&&(g.expiry=\"infinite\"),b.getToken(\"block\").then(function(a){i.status(\"\u5904\u7406\u4e2d\u2026\"),g.token=a;var b=new Morebits.wiki.api(\"\u6267\u884c\u5c01\u7981\",g,function(){i.info(\"\u5b8c\u6210\"),f&&Twinkle.block.callback.issue_template(h)});b.post()},function(){i.error(\"\u672a\u80fd\u6293\u53d6\u5c01\u7981\u4ee4\u724c\")})}else{if(!f)return alert(\"\u8bf7\u7ed9Twinkle\u70b9\u4e8b\u505a\uff01\");Morebits.simpleWindow.setButtonsEnabled(!1),Morebits.status.init(c.target),Twinkle.block.callback.issue_template(h)}},Twinkle.block.callback.issue_template=function(b){var e,c=\"User_talk:\"+mw.config.get(\"wgRelevantUserName\"),d=a.extend(b,{messageData:Twinkle.block.blockPresetsInfo[b.template],reason:Twinkle.block.field_template_options.block_reason,disabletalk:Twinkle.block.field_template_options.notalk});d.template=d.template.split(\":\",1)[0],Morebits.wiki.actionCompleted.redirect=c,Morebits.wiki.actionCompleted.notice=\"\u5b8c\u6210\uff0c\u5c06\u5728\u51e0\u79d2\u540e\u8f7d\u5165\u7528\u6237\u5bf9\u8bdd\u9875\",e=new Morebits.wiki.page(c,\"\u7528\u6237\u5bf9\u8bdd\u9875\u4fee\u6539\"),e.setCallbackParameters(d),e.setFollowRedirect(!0),e.load(Twinkle.block.callback.main)},Twinkle.block.callback.getBlockNoticeWikitext=function(a){var b=\"{{\",c=Twinkle.block.blockPresetsInfo[a.template];return c.nonstandard?b+=a.template:(b+=\"subst:\"+a.template,a.article&&c.pageParam&&(b+=\"|page=\"+a.article),/te?mp|^\\s*$|min/.exec(a.expiry)||(a.indefinite?b+=\"|indef=yes\":a.blank_duration||(b+=\"|time=\"+a.expiry)),Twinkle.block.isRegistered||a.hardblock||(b+=\"|anon=yes\"),a.reason&&(b+=\"|reason=\"+a.reason),a.disabletalk&&(b+=\"|notalk=yes\")),b+=\"|subst=subst:\",\"~~\"+\"~\"===c.sig?b+=\"}}--~~\"+\"~\":c.sig?(b+=\"|sig=\"+c.sig,b+=\"}}\"):b+=\"}}\",b},Twinkle.block.callback.main=function(a){for(var g,h,i,j,k,b=a.getPageText(),c=a.getCallbackParameters(),d=c.messageData,e=new Date,f=new RegExp(\"^==+\\\\s*\"+e.getUTCFullYear()+\"\u5e74\"+(e.getUTCMonth()+1)+\"\u6708\"+\"\\\\s*==+\",\"mg\");null!==(g=f.exec(b));)h=g;i=b.lastIndexOf(\"\\n==\")+1,b.length>0&&(b+=\"\\n\\n\"),c.indefinite=/indef|infinity|never|\\*|max/.test(c.expiry),Twinkle.getPref(\"blankTalkpageOnIndefBlock\")&&\"uw-lblock\"!==c.template&&c.indefinite?(Morebits.status.info(\"\u4fe1\u606f\",\"\u6839\u636e\u53c2\u6570\u8bbe\u7f6e\u6e05\u7a7a\u8ba8\u8bba\u9875\u5e76\u4e3a\u65e5\u671f\u521b\u5efa\u65b02\u7ea7\u6807\u9898\"),b=\"== \"+e.getUTCFullYear()+\"\u5e74\"+(e.getUTCMonth()+1)+\"\u6708 \"+\" ==\\n\"):h&&h.index===i||(Morebits.status.info(\"\u4fe1\u606f\",\"\u672a\u627e\u5230\u5f53\u6708\u6807\u9898\uff0c\u5c06\u521b\u5efa\u65b0\u7684\"),b+=\"== \"+e.getUTCFullYear()+\"\u5e74\"+(e.getUTCMonth()+1)+\"\u6708 \"+\" ==\\n\"),c.expiry=\"undefined\"!=typeof c.template_expiry?c.template_expiry:c.expiry,b+=Twinkle.block.callback.getBlockNoticeWikitext(c),j=d.templateName||d.template||d.value,k=\"{{\"+j+\"}}: \"+c.reason,d.suppressArticleInSummary!==!0&&c.article&&(k+=\"\uff0c\u4e8e[[\"+c.article+\"]]\"),k+=Twinkle.getPref(\"summaryAd\"),a.setPageText(b),a.setEditSummary(k),a.setWatchlist(Twinkle.getPref(\"watchWarnings\")),a.save()}}(jQuery);\n// </pre>"}}}