{"parse":{"title":"MediaWiki:Group-sysop.js","pageid":134287,"wikitext":{"*":"// <pre>\n/* \u8fd9\u91cc\u7684\u4efb\u4f55JavaScript\u5c06\u53ea\u4e3a\u7ba1\u7406\u5458\u52a0\u8f7d \n * \u8bf7\u5c0a\u91cd\u840c\u5a18\u767e\u79d1\u7248\u6743\uff0c\u4ee5\u4e0b\u4ee3\u7801\u590d\u5236\u9700\u8981\u6ce8\u660e\u539f\u81ea\u840c\u5a18\u767e\u79d1\uff0c\u5e76\u4e14\u9644\u4e0aURL\u5730\u5740http://zh.moegirl.org/MediaWiki:Group-sysop.js\n * \u7248\u6743\u534f\u5b9a\uff1a\u77e5\u8bc6\u5171\u4eab \u7f72\u540d-\u975e\u5546\u4e1a\u6027\u4f7f\u7528-\u76f8\u540c\u65b9\u5f0f\u5171\u4eab 3.0\n */\n(function($, mw) {\n    /* \u51fd\u6570\u5b9a\u4e49\u5757 */\n    //\u9996\u5b57\u6bcd\u5927\u5199\n    function toUpperFirstCase(t) {\n        return t[0].substring(0, 1).toUpperCase() + t.substring(1);\n    }\n    //\u68c0\u6d4b\u662f\u5426\u4f7f\u7528wikiplus\n    function useWikiplus() {\n        if (typeof wikiplus == 'object' || $(\"#MoeNotification\")[0]) return true;\n        else return false;\n    }\n    //\u9488\u5bf9\u4e0d\u540c\u7684\u73af\u5883\u8f93\u51fa\u4e0d\u540c\u7684\u5b57\u7b26\u4e32\n    function ifUseWikiplus(yT, nT) {\n        return (useWikiplus() ? yT : nT) + '';\n    }\n    //\u6dfb\u52a0\u5220\u9664\u539f\u56e0\u94fe\u63a5\n    function addLink($obj, act) {\n        var href = $obj.css(\"margin-right\", \"1em\")[0].href,\n            reasonPageName = href.slice(href.indexOf(\"title=\") + 6, href.indexOf(\"&action\"));\n        $obj.after('<a target=\"_blank\" href=\"/' + reasonPageName + '\">\u6d4f\u89c8' + act + '\u539f\u56e0</a>');\n    }\n    //\u9632\u6ee5\u7528\u8fc7\u6ee4\u5668\u76f8\u5173\n    function abuseLog() {\n        if ($(\".mw-special-AbuseLog\")[0]) {\n            $(\".plainlinks li\").each(function() {\n                if (($(this).text().indexOf(\"\u8fc7\u6ee4\u56681\u3002\") + $(this).text().indexOf(\"\u65e0\u5173\u7f51\u7ad9\u94fe\u63a5\") != -2) || ($(this).text().indexOf(\"\u8fc7\u6ee4\u566811\u3002\") + $(this).text().indexOf(\"\u7528\u6237\u9875\u9762\u4f7f\u7528\u9519\u8bef\u5206\u7c7b/\u6a21\u677f\") != -2)) $(this).addClass(\"AbuseFilterHidden\");\n            });\n            if ($(\".AbuseFilterHidden\")[0]) {\n                $(\"#mw-content-text > .mw-parser-output > form > fieldset\").append(\"<p/>\").find(\"p\").append($(\"<span/>\", {\n                    text: \"\u70b9\u51fb\u9690\u85cf/\u663e\u793a\u9632\u6ee5\u7528\u8fc7\u6ee4\u56681\u548c11\u7684\u65e5\u5fd7\uff1a\"\n                })).append($(\"<input/>\", {\n                    val: \"\u663e\u793a\",\n                    bind: {\n                        click: function() {\n                            if ($(\".AbuseFilterHidden\").is(\":hidden\")) {\n                                $(\".AbuseFilterHidden\").fadeIn();\n                                $(this).val(\"\u9690\u85cf\");\n                            } else {\n                                $(\".AbuseFilterHidden\").fadeOut();\n                                $(this).val(\"\u663e\u793a\");\n                            }\n                        }\n                    },\n                    attr: {\n                        type: \"button\"\n                    }\n                }));\n                $(\".AbuseFilterHidden\").hide();\n            }\n        }\n    }\n    //\u9632\u6ee5\u7528\u8fc7\u6ee4\u5668\u7f16\u8f91\u76f8\u5173\n    function abuseFilterEdit() {\n        var MAWI, selectOpt, selectVal;\n        $('#mw-abusefilter-edit-warn-message').each(function() { //\u5143\u7d20\u5206\u5f00\u64cd\u4f5c\uff0c\u7b80\u5316\u4f5c\u7528\u57df\u94fe\n            var self = $(this),\n                select = self.find('select').appendTo(self),\n                MWFP, MAWP, MWFC;\n            self.find('td').remove();\n            self.append('<td><fieldset><legend>\u4f7f\u7528\u73b0\u6709\u7684\u6d88\u606f</legend><table><tr><td class=\"mw-label\">\u7528\u4f5c\u8b66\u544a\u7684\u7cfb\u7edf\u6d88\u606f\uff1a</td><td class=\"mw-input\" id=\"mw-abusefilter-edit-warn-message-select\"></td></tr><tr><td class=\"mw-label\">\u64cd\u4f5c\uff1a</td><td class=\"mw-input\"><p><input id=\"MWFP\" type=\"button\" value=\"\u9884\u89c8\u6d88\u606f\"><input id=\"MWFC\" type=\"button\" value=\"\u6e05\u7a7a\u9884\u89c8\" style=\"display: none;\"><input id=\"MWFO\" type=\"button\" value=\"\u5728\u65b0\u7a97\u53e3\u6253\u5f00\"> </p></td></tr><tr><td id=\"MAWP\" colspan=\"2\"></td></tr><tr><td colspan=\"2\"><p>P.S.\u53ea\u6709\u8fd9\u91cc\u7684\u4e0b\u62c9\u680f\u8bbe\u7f6e\u7684\u7cfb\u7edf\u6d88\u606f\u624d\u662f\u9632\u6ee5\u7528\u8fc7\u6ee4\u5668\u4f7f\u7528\u7684\u7cfb\u7edf\u6d88\u606f\uff0c\u9694\u58c1\u662f\u521b\u5efa\u7528\u5566\uff01</p></td></tr><tr><td colspan=\"2\" id=\"MAWI\"></td></tr></table></fieldset></td>').find('#mw-abusefilter-edit-warn-message-select').append(select);\n            MWFP = self.find('#MWFP'), MAWP = self.find('#MAWP'), MWFC = self.find('#MWFC'), MWFO = self.find('#MWFO');\n            MAWI = self.find('#MAWI'), selectOpt = select.html(), selectVal = select.val(); //\u653e\u7f6e\u5230\u4e0a\u7ea7\u4f5c\u7528\u57df\u94fe\u4ee5\u4fbf\u5176\u4ed6\u5143\u7d20\u6267\u884c\n            MWFP.on('click', function() {\n                MAWP.load('//zh.moegirl.org/Mediawiki:' + select.val() + '?action=render');\n                MWFC.fadeIn();\n            });\n            MWFC.on('click', function() {\n                MAWP.empty();\n                MWFC.fadeOut();\n            });\n            MWFO.on('click', function() {\n                window.open('//zh.moegirl.org/Mediawiki:' + select.val(), '_blank');\n            });\n        });\n        $('#mw-abusefilter-edit-warn-other-label').each(function() {\n            var self = $(this),\n                MACN, MWCE, MWCV, MACT, pageName, preloadPage, select;\n            self.find('#mw-abusefilter-warn-message-other').css({\n                visibility: \"hidden\",\n                height: \"0\"\n            }).appendTo(MAWI);\n            self.empty();\n            self.append('<td><fieldset><legend>\u60f3\u8981\u521b\u5efa\uff0f' + ifUseWikiplus(\"\u6d4f\u89c8\", \"\u7f16\u8f91\") + '\u7684\u6d88\u606f\uff1a</legend><table><tr><td class=\"mw-label\">\u4f5c\u4e3a\u6a21\u677f\u7684\u7cfb\u7edf\u6d88\u606f\uff1a</td><td><select></select></td></tr><tr><td class=\"mw-label\"><p>\u60f3\u8981\u521b\u5efa\uff0f\u6d4f\u89c8\u7684\u6d88\u606f\uff1a</p><dl><dd>\uff08\u65e0\u987bMediaWiki\u524d\u7f00\uff09</dd></dl></td><td class=\"mw-input\"><input size=\"45\" id=\"MACN\"></td><tr><td class=\"mw-label\">\u64cd\u4f5c\uff1a</td><td><input type=\"button\" id=\"MWCEVB\"></td></tr><tr><td colspan=\"2\" id=\"MACT\"></td></tr></table></fieldset></td>');\n            MACN = self.find('#MACN').val(selectVal), MWCEVB = self.find('#MWCEVB').val(ifUseWikiplus(\"\u521b\u5efa\uff0f\u6d4f\u89c8\u6240\u9009\u6d88\u606f\", \"\u521b\u5efa\uff0f\u7f16\u8f91\u6240\u9009\u6d88\u606f\")), MWCV = self.find('#MWCV'), MACT = self.find('#MACT'), select = self.find('select').html(selectOpt).val(selectVal);\n            MACT.text('P.S.\u70b9\u51fb\u6309\u94ae\u540e' + ifUseWikiplus(\"\u5982\u679c\u8f93\u5165\u6846\u5185\u6240\u6307\u6d88\u606f\u5b58\u5728\u5219\u5728\u65b0\u6807\u7b7e\u9875\u8bbf\u95ee\u8be5\u6d88\u606f\u9875\u9762\uff0c\u5426\u5219\u5219\u6253\u5f00\u4e00\u4e2a\u521b\u5efa\u8be5\u6d88\u606f\u7684\u65b0\u6807\u7b7e\u9875\", \"\u6253\u5f00\u4e00\u4e2a\u521b\u5efa/\u7f16\u8f91\u8be5\u6d88\u606f\u7684\u65b0\u6807\u7b7e\u9875\"));\n            MWCEVB.on('click', function() {\n                pageName = 'Mediawiki:' + MACN.val(), preloadPage = 'Mediawiki:' + select.val();\n                $.ajax({\n                    url: \"//zh.moegirl.org/api.php\",\n                    beforeSend: function() {\n                        MACT.text(\"\u6b63\u5728\u68c0\u67e5\");\n                    },\n                    type: 'POST',\n                    data: {\n                        action: 'query',\n                        titles: pageName,\n                        format: 'json',\n                        converttitles: ' zh-cn'\n                    },\n                    success: function(data) {\n                        if (data.query.pages['-1']) {\n                            MACT.text('\u8be5\u6d88\u606f\u4e0d\u5b58\u5728\uff01\u5373\u5c06\u4ece\u65b0\u6807\u7b7e\u9875\u8bbf\u95ee\u8be5\u6d88\u606f\u9875\u9762\u7684\u521b\u5efa\u9875\uff01');\n                            window.setTimeout(function() {\n                                window.open('//zh.moegirl.org/index.php?preload=' + preloadPage + '&action=edit&title=' + pageName, '_blank');\n                            }, 1730);\n                        } else {\n                            MACT.text('\u8be5\u6d88\u606f\u5b58\u5728\uff01\u5373\u5c06\u4ece\u65b0\u6807\u7b7e\u9875\u8bbf\u95ee\u8be5\u6d88\u606f' + ifUseWikiplus('\uff01', '\u7684\u7f16\u8f91\u9875\uff01'));\n                            window.setTimeout(function() {\n                                window.open(ifUseWikiplus('//zh.moegirl.org/', '//zh.moegirl.org/index.php?action=edit&title=') + pageName, '_blank');\n                            }, 1730);\n                        }\n                    },\n                    error: function() {\n                        MACT.text('\u5bff\u53f8\u5a18\u6765\u88ad\uff01\u65e0\u6cd5\u68c0\u6d4b\u9875\u9762\u662f\u5426\u5b58\u5728\uff01\u5373\u5c06\u4ece\u65b0\u6807\u7b7e\u9875\u8bbf\u95ee\u8be5\u6d88\u606f\u9875\u9762\u7684\u7f16\u8f91/\u521b\u5efa\u9875\uff01');\n                        window.setTimeout(function() {\n                            window.open('//zh.moegirl.org/index.php?preload=' + preloadPage + '&action=edit&title=' + pageName, '_blank');\n                        }, 1730);\n                    }\n                });\n            });\n        });\n        $('#mw-abusefilter-edit-warn-actions').remove();\n    }\n    //\u9632\u6ee5\u7528\u8fc7\u6ee4\u5668\u9884\u52a0\u8f7d\u76f8\u5173\n    function widgetPreload() {\n        if (mw.config.get('wgAction') === 'edit') {\n            var regex = /[-_,.\\/\\\\]/;\n            if (regex.test(mw.config.get('wgPageName'))) {\n                window.onbeforeunload = undefined;\n                $(window).off(\"beforeunload\");\n                location.replace('https://zh.moegirl.org/index.php?action=edit&title=' + mw.config.get('wgPageName').replace(/ |_/g, '').replace(/^([^\\/]*)[\\/\\\\].*$/i, '$1').split(regex).map(function(n) { return toUpperFirstCase(n); }).join(''));\n                return;\n            }\n            var flag = (\"wg\" + mw.config.get('wgTitle')).replace(/ /g, '');\n            $(\"#wpTextbox1\").val(\"<noinclude> </noinclude><includeonly><!--{if !isset($\" + flag + \") || !$\" + flag + '}--><!--{assign var=\"' + flag + '\" value=true scope=\"global\"}--><script>\\nwindow.RLQ = window.RLQ || [];\\nwindow.RLQ.push(function(){\\n\\n});</script><!--{/if}--></includeonly>');\n        }\n        if ($('#mw-content-text > .mw-parser-output > .noarticletext')[0]) $(document.body).addClass('noWidget');\n    }\n    //\u9632\u6ee5\u7528\u8fc7\u6ee4\u5668\u5217\u8868\n    function widgetList() {\n        var idList = $('.TablePager_col_af_id a'),\n            lvList = $('.TablePager_col_af_hidden'),\n            idLength = idList.last().text().length;\n        idList.each(function() {\n            var zero = '';\n            while ($(this).text().length + zero.length < idLength) zero += '0';\n            $(this).prepend('<span style=\"speak:none;visibility:hidden;color:transparent;\">' + zero + '</span>');\n        });\n        lvList.each(function() {\n            if ($(this).text().length == 2) $(this).prepend('<span style=\"speak:none;visibility:hidden;color:transparent;\">\u5df2</span>');\n        });\n    }\n    // \u4eceMediaWiki\u62f7\u8fc7\u6765\u7684\u7528\u4e8e\u52a8\u6001\u4fee\u6539\u4fa7\u8fb9\u680f\n    function modifySidebar(action, section, name, link) {\n        try {\n            var target = {\n                'languages': '#p-lang',\n                'toolbox': '#p-tb'\n            } [section] || '#p-' + section;\n            if (action == 'add') $(target).find('div:first ul:first').append('<li class=\"plainlinks\"><a href=\"' + link + '\">' + name + '</a></li>');\n            if (action == 'remove') $(target).find('div:first ul:first li a[href=\"' + link + '\"][title=\"' + name + '\"]').parent().hide();\n        } catch (e) {\n            console.debug('modifySidebar', e); // let's just ignore what's happened\n        }\n    }\n    //\u8bc4\u8bba\u680f\u7ba1\u7406\u94fe\u63a5\n    function flowthreadAdminLink() {\n        var link = $('<div/>', {\n                id: 'flowthreadAdminLink',\n                css: {\n                    'font-size': '12px',\n                    'color': '#999',\n                    'text-align': 'right'\n                }\n            }).append('<a href=\"//zh.moegirl.org/MediaWiki:Flowthread-Articleblacklist\" style=\"margin-right:8px;\" target=\"_blank\">\u7981\u6b62\u8bc4\u8bba\u540d\u5355</a>')\n            .append('<a href=\"//zh.moegirl.org/MediaWiki:Flowthread-blacklist\" style=\"margin-right:8px;\" target=\"_blank\">\u5173\u952e\u8bcd\u8fc7\u6ee4\u540d\u5355</a>')\n            .append('<a href=\"//zh.moegirl.org/Special:%E7%AE%A1%E7%90%86FlowThread%E8%AF%84%E8%AE%BA\" target=\"_blank\">\u8bc4\u8bba\u7ba1\u7406</a>');\n        $('#content > div.comment-replybox').append(link);\n    }\n    //i18n\u8bed\u8a00\u94fe\u63a5\n    function i18nLink() {\n        $('#mw-content-text a.new[href$=\"/zh-cn\"], #mw-content-text a.new[href$=\"/zh-tw\"]').each(function(_, ele) {\n            $(ele).removeClass('new').attr({\n                title: ele.title.replace(/\\/zh-[a-z]+|\uff08\u9875\u9762\u4e0d\u5b58\u5728\uff09/g, ''),\n                href: ele.href.replace(/\\/zh-[a-z]+/g, '')\n            });\n        });\n    }\n    /* \u51fd\u6570\u6267\u884c\u5757 */\n    $(function() {\n        //\u9632\u6ee5\u7528\u8fc7\u6ee4\u5668\u7f16\u8f91\u76f8\u5173\n        if ($('body.mw-special-AbuseFilter')[0] && $('#mw-abusefilter-warn-parameters')[0]) abuseFilterEdit();\n        //Widget\u9884\u52a0\u8f7d\u6a21\u677f\n        if (mw.config.get('wgNamespaceNumber') == 274 && !mw.config.get('wgCurRevisionId')) widgetPreload();\n        //\u5220\u9664\u4fdd\u62a4\u539f\u56e0\u6d4f\u89c8\u94fe\u63a5\n        if (window.location.href.indexOf(\"action=delete\") != -1) {\n            if ($(\".mw-delete-editreasons\")[0]) addLink($(\".mw-delete-editreasons a\"), '\u5220\u9664');\n            if ($(\".mw-filedelete-editreasons\")[0]) addLink($(\".mw-filedelete-editreasons a\"), '\u5220\u9664');\n        }\n        if (window.location.href.indexOf(\"action=protect\") != -1 && $(\".mw-protect-editreasons\")[0]) addLink($(\".mw-protect-editreasons a\"), '\u4fdd\u62a4');\n        //\u9632\u6ee5\u7528\u8fc7\u6ee4\u5668\u65e5\u5fd7\n        abuseLog();\n        //\u9632\u6ee5\u7528\u8fc7\u6ee4\u5668\u5217\u8868\n        if ($('.mw-special-AbuseFilter')[0]) widgetList();\n        //i18n\u8bed\u8a00\u94fe\u63a5\n        //\u8bc4\u8bba\u7ba1\u7406\n        setInterval(function() {\n            i18nLink();\n            if ($('.comment-container,.comment-paginator,.comment-replybox')[0] && !$(\"#flowthreadAdminLink\")[0]) flowthreadAdminLink();\n        }, 100);\n    });\n})(jQuery, mediaWiki);\n// </pre>"}}}