{"parse":{"title":"User:\u6771\u6771\u541b/js/contentBackup.js","pageid":309558,"wikitext":{"*":"/*\n\t\u8fd9\u662f\u4e00\u4e2a\u4fdd\u5b58\u7f16\u8f91\u5185\u5bb9\u7684\u5c0f\u63d2\u4ef6\uff0c\u8f7d\u5165\u540e\u5c06\u5728\u201c\u663e\u793a\u66f4\u6539\u201d\u6309\u94ae\u540e\u751f\u6210\u4e00\u4e2a\u201c\u8fd8\u539f\u5907\u4efd\u201d\u6309\u94ae\u3002\t\n\t\u840c\u767e\u672c\u8eab\u6709\u4e00\u4e2a\u7f13\u5b58\u7f16\u8f91\u7684\u5185\u5bb9\u7684\u63d2\u4ef6\uff0c\u4f46\u662f\u6211\u7528\u5f97\u611f\u89c9\u5f88\u8ff7\uff0c\u66fe\u7ecf\u4e24\u6b21\u5728\u5f00\u4e86\u90a3\u4e2a\u63d2\u4ef6\u7684\u60c5\u51b5\u4e0b\u63d0\u4ea4\u7f16\u8f91\u540e\u53d1\u751f\u7f51\u7edc\u9519\u8bef\uff0c\n\t\u7136\u800c\u518d\u6b21\u56de\u5230\u7f16\u8f91\u9875\u9762\u540e\u5374\u65e0\u6cd5\u8fd8\u539f\uff0c\u4e0d\u77e5\u9053\u662f\u6709Bug\u8fd8\u662f\u6211\u6ca1\u7528\u597d\u3002\n\t\n\t\u8fd9\u4e2a\u63d2\u4ef6\u5c06\u5728\u70b9\u51fb\u201c\u63d0\u4ea4\u7f16\u8f91\u3001\u663e\u793a\u9884\u89c8\u3001\u663e\u793a\u66f4\u6539\u201d\u4e2d\u4efb\u610f\u4e00\u4e2a\u6309\u94ae\u65f6\u5907\u4efd\u5f53\u524d\u7684\u7f16\u8f91\u3002\u5f53\u5b58\u5728\u5907\u4efd\u65f6\uff0c\u201c\u8fd8\u539f\u5907\u4efd\u201d\u6309\u94ae\u53d8\u4e3a\u53ef\u4ee5\u70b9\u51fb\u3002\n\t\u5907\u4efd\u4f1a\u4fdd\u5b587\u5929\uff0c7\u5929\u540e\u81ea\u52a8\u6e05\u9664\u3002\n*/\n$(function(){\n  if(! /action=(edit|submit)/.test(location.href)){ return }\n\n  var editBox = $('#wpTextbox1'),\n  btns = $('#wpSaveWidget, #wpPreviewWidget, #wpDiffWidget'),\n  title = decodeURIComponent(location.search.match(/title=([^&]+)/)[1]),\n  backupList = JSON.parse(localStorage.getItem('Moegirl-koharubiyori-editBackup') || '{}')\n  \n  $.each(backupList, function(key, val){\n  \tvar time = new Date().getTime()\n  \tif(val.expires < time){\n  \t\tdelete backupList[key]\n  \t}\n  })\n\n\tsetTimeout(function(){\n\t  var backup = backupList[title]\n\t  if(backup){\n\t\tvar btn = $('<span class=\"oo-ui-widget oo-ui-widget-enabled oo-ui-inputWidget oo-ui-buttonElement oo-ui-buttonElement-framed oo-ui-labelElement oo-ui-buttonInputWidget\"><input type=\"button\" value=\"\u8fd8\u539f\u5907\u4efd\" class=\"oo-ui-inputWidget-input oo-ui-buttonElement-button\" /></span>')\n\t\t.click(function(){ \n\t\t\teditBox.val(backup.content)\n\t    \tmw.notify('\u5df2\u8fd8\u539f\u5907\u4efd\uff01', { type: 'warn' })     \n\t\t})    \t\n\t  }else{\n\t  \tvar btn = $('<span class=\"oo-ui-widget oo-ui-inputWidget oo-ui-buttonElement oo-ui-buttonElement-framed oo-ui-labelElement oo-ui-buttonInputWidget oo-ui-widget-disabled\"><input type=\"button\" value=\"\u8fd8\u539f\u5907\u4efd\" class=\"oo-ui-inputWidget-input oo-ui-buttonElement-button\" disabled /></span>')\n\t  }\n\t  $('#wpDiffWidget').after(btn)\n\t})\n\n  btns.mousedown(function(e){\n      var content = editBox.val()\n\t  var expire = new Date().getTime() + 1000 * 60 * 60 * 24 * 7\n\t  backupList[title] = {\n\t  \texpires : expire,\n\t  \tcontent : content\n\t  }\n\t  localStorage.setItem('Moegirl-koharubiyori-editBackup', JSON.stringify(backupList))\n  })\n})"}}}