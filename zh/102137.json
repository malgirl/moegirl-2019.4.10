{"parse":{"title":"MediaWiki:Gadget-Purgecache.js","pageid":5037,"wikitext":{"*":"// <pre>\n$(function(){\n    mw.loader.using(\"moment\").then(function() {\n        var li = $('<li/>').appendTo(\"#p-personal > ul\"),\n            textNode = $('<span/>'),\n            containerNode;\n        if (mw.config.get('wgNamespaceNumber') === -1) {\n            containerNode = $('<span/>');\n            containerNode.css({\n                'cursor': 'default',\n                'user-select': 'none'\n            });\n            containerNode.append('\u7279\u6b8a\u9875\u9762\uff08').append(textNode).append('\uff09');\n        } else {\n            containerNode = $('<a/>');\n            var statusNode = $('<span/>').text('\u5f3a\u5236\u5237\u65b0\u9875\u9762'),\n                runningStatus = false;\n            containerNode.attr(\"href\", 'javascript:void(0);');\n            containerNode.append(statusNode).append('\uff08').append(textNode).append('\uff09');\n            containerNode.on('click', function() {\n                if (runningStatus) return;\n                statusNode.text('\u6b63\u5728\u5f3a\u5236\u5237\u65b0\u9875\u9762\u2026\u2026');\n                statusNode.prepend('<img src=\"https://static.mengniang.org/common/d/d1/Windows_10_loading.gif\" style=\"height: 1em; margin-top: -.25em;\">');\n                runningStatus = true;\n                var api = new mw.Api(),\n                    opt = {\n                        action: 'purge',\n                        format: 'json',\n                        forcelinkupdate: true,\n                        titles: mw.config.get('wgPageName')\n                    };\n                api.post(opt).then(function() {\n                    setTimeout(function() {\n                        api.post(opt).then(function() {\n                            statusNode.text('\u5f3a\u5236\u5237\u65b0\u9875\u9762\u6210\u529f\uff01');\n                            setTimeout(location.reload.bind(location), 1000);\n                        }, function() {\n                            statusNode.text('\u5f3a\u5236\u5237\u65b0\u9875\u9762\u5931\u8d25\uff0c\u70b9\u51fb\u53ef\u91cd\u8bd5\uff01');\n                            runningStatus = false;\n                            setTimeout(function() {\n                                if (!runningStatus) statusNode.text('\u5f3a\u5236\u5237\u65b0\u9875\u9762');\n                            }, 5000);\n                        });\n                    }, 370);\n                }, function() {\n                    statusNode.text('\u5f3a\u5236\u5237\u65b0\u9875\u9762\u5931\u8d25\uff0c\u70b9\u51fb\u53ef\u91cd\u8bd5\uff01');\n                    runningStatus = false;\n                    setTimeout(function() {\n                        if (!runningStatus) statusNode.text('\u5f3a\u5236\u5237\u65b0\u9875\u9762');\n                    }, 5000);\n                });\n            });\n        }\n        li.append(containerNode);\n        textNode.text(moment().format('A h[:]mm[:]ss'));\n        var date = new Date();\n        var now = date.getTime();\n        date.setMilliseconds(0);\n        date.setSeconds(date.getSeconds() + 1);\n        setTimeout(function() {\n            setInterval(function() {\n                textNode.text(moment().format('A h[:]mm[:]ss'));\n            }, 1e3);\n            textNode.text(moment().format('A h[:]mm[:]ss'));\n        }, date.getTime() - now);\n    });\n});\n// </pre>"}}}