{"parse":{"title":"\u6a21\u5757:SectionEmbed","pageid":306580,"wikitext":{"*":"local module = {}\n\nlocal getArgs = require('Module:Arguments').getArgs\n\nfunction errorMsg(text)\n\terror(text..'[[\u5206\u7c7b:\u542b\u6709\u9519\u8bef\u5d4c\u5165\u7247\u6bb5\u7684\u9875\u9762]]')\nend\n\nfunction module._main(args, frame)\n\tlocal titleName = args['page'] or ''\n\tif titleName == '' then errorMsg('\u8bf7\u4f20\u5165\u8981\u8f7d\u5165\u5185\u5bb9\u6240\u5728\u7684\u9875\u9762\uff01') end\n\tlocal section = args['id'] or ''\n\tsection = string.gsub(section, '([%%%(%)%.%+%-%*%?%[%]%^%$])', '%%%1')\n\tlocal params = args\n\tparams['page'] = nil\n\tparams['id'] = nil\n\t\n\tlocal title = mw.title.new(titleName)\n\tlocal redirect = ''\n\tlocal content = title:getContent()\n\tif content == nil then errorMsg('\u9875\u9762\u540d\u65e0\u6548\uff0c\u8bf7\u786e\u8ba4\u4f20\u5165\u7684\u9875\u9762\u540d\u662f\u5426\u6b63\u786e\uff01') end\n\tif string.find(content, '^#REDIRECT%s+%[%[.+%]%]%s*$') or string.find(content, '^#\u91cd\u5b9a\u5411%s+%[%[.+%]%]%s*$') then\n\t\tredirect = string.gsub(content, '.+%[%[(.+)%]%]%s*$', '%1')\n\t\ttitle = mw.title.new(redirect)\n\t\tcontent = title:getContent()\t\t\n\t\tif content == nil then errorMsg('\u4f20\u5165\u7684\u9875\u9762\u3010'..titleName..'\u3011\u4e3a\u4e00\u4e2a\u91cd\u5b9a\u5411\u9875\uff0c\u5e76\u4e14\u5b83\u6307\u5411\u7684\u9875\u9762\u3010'..redirect..'\u3011\u65e0\u6548\uff01') end\n\tend\n\t\n\tlocal redirectMsg = ''\n\tif redirect ~= '' then redirectMsg = '\uff08\u91cd\u5b9a\u5411\u81f3'..redirect..'\uff09' end\n\n\tlocal ptn = '^(.-)<!%-%-%s*embed:?%s*'..(((section ~= '') and section) or '.-')..\n\t\t\t\t'%s*%-%->%s*(.-)%s*<!%-%-%s*embed%-end:?%s*'..(((section ~= '') and section) or '.-')..\n\t\t\t\t'%s*%-%->.-$'\n\tlocal sample = content\n\tcontent = mw.ustring.gsub(content, ptn, function(s1, s2) \n\t\ts1 = string.gsub(s1, '([^\\n]*)\\n', function(s3)\n\t\t\tif string.find(s3, '^(==?=?=?[^\\n]-==?=?=?)$') then \n\t\t\t\treturn s3..'\\n'\n\t\t\telse\n\t\t\t\treturn ''\n\t\t\tend\n\t\tend)\n\t\t\n\t\tlocal frame_child = frame:newChild({ title = (((redirect ~= '') and redirect) or titleName), args = params })\t\t\n\t\treturn string.gsub(frame_child:preprocess(s1..'\\n@@@sectionEmbed-target@@@sectionEmbed-target@@@\\n'..s2),\n\t\t\t\t'^.-\\n@@@sectionEmbed%-target@@@sectionEmbed%-target@@@\\n(.-)$', '%1')\n\tend)\n\tif sample == content then\n\t\tif section ~= '' then\n\t\t\terrorMsg('\u5d4c\u5165\u5931\u8d25\uff0c\u8bf7\u786e\u8ba4\u5728\u9875\u9762\u3010'..titleName..'\u3011'..redirectMsg..'\u662f\u5426\u5b58\u5728id\u4e3a\u201c'..section..'\u201d\u7684embed\u5d4c\u5165\u6807\u8bb0\uff0c\u5e76\u68c0\u67e5\u4e66\u5199\u662f\u5426\u6b63\u786e\uff01')\t\n\t\telse\n\t\t\terrorMsg('\u5d4c\u5165\u5931\u8d25\uff0c\u8bf7\u786e\u8ba4\u5728\u9875\u9762\u3010'..titleName..'\u3011'..redirectMsg..'\u662f\u5426\u5b58\u5728embed\u5d4c\u5165\u6807\u8bb0\uff0c\u5e76\u68c0\u67e5\u4e66\u5199\u662f\u5426\u6b63\u786e\uff01')\t\n\t\tend\n\tend\n\treturn content\nend\n\nfunction module.main(frame)\n\tlocal args = getArgs(frame)\n\treturn module._main(args, frame)\nend\n\nreturn module"}}}