{"parse":{"title":"\u6a21\u5757:Var-array","pageid":307688,"wikitext":{"*":"local module = {}\n\nfunction module.new(name, array)\n\tlocal frame = mw.getCurrentFrame()\n\tfunction foo(name, array)\n\t\tname = '@array-innerArrayIdentifier:'..name\n\t\tframe:callParserFunction( '#vardefine', name, name)\n\t\tframe:callParserFunction( '#vardefine', name..'.count', 0)\n\t\tfor i, v in ipairs(array) do\n\t\t\tif type(v) == 'table' then\n\t\t\t\tlocal innerArrayName = name..math.random()\n\t\t\t\tfoo(innerArrayName, v)\n\t\t\t\tv = '@array-innerArrayIdentifier:'..innerArrayName\n\t\t\tend\n\t\t\tframe:callParserFunction( '#vardefine', name..i, v)\t\t\n\t\t\tframe:callParserFunction( '#vardefine', name..'.count', i)\n\t\tend\t\t\n\tend\n\tfoo(name, array)\n\t\n\treturn name\nend\n\nfunction module.get(name)\n\tlocal frame = mw.getCurrentFrame()\n\tif type(name) == 'nil' then return nil end\n\tlocal time = 0\n\tfunction foo(name)\n\t\tlocal array = {}\n\t\t\n\t\ttime = time + 1\n\t\tif time == 1 then\n\t\t\tname = '@array-innerArrayIdentifier:'..name\n\t\tend\n\t\t\n\t\tlocal count = frame:callParserFunction( '#var', name..'.count')\t\t\n\t\tif count == '' then return false end\n\t\tfor i=1, count do\n\t\t\tlocal val = frame:callParserFunction('#var', name..i)\n\t\t\tif string.find(val, '^@array%-innerArrayIdentifier:') then\n\t\t\t\tarray[i] = foo(val)\n\t\t\telse\n\t\t\t\tarray[i] = val\n\t\t\tend\n\t\tend\n\t\treturn array\n\tend\n\t\n\treturn foo(name)\nend\n\nreturn module"}}}