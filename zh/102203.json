{"parse":{"title":"MediaWiki:Gadget-rollbackEverything.js","pageid":161986,"wikitext":{"*":"// <pre>\n$(function() {\n    var rollbackLinks = $('span.mw-rollback-link');\n    function wgULS(hans, hant){\n        var ret = {\n            'zh': hans || hant,\n            'zh-hans': hans,\n            'zh-hant': hant,\n            'zh-cn': hans,\n            'zh-sg': hans,\n            'zh-tw': hant,\n            'zh-hk': hant,\n            'zh-mo': hant\n        }\n        return ret[mw.config.get('wgUserLanguage')] || hans || hant;\n    }\n    if (!rollbackLinks[0] || document.title.indexOf(wgULS(\"\u7528\u6237\u8d21\u732e\", \"\u7528\u6236\u8ca2\u737b\")) == -1) return;\n    $(mw.util.addPortletLink('p-views', 'javascript:void(0)', '\u6279\u91cf\u56de\u9000', 'ca-rollbackEverything', wgULS('\u56de\u9000\u672c\u9801\u7684\u6240\u6709\u7de8\u8f2f'))).on('click', function() {\n        if(!window.confirm('\u4f60\u786e\u5b9a\u771f\u7684\u8981\u56de\u9000\u6b64\u7528\u6237\u7684\u6240\u6709\u7f16\u8f91\uff1f')) return;\n        $('body').css('overflow', 'hidden').append($('<div/>', {\n                css: {\n                    position: 'fixed',\n                    top: 0,\n                    left: 0,\n                    width: '100%',\n                    height: '100%',\n                    'background-color': 'rgba(0,0,0,0.73)',\n                    'z-index': 101\n                }\n            })\n            .append($('<div>', {\n                    css: {\n                        width: '10em',\n                        padding: '2em',\n                        border: '#a7d7f9 3px solid',\n                        'border-radius': '3px',\n                        'text-align': 'center ',\n                        'background-color': 'white',\n                        'margin': $(window).height() / 4 + 'px auto 0'\n                    },\n                    text: '\u6b63\u5728\u6279\u91cf\u56de\u9000\u2026\u2026'\n                })\n                .append('<div><span id=\"rbt\">0</span>/' + rollbackLinks.length + '</div><div id=\"cancel\" style=\"width:2em;padding:0.5em 1em;color:white;background:rgba(255,0,0,0.73);box-shadow: 3px 3px 3px -2px black;margin: auto;cursor: pointer;\">\u53d6\u6d88</div>')));\n        var rbt = $('#rbt'),\n            length = rollbackLinks.length,\n            flag = true;\n        $('#cancel').on('click', function(){\n            $(this).css('background', '#aaa')\n            flag = false;\n        });\n        rollbackLinks.each(function() {\n            var obj = {};\n            if (mw.config.get('wgRollbackTool') == 'inited') obj = $(this).find('a').data();\n            else {\n                $(this).attr('href').slice(11).split('&').forEach(function(v) {\n                    var arr = v.split('=');\n                    obj[arr[0]] = decodeURIComponent(arr[1]);\n                });\n            }\n            $.ajax({\n                url: 'https://zh.moegirl.org/api.php',\n                type: 'POST',\n                data: {\n                    title: obj.title,\n                    user: obj.from,\n                    summary: '\u6279\u91cf\u56de\u9000',\n                    token: obj.token,\n                    action: 'rollback',\n                    format: 'json'\n                },\n                beforeSend: function(){\n                    return flag;\n                },\n                success: function(d) {\n                    if (!d.error) rbt.text(+rbt.text() + 1);\n                    if (!--length) window.location.reload();\n                }\n            });\n        });\n    });\n});\n// </pre>"}}}