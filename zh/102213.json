{"parse":{"title":"MediaWiki:Gadget-twinklebatchundelete.js","pageid":164861,"wikitext":{"*":"//\u672cjs\u5f15\u81ea\u4e2d\u6587\u7ef4\u57fa\u767e\u79d1[[zhwiki:Special:Permalink/36140916]]\n!function(a){Twinkle.batchundelete=function(){mw.config.get(\"wgNamespaceNumber\")!==mw.config.get(\"wgNamespaceIds\").user&&mw.config.get(\"wgNamespaceNumber\")!==mw.config.get(\"wgNamespaceIds\").project||!mw.config.get(\"wgArticleId\")||Morebits.userIsInGroup(\"sysop\")&&Twinkle.addPortletLink(Twinkle.batchundelete.callback,\"\u6279\u590d\",\"tw-batch-undel\",\"\u53cd\u5220\u9664\u9875\u9762\")},Twinkle.batchundelete.callback=function(){var c,d,e,f,g,b=new Morebits.simpleWindow(600,400);b.setScriptName(\"Twinkle\"),b.setTitle(\"\u6279\u91cf\u53cd\u5220\u9664\"),b.addFooterLink(\"Twinkle\u5e2e\u52a9\",\"WP:TW/DOC#batchundelete\"),c=new Morebits.quickForm(Twinkle.batchundelete.callback.evaluate),c.append({type:\"input\",name:\"reason\",label:\"\u7406\u7531\uff1a\",size:60}),d=document.createElement(\"div\"),d.style.padding=\"15px\",b.setContent(d),Morebits.status.init(d),b.display(),e={action:\"query\",generator:\"links\",titles:mw.config.get(\"wgPageName\"),gpllimit:Twinkle.getPref(\"batchMax\")},f=new Morebits.status(\"\u6293\u53d6\u9875\u9762\u5217\u8868\"),g=new Morebits.wiki.api(\"\u8f7d\u5165\u4e2d\u2026\",e,function(b){var f,c=b.responseXML,d=a(c).find(\"page[missing]\"),e=[];d.each(function(b,c){var d=a(c),f=d.attr(\"title\");e.push({label:f,value:f,checked:!0})}),b.params.form.append({type:\"header\",label:\"\u5f85\u6062\u590d\u9875\u9762\"}),b.params.form.append({type:\"button\",label:\"\u5168\u9009\",event:function(b){a(Morebits.quickForm.getElements(b.target.form,\"pages\")).prop(\"checked\",!0)}}),b.params.form.append({type:\"button\",label:\"\u5168\u4e0d\u9009\",event:function(b){a(Morebits.quickForm.getElements(b.target.form,\"pages\")).prop(\"checked\",!1)}}),b.params.form.append({type:\"checkbox\",name:\"pages\",list:e}),b.params.form.append({type:\"submit\"}),f=b.params.form.render(),b.params.Window.setContent(f),Morebits.checkboxShiftClickSupport(Morebits.quickForm.getElements(f,\"pages\"))},f),g.params={form:c,Window:b},g.post()},Twinkle.batchundelete.callback.evaluate=function(a){var b,c,d;return Morebits.wiki.actionCompleted.notice=\"\u72b6\u6001\",Morebits.wiki.actionCompleted.postfix=\"\u53cd\u5220\u9664\u5df2\u5b8c\u6210\",b=a.target.getChecked(\"pages\"),(c=a.target.reason.value)?(Morebits.simpleWindow.setButtonsEnabled(!1),Morebits.status.init(a.target),b?(d=new Morebits.batchOperation(\"\u53cd\u5220\u9664\u9875\u9762\"),d.setOption(\"chunkSize\",Twinkle.getPref(\"batchUndeleteChunks\")),d.setOption(\"preserveIndividualStatusLines\",!0),d.setPageList(b),d.run(function(a){var b={token:mw.user.tokens.get().editToken,title:a,action:\"undelete\",reason:c+Twinkle.getPref(\"deletionSummaryAd\")},e=new Morebits.wiki.api(\"\u53cd\u5220\u9664\u9875\u9762\"+a,b,d.workerSuccess,null,d.workerFailure);e.statelem.status(\"\u53cd\u5220\u9664\u4e2d\u2026\"),e.pageName=a,e.post()}),void 0):(Morebits.status.error(\"\u9519\u8bef\",\"\u6ca1\u4ec0\u4e48\u8981\u53cd\u5220\u9664\u7684\uff0c\u53d6\u6d88\u64cd\u4f5c\"),void 0)):(alert(\"\u60a8\u9700\u8981\u6307\u5b9a\u7406\u7531\u3002\"),void 0)}}(jQuery);"}}}