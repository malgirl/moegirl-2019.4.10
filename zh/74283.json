{"parse":{"title":"User:\u4e5d\u6c5f\u6708/\u8868\u683c\u7f16\u8f91\u5668","pageid":205599,"wikitext":{"*":"\u5c06\u4ee3\u7801\u590d\u5236\u5230\u8bb0\u4e8b\u672c\u91cc\u4fdd\u5b58,\u7136\u540e\u53e6\u5b58\u4e3a\u7f16\u7801\u683c\u5f0f\u9009\u62e9utf-8\n\n\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e00\u6bb5meta\u5b57\u5934\u53d6\u4ee3\u539fmeta\u5b57\u5934,\u4ee5\u4fdd\u8bc1\u6c49\u5b57\u4e0d\u4f1a\u51fa\u73b0\u4e71\u7801\n\n<pre>    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=gbk-2312\" /></pre>\n\n\u7bad\u5934\u51fd\u6570ie\u80af\u5b9a\u662f\u4e0d\u884c\u7684,\u4f46\u53ef\u4ee5\u624b\u52a8\u66ff\u6362\u4e3a\u533f\u540d\u51fd\u6570\u7684\u5199\u6cd5,\u6279\u91cf\u66ff\u6362\u5c31\u884c\n\n(obj) =>\u7b49\u4e8efunction(obj),(n) =>\u7b49\u4e8efunction(n),() =>\u7b49\u4e8efunction()\n\n<pre>\n<!DOCTYPE html>\n<html>\n<head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n    <title></title>\n    <style>\n        .db {\n            height: 30px;\n            width: 30px;\n            display: inline-block;\n        }\n        .main{\n            margin:auto;\n            text-align:center;\n        }\n        .active {\n            border: 1px solid #ffd800 !important;\n        }\n        .col{\n            border:1px solid #000;\n        }\n        .content{\n            width:800px;\n            margin:auto;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"content\">\n        <p>\u7f16\u8f91\u680f</p>\n        <div style=\"margin:8px 0\">\n            <input type=\"button\" value=\"\u7f16\u8bd1(F5)\" onclick=\"moetable.compile()\" />\n            <input type=\"button\" value=\"\u53cd\u7f16\u8bd1\" onclick=\"moetable.decompile()\" />\n            <input type=\"button\" value=\"\u590d\u5236\" onclick=\"clipboard(0)\" />\n            <input type=\"button\" value=\"\u526a\u5207\" onclick=\"clipboard(-1)\" />\n            <input type=\"button\" value=\"\u7c98\u8d34\" onclick=\"clipboard(1)\" />\n        </div>\n        <div style=\"margin:8px 0\">\n            <input type=\"button\" value=\"\u5408\u5e76\u884c\" onclick=\"moetable.changespan(1)\" />\n            <input type=\"button\" value=\"\u5408\u5e76\u5217\" onclick=\"moetable.changespan(2)\" />\n            <input type=\"button\" value=\"\u63d2\u5165\u5355\u5143\u683c\" onclick=\"moetable.changenode(1)\" />\n            <input type=\"button\" value=\"\u63d2\u5165\u884c\" onclick=\"moetable.changenode(2)\" />\n        </div>\n        <div style=\"margin:8px 0\">\n            <input type=\"button\" value=\"\u62c6\u5206\u884c\" onclick=\"moetable.changespan(3)\" />\n            <input type=\"button\" value=\"\u62c6\u5206\u5217\" onclick=\"moetable.changespan(4)\" />\n            <input type=\"button\" value=\"\u65b0\u589e\u5355\u5143\u683c\" onclick=\"moetable.changenode(3)\" />\n            <input type=\"button\" value=\"\u65b0\u589e\u884c\" onclick=\"moetable.changenode(4)\" />\n        </div> \n        <div style=\"margin:8px 0\">\n            <input type=\"button\" value=\"\u80cc\u666f\u8272\" onclick=\"moetable.changecolor(0)\" />\n            <input type=\"button\" value=\"\u5b57\u4f53\u8272\" onclick=\"moetable.changecolor(1)\" />\n            <input type=\"button\" value=\"\u5220\u9664\u5355\u5143\u683c\" onclick=\"moetable.changenode(-1)\" />\n            <input type=\"button\" value=\"\u5220\u9664\u884c\" onclick=\"moetable.changenode(-2)\" />\n        </div>\n        <div style=\"margin:8px 0;\" id=\"colormenu\">\n            <span>\u80cc\u666f\u8272</span>\n            <input type=\"text\" value=\"#000000\" id=\"getbgcolor\" />\n            <br>\n            <span>\u5b57\u4f53\u8272</span>\n            <input type=\"text\" value=\"#000000\" id=\"getftcolor\" />\n        </div>\n        <div style=\"margin-top:5px\">\n            <i>fx</i>\n            <input type=\"text\" value=\"\" id=\"getvalue\" />\n            <input type=\"button\" value=\"\u8d4b\u503c\" onclick=\"moetable.setvalue()\" />\n        </div>\n        <p>\u72b6\u6001\u680f:<span id=\"message\"></span></p>\n        <p>\u7f16\u8f91\u533a</p>\n        <table class=\"moetable\" id=\"table1\">\n            <tbody>\n                <tr class=\"row\">\n                    <td class=\"col\" rowspan=\"2\" colspan=\"2\" onclick=\"moetable.active(this)\">11</td>\n                    <td class=\"col\" style=\"background-color:#ffd800\" onclick=\"moetable.active(this)\">12</td>\n                    <td class=\"col\" style=\"color:#33ccff\" onclick=\"moetable.active(this)\">13</td>\n                    <td class=\"col\" onclick=\"moetable.active(this)\">14</td>\n                </tr>\n                <tr class=\"row\">\n                    <td class=\"col\" onclick=\"moetable.active(this)\">21</td>\n                    <td class=\"col\" onclick=\"moetable.active(this)\">22</td>\n                    <td class=\"col\" onclick=\"moetable.active(this)\">23</td>\n                </tr>\n                <tr class=\"row\">\n                    <td class=\"col\" onclick=\"moetable.active(this)\">31</td>\n                    <td class=\"col\" onclick=\"moetable.active(this)\">32</td>\n                    <td class=\"col\" onclick=\"moetable.active(this)\">33</td>\n                    <td class=\"col\" onclick=\"moetable.active(this)\">34</td>\n                    <td class=\"col\" onclick=\"moetable.active(this)\">35</td>\n                </tr>\n            </tbody>\n        </table>\n        <p>wiki\u4ee3\u7801</p>\n        <div>\n\n        </div>\n        <textarea id=\"table2\" style=\"width:100%;height:500px;\"></textarea>\n        <script>\nvar alertdata = \"\";\nvar moetable = {\n    datatable: [],//json exchange\n    clipedata: \"\",    \n    init: (name) =>\n    {\n        //(dom)box(json)encode(wikicode)decode(json)unbox(dom)  \n        moetable.decompile();\n        moetable.decompile();\n    },\n    //dom to json\n    boxtable: (obj) =>\n    {\n        return moetable.boxrows(obj);\n    },\n    boxrows: (obj) =>\n    {\n        var trs = obj.getElementsByTagName('tr');\n        var boxed = [];\n        for (var i in trs)\n        {\n            if (i < trs.length)\n            {\n                var item = moetable.boxcols(trs[i]);\n                boxed.push(item);\n            }\n        }\n        return boxed;\n    },\n    boxcols: (obj) =>\n    {\n        var tds = obj.getElementsByTagName('td');\n        var boxed = [];\n        for (var i in tds)\n        {\n            if (i < tds.length)\n            {                \n                var item = moetable.boxitem(tds[i]);\n                boxed.push(item);\n            }\n        }\n        return boxed\n    },\n    boxitem: (obj) =>\n    {\n        var boxed = {\n            className:obj.className,\n            values: (obj.innerHTML.indexOf('<input ') < 0 ? obj.innerHTML : \"@input\"),\n            rowspan: obj.rowSpan,\n            colspan: obj.colSpan,\n            color: obj.style.color,\n            bgcolor: obj.style.backgroundColor,\n            align: obj.style.textAlign\n        };\n        return boxed;\n    },\n    //json to dom\n    unboxtable: (obj) =>\n    {\n        return moetable.unboxrows(obj);\n    },\n    unboxrows: (obj) =>\n    {\n        var unboxed = document.createElement('table');\n        for (var i in obj)\n        {\n            var item = moetable.unboxcols(obj[i]);\n            unboxed.appendChild(item);\n        }\n        return unboxed;\n    },\n    unboxcols: (obj) =>\n    {\n        var unboxed = document.createElement('tr');\n        for (var i in obj)\n        {\n            var item = moetable.unboxitem(obj[i]);\n            unboxed.appendChild(item);\n        }\n        return unboxed;\n    },\n    unboxitem: (obj) =>\n    {\n        var unboxed = document.createElement('td');\n        unboxed.className = obj.className;\n        unboxed.innerHTML = obj.values == \"@input\" ? '<input type=\"button\" value=\"+\" onclick=\"moetable.addtd(this)\" />' : obj.values;\n        unboxed.rowSpan = obj.rowspan;\n        unboxed.colSpan = obj.colspan;\n        unboxed.style.color = obj.color;\n        unboxed.style.backgroundColor = obj.bgcolor;\n        unboxed.style.textAlign = obj.align;\n        unboxed.setAttribute('onclick', 'moetable.active(this)');\n        return unboxed;\n    },\n    //json to wikicode\n    encodetable: (obj) =>\n    {\n        var str = '{| class=\"wikitable\"\\n';\n        str += moetable.encoderows(obj);\n        str = str.replace(new RegExp(/(\\n)/g), \"<br>\");\n        str += '|}';\n        return str;\n    },\n    encoderows: (obj) =>\n    {\n        var str = \"\";\n        for (var i in obj)\n        {\n            str += \"|-\\n\" + moetable.encodecols(obj[i]);\n        }\n        return str;\n    },\n    encodecols: (obj) =>\n    {\n        var str = \"\";\n        for (var i in obj)\n        {\n            str += moetable.encodeitem(obj[i]) + \"\\n\";\n        }\n        return str;\n    },\n    encodeitem: (obj) =>\n    {\n        var str = \"|\";\n        str += (obj.align == \"\" ? \"\" : 'align=\"' + obj.align + '\" ');\n        str += (obj.rowspan <= 1 ? \"\" : 'rowspan=\"' + obj.rowspan + '\" ');\n        str += (obj.colspan <= 1 ? \"\" : 'colspan=\"' + obj.colspan + '\" ');\n        str += (obj.color == \"\" ? \"\" : 'color=\"' + obj.color + '\" ');\n        str += (obj.bgcolor == \"\" ? \"\" : 'bgcolor=\"' + obj.bgcolor + '\" ');\n        str += (str == \"|\" ? obj.values : '|' + obj.values);\n        return str;\n    },\n    //wiki to json\n    decodetable: (obj) =>\n    {\n        var sline = obj.split('<br>');\n        var json = moetable.decoderows(sline);\n        return json;\n    },\n    decoderows: (obj) =>\n    {\n        var datatable = [];\n        var rows = [];\n        for (var i in obj)\n        {\n            if (obj[i].indexOf(\"{|\", 0) < 0)\n            {\n                if (obj[i].indexOf(\"|-\", 0) == 0)\n                {\n                    datatable.push(rows);\n                    rows = [];\n                }\n                else\n                {\n                    if (obj[i].indexOf(\"|}\", 0) < 0)\n                    {\n                        var item = moetable.decodecols(obj[i]);\n                        rows.push(item);\n                    }\n                }\n            }\n        }\n        datatable.push(rows);\n        datatable.splice(0,1);\n        return datatable;\n    },\n    decodecols: (obj) =>\n    {\n        var items = moetable.decodeitem(obj);\n        var str = \"\";\n        if (obj.indexOf(\"|\",0) > -1)\n        {\n            var firststick = 0;\n            firststick = obj.indexOf(\"|\", 1) > 0 ? 1 : 0;\n            var index = obj.indexOf(\"|\", firststick);\n            str = obj.substr(index + 1, obj.length - index - 1);\n        }\n        items[\"values\"] = str;\n        return items;\n    },\n    decodeitem: (obj) =>\n    {\n        var item = {};\n        var parts = [\n            [\"string\", \"align\"],\n            [\"string\", \"bgcolor\"],\n            [\"string\", \"color\"],\n            [\"string\", \"className\"],\n            [\"int\", \"colspan\"],\n            [\"int\",\"rowspan\"]];\n        for (var i in parts)\n        {            \n            var patt = new RegExp(parts[i][1] + '=\".*?\"');\n            var res = patt.exec(obj);\n            if (parts[i][1] == \"color\")\n            {\n                if (obj.indexOf(' color=\"') > -1 || obj.indexOf('|color=\"') > -1)\n                {\n                    patt = new RegExp(' color=\".*?\"');\n                    if (res == null)\n                    {\n                        patt = new RegExp('\\\\|color=\".*?\"');\n                        res = patt.exec(obj);\n                    }\n                } else\n                {\n                    res = null;\n                }\n            }\n            if (res != null)\n            {\n                var s = res[0].replace(parts[i][1] + '=\"', '').replace('\"', '');\n                if (parts[i][0] == \"int\")\n                {\n                    item[parts[i][1]] = parseInt(s);\n                }\n                else\n                {\n                    item[parts[i][1]] = parts[i][1]==\"className\"?\"col\":s;\n                }\n            }\n            else\n            {\n                item[parts[i][1]] = parts[i][1] == \"className\" ? \"col\" :\"\";\n            }\n        }\n        return item;\n    },\n    //change td|tr node\n    changenode: (n) =>\n    {\n        var table = document.getElementById('table1');\n        var act = table.getElementsByClassName('active');\n        if (act.length > 0)\n        {\n            var tr = document.createElement('tr');\n            var td = document.createElement('td');\n            td.setAttribute('class', 'col');\n            td.setAttribute('onclick', 'moetable.active(this)');\n            td.innerHTML = \"null\";\n            tr.appendChild(td);\n            switch (n)\n            {\n                case -2:                    \n                    removeAlert(act[0].parentNode, 'trtold', '\u884c\u5220\u9664\u4e4b\u540e\u4e0d\u53ef\u6062\u590d,\u518d\u6b21\u70b9\u51fb\u786e\u5b9a\u5220\u9664');\n                    break;\n                case -1:\n                    removeAlert(act[0], 'tdtold', '\u5355\u5143\u683c\u5220\u9664\u4e4b\u540e\u4e0d\u53ef\u6062\u590d,\u518d\u6b21\u70b9\u51fb\u786e\u5b9a\u5220\u9664');\n                    break;\n                case 1:\n                    act[0].parentNode.insertBefore(td, act[0]);\n                    break;\n                case 2:\n                    act[0].parentNode.parentNode.insertBefore(tr, act[0].parentNode);\n                    break;\n                case 3:\n                    insertAfter(td, act[0])\n                    break;\n                case 4:\n                    insertAfter(tr, act[0].parentNode)\n                    break;\n            }\n        }\n        function insertAfter(newElement, targetElement)\n        {\n            var parent = targetElement.parentNode;\n            if (parent.lastChild == targetElement)\n            {\n                parent.appendChild(newElement);\n            } else\n            {\n                parent.insertBefore(newElement, targetElement.nextSibling);\n            }\n        }\n        function removeAlert(obj, flag, msg)\n        {\n            if (alertdata == flag)\n            {\n                alertdata = \"\";\n                message('');\n                obj.remove();\n            } else\n            {\n                alertdata = flag;\n                message(msg);\n            }\n        }\n    },\n    changespan: (n) =>\n    {\n        message('');\n        alertdata = \"\";\n        var table = document.getElementById('table1');\n        var act = table.getElementsByClassName('active');\n        if (act.length > 0)\n        {\n            switch (n)\n            {\n                case 1:\n                    act[0].rowSpan++;\n                    break;\n                case 2:\n                    act[0].colSpan++;\n                    break;\n                case 3:\n                    act[0].rowSpan--;\n                    break;\n                case 4:\n                    act[0].colSpan--;\n                    break;\n            }            \n        }\n    },\n    changecolor: (n) =>\n    {\n        \n        var table = document.getElementById('table1');\n        var act = table.getElementsByClassName('active');\n        if (act.length > 0)\n        {\n            var menu = document.getElementById('colormenu');\n            var bgcolor = document.getElementById('getbgcolor');\n            var ftcolor = document.getElementById('getftcolor');\n            switch (n)\n            {\n                case 0:\n                    if (alertdata == \"bgcolortold\")\n                    {\n                        message('');\n                        alertdata = \"\";                        \n                        act[0].style.backgroundColor = bgcolor.value;                        \n                    } else\n                    {\n                        alertdata = 'bgcolortold';\n                        message(bgcolor.value + \" -> \" + (act[0].style.backgroundColor == \"\" ? \"rgb(255, 255, 255)\" : act[0].style.backgroundColor)+\n                            \" : \u518d\u6b21\u70b9\u51fb\u786e\u8ba4\u4fee\u6539\u80cc\u666f\u8272\");\n                    }\n                    break;\n                case 1:\n                    if (alertdata == \"colortold\")\n                    {\n                        message('');\n                        alertdata = \"\";\n                        act[0].style.color = ftcolor.value;\n                    } else\n                    {\n                        alertdata = 'colortold';\n                        message(ftcolor.value + \" -> \" + (act[0].style.color == \"\" ? \"rgb(0, 0, 0)\" : act[0].style.color) +\n                            \" : \u518d\u6b21\u70b9\u51fb\u786e\u5b9a\u4fee\u6539\u5b57\u4f53\u8272\");\n                    }\n                    break;\n            }\n        }\n    },\n    clipboard: (n) =>\n    {\n        message('');\n        alertdata = \"\";\n        var table = document.getElementById('table1');\n        var act = table.getElementsByClassName('active');\n        if (act.length > 0)\n        {\n            switch (n)\n            {\n                case -1:\n                    message('\u526a\u8d34,\u4f46\u662f\u8fd8\u6ca1\u4ec0\u4e48\u7528');\n                    moetable.clipedata = act[0].innerHTML;\n                    break;\n                case 0:\n                    message('\u590d\u5236,\u4f46\u662f\u8fd8\u6ca1\u4ec0\u4e48\u7528');\n                    moetable.clipedata = act[0].innerHTML;\n                    break;\n                case 1:\n                    message('\u7c98\u8d34,\u4f46\u662f\u8fd8\u6ca1\u4ec0\u4e48\u7528');\n                    moetable.clipedata = \"\";\n                    break;\n            }\n        }\n    },\n    decompile: () =>\n    {\n        if (alertdata == \"decompiletold\")\n        {\n            alertdata = \"\";\n            message('');\n            var table = document.getElementById('table1');\n            moetable.datatable = moetable.boxtable(table);\n            var table2 = document.getElementById('table2');\n            table2.value = moetable.encodetable(moetable.datatable).replace(new RegExp(/(<br>)/g), \"\\n\");\n        } else\n        {\n            alertdata = \"decompiletold\";\n            message(\"\u53cd\u7f16\u8bd1\u4f1a\u5c06dom\u5143\u7d20\u8f6c\u6362\u6210wiki\u4ee3\u7801,\u539fwiki\u4ee3\u7801\u5c06\u4f1a\u4e22\u5931,\u518d\u6b21\u70b9\u51fb\u786e\u5b9a\u6267\u884c.\");\n        }\n    },\n    compile: () =>\n    {\n        if (alertdata == \"compiletold\")\n        {\n            alertdata = \"\";\n            message('');\n            var table = document.getElementById('table2');\n            moetable.datatable = moetable.decodetable(table.value.replace(new RegExp(/(\\n)/g), \"<br>\"));\n            var table2 = document.getElementById('table1');\n            table2.innerHTML = moetable.unboxtable(moetable.datatable).innerHTML;\n        } else\n        {\n            alertdata = \"compiletold\";\n            message(\"\u7f16\u8bd1\u4f1a\u5c06wiki\u4ee3\u7801\u8f6c\u6362\u6210dom\u5143\u7d20,\u539fdom\u6570\u636e\u5c06\u4f1a\u4e22\u5931,\u518d\u6b21\u70b9\u51fb\u786e\u5b9a\u6267\u884c.\");\n        }\n    },\n    setvalue: () =>\n    {\n        message('');\n        alertdata = \"\";\n        var table = document.getElementById('table1');\n        var act = table.getElementsByClassName('active');\n        if (act.length > 0)\n        {\n            act[0].innerHTML = document.getElementById('getvalue').value;\n        }\n    },\n    active: (obj) =>\n    {\n        message('');\n        alertdata =\"\";\n        var table = document.getElementById('table1');\n        var act = table.getElementsByClassName('active');\n        if (act.length>0)\n        {\n            var s = act[0].getAttribute('class').replace('active', '');\n            act[0].setAttribute('class', s);\n        }        \n        obj.setAttribute('class', 'col active');\n        document.getElementById('getvalue').value = obj.innerHTML;\n    }\n};\nfunction message(str)\n{\n    var ph = document.getElementById('message');\n    ph.innerHTML = str;\n};\n\n            moetable.init();\n        </script>\n    </div>\n</body>\n</html>\n</pre>"}}}