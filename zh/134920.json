{"parse":{"title":"\u6a21\u5757:Birthday","pageid":279152,"wikitext":{"*":"local module = {}\n\nlocal getArgs = require('Module:Arguments').getArgs\n\nfunction module._main(args)\n\targs[1] = tonumber(args[1])\n\targs[2] = tonumber(args[2])\n\tlocal month = { 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 }\n\n\tif args[1] < 1 or args[1] > 12 then\n\t    error('\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u6708\u4efd\uff01')\n\tend\n\t\n\tif args[2] < 1 or args[2] > month[args[1]] then\n\t    error('\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u65e5\u671f\uff01')\n\tend\n\t\n\tfunction isLeapYear(year)\n\t    local year = year or os.date('%Y')\n\t    if (year % 4 == 0) and (year % 100 ~= 0 or year % 400 == 0) then\n\t        return true\n\t    end\n\t    return false\n\tend\n\t\n\tif isLeapYear() == false then\n\t    month[2] = 28\n\tend\n\t\n\tlocal count = args[2]\n\tfor i=1, args[1] - 1 do\n\t    count = count + month[i]\n\tend\n\t\n\tlocal year = os.date('%Y') + 1\n\tlocal num = os.date('%j')\n\t\n\tcount = count - num\n\tif count < 0 then\n\t    local foo = 0\n\t    if isLeapYear(year) then\n\t    \tif (args[1] == 2 and args[2] == 29) or args[1] > 2 then\n\t    \t\tfoo = 1\n\t    \tend\n\t    end\n\t    count = count + 365 + foo\n\tend\n\t\n\t-- \u9488\u5bf92\u670829\u65e5\u7684\u8ba1\u7b97\n\tif(args[1] == 2 and args[2] == 29) then\n\t    count = 0\n\t    if isLeapYear() == false or num > 60 then\n\t        local foo = 0\n\t        if isLeapYear() and num > 60 then\n\t            foo = 1\n\t        end\n\t        count = 365 - num + foo\n\t\n\t        while isLeapYear(year) == false do\n\t            count = count + 365\n\t            year = year + 1\n\t        end\n\t        count = count + 60\n\t    else\n\t        count = 60 - num\n\t    end\n\t    \n\tend\n\t\n\tcount = math.floor(count)\n\treturn count\nend\n\nfunction module.main(frame)\n\tlocal args = getArgs(frame, {wrappers='Template:\u751f\u65e5'})\n\treturn module._main(args)\nend\n\nreturn module"}}}