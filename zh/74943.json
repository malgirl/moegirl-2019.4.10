{"parse":{"title":"User:\u59b9\u7a7a\u9171/LyricColorizition.js","pageid":149996,"wikitext":{"*":"/*\n  \u6b64\u811a\u672c\u529f\u80fd\u4e3a\u63d0\u4f9b\u5feb\u901f\u7684\u6b4c\u8bcd\u4e0a\u8272\u65b9\u6cd5\u3002\n  \u5f15\u5165\u6b64\u811a\u672c\u5c06\u5728\u7f16\u8f91\u9875\u9762\u53f3\u4fa7\u663e\u793a\u4e00\u4e2a\u989c\u8272\u7ba1\u7406\u9762\u677f\u3002\n  \u70b9\u51fb\u5e76\u6dfb\u52a0\u989c\u8272\u5373\u53ef\u3002\n  '''\u672c\u811a\u672c\u5c5e\u968f\u624b\u4f5c\u54c1\uff0c\u4ee3\u7801\u65e0\u53ef\u8bfb\u6027\uff0c\u8bf7\u52ff\u53c2\u8003'''\u3002\n  \u672c\u811a\u672c\u4ec5\u652f\u6301\u73b0\u4ee3\u6d4f\u89c8\u5668\u3002\n  \u672c\u811a\u672c\u4f9d\u8d56Wikiplus\u7684\u524d\u7aef\u7ec4\u4ef6\u3002\u56e0\u6b64\u4f60\u9700\u8981\u542f\u7528Wikiplus\u3002\n  \n  \u4f7f\u7528\u8bf4\u660e\uff1a\n  \u5355\u51fb\u989c\u8272\uff0c\u53ef\u4ee5\u5c06\u5f53\u524d\u9009\u4e2d\u7684\u6587\u5b57\u4f7f\u7528color\u6a21\u677f\u7740\u8272\u3002\u518d\u6b21\u5355\u51fb\u53ef\u4ee5\u53d6\u6d88\u4e0a\u8272\u3002\n  \u53cc\u51fb\u989c\u8272\uff0c\u53ef\u4ee5\u5220\u9664\u8fd9\u4e00\u989c\u8272\u3002\n  Ctrl+1~Ctrl+9\u5c06\u5206\u522b\u4f5c\u4e3a\u989c\u8272\u7684\u5feb\u6377\u952e\uff0c\u4f8b\u5982Ctrl+1\u5c31\u662f\u7b2c\u4e00\u79cd\u989c\u8272\u3002\n  \n  \u4e00\u4e9b\u8c03\u7528\u5efa\u8bae\uff1a\n  \u53ef\u4ee5\u65b0\u5efa\u4e00\u4e2a\u4e66\u7b7e\uff0c\u5185\u5bb9\u4e3a\uff1a\n  javascript:mw.loader.load('http://zh.moegirl.org/index.php?title=User:%E5%A6%B9%E7%A9%BA%E9%85%B1/LyricColorizition.js&action=raw&ctype=text/javascript');\n  \u9700\u8981\u672c\u811a\u672c\u65f6\u70b9\u51fb\u4e66\u7b7e\u5373\u53ef\u3002\n*/\n/*\n  By: Eridanus Sora\n*/\n/* global Wikiplus */\n/* global mw */\n'use strict';\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\n$(document).ready(function () {\n    var LC = (function () {\n        function LC(element) {\n            _classCallCheck(this, LC);\n\n            var self = this;\n            this.area = element;\n            this.colorList = [];\n            var controlPanel = $('<div>').css({\n                'position': 'fixed',\n                'top': '40%',\n                'right': '0px',\n                'min-height': '80px',\n                'min-width': '70px',\n                'width': 'auto',\n                'background-color': '#ffffff',\n                'border': '1px black solid'\n            }).addClass('LC-Container');\n            controlPanel.append(this.generateColorBlock('#FFFFFF', '\u6dfb\u52a0\u989c\u8272', function () {\n                Wikiplus.createDialogBox('\u6dfb\u52a0\u989c\u8272', $('<div>').append($('<input>').attr({ 'placeholder': '\u989c\u8272', 'id': 'LC-ColorInput' })).append($('<br>')).append($('<input>').attr({ 'placeholder': '\u89d2\u8272\u540d', 'id': 'LC-CharaInput' })).append($('<hr>')).append($('<div>').addClass('Wikiplus-InterBox-Btn').attr('id', 'LC-Apply').text('\u786e\u8ba4')), 600, function () {\n                    $('#LC-Apply').click(function () {\n                        var color = $('#LC-ColorInput').val();\n                        var chara = $('#LC-CharaInput').val();\n                        $('.Wikiplus-InterBox-Close').click();\n                        $('.LC-Add').before(self.generateColorBlock(color, chara, function () {\n                            console.log(color + ' - ' + chara);\n                            var text = self.area.val();\n                            var start = self.area[0].selectionStart;\n                            var end = self.area[0].selectionEnd;\n                            if (start === end) return;\n                            var selectedText = self.area.val().slice(start, end);\n                            var regResult = selectedText.match(/^{{color[^]*\\|[^]*\\|([^.]+)[^]*}}$/m);\n                            if (regResult !== null && regResult[1] !== undefined) {\n                                //\u53bb\u9664\u989c\u8272\n                                self.area.val('' + text.slice(0, start) + regResult[1] + text.slice(end, text.length));\n                                self.area[0].setSelectionRange(start, start + regResult[1].length);\n                            } else {\n                                //\u52a0\u4e0a\u53bb\n                                self.area.val(text.slice(0, start) + '{{color|' + color + '|' + text.slice(start, end) + '}}' + text.slice(end, text.length));\n                                self.area[0].setSelectionRange(start, end + 11 + color.length);\n                            }\n                        }));\n                    });\n                });\n            }, 'LC-Add'));\n            $('body').append(controlPanel);\n            this.area.keydown(function (e) {\n                if (e.ctrlKey && 49 <= e.which && e.which <= 57) {\n                    e.preventDefault();\n                    $('.LC-Color')[e.which - 49] && $('.LC-Color')[e.which - 49].click();\n                }\n            });\n        }\n\n        _createClass(LC, [{\n            key: 'generateColorBlock',\n            value: function generateColorBlock(color, text, event) {\n                var className = arguments.length <= 3 || arguments[3] === undefined ? 'LC-Color' : arguments[3];\n\n                return $('<div>').css({\n                    'width': '50px',\n                    'height': '50px',\n                    'margin': '10px',\n                    'padding': '3px',\n                    'font-size': '12px',\n                    'line-height': '50px',\n                    'font-weight': 'bold',\n                    'text-align': 'center',\n                    'float': 'left',\n                    'background-color': color,\n                    'border': '1px black solid',\n                    'cursor': 'pointer'\n                }).text(text).addClass(className).click(event).dblclick(function () {\n                    if (className !== 'LC-Color') return;\n                    $(this).fadeOut('fast', function () {\n                        $(this).remove();\n                    });\n                });\n            }\n        }, {\n            key: 'throwError',\n            value: function throwError(message) {\n                var error = new Error();\n                console.log('[CRITICAL] ' + message);\n                console.log(error);\n            }\n        }]);\n\n        return LC;\n    })();\n\n    if (mw.config.values.wgAction === 'edit') {\n        console.log(new LC($('#wpTextbox1')));\n    }\n});"}}}