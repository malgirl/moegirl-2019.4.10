{"parse":{"title":"MediaWiki:Gadget-twinkleimage.js","pageid":164869,"wikitext":{"*":"//\u672cjs\u5f15\u81ea\u4e2d\u6587\u7ef4\u57fa\u767e\u79d1[[zhwiki:Special:Permalink/39800999]]\n!function(){Twinkle.image=function(){6===mw.config.get(\"wgNamespaceNumber\")&&!document.getElementById(\"mw-sharedupload\")&&document.getElementById(\"mw-imagepage-section-filehistory\")&&Twinkle.addPortletLink(Twinkle.image.callback,\"\u56fe\u6743\",\"tw-di\",\"\u63d0\u4ea4\u6587\u4ef6\u5feb\u901f\u5220\u9664\")},Twinkle.image.callback=function(){var b,c,d,e,a=new Morebits.simpleWindow(600,330);a.setTitle(\"\u6587\u4ef6\u5feb\u901f\u5220\u9664\u5019\u9009\"),a.setScriptName(\"Twinkle\"),a.addFooterLink(\"\u5feb\u901f\u5220\u9664\u65b9\u9488\",\"WP:CSD\"),a.addFooterLink(\"Twinkle\u5e2e\u52a9\",\"WP:TW/DOC#image\"),b=new Morebits.quickForm(Twinkle.image.callback.evaluate),b.append({type:\"checkbox\",list:[{label:\"\u901a\u77e5\u4e0a\u4f20\u8005\",value:\"notify\",name:\"notify\",tooltip:\"\u5982\u679c\u60a8\u5728\u6807\u8bb0\u540c\u4e00\u7528\u6237\u7684\u5f88\u591a\u6587\u4ef6\uff0c\u8bf7\u53d6\u6d88\u6b64\u590d\u9009\u6846\u4ee5\u907f\u514d\u4f7f\u7528\u6237\u5bf9\u8bdd\u9875\u8fc7\u8f7d\u3002\",checked:Twinkle.getPref(\"notifyUserOnDeli\")}]}),c=b.append({type:\"field\",label:\"\u9700\u8981\u7684\u52a8\u4f5c\"}),c.append({type:\"radio\",name:\"type\",list:[{label:\"\u6ca1\u6709\u6765\u6e90\uff08CSD F3\uff09\",value:\"no source\",checked:!0,tooltip:\"\u672c\u56fe\u50cf\u5e76\u672a\u6ce8\u660e\u539f\u59cb\u51fa\u5904\uff0c\u5176\u58f0\u79f0\u7684\u7248\u6743\u4fe1\u606f\u65e0\u6cd5\u4e88\u4ee5\u67e5\u8bc1\"},{label:\"\u6ca1\u6709\u7248\u6743\uff08CSD F4\uff09\",value:\"no license\",tooltip:\"\u672c\u6863\u6848\u7f3a\u5c11\u7248\u6743\u4fe1\u606f\"}]}),b.append({type:\"submit\"}),d=b.render(),a.setContent(d),a.display(),e=document.createEvent(\"Event\"),e.initEvent(\"change\",!0,!0),d.type[0].dispatchEvent(e)},Twinkle.image.callback.evaluate=function(a){var b,e,f,g,h,i,j,k,c=a.target.notify.checked,d=a.target.type;for(e=0;e<d.length;++e)if(d[e].checked){b=d[e].values;break}switch(b){case\"no source\":f=\"f3\";break;case\"no license\":f=\"f4\";break;default:throw new Error(\"Twinkle.image.callback.evaluate\uff1a\u672a\u77e5\u6761\u6b3e\")}g=Twinkle.getPref(\"logSpeedyNominations\")&&-1===Twinkle.getPref(\"noLogOnSpeedyNomination\").indexOf(f.toLowerCase()),h=b,i={type:b,templatename:h,normalized:f,lognomination:g},Morebits.simpleWindow.setButtonsEnabled(!1),Morebits.status.init(a.target),Morebits.wiki.actionCompleted.redirect=mw.config.get(\"wgPageName\"),Morebits.wiki.actionCompleted.notice=\"\u6807\u8bb0\u5b8c\u6210\",j=new Morebits.wiki.page(mw.config.get(\"wgPageName\"),\"\u6dfb\u52a0\u5220\u9664\u6807\u8bb0\"),j.setCallbackParameters(i),j.load(Twinkle.image.callbacks.taggingImage),c?j.lookupCreator(Twinkle.image.callbacks.userNotification):(g&&(i.fromDI=!0,Twinkle.speedy.callbacks.user.addToLog(i,null)),k=document.createElement(\"pre\"),k.appendChild(document.createTextNode(\"{{subst:Uploadvionotice|\"+Morebits.pageNameNorm+\"}}--~~\"+\"~~\")),Morebits.status.info(\"\u63d0\u793a\",[\"\u8fd9\u4e9b\u5185\u5bb9\u5e94\u8d34\u8fdb\u4e0a\u4f20\u8005\u5bf9\u8bdd\u9875\uff1a\",document.createElement(\"br\"),k]))},Twinkle.image.callbacks={taggingImage:function(a){var d,b=a.getPageText(),c=a.getCallbackParameters();switch(b=b.replace(/\\{\\{(mtc|(copy |move )?to ?commons|move to wikimedia commons|copy to wikimedia commons)[^}]*\\}\\}/gi,\"\"),wikipedia_page=new Morebits.wiki.page(\"Wikipedia:\u6a94\u6848\u5b58\u5ee2\u8a0e\u8ad6/\u7121\u7248\u6b0a\u8a0a\u606f\u6216\u6a94\u6848\u4f86\u6e90\",\"\u6dfb\u52a0\u5feb\u901f\u5220\u9664\u8bb0\u5f55\u9879\"),wikipedia_page.setFollowRedirect(!0),wikipedia_page.setCallbackParameters(c),wikipedia_page.load(Twinkle.image.callbacks.imageList),d=\"{{subst:\"+c.templatename+\"/auto\",d+=\"}}\\n\",a.setPageText(d+b),a.setEditSummary(\"\u8bf7\u6c42\u5feb\u901f\u5220\u9664\uff08[[WP:CSD#\"+c.normalized.toUpperCase()+\"|CSD \"+c.normalized.toUpperCase()+\"]]\uff09\uff1a\"+c.type+Twinkle.getPref(\"summaryAd\")),Twinkle.getPref(\"deliWatchPage\")){case\"yes\":a.setWatchlist(!0);break;case\"no\":a.setWatchlistFromPreferences(!1);break;default:a.setWatchlistFromPreferences(!0)}a.setCreateOption(\"nocreate\"),a.save()},userNotification:function(a){var d,e,b=a.getCallbackParameters(),c=a.getCreator();if(c===mw.config.get(\"wgUserName\"))a.getStatusElement().warn(\"\u60a8\uff08\"+c+\"\uff09\u521b\u5efa\u4e86\u8be5\u9875\uff0c\u8df3\u8fc7\u901a\u77e5\");else{switch(d=new Morebits.wiki.page(\"User talk:\"+c,\"\u901a\u77e5\u4e0a\u4f20\u8005(\"+c+\")\"),e=\"\\n{{subst:Uploadvionotice|\"+Morebits.pageNameNorm+\"}}--~~\"+\"~~\",d.setAppendText(e),d.setEditSummary(\"\u901a\u77e5\uff1a\u6587\u4ef6[[\"+Morebits.pageNameNorm+\"]]\u5feb\u901f\u5220\u9664\u63d0\u540d\"+Twinkle.getPref(\"summaryAd\")),d.setCreateOption(\"recreate\"),Twinkle.getPref(\"deliWatchUser\")){case\"yes\":d.setWatchlist(!0);break;case\"no\":d.setWatchlistFromPreferences(!1);break;default:d.setWatchlistFromPreferences(!0)}d.setFollowRedirect(!0),d.append()}b.lognomination&&(b.fromDI=!0,Twinkle.speedy.callbacks.user.addToLog(b,c))},imageList:function(a){var b=a.getPageText();a.getCallbackParameters(),a.setPageText(b+\"\\n* [[:\"+Morebits.pageNameNorm+\"]]--~~\"+\"~~\"),a.setEditSummary(\"\u6dfb\u52a0[[\"+Morebits.pageNameNorm+\"]]\u3002\"+Twinkle.getPref(\"summaryAd\")),a.setCreateOption(\"recreate\"),a.save()}}}(jQuery);"}}}