{"parse":{"title":"MediaWiki:Gadget-friendlytalkback.js","pageid":164859,"wikitext":{"*":"//\u672cjs\u5f15\u81ea\u4e2d\u6587\u7ef4\u57fa\u767e\u79d1[[zhwiki:Special:Permalink/36140893]]\n!function(a){var b,c,d,e,f;Twinkle.talkback=function(){mw.config.get(\"wgRelevantUserName\")&&Twinkle.addPortletLink(Twinkle.talkback.callback,\"\u901a\u544a\",\"friendly-talkback\",\"\u56de\u590d\u901a\u544a\")},Twinkle.talkback.callback=function(){var a,b,c,d,g,h,i;(mw.config.get(\"wgRelevantUserName\")!==mw.config.get(\"wgUserName\")||confirm(\"\u60a8\u5bc2\u5bde\u5230\u4e86\u8981\u81ea\u5df1\u56de\u590d\u81ea\u5df1\u7684\u7a0b\u5ea6\u4e48\uff1f\"))&&(a=new Morebits.simpleWindow(600,350),a.setTitle(\"\u56de\u590d\u901a\u544a\"),a.setScriptName(\"Twinkle\"),a.addFooterLink(\"\u5173\u4e8e{{talkback}}\",\"Template:Talkback\"),a.addFooterLink(\"Twinkle\u5e2e\u52a9\",\"WP:TW/DOC#talkback\"),b=new Morebits.quickForm(f),b.append({type:\"radio\",name:\"tbtarget\",list:[{label:\"\u56de\u590d\uff1a\u6211\u7684\u5bf9\u8bdd\u9875\",value:\"mytalk\",checked:\"true\"},{label:\"\u56de\u590d\uff1a\u5176\u4ed6\u7528\u6237\u7684\u5bf9\u8bdd\u9875\",value:\"usertalk\"},{label:\"\u5176\u5b83\u9875\u9762\",value:\"other\"},{label:\"\u201c\u6709\u65b0\u90ae\u4ef6\u201d\",value:\"mail\"}],event:e}),b.append({type:\"field\",label:\"\u5de5\u4f5c\u533a\",name:\"work_area\"}),b.append({type:\"submit\"}),c=b.render(),a.setContent(c),a.display(),d=document.createEvent(\"Event\"),d.initEvent(\"change\",!0,!0),c.tbtarget[0].dispatchEvent(d),g=mw.config.get(\"wgCategories\"),g.length&&-1===g.indexOf(\"\u4e0d\u5e0c\u671b\u6536\u5230\u56de\u590d\u901a\u544a\u7684\u7528\u6237\")?Twinkle.talkback.optout=!1:(h={action:\"query\",prop:\"extlinks\",titles:mw.config.get(\"wgPageName\"),elquery:\"userjs.invalid/noTalkback\",ellimit:\"1\"},i=new Morebits.wiki.api(\"\u6293\u53d6opt-out\u4fe1\u606f\",h,Twinkle.talkback.callback.optoutStatus),i.post()))},Twinkle.talkback.optout=null,Twinkle.talkback.callback.optoutStatus=function(b){var e,f,c=b.getXML(),d=a(c).find(\"el\");d.length?(Twinkle.talkback.optout=mw.config.get(\"wgRelevantUserName\")+\"\u4e0d\u5e0c\u671b\u6536\u5230\u56de\u590d\u901a\u544a\",e=d.text(),Twinkle.talkback.optout+=e.indexOf(\"reason=\")>-1?\"\uff1a\"+decodeURIComponent(e.substring(e.indexOf(\"reason=\")+7))+\"\u3002\":\"\u3002\"):Twinkle.talkback.optout=!1,f=a(\"#twinkle-talkback-optout-message\"),f.length&&f.append(Twinkle.talkback.optout)},b=\"\",c=\"\",d=\"\",e=function(e){var i,f=e.target.values,g=e.target.form,h=Morebits.quickForm.getElements(g,\"work_area\")[0];switch(g.section&&(c=g.section.value),g.message&&(d=g.message.value),g.page&&(b=g.page.value),i=new Morebits.quickForm.element({type:\"field\",label:\"\u56de\u590d\u901a\u544a\u4fe1\u606f\",name:\"work_area\"}),f){case\"mytalk\":default:i.append({type:\"div\",label:\"\",style:\"color: red\",id:\"twinkle-talkback-optout-message\"}),i.append({type:\"input\",name:\"section\",label:\"\u5c0f\u8282\uff08\u53ef\u9009\uff09\",tooltip:\"\u60a8\u7559\u4e0b\u6d88\u606f\u7684\u5c0f\u8282\u6807\u9898\u3002\",value:c});break;case\"usertalk\":i.append({type:\"div\",label:\"\",style:\"color: red\",id:\"twinkle-talkback-optout-message\"}),i.append({type:\"input\",name:\"page\",label:\"\u7528\u6237\",tooltip:\"\u60a8\u7559\u4e0b\u6d88\u606f\u7684\u7528\u6237\u540d\u3002\",value:b}),i.append({type:\"input\",name:\"section\",label:\"\u5c0f\u8282\uff08\u53ef\u9009\uff09\",tooltip:\"\u60a8\u7559\u4e0b\u6d88\u606f\u7684\u5c0f\u8282\u6807\u9898\u3002\",value:c});break;case\"other\":i.append({type:\"div\",label:\"\",style:\"color: red\",id:\"twinkle-talkback-optout-message\"}),i.append({type:\"input\",name:\"page\",label:\"\u5b8c\u6574\u9875\u9762\u540d\",tooltip:\"\u60a8\u7559\u4e0b\u6d88\u606f\u7684\u5b8c\u6574\u9875\u9762\u540d\uff0c\u6bd4\u5982\u201cWikipedia talk:Twinkle\u201d\u3002\",value:b}),i.append({type:\"input\",name:\"section\",label:\"\u5c0f\u8282\uff08\u53ef\u9009\uff09\",tooltip:\"\u60a8\u7559\u4e0b\u6d88\u606f\u7684\u5c0f\u8282\u6807\u9898\u3002\",value:c});break;case\"mail\":i.append({type:\"input\",name:\"section\",label:\"\u7535\u5b50\u90ae\u4ef6\u4e3b\u9898\uff08\u53ef\u9009\uff09\",tooltip:\"\u60a8\u53d1\u51fa\u7684\u7535\u5b50\u90ae\u4ef6\u7684\u4e3b\u9898\u3002\"})}\"notice\"!==f&&i.append({type:\"textarea\",label:\"\u9644\u52a0\u4fe1\u606f\uff08\u53ef\u9009\uff09\uff1a\",name:\"message\",tooltip:\"\u4f1a\u5728\u56de\u590d\u901a\u544a\u6a21\u677f\u4e0b\u51fa\u73b0\u7684\u6d88\u606f\uff0c\u60a8\u7684\u7b7e\u540d\u4f1a\u88ab\u52a0\u5728\u6700\u540e\u3002\"}),i=i.render(),g.replaceChild(i,h),g.message&&(g.message.value=d),Twinkle.talkback.optout&&a(\"#twinkle-talkback-optout-message\").append(Twinkle.talkback.optout)},f=function(a){var f,g,h,i,j,b=a.target.getChecked(\"tbtarget\")[0],c=null,d=a.target.section.value,e=mw.config.get(\"wgFormattedNamespaces\")[mw.config.get(\"wgNamespaceIds\").user_talk]+\":\"+mw.config.get(\"wgRelevantUserName\");if(\"usertalk\"===b||\"other\"===b)if(c=a.target.page.value,\"usertalk\"===b){if(!c)return alert(\"\u60a8\u5fc5\u987b\u6307\u5b9a\u7528\u6237\u540d\u3002\"),void 0}else if(!c)return alert(\"\u60a8\u5fc5\u987b\u6307\u5b9a\u9875\u9762\u540d\u3002\"),void 0;a.target.message&&(f=a.target.message.value),Morebits.simpleWindow.setButtonsEnabled(!1),Morebits.status.init(a.target),Morebits.wiki.actionCompleted.redirect=e,Morebits.wiki.actionCompleted.notice=\"\u56de\u590d\u901a\u544a\u5b8c\u6210\uff0c\u5c06\u5728\u51e0\u79d2\u5185\u5237\u65b0\",g=new Morebits.wiki.page(e,\"\u6dfb\u52a0\u56de\u590d\u901a\u544a\"),h=\"mytalk\"===b?mw.config.get(\"wgUserName\"):c,\"mail\"===b?(i=\"\\n\\n==\"+Twinkle.getFriendlyPref(\"mailHeading\")+\"==\\n{{you've got mail|subject=\",i+=d+\"|ts=~~\"+\"~~}}\",f?i+=\"\\n\"+f.trim()+\"--~~\"+\"~\":Twinkle.getFriendlyPref(\"insertTalkbackSignature\")&&(i+=\"\\n~~\"+\"~\"),g.setEditSummary(\"\u901a\u77e5\uff1a\u6709\u65b0\u90ae\u4ef6\"+Twinkle.getPref(\"summaryAd\"))):(i=\"\\n\\n==\"+Twinkle.getFriendlyPref(\"talkbackHeading\").replace(/^\\s*=+\\s*(.*?)\\s*=+$\\s*/,\"$1\")+\"==\\n{{talkback|\",i+=h,d&&(i+=\"|\"+d),i+=\"|ts=~~\"+\"~~}}\",f?i+=\"\\n\"+f.trim()+\"--~~\"+\"~\":Twinkle.getFriendlyPref(\"insertTalkbackSignature\")&&(i+=\"\\n~~\"+\"~\"),j=\"\u56de\u590d\u901a\u544a\uff08[[\",\"other\"===b||/^\\s*user talk:/i.test(h)||(j+=\"User talk:\"),j+=h+(d?\"#\"+d:\"\")+\"]]\uff09\",g.setEditSummary(j+Twinkle.getPref(\"summaryAd\"))),g.setAppendText(i),g.setCreateOption(\"recreate\"),g.setMinorEdit(Twinkle.getFriendlyPref(\"markTalkbackAsMinor\")),g.setFollowRedirect(!0),g.append()}}(jQuery);"}}}