{"parse":{"title":"User:\u6771\u6771\u541b/js/lockSummary.js","pageid":291664,"wikitext":{"*":"/*\n\t\u52a0\u8f7d\u540e\u5c06\u5728\u6458\u8981\u680f\u53f3\u4fa7\u751f\u6210\u4e00\u4e2a\u5c0f\u9501\u56fe\u6807\uff0c\u5728\u9501\u5b9a\u65f6\u6253\u5f00\u7f16\u8f91\u9875\u9762\u5c31\u4f1a\u81ea\u52a8\u5728\u6458\u8981\u680f\u4e2d\u6dfb\u52a0\u6700\u540e\u4e00\u6b21\u4e0a\u9501\u65f6\u6458\u8981\u680f\u4e2d\u7684\u6587\u5b57\n*/\n\n$(function(){\n\tif(! /action=(edit|submit)/.test(location.href)){ return false }\n\tvar lockIcon = 'https://i.loli.net/2018/08/12/5b6f8ffac3db6.png',\n\tlockedIcon = 'https://i.loli.net/2018/08/12/5b6f85c3134fe.png',\n\tsummary = $('#wpSummary')\n\tsetTimeout(function(){\n\t\tvar locked = localStorage.getItem('lockSummary-locked')\n\t\tvar statusIcon = lockIcon\n\t\tif(locked){\n\t\t\tvar text = localStorage.getItem('lockSummary-text')\n\t\t\tsummary.val(text)\n\t\t\tnew mw.Api().get({\n\t\t\t\t\"action\": \"parse\",\n\t\t\t\t\"format\": \"json\",\n\t\t\t\t\"summary\": text,\n\t\t\t\t\"prop\": \"\"\n\t\t\t}).done(function(data){\n\t\t\t\tif(! $('.mw-summary-preview .comment').length){\n\t\t\t\t\t$('#wpSummaryLabel').after('<div class=\"mw-summary-preview\">\u7f16\u8f91\u6458\u8981\u7684\u9884\u89c8\uff1a <span class=\"comment\" style=\"font-style:italic;\"></span></div>')\n\t\t\t\t}\n\t\t\t\t$('.mw-summary-preview .comment').html('\uff08' + data.parse.parsedsummary['*'] + '\uff09')\n\t\t\t})\n\t\t\tvar statusIcon = lockedIcon\n\t\t}\n\t\t$('#wpSummaryWidget').append('<img src=\"' + statusIcon + '\" id=\"lockSummary\" style=\"width:25px; position:absolute; top:0; right:0; transform:translateY(calc(-100% - 2px)); cursor:pointer;\" />')\n\t\t$('#lockSummary').click(function(){\n\t\t\tif(! locked){\n\t\t\t\tlocalStorage.setItem('lockSummary-text', summary.val())\t\t\t\t\t\t\t\n\t\t\t\tlocalStorage.setItem('lockSummary-locked', 'true')\n\t\t\t\tlocked = true\n\t\t\t\t$(this).attr('src', lockedIcon)\t\t\t\n\t\t\t}else{\n\t\t\t\tlocalStorage.removeItem('lockSummary-locked')\n\t\t\t\tlocked = false\n\t\t\t\t$(this).attr('src', lockIcon)\n\t\t\t}\n\t\t})\n\t}, 1000)\n})"}}}