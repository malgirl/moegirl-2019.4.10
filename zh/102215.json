{"parse":{"title":"MediaWiki:Gadget-twinkleclose.js","pageid":164863,"wikitext":{"*":"//\u672cjs\u5f15\u81ea\u4e2d\u6587\u7ef4\u57fa\u767e\u79d1[[zhwiki:Special:Permalink/39605553]]\n!function(a){Twinkle.close=function(){var b,c,d,e,f;Morebits.userIsInGroup(\"sysop\")&&/^Wikipedia:(\u9801\u9762|\u6a94\u6848)\u5b58\u5ee2\u8a0e\u8ad6\\/\u8a18\u9304\\/\\d+\\/\\d+\\/\\d+$/.test(mw.config.get(\"wgPageName\"))&&(b=function(a,b){var c=document.createElement(\"span\");return c.style.color=a,c.appendChild(document.createTextNode(b)),c},c=\":has(.mw-headline a:only-of-type):not(:has(+ div.NavFrame))\",d=a(\"#bodyContent\").find(\"h2\"+c+\":not(:has(+ p + h3)), h3\"+c),e=document.createElement(\"strong\"),f=document.createElement(\"a\"),f.appendChild(b(\"Black\",\"[\")),f.appendChild(b(\"Red\",\"\u5173\u95ed\u8ba8\u8bba\")),f.appendChild(b(\"Black\",\"]\")),e.appendChild(f),d.each(function(b,c){var f,g,h,i,j,d=a(c).find(\".mw-headline a\").attr(\"href\");f=-1===d.indexOf(\"redlink=1\")?d.slice(6):d.slice(19,-22),f=decodeURIComponent(f),g=a(c).find(\".mw-headline a\").hasClass(\"new\"),h=/section=(\\d+)/.exec(a(c).find(\".mw-editsection a\").attr(\"href\"))[1],i=c.getElementsByClassName(\"mw-headline\")[0],i.appendChild(document.createTextNode(\" \")),j=e.cloneNode(!0),j.firstChild.href=\"#\"+h,a(j.firstChild).click(function(){return Twinkle.close.callback(f,h,g),!1}),i.appendChild(j)}))},Twinkle.close.codes={\"\u8bf7\u6c42\u65e0\u6548\":{ir:{label:\"\u8bf7\u6c42\u65e0\u6548\",action:\"keep\"},rep:{label:\"\u91cd\u590d\u63d0\u51fa\uff0c\u65e0\u6548\",action:\"keep\"},commons:{label:\"\u5e94\u5728\u7ef4\u57fa\u5171\u4eab\u8d44\u6e90\u63d0\u8bf7\",action:\"keep\"},ne:{label:\"\u76ee\u6807\u9875\u9762\u6216\u6863\u6848\u4e0d\u5b58\u5728\uff0c\u65e0\u6548\",action:\"keep\"},nq:{label:\"\u63d0\u5220\u8005\u672a\u53d6\u5f97\u63d0\u5220\u8d44\u683c\uff0c\u65e0\u6548\",action:\"keep\"}},\"\u4fdd\u7559\":{k:{label:\"\u4fdd\u7559\",action:\"keep\"},sk:{label:\"\u5feb\u901f\u4fdd\u7559\",action:\"keep\"},tk:{label:\"\u6682\u65f6\u4fdd\u7559\",action:\"keep\"},rr:{label:\"\u8bf7\u6c42\u7406\u7531\u6d88\u5931\",action:\"keep\"},dan:{label:\"\u5220\u540e\u91cd\u5efa\",action:\"keep\"}},\"\u5220\u9664\":{d:{label:\"\u5220\u9664\",action:\"del\",selected:!0},ic:{label:\"\u56fe\u50cf\u56e0\u4fb5\u6743\u88ab\u5220\",action:\"del\"}},\"\u5feb\u901f\u5220\u9664\":{sd:{label:\"\u5feb\u901f\u5220\u9664\",action:\"del\"},lssd:{label:\"\u65e0\u6765\u6e90\u6216\u7248\u6743\u8d44\u8baf\uff0c\u5feb\u901f\u5220\u9664\",action:\"del\"},svg:{label:\"\u5df2\u6539\u7528SVG\u56fe\u5f62\uff0c\u5feb\u901f\u5220\u9664\",action:\"del\"},nowcommons:{label:\"\u7ef4\u57fa\u5171\u4eab\u8d44\u6e90\u5df2\u63d0\u4f9b\uff0c\u5feb\u901f\u5220\u9664\",action:\"del\"},drep:{label:\"\u591a\u6b21\u88ab\u5220\u9664\uff0c\u6761\u76ee\u9501\u5b9a\",action:\"del\"}},\"\u8f6c\u79fb\u81f3\u5176\u4ed6\u7ef4\u57fa\u8ba1\u5212\":{twc:{label:\"\u8f6c\u79fb\u81f3\u7ef4\u57fa\u5171\u4eab\u8d44\u6e90\",action:\"noop\"},twn:{label:\"\u8f6c\u79fb\u81f3\u7ef4\u57fa\u65b0\u95fb\",action:\"noop\"},tws:{label:\"\u8f6c\u79fb\u81f3\u7ef4\u57fa\u6587\u5e93\",action:\"noop\"},twb:{label:\"\u8f6c\u79fb\u81f3\u7ef4\u57fa\u6559\u79d1\u4e66\",action:\"noop\"},twq:{label:\"\u8f6c\u79fb\u81f3\u7ef4\u57fa\u8bed\u5f55\",action:\"noop\"},twt:{label:\"\u8f6c\u79fb\u81f3\u7ef4\u57fa\u8bcd\u5178\",action:\"noop\"},two:{label:\"\u8f6c\u79fb\u81f3\u5176\u4ed6\u7ef4\u57fa\u8ba1\u5212\",action:\"noop\"}},\"\u5176\u4ed6\u5904\u7406\u65b9\u6cd5\":{c:{label:\"\u8f6c\u4ea4\u4fb5\u6743\",action:\"noop\"},m2ifd:{label:\"\u8f6c\u9001\u6587\u4ef6\u5b58\u5e9f\u8ba8\u8bba\",action:\"noop\"},r:{label:\"\u91cd\u5b9a\u5411\",action:\"noop\"},cr:{label:\"\u5206\u7c7b\u91cd\u5b9a\u5411\",action:\"noop\"},m:{label:\"\u79fb\u52a8\",action:\"noop\"},merge:{label:\"\u5e76\u5165\",action:\"noop\"},nc:{label:\"\u65e0\u5171\u8bc6\",action:\"keep\"}}},Twinkle.close.callback=function(b,c,d){var f,g,h,i,j,k,e=new Morebits.simpleWindow(400,150);e.setTitle(\"\u5173\u95ed\u5b58\u5e9f\u8ba8\u8bba \u00b7 \"+b),e.setScriptName(\"Twinkle\"),e.addFooterLink(\"Twinkle\u5e2e\u52a9\",\"WP:TW/DOC#close\"),f=new Morebits.quickForm(Twinkle.close.callback.evaluate),f.append({type:\"select\",label:\"\u5904\u7406\u7ed3\u679c\uff1a\",name:\"sub_group\",event:Twinkle.close.callback.change_code}),f.append({type:\"input\",name:\"remark\",label:\"\u8865\u5145\u8bf4\u660e\uff1a\"}),f.append({type:\"checkbox\",list:[{label:\"\u53ea\u5173\u95ed\u8ba8\u8bba\uff0c\u4e0d\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\",value:\"noop\",name:\"noop\",checked:d}]}),f.append({type:\"submit\"}),g=f.render(),e.setContent(g),e.display(),h=g.getElementsByTagName(\"select\")[0],i={title:b,section:parseInt(c),noop:d},a(g).data(\"resultData\",i),j=function(b,c){a.each(b,function(b,d){var e=\"string\"==typeof b?b:d.value,f=new Morebits.quickForm.element({type:\"option\",label:e+\"\uff1a\"+d.label,value:e,selected:d.selected}),g=c.appendChild(f.render());a(g).data(\"messageData\",d)})},a.each(Twinkle.close.codes,function(a,b){var c=new Morebits.quickForm.element({type:\"optgroup\",label:a});c=c.render(),h.appendChild(c),j(b,c)}),k=document.createEvent(\"Event\"),k.initEvent(\"change\",!0,!0),g.sub_group.dispatchEvent(k)},Twinkle.close.callback.change_code=function(b){var c=a(b.target.form).data(\"resultData\"),d=a(b.target).find('option[value=\"'+b.target.value+'\"]').data(\"messageData\"),e=b.target.form.noop;c.noop||\"noop\"===d.action?(e.checked=!0,e.disabled=!0):(e.checked=!1,e.disabled=!1)},Twinkle.close.callback.evaluate=function(b){var h,c=b.target.sub_group.value,d=a(b.target).data(\"resultData\"),e=a(b.target.sub_group).find('option[value=\"'+c+'\"]').data(\"messageData\"),f=b.target.noop.checked,g={title:d.title,code:c,remark:b.target.remark.value,section:d.section,messageData:e};if(Morebits.simpleWindow.setButtonsEnabled(!1),Morebits.status.init(b.target),Morebits.wiki.actionCompleted.notice=\"\u64cd\u4f5c\u5b8c\u6210\",f||\"noop\"===e.action)Twinkle.close.callbacks.talkend(g);else switch(e.action){case\"del\":Twinkle.close.callbacks.del(g);break;case\"keep\":h=new Morebits.wiki.page(g.title,\"\u79fb\u9664\u5b58\u5e9f\u8ba8\u8bba\u6a21\u677f\"),h.setCallbackParameters(g),h.load(Twinkle.close.callbacks.keep);break;default:return alert(\"Twinkle.close\uff1a\u672a\u5b9a\u4e49 \"+c),void 0}},Twinkle.close.callbacks={del:function(a){Morebits.wiki.addCheckpoint();var b=new Morebits.wiki.page(a.title,\"\u5220\u9664\u9875\u9762\");b.setEditSummary(\"\u5b58\u5e9f\u8ba8\u8bba\u901a\u8fc7\uff1a[[\"+mw.config.get(\"wgPageName\")+\"]]\"+Twinkle.getPref(\"deletionSummaryAd\")),b.deletePage(function(){b.getStatusElement().info(\"\u5b8c\u6210\"),Twinkle.close.callbacks.talkend(a)}),Morebits.wiki.removeCheckpoint()},keep:function(a){var c,d,e,f,g,h,i,j,b=a.getStatusElement();return a.exists()?(c=a.getPageText(),d=a.getCallbackParameters(),e=mw.Title.newFromText(d.title),0===e.getNamespaceId()%2&&(f=new mw.Title(e.getMainText(),e.getNamespaceId()+1),g=new Morebits.wiki.page(f.toString(),\"\u6807\u8bb0\u8ba8\u8bba\u9875\"),h=\"{{vfd-kept|\"+mw.config.get(\"wgPageName\").split(\"/\").slice(2).join(\"/\")+\"|\"+d.messageData.label+\"}}\\n\",g.setPrependText(h),g.setEditSummary(\"[[\"+mw.config.get(\"wgPageName\")+\"]]\uff1a\"+d.messageData.label+Twinkle.getPref(\"summaryAd\")),g.setCreateOption(\"recreate\"),g.prepend()),i=c.replace(/<noinclude>\\s*\\{\\{([rsaiftcmv]fd)\\|[^{}]*?\\}\\}\\s*<\\/noinclude>\\s*/gi,\"\"),i=i.replace(/\\{\\{([rsaiftcmv]fd)\\|[^{}]*?\\}\\}\\s*/gi,\"\"),\"tk\"!==d.code&&(i=i.replace(/\\{\\{(notability)\\|[^{}]*?\\}\\}\\n*/gi,\"\"),i=i.replace(/\\{\\{(substub)\\|[^{}]*?\\}\\}\\n*/gi,\"\")),i===c?(b.warn(\"\u672a\u627e\u5230\u5b58\u5e9f\u8ba8\u8bba\u6a21\u677f\uff0c\u53ef\u80fd\u5df2\u88ab\u79fb\u9664\"),Twinkle.close.callbacks.talkend(d),void 0):(j=\"\u5b58\u5e9f\u8ba8\u8bba\u5173\u95ed\uff1a[[\"+mw.config.get(\"wgPageName\")+\"]]\",a.setPageText(i),a.setEditSummary(j+Twinkle.getPref(\"summaryAd\")),a.setCreateOption(\"nocreate\"),a.save(Twinkle.close.callbacks.keepComplete),void 0)):(b.error(\"\u9875\u9762\u4e0d\u5b58\u5728\uff0c\u53ef\u80fd\u5df2\u88ab\u5220\u9664\"),void 0)},keepComplete:function(a){var b=a.getCallbackParameters();Twinkle.close.callbacks.talkend(b)},talkend:function(a){var b=new Morebits.wiki.page(mw.config.get(\"wgPageName\"),\"\u5173\u95ed\u8ba8\u8bba\");b.setCallbackParameters(a),b.setPageSection(a.section),b.load(Twinkle.close.callbacks.saveTalk)},saveTalk:function(a){var e,f,g,h,b=a.getStatusElement(),c=a.getPageText(),d=a.getCallbackParameters();return-1!==c.indexOf(\"{{delh\")?(b.error(\"\u8ba8\u8bba\u5df2\u88ab\u5173\u95ed\"),void 0):(e=-1!==c.indexOf(\"<section begin=backlog />\"),f=-1!==c.indexOf(\"<section end=backlog />\"),c=c.replace(\"\\n<section begin=backlog />\",\"\"),c=c.replace(\"\\n<section end=backlog />\",\"\"),g=c.split(\"\\n----\\n\"),h=g[0].split(\"\\n\"),c=h[0]+\"\\n{{delh|\"+d.code+\"}}\\n\"+h.slice(1).join(\"\\n\"),c+=\"\\n----\\n: \"+d.messageData.label,c+=d.remark?\"\uff1a\"+d.remark:\"\u3002\",c+=\"--~~\"+\"~\\n{{delf}}\",g[1]&&(c+=\"\\n----\\n\"+g.slice(1).join(\"\\n----\\n\")),f&&(c+=\"\\n<section end=backlog />\"),e&&(c+=\"\\n<section begin=backlog />\"),a.setPageText(c),a.setEditSummary(\"/* \"+d.title+\" */ \"+d.messageData.label+Twinkle.getPref(\"summaryAd\")),a.setCreateOption(\"nocreate\"),a.save(Twinkle.close.callbacks.disableLink),void 0)},disableLink:function(b){var c=b.getCallbackParameters();a(\"strong a[href=#\"+c.section+\"] span\").css(\"color\",\"grey\")}}}(jQuery);"}}}