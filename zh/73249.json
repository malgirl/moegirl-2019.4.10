{"parse":{"title":"User:SegFault/wiki.py","pageid":165464,"wikitext":{"*":"<poem><nowiki>\nfrom urllib.request import urlopen\nimport json\n\ndef getShipName(ship):\n    name = ship['title'].strip()\n    idx = int(ship['shipIndex'])\n    if idx < 1000 or name in [ '\u91cd\u5e86', '\u5965\u5e0c\u91d1\u65af', '\u4fe1\u8d56', '\u841d\u5fb7\u5c3c' ]:\n        return name\n    elif idx < 2000:\n        return name + '\u00b7\u6539'\n    else:\n        return name + '(\u7279\u6b8a)'\n\ndef getShipEquipts(ship, equipts):\n    ret = [ '\u88c5\u5907\u4e0d\u53ef' ] * 4\n    n = len(ship['equipment'])\n    for i in range(n):\n        ret[i] = [ e['title'] for e in equipts if e['cid'] == ship['equipment'][i] ][0]\n    for i in range(n, ship['equipmentNum']):\n        ret[i] = '\u672a\u88c5\u5907'\n    return ret\n\ndef getMainAttr(ship, allShips, equipts):\n    st = ship['strengthenTop']\n    exp = ship['strengthenLevelUpExp']\n\n    cap = [ 0 ] * 4\n    if ship['capacityInit']:\n        for i in range(len(ship['capacityInit'])):\n            cap[i] = ship['capacityInit'][i]\n\n    eq = [ '\u88c5\u5907\u4e0d\u53ef' ] * 4\n    n = len(ship['equipment'])\n    for i in range(n):\n        eq[i] = [ e['title'] for e in equipts if e['cid'] == ship['equipment'][i] ][0]\n    for i in range(n, ship['equipmentNum']):\n        eq[i] = '\u672a\u88c5\u5907'\n\n    t = [ '', '\u65e5\u672c', '\u5fb7\u56fd', '\u82f1\u56fd', '\u7f8e\u56fd', '\u610f\u5927\u5229', '\u6cd5\u56fd', '\u82cf\u8054', '\u4e2d\u56fd', '???' ]\n    country = t[int(ship['country'])]\n    t = { '\u6208\u672c':'\u571f\u8033\u5176', '\u5fb7\u00b7\u9c81\u4f0a\u7279':'\u8377\u5170', '\u82cf\u8d6b\u5df4\u6258\u5c14':'\u8499\u53e4', '\u5965\u5e0c\u91d1\u65af':'\u667a\u5229' }\n    if ship['title'] in t:\n        country = t[ship['title']]\n\n    ret = \"ships['%s'] = {\\n    \" % getShipName(ship)\n\n    ret += \"index=%s, \" % int(ship['shipIndex'])\n    ret += \"rarity=%s, \" % ship['star']\n    t = [ '', 'CV', 'CVL', 'AV', 'BB', 'BBV', 'BC', 'CA', 'CAV', 'CLT', 'CL', 'BM', 'DD', 'SSV', 'SS', 'SC', 'AP' ]\n    ret += \"type='%s', \" % t[ship['type']]\n    ret += \"country='%s', \" % country\n    ret += \"class='%s', \" % ship['classNo']\n\n    ret = ret[:-1] + '\\n    '\n\n    ret += \"hp=%s, \" % ship['hp']\n    ret += \"atk=%s, \" % ship['atk']\n    ret += \"tpd=%s, \" % ship['torpedo']\n    ret += \"def=%s, \" % ship['def']\n    ret += \"aa=%s, \" % ship['airDef']\n    ret += \"eva=%s, \" % ship['miss']\n    ret += \"as=%s, \" % ship['antisub']\n    ret += \"rec=%s, \" % ship['radar']\n    ret += \"speed=%s, \" % ship['speed']\n    ret += \"luck=%s, \" % ship['luck']\n    t = [ '', '\u77ed', '\u4e2d', '\u957f', '\u8d85\u957f' ]\n    ret += \"range='%s', \" % t[ship['range']]\n\n    ret = ret[:-1] + '\\n    '\n\n    ret += \"atkMax=%s, \" % (int(ship['atk']) + st['atk'] // exp)\n    ret += \"tpdMax=%s, \" % (int(ship['torpedo']) + st['torpedo'] // exp)\n    ret += \"defMax=%s, \" % (ship['def'] + st['def'] // exp)\n    ret += \"aaMax=%s, \" % (int(ship['airDef']) + st['air_def'] // exp)\n    ret += \"evaMax=%s, \" % ship['missMax']\n    ret += \"asMax=%s, \" % ship['antisubMax']\n    ret += \"recMax=%s, \" % ship['radarMax']\n\n    ret = ret[:-1] + '\\n    '\n\n    ret += \"cap1=%s, \" % cap[0]\n    ret += \"cap2=%s, \" % cap[1]\n    ret += \"cap3=%s, \" % cap[2]\n    ret += \"cap4=%s, \" % cap[3]\n    ret += \"eq1='%s', \" % eq[0]\n    ret += \"eq2='%s', \" % eq[1]\n    ret += \"eq3='%s', \" % eq[2]\n    ret += \"eq4='%s', \" % eq[3]\n\n    ret = ret[:-1] + '\\n    '\n\n    ret += \"sFuel=%s, \" % ship['maxOil']\n    ret += \"sAmmo=%s, \" % ship['maxAmmo']\n    ret += \"rFuel=%s, \" % ship['repairOilModulus']\n    ret += \"rSteel=%s, \" % ship['repairSteelModulus']\n    ret += \"sAtk=%s, \" % ship['strengthenSupplyExp']['atk']\n    ret += \"sTpd=%s, \" % ship['strengthenSupplyExp']['torpedo']\n    ret += \"sDef=%s, \" % ship['strengthenSupplyExp']['def']\n    ret += \"sAa=%s, \" % ship['strengthenSupplyExp']['air_def']\n\n    t = [ s for s in allShips if int(s['shipIndex']) - int(ship['shipIndex']) == 1000 ]\n    if len(t) != 0:\n        mod = { '2':0, '3':0, '4':0, '9':0 }\n        for k,v in ship['evoNeedResource'].items():\n            mod[k] = v\n\n        ret = ret[:-1] + '\\n    '\n        ret += \"mod='%s', \" % getShipName(t[0])\n        ret += \"modLv=%s, \" % ship['evoLevel']\n        t = { 10441:'\u9a71\u9010', 10341:'\u5de1\u6d0b', 10241:'\u6218\u5217', 10141:'\u822a\u6bcd', 10541:'\u6f5c\u8247' }\n        ret += \"coreType='%s', \" % t[ship['evoNeedItemCid']]\n        ret += \"coreNum=%s, \" % ship['evoNeedResource'][str(ship['evoNeedItemCid'])]\n        ret += \"mFuel=%s, \" % mod['2']\n        ret += \"mAmmo=%s, \" % mod['3']\n        ret += \"mSteel=%s, \" % mod['4']\n        ret += \"mBaux=%s, \" % mod['9']\n\n    return ret[:-2] + '\\n}\\n'\n\n\ndef getDialogue(ship):\n    name = getShipName(ship)\n    ret = \"dialogue['\" + name + \"']= { }\\n\"\n    ret += \"dialogue['\" + name + \"']['\u767b\u573a\u53f0\u8bcd'] = '\" + ship['getDialogue'].strip() + \"'\\n\"\n    ret += \"dialogue['\" + name + \"']['\u8a93\u7ea6\u53f0\u8bcd'] = '\" + ship['vow'].strip() + \"'\\n\"\n    if ship['mainDialogue'] and ship['mainDialogue'][0]:\n        ret += \"dialogue['\" + name + \"']['\u653e\u7f6e\u53f0\u8bcd1'] = '\" + ship['mainDialogue'][0].strip() + \"'\\n\"\n        ret += \"dialogue['\" + name + \"']['\u653e\u7f6e\u53f0\u8bcd2'] = '\" + ship['mainDialogue'][1].strip() + \"'\\n\"\n        ret += \"dialogue['\" + name + \"']['\u653e\u7f6e\u53f0\u8bcd3'] = '\" + ship['mainDialogue'][2].strip() + \"'\\n\"\n    if ship['mainDialogue'] and ship['mainDialogue'][6]:\n        ret += \"dialogue['\" + name + \"']['\u591c\u665a\u53f0\u8bcd1'] = '\" + ship['mainDialogue'][6].strip() + \"'\\n\"\n        ret += \"dialogue['\" + name + \"']['\u591c\u665a\u53f0\u8bcd2'] = '\" + ship['mainDialogue'][7].strip() + \"'\\n\"\n        ret += \"dialogue['\" + name + \"']['\u591c\u665a\u53f0\u8bcd3'] = '\" + ship['mainDialogue'][8].strip() + \"'\\n\"\n    if ship['atkDialogue']:\n        ret += \"dialogue['\" + name + \"']['\u653b\u51fb\u53f0\u8bcd'] = '\" + ship['atkDialogue'].strip() + \"'\\n\"\n    if ship['nightAtkDialogue']:\n        ret += \"dialogue['\" + name + \"']['\u591c\u6218\u53f0\u8bcd'] = '\" + ship['nightAtkDialogue'].strip() + \"'\\n\"\n    if ship['breakDialogue']:\n        ret += \"dialogue['\" + name + \"']['\u53d7\u4f24\u53f0\u8bcd'] = '\" + ship['breakDialogue'].strip() + \"'\\n\"\n    if ship['formationDialogue']:\n        ret += \"dialogue['\" + name + \"']['\u5907\u6218\u53f0\u8bcd'] = '\" + ship['formationDialogue'].strip() + \"'\\n\"\n    #ret = ret[:-1] + '\\n'\n    return ret + '\\n'\n\ndef run(data):\n    ships = [ s for s in data['shipCard'] if int(s['npc']) == 0 ]\n    f = open('\u5c5e\u6027.txt', 'w')\n    for s in ships:\n        f.write(getMainAttr(s, ships, data['shipEquipmnt']))\n        f.write('\\n')\n    f.close()\n\ndef formatEquipt(e):\n    ret = \"equipts['%s'] = { \" % e['title']\n    ret += 'index=%d, rarity=%d' % (int(e['equipIndex']), e['star'])\n    if e['atk'] != 0:           ret += ', atk=%d'   % e['atk']\n    if e['def'] != 0:           ret += ', def=%d'   % e['def']\n    if e['torpedo'] != 0:       ret += ', tpd=%d'   % e['torpedo']\n    if e['antisub'] != 0:       ret += ', as=%d'    % e['antisub']\n    if e['radar'] != 0:         ret += ', rec=%d'   % e['radar']\n    if e['hit'] != 0:           ret += ', acc=%d'   % e['hit']\n    if e['range'] != 0:         ret += ', range=%d' % e['range']\n    if e['miss'] != 0:          ret += ', eva=%d'   % e['miss']\n    if e['luck'] != 0:          ret += ', luck=%d'  % e['luck']\n    if e['aircraftAtk'] != 0:   ret += ', bomb=%d'  % e['aircraftAtk']\n    if e['airDef'] != 0:        ret += ', aa=%d'    % e['airDef']\n    if e['airDefCorrect'] != 0: ret += ', aac=%d'   % (e['airDefCorrect'] * 100)\n    if e['aluminiumUse'] != 0:  ret += ', baux=%d'  % e['aluminiumUse']\n    return ret + ' }'\n\ndef printShips(data):\n    ships = [ s for s in data['shipCard'] if int(s['npc']) == 0 ]\n\n    f = open('\u53f0\u8bcd.txt', 'w')\n    for s in ships:\n        f.write(getDialogue(s))\n    f.close()\n\n    ships = [ s for s in data['shipCard'] if int(s['npc']) == 0 and int(s['shipIndex']) < 2000 ]\n\n    f = open('\u5c5e\u6027.txt', 'w')\n    for s in ships:\n        f.write(getMainAttr(s, ships, data['shipEquipmnt']))\n        f.write('\\n')\n    f.close()\n\n    f = open('\u88c5\u5907.txt', 'w')\n    for equipt in data['shipEquipmnt']:\n        if equipt['picId'] == 998: continue\n        if equipt['title'] == '\u55b5': continue\n        f.write(formatEquipt(equipt))\n        f.write('\\n')\n    f.close()\n\ndef download():\n    j = urlopen('http://login.jianniang.com/index/getInitConfigs').read().decode('utf-8')\n    return json.loads(j)\n\nif __name__ == '__main__':\n    data = download()\n    printShips(data)\n</nowiki></poem>"}}}