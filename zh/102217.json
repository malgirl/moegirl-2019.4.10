{"parse":{"title":"MediaWiki:Gadget-twinklecopyvio.js","pageid":164865,"wikitext":{"*":"//\u672cjs\u5f15\u81ea\u4e2d\u6587\u7ef4\u57fa\u767e\u79d1[[zhwiki:Special:Permalink/32272487]]\n!function(){Twinkle.copyvio=function(){mw.config.get(\"wgNamespaceNumber\")<0||!mw.config.get(\"wgArticleId\")||6===mw.config.get(\"wgNamespaceNumber\")&&(document.getElementById(\"mw-sharedupload\")||!document.getElementById(\"mw-imagepage-section-filehistory\")&&!Morebits.wiki.isPageRedirect())||Twinkle.addPortletLink(Twinkle.copyvio.callback,\"\u4fb5\u6743\",\"tw-copyvio\",\"\u63d0\u62a5\u4fb5\u6743\u9875\u9762\",\"\")},Twinkle.copyvio.callback=function(){var b,c,a=new Morebits.simpleWindow(600,350);a.setTitle(\"\u63d0\u62a5\u4fb5\u6743\u9875\u9762\"),a.setScriptName(\"Twinkle\"),a.addFooterLink(\"Twinkle\u5e2e\u52a9\",\"WP:TW/DOC#copyvio\"),b=new Morebits.quickForm(Twinkle.copyvio.callback.evaluate),b.append({type:\"textarea\",label:\"\u4fb5\u6743\u6765\u6e90\uff1a\",name:\"source\"}),b.append({type:\"checkbox\",list:[{label:\"\u901a\u77e5\u9875\u9762\u521b\u5efa\u8005\",value:\"notify\",name:\"notify\",tooltip:\"\u5728\u9875\u9762\u521b\u5efa\u8005\u5bf9\u8bdd\u9875\u4e0a\u653e\u7f6e\u4e00\u901a\u77e5\u6a21\u677f\u3002\",checked:!0}]}),b.append({type:\"submit\"}),c=b.render(),a.setContent(c),a.display()},Twinkle.copyvio.callbacks={main:function(a){var d,e,b=a.getCallbackParameters(),c=a.getCreator();if(wikipedia_page=new Morebits.wiki.page(b.logpage,\"\u6dfb\u52a0\u4fb5\u6743\u8bb0\u5f55\u9879\"),wikipedia_page.setFollowRedirect(!0),wikipedia_page.setCallbackParameters(b),wikipedia_page.load(Twinkle.copyvio.callbacks.copyvioList),b.usertalk){switch(d=new Morebits.wiki.page(\"User talk:\"+c,\"\u901a\u77e5\u9875\u9762\u521b\u5efa\u8005\uff08\"+c+\"\uff09\"),e=\"\\n{{subst:CopyvioNotice|\"+mw.config.get(\"wgPageName\")+\"}}\",d.setAppendText(e),d.setEditSummary(\"\u901a\u77e5\uff1a\u9875\u9762[[\"+mw.config.get(\"wgPageName\")+\"]]\u7591\u4f3c\u4fb5\u72af\u7248\u6743\"+Twinkle.getPref(\"summaryAd\")),d.setCreateOption(\"recreate\"),Twinkle.getPref(\"copyvioWatchUser\")){case\"yes\":d.setWatchlist(!0);break;case\"no\":d.setWatchlistFromPreferences(!1);break;default:d.setWatchlistFromPreferences(!0)}d.setFollowRedirect(!0),d.append()}},taggingArticle:function(a){var b=a.getCallbackParameters(),c=\"{{subst:Copyvio/auto|url=\"+b.source.replace(/http/g,\"&#104;ttp\").replace(/\\n+/g,\"\\n\").replace(/^\\s*([^\\*])/gm,\"* $1\").replace(/^\\* $/m,\"\")+\"}}\";switch(/\\/temp$/i.test(mw.config.get(\"wgPageName\"))&&(c=\"{{D|G16}}\\n\"+c),a.setPageText(c),a.setEditSummary(\"\u672c\u9875\u9762\u7591\u4f3c\u4fb5\u72af\u7248\u6743\"+Twinkle.getPref(\"summaryAd\")),Twinkle.getPref(\"copyvioWatchPage\")){case\"yes\":a.setWatchlist(!0);break;case\"no\":a.setWatchlistFromPreferences(!1);break;default:a.setWatchlistFromPreferences(!0)}a.save(),Twinkle.getPref(\"markCopyvioPagesAsPatrolled\")&&a.patrol()},copyvioList:function(a){a.getPageText(),a.getCallbackParameters(),a.setAppendText(\"\\n{{subst:CopyvioVFDRecord|\"+mw.config.get(\"wgPageName\")+\"}}\"),a.setEditSummary(\"\u6dfb\u52a0[[\"+mw.config.get(\"wgPageName\")+\"]]\"+Twinkle.getPref(\"summaryAd\")),a.setCreateOption(\"recreate\"),a.append()}},Twinkle.copyvio.callback.evaluate=function(a){var b,c,e,g,h;return mw.config.set(\"wgPageName\",mw.config.get(\"wgPageName\").replace(/_/g,\" \")),b=a.target.source.value,c=a.target.notify.checked,Morebits.simpleWindow.setButtonsEnabled(!1),Morebits.status.init(a.target),b.trim()?(g=\"Wikipedia:\u9801\u9762\u5b58\u5ee2\u8a0e\u8ad6/\u7591\u4f3c\u4fb5\u6b0a\",h={source:b,logpage:g,usertalk:c},Morebits.wiki.addCheckpoint(),Morebits.wiki.actionCompleted.redirect=mw.config.get(\"wgPageName\"),Morebits.wiki.actionCompleted.notice=\"\u63d0\u62a5\u5b8c\u6210\uff0c\u5c06\u5728\u51e0\u79d2\u5185\u5237\u65b0\",e=new Morebits.wiki.page(mw.config.get(\"wgPageName\"),\"\u6dfb\u52a0\u4fb5\u6743\u6a21\u677f\u5230\u9875\u9762\"),e.setFollowRedirect(!0),e.setCallbackParameters(h),e.load(Twinkle.copyvio.callbacks.taggingArticle),e=new Morebits.wiki.page(mw.config.get(\"wgPageName\")),e.setCallbackParameters(h),e.lookupCreator(Twinkle.copyvio.callbacks.main),Morebits.wiki.removeCheckpoint(),void 0):(Morebits.status.error(\"\u9519\u8bef\",\"\u672a\u6307\u5b9a\u4fb5\u6743\u6765\u6e90\"),void 0)}}(jQuery);"}}}