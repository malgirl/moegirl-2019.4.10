{"parse":{"title":"MediaWiki:Gadget-Edittools.js","pageid":42040,"wikitext":{"*":"/**\n * EditTools support: add a selector, change <a> into buttons.\n * The special characters to insert are defined at [[MediaWiki:Edittools]].\n *\n * @author Arnomane, 2006 (on the commons.wikimedia.org/wiki/MediaWiki:Edittools.js)\n * @author Kaganer, 2007 (adapting to www.mediawiki.org)\n * @author Krinkle, 2012\n * @source www.mediawiki.org/wiki/MediaWiki:Gadget-Edittools.js\n * @revision 2012-02-29\n */\n/*jslint browser: true*/\n/*global jQuery, mediaWiki*/\n(function ($, mw) {\n\t\"use strict\";\n\n\tvar conf, editTools, $sections;\n\n\tconf = {\n\t\tinitialSubset: window.EditTools_initial_subset === undefined ? window.EditTools_initial_subset : 0\n\t};\n\n\teditTools = {\n\n\t\t/**\n\t\t * Creates the selector\n\t\t */\n\t\tsetup: function () {\n\t\t\tvar $container, $select, initial;\n\n\t\t\t$container = $('#mw-edittools-charinsert');\n\t\t\tif (!$container.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$sections = $container.find('.mw-edittools-section');\n\t\t\tif ($sections.length <= 1) {\n\t\t\t\t// Only care if there is more than one\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$select = $('<select/>').css('display', 'inline');\n\n\t\t\tinitial = conf.initialSubset;\n\t\t\tif (isNaN(initial) || initial < 0 || initial >= $select.length) {\n\t\t\t\tinitial = 0;\n\t\t\t}\n\n\t\t\t$sections.each(function (i, el) {\n\t\t\t\tvar $section, sectionTitle, $option;\n\n\t\t\t\t$section = $(el);\n\t\t\t\tsectionTitle = $section.data('sectionTitle');\n\n\t\t\t\t$option = $('<option/>')\n\t\t\t\t\t.text(sectionTitle)\n\t\t\t\t\t.prop('value', i)\n\t\t\t\t\t.prop('selected', i === initial);\n\n\t\t\t\t$select.append($option);\n\t\t\t});\n\n\t\t\t$select.change(editTools.handleOnchange);\n\t\t\t$container.prepend($select);\n\n\t\t\teditTools.chooseSection(initial);\n\t\t},\n\n\t\t/**\n\t\t * Handle onchange event of the <select>\n\t\t *\n\t\t * @context {Element}\n\t\t * @param e {jQuery.Event}\n\t\t */\n\t\thandleOnchange: function () {\n\t\t\teditTools.chooseSection(Number($(this).val()));\n\n\t\t\treturn true;\n\t\t},\n\n\t\t/**\n\t\t * Toggle the currently visible section\n\t\t *\n\t\t * @param sectionNr {Number}\n\t\t * @param setFocus {Boolean}\n\t\t */\n\t\tchooseSection: function (sectionNr) {\n\t\t\tvar $choise = $sections.eq(sectionNr);\n\t\t\tif ($choise.length !== 1) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Making these buttons is a little slow,\n\t\t\t// If we made them all at once the browser would hang\n\t\t\t// for over 2 seconds, so instead we're doing it on-demand\n\t\t\t// for each section. No need to do it twice thoguh, so remember\n\t\t\t// in data whether it was done already\n\t\t\tif (!$choise.data('charInsert.buttonsMade')) {\n\t\t\t\t$choise.data('charInsert.buttonsMade', true);\n\t\t\t\teditTools.makeButtons($choise);\n\t\t\t}\n\n\t\t\t$choise.show();\n\t\t\t$sections.not($choise).hide();\n\t\t},\n\n\t\t/**\n\t\t * Convert the <a onclick> links to buttons in a given section.\n\t\t *\n\t\t * @param $section {jQuery}\n\t\t */\n\t\tmakeButtons: function ($section) {\n\t\t\tvar $links;\n\n\t\t\tif (!$section.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$links = $section.find('a');\n\t\t\t$links.each(function (i, a) {\n\t\t\t\tvar $a, button;\n\t\t\t\t$a = $(a);\n\t\t\t\tbutton = document.createElement('input');\n\t\t\t\tbutton.type = 'button';\n\t\t\t\tbutton.onclick = a.onclick;\n\t\t\t\tbutton.value = $a.text();\n\t\t\t\t$a.replaceWith(button);\n\t\t\t});\n\t\t}\n\n\t};\n\n\t$(document).ready(editTools.setup);\n\n}(jQuery, mediaWiki));"}}}