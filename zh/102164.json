{"parse":{"title":"MediaWiki:Gadget-allmessageFilter.js","pageid":243711,"wikitext":{"*":"// <pre>\n(function(isCompleted) {\n    function load() {\n        if (mw.config.get('wgNamespaceNumber') !== -1 || mw.config.get('wgCanonicalSpecialPageName') !== \"Allmessages\") return;\n        mw.util.addCSS([\n            \".TablePager_nav {\",\n            \"    user-select: none;\",\n            \"}\",\n            \".TablePager_nav-enabled {\",\n            \"    cursor: pointer;\",\n            \"}\",\n            \"#mw-allmessages-filter-status {\",\n            \"    color: red;\",\n            \"}\"\n        ].join('\\n'));\n        var containter = $('<fieldset/>'),\n            api = new mw.Api(),\n            length = +$('#mw-table_pager_limit_label').val();\n        var index = 0,\n            filter, rfilter, am;\n        var enablePrevLink = function enablePrevLink(b) {\n            if (!b) $('.TablePager_nav-prev div').removeClass(\"TablePager_nav-enabled\").addClass(\"TablePager_nav-disabled\");\n            else $('.TablePager_nav-prev div').removeClass(\"TablePager_nav-disabled\").addClass(\"TablePager_nav-enabled\");\n        };\n        var enableNextLink = function enableNextLink(b) {\n            if (!b) $('.TablePager_nav-next div').removeClass(\"TablePager_nav-enabled\").addClass(\"TablePager_nav-disabled\");\n            else $('.TablePager_nav-next div').removeClass(\"TablePager_nav-disabled\").addClass(\"TablePager_nav-enabled\");\n        };\n        var check = function check(am) {\n            if (am.length <= length) {\n                enableNextLink(false);\n                enablePrevLink(false);\n            } else if (index === 0) {\n                enablePrevLink(false);\n                enableNextLink(true);\n            } else if (index + length < am.length) {\n                enablePrevLink(true);\n                enableNextLink(true);\n            } else {\n                enablePrevLink(true);\n                enableNextLink(false);\n            }\n        };\n        var init = function init() {\n            if (!$('#mw-allmessages-form')[0]) return;\n            $('#mw-allmessages-form').remove();\n            $('.TablePager_nav td').remove();\n            $('.TablePager_nav tr').append('<td style=\"width: 50%;\" class=\"TablePager_nav-prev\"><div class=\"TablePager_nav-disabled\">\u4e0a\u4e00\u9875</div></td><td style=\"width: 50%;\" class=\"TablePager_nav-next\"><div class=\"TablePager_nav-disabled\">\u4e0b\u4e00\u9875</div></td>');\n            $('.TablePager_nav-prev div').on('click', function() {\n                if ($(this).hasClass('TablePager_nav-disabled')) return false;\n                index -= length;\n                if (index < 0) index = 0;\n                load(am.slice(index, index + length));\n            });\n            $('.TablePager_nav-next div').on('click', function() {\n                if ($(this).hasClass('TablePager_nav-disabled')) return false;\n                index += length;\n                load(am.slice(index, index + length));\n            });\n        };\n        var load = function load(_am) {\n            check(am);\n            var head = $('#mw-allmessagestable thead');\n            if (head.find('tr').length !== 1) {\n                head.find('td:first').removeAttr('rowspan');\n                head.find('tr:first td:last').text('\u5f53\u524d\u4fe1\u606f\u6587\u5b57');\n                head.find('tr:not(:first)').remove();\n            }\n            var list = $('#mw-allmessagestable tbody');\n            list.empty();\n            _am.forEach(function(n) {\n                var name = n.name,\n                    text = n['*'];\n                var row = $('<tr/>');\n                row.attr('id', name).append('<td class=\"am_title\"></td><td class=\"am_default\"></td>');\n                $('<a/>').addClass('external').attr({\n                    href: 'https://zh.moegirl.org/MediaWiki:' + name,\n                    rel: 'nofollow'\n                }).html(name.replace(rfilter, '<span style=\"font-weight: bold;\">' + filter + '</span>')).appendTo(row.find('.am_title'));\n                row.find('.am_default').text(text);\n                list.append(row);\n            });\n        };\n        $('#mw-allmessages-form').after(containter);\n        containter.append('<legend>\u641c\u7d22</legend>');\n        var table = $('<table/>');\n        containter.append(table);\n        table.append('<tr></tr><tr></tr>');\n        $('<td/>').addClass('mw-label').html('<label for=\"mw-allmessages-filter\">\u4ee5\u542b\u6709\u6b64\u5b57\u7b26\u4e32\u8fc7\u6ee4\uff1a</label>').appendTo(table.find('tr:first'));\n        $('<td/>').addClass('mw-input').html('<input size=\"20\" value=\"\" id=\"mw-allmessages-filter\">').appendTo(table.find('tr:first'));\n        $('<td/>').appendTo(table.find('tr:last'));\n        var submit = $('<button/>');\n        submit.text('\u641c\u7d22');\n        $('<td/>').addClass('mw-input').append(submit).appendTo(table.find('tr:last'));\n        var input = $('#mw-allmessages-filter');\n        submit.on('click', function() {\n            if (!input.val()) return alert('\u8bf7\u8f93\u5165\u5185\u5bb9\u4ee5\u641c\u7d22\u7cfb\u7edf\u6d88\u606f');\n            $('#mw-allmessages-filter-status').remove();\n            init();\n            filter = input.val();\n            rfilter = RegExp(filter, 'i');\n            containter.append('<div id=\"mw-allmessages-filter-status\">\u6b63\u5728\u52a0\u8f7d\u4e2d\u2026\u2026</div>');\n            api.post({\n                action: 'query',\n                format: 'json',\n                meta: 'allmessages',\n                amfilter: filter\n            }).then(function(data) {\n                am = data.query.allmessages;\n                index = 0;\n                $('#mw-allmessages-filter-status').remove();\n                load(am.slice(index, index + length));\n            }, function() {\n                $('#mw-allmessages-filter-status').remove();\n                containter.append('<div id=\"mw-allmessages-filter-status\">\u53d1\u751f\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\uff01</div>');\n            });\n        });\n        input.on('keypress', function(e) {\n            if (e.which == 13) submit.click();\n        });\n    }\n    if (isCompleted) load();\n    else $(window).on('load', load);\n})(document.readyState === 'complete');\n// </pre>"}}}