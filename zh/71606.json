{"parse":{"title":"User:D41D8CD98F/minerva.js","pageid":135971,"wikitext":{"*":"(function() {\n// \u6765\u81ea\u767e\u5ea6\u7684\u8bbf\u95ee\u9ed8\u8ba4\u8df3\u8f6czh\u7248\n// \u4e0d\u9700\u8981\u5728\u6240\u6709\u4e1c\u897f\u52a0\u8f7d\u5b8c\u6bd5\u540e\u518d\u6267\u884c\uff0c\u56e0\u6b64\u4e0d\u653e\u5728 $(function(){...}) \u91cc\u9762\nif(document.referrer.includes('//www.bai' + 'du.com/'))\n\tlocation = 'https://zh.moegirl.org' + location.pathname + location.search;\n\nmw.loader.using('mobile.site').then(function() {$(function() {mw.loader.using('mediawiki.Uri').then(function() {$('#mw-content-text').off('click')})})});\n\nfunction withElem(s) {\n\treturn new Promise(function(r) {\n\t\tif ($(s).length) r($(s));\n\t\tnew MutationObserver(function(rec,self) {\n\t\t\t$.each(rec, function(i,v) {\n\t\t\t\tvar t = $(v.addedNodes).filter(s);\n\t\t\t\tif (t.length) self.disconnect(), r(t)\n\t\t\t})\n        \t}).observe(document.body, {childList: true, subtree: true})\n\t})\n}\nif ((mw.config.get('wgCanonicalSpecialPageName') === 'MobileEditor' || location.hash === '#/editor/0') && location.search.includes('&redlink=1'))\n\tlocation = '/' + mw.config.get('wgPageName').replace('Special:\u79fb\u52a8\u7248\u7f16\u8f91\u5668/', '');\n\n// \u907f\u514d\u4f7f\u7528 MobileFrontend \u7684\u7f16\u8f91\u5668\nif (mw.config.get('wgAction') === 'view') $.when($.ready, mw.loader.using('skins.minerva.editor')).always(function() {\n\tvar editlink = '/index.php?action=edit&title='+encodeURIComponent(mw.config.get('wgPageName'))+'&oldid='+mw.config.get('wgRevisionId');\n\t$('a.edit-page').each(function() { $(this).off('click').prop('href', editlink + '&section=' + $(this).data('section')) });\n\t$('#ca-edit').off('click').empty().append($('<a>').prop('href', editlink));\n});\n\nif (mw.config.get('wgAction') === 'edit') {\n\twithElem('#wpMinoredit').then(function(e) { e.prop('checked', true) });\n\treturn;\n}\n\n$(document).on('click.D4.customized.heimu', '.heimu', function() {\n\t$(this).removeClass('heimu').addClass('heimu-off');\n\treturn false;\n});\n\n// \u201c\u9875\u9876\u63d0\u793a\u6a21\u677f\u76f8\u5173\u201d\uff0c\u5229\u7528\u4e86[[MediaWiki:Mobile.css]]\u4e2d\u7684\u6837\u5f0f\n$(function($) {\n\tvar infoBoxes = [],\n\t    cont = $('<div id=\"commonBoxContainer\"><div id=\"commonBoxInfo\"><div id=\"commonBoxList\"></div></div></div>'),\n\t    list = cont.find('#commonBoxList');\n\t$('.mf-section-0').children().each(function() {\n\t\tvar self = $(this);\n\t\tif (!self.is('.infoBox')) return;\n\t\tinfoBoxes.push(this);\n\t\tvar btn = $('<div class=\"commonBoxButton\">').appendTo(list);\n\t\tbtn.append(self.find('.infoBoxIcon')).find('img').css({\n\t\t\t'width': 'auto',\n\t\t\t'max-height': '45px',\n\t\t});\n\t\tbtn.css({\n\t\t\t'width': 'auto',\n\t\t\t'height': '50px',\n\t\t\t'vertical-align': 'bottom',\n\t\t\t'border-color': self.css('border-left-color'),\n\t\t}).on('click touchend', function() {\n\t\t\t$(infoBoxes).not(self).hide();\n\t\t\tself.toggle();\n\t\t\tbtn.toggleClass('current', self.css('display') !== 'none');\n\t\t\tbtn.siblings().removeClass('current');\n\t\t\tlist.toggleClass('open', btn.hasClass('current'));\n\t\t\treturn false;\n\t\t});\n\t});\n\tcont.prependTo($('.mf-section-0'));\n\t$(infoBoxes).appendTo(cont).hide();\n});\n\nif (mw.config.get('wgCanonicalSpecialPageName') === 'MobileDiff') {\n// \u5728[[special:\u79fb\u52a8\u7248\u5dee\u5f02/xxx]]\u9875\u9762\u52a0\u4e00\u4e2a\u6307\u5411[[special:\u56fa\u5b9a\u94fe\u63a5/xxx]]\u7684\u94fe\u63a5\n// \u4ee5\u53ca\u589e\u52a0\u5207\u6362\u81f3\u684c\u9762\u7248\u5dee\u5f02\u663e\u793a\u65b9\u5f0f\u7684\u529f\u80fd\nwithElem('.revision-history-links').then(function(a) {\n\tvar pageName = mw.config.get('wgPageName');\n\tvar revs = /\\/(\\d+)(?:\\.\\.\\.(\\d+))?/.exec(mw.config.get('wgTitle'));\n\tvar link = $('<a>\u56fa\u5b9a\u94fe\u63a5</a>').attr('href', '/' + pageName.replace('\u79fb\u52a8\u7248\u5dee\u5f02', '\u56fa\u5b9a\u94fe\u63a5'));\n\tvar desktopdiff = $('<a id=\"D4-show-desktop-diff\" href>\u684c\u9762\u7248\u5dee\u5f02</a>');\n\t$(document).on('click.D4.customized.showdesktopdiff', '#D4-show-desktop-diff', function(e) {\n\t\tif (!$('table.diff')[0]) $.get('/api.php', $.extend(\n\t\t\t{ format: 'json', formatversion: 2, action: 'compare', fromrev: revs[1] },\n\t\t\trevs[2] ? { torev: revs[2] } : { torelative: 'prev' }\n\t\t)).then(function(data) {\n\t\t\t$('#mw-mf-minidiff').css('display', 'none').before($('<table class=\"diff\">').append($(data.compare.body)));\n\t\t\tmw.hook('wikipage.diff').fire($('table.diff'))\n\t\t});\n\t\treturn false\n\t});\n\ta.prepend(a.children('.revision-history-prev'), $('<li>').append(link), $('<li>').append(desktopdiff))\n});\n\n// \u5904\u7406\u4e2d\u6587wiki\u5728\u751f\u6210\u5dee\u5f02\u65f6\u9519\u8bef\u589e\u52a0\u7684\u7a7a\u683c\uff08\u684c\u9762\u7248\u5dee\u5f02\u4e5f\u6709\u6b64\u95ee\u9898\uff0c\u5bf9\u6b64\u7684\u5904\u7406\u5728[[User:D41D8CD98F/common.js]]\uff09\n// \u53e6\u5916\u79fb\u52a8\u7248\u5dee\u5f02\u8fd8\u6709\u6bb5\u843d\u95f4\u9694\u83ab\u540d\u6d88\u5931\u95ee\u9898\uff0c\u8fd9\u91cc\u4e5f\u987a\u4fbf\u8865\u6551\nwithElem('#mw-mf-minidiff').then(function(t) {\n\tt.children('.mw-diff-inline-changed').contents().each(function() {\n\t\tif (this.nextSibling) {\n\t\t\tif (this.nextSibling.textContent.match(/^[^\\x00-\\x7f]/))\n\t\t\t\tthis.textContent = this.textContent.replace(/ $/, '');\n\t\t\tif (this.tagName === this.nextSibling.tagName)\n\t\t\t\t$(this).after('<br>')\n\t\t}\n\t});\n});\n}\n\n// \u5728\u79fb\u52a8\u7248\u9875\u9762\u5e95\u90e8\u6dfb\u52a0\u6309\u94ae\uff0c\u5141\u8bb8\u52a0\u8f7d<s>\u6495\u903c\u533a</s>\u8bc4\u8bba\u533a\n// \u8003\u8651\u5230\u4e00\u822c\u6a21\u5757\u7f16\u5199\u65f6\u672a\u5fc5\u8003\u8651\u5230\u79fb\u52a8\u7248\uff0cMobileFrontend \u4f1a\u963b\u6b62\u5728\u79fb\u52a8\u7248\u4e0a\u52a0\u8f7d\u5b83\u4eec\n// \u4e0d\u8fc7\u8fd9\u4e2a\u7528\u6237\u8ba4\u4e3a ext.flowthread \u5728\u79fb\u52a8\u7248\u4e0a\u7684\u663e\u793a\u6548\u679c\u662f\u80fd\u770b\u7684\uff0c\u867d\u7136\u4e0d\u80fd\u8bf4\u5b8c\u7f8e\n// \u56e0\u6b64\u81f3\u5c11\u5728\u8fd9\u4e2a\u7528\u6237\u9605\u8bfb\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u70b9\u51fb\u6309\u94ae\u52a0\u8f7d ext.flowthread\n$(function() {\n\tvar loadComment = $('<div class=\"D4-load-comment\" style=\"background-color:lightgrey;line-height:3em;text-align:center;border:1px solid;margin: 0 16px;\">\u52a0\u8f7d\u8bc4\u8bba\u533a</div>');\n\tif (mw.config.exists('wgFlowThreadConfig')) {\n\t\tmw.config.set('wgFlowThreadConfig', {AnonymousAvatar:'', Avatar:''});\n\t\tloadComment.one('click', function() {\n\t\t\tmw.loader.load('/load.php?modules=ext.flowthread|moment');\n\t\t\t{mw.loader.addStyleTag('\\\n.comment-avatar {\\\n\tdisplay: none;\\\n}\\\n\\\n.comment-body {\\\n\tpadding-left: 0;\\\n}\\\n\\\n.comment-thread > div:not(:first-child) .comment-body {\\\n\tpadding-left: 0;\\\n}\\\n\\\n.comment-container-top, \\\n.comment-container, \\\n.comment-paginator, \\\n.comment-replybox {\\\n\tmargin: 0 16px;\\\n}\\\n\\\n@media all and (min-width: 62.5em) {\\\n\t.comment-container-top, \\\n\t.comment-container, \\\n\t.comment-paginator, \\\n\t.comment-replybox {\\\n\t\tmax-width: 55.8em;\\\n\t\tmargin: 0 auto;\\\n\t}\\\n}\\\n\\\n.comment-post:hover .comment-report {\\\n\tdisplay: none;\\\n}\\\n\\\n.comment-post .comment-delete {\\\n\tdisplay: initial;\\\n}\\\n\\\n.comment-user, .comment-user a {\\\n\tfont-size: 16px;\\\n}\\\n\\\n.comment-text {\\\n\tfont-size: 16px;\\\n}\\\n\\\n.comment-footer {\\\n\tfont-size: 14px;\\\n}\\\n\\\n.comment-paginator span {\\\n\tfont-size: 14px;\\\n}\\\n\t\t\t');}\n\t\t\t$(this).empty().append('<div class=\"mw-ui-icon mw-ui-icon-mf-spinner mw-ui-icon-element spinner loading\">\u6b63\u5728\u52a0\u8f7d...</div>');\n\t\t\twithElem('.comment-container').then(function() { loadComment.css('display', 'none') })\n\t\t});\n\t\t$('#bodyContent').after(loadComment)\n\t}\n})\n})()"}}}