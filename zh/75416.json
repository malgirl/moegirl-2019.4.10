{"parse":{"title":"User:\u673a\u667a\u7684\u5c0f\u9c7c\u541b/common.js","pageid":277888,"wikitext":{"*":"/*****************************************************\n*\u989c\u8272\u9884\u89c8\u63d2\u4ef6\n*\u00a9copyright:\u673a\u667a\u7684\u5c0f\u9c7c\u541b\n*http://c.wikia.com/wiki/User:\u673a\u667a\u7684\u5c0f\u9c7c\u541b/global.js\n*Under CC-BY-SA 3.0\n*update log:\n**Vector\u76ae\u80a4\u652f\u63012018.4.30\n*****************************************************/\n$('.mw-editform,#Wikiplus-Quickedit').prepend('<h2>\u9884\u89c8\u989c\u8272</h2><div id=\"colorbox\"><p id=\"sample\"></p><textarea id=\"colorhex\" rows=\"1\" placeholder=\"\u8f93\u5165\u7f51\u7edc\u5b89\u5168\u989c\u8272\u540d\u3001\u5341\u516d\u4f4d\u989c\u8272\u4ee3\u7801\u6216\u8005rgb\u989c\u8272\u4ee3\u7801\"></textarea></div><hr>');\n\t$('#colorhex').keyup(function() {\n\tif($('#colorhex').val()[0] == '#') {\n\t\tvar hexColor = $('#colorhex').val();\n\t} else if($('#colorhex').val() !== '') {\n\t\tvar hexColor =  $('#colorhex').val();\n\t} else {\n\t\tvar hexColor = '';\n\t}\n\t$('#sample').html('<span style=\"color:' + hexColor + '; background-color:' + hexColor + ';\">' + hexColor + '</span>');\n});\n/** \u65b9\u4fbf\u4e0a\u4f20\u76f8\u518c\u7f3a\u5c11\u7684\u56fe\u7247 **/\n$('.gallery .thumb').prepend(function () {\n  var galleryfile = $(this).text();\n  if (galleryfile == '') {\n    return;\n  } else {\n    $(this).html('<a href=\"https://commons.moegirl.org/index.php?title=Special:Upload&wpDestFile='+galleryfile+'\" class=\"new\" target=\"_blank\">\u70b9\u51fb\u4e0a\u4f20<br/>' + galleryfile + '</a>')\n  }\n});\n/** TEST DROPDOWN **/\n/*******************************************************\n*\u975e\u5e38\u5389\u5bb3\u7684\u4e0b\u62c9\u83dc\u5355\n*\u6539\u7f16\u81eadev.wikia.com/Mediawiki:UsefulDropdown/code.js\n*\u00a9copyright:\u673a\u667a\u7684\u5c0f\u9c7c\u541b\n*Under CC-BY-NC-SA 4.0\n*update log:\n**Vector\u76ae\u80a4\u652f\u63012018.5.4\n*******************************************************/\n $(function() {\n    if ((window.UsefulDropdown)) {\n        return; \n    } \n \n    $('.vectorMenu div.menu ul').append(\n    \"<li><a id=\\\"num1\\\" href=\\\"javascript:void(0)\\\">\" + \"\u4fdd\u62a4\u9875\u9762\" +\"</a></li>\" +\n    \"<li><a id=\\\"num2\\\" href=\\\"javascript:void(0)\\\">\" + \"AJAX\u5237\u65b0\" +\"</a></li>\" +\n    \"<li><a id=\\\"num7\\\" href=\\\"javascript:void(0)\\\">\" + \"AJAX\u5220\u9664\" +\"</a></li>\" +\n    \"<li><a id=\\\"num3\\\" href=\\\"javascript:void(0)\\\">\" + \"\u91cd\u5b9a\u5411\u5230\u6b64\" +\"</a></li>\" +\n    \"<li><a id=\\\"num4\\\" href=\\\"javascript:void(0)\\\">\" + \"\u901a\u62a5\u5220\u9664\" +\"</a></li>\" +\n    \"<li><a id=\\\"num5\\\" href=\\\"javascript:void(0)\\\">\" + \"\u7f6e\u9876\u6a21\u7248\" +\"</a></li>\"\n    );\n    // Protection \n    $('a#num1').click(function() {\n        var protectiontime = prompt('\u65f6\u9650:');\n        var protectionreason = prompt('\u539f\u56e0:');\n        if (protectiontime) {\n            new mw.Api().post({\n                action: 'protect',\n                title: mw.config.get('wgPageName'),\n                reason: protectionreason,\n                expiry: protectiontime,\n                protections: 'edit=sysop',\n                token: mw.user.tokens.get('editToken')\n            }).done(function(d) {\n                if (d.error) {\n                    new BannerNotification('Error while protecting article: ' + d.error.code, 'error').show();\n                } else {\n                    new BannerNotification('Successfully protected article', 'success').show();\n                }\n            }).fail(function() {\n                new BannerNotification('Error while protecting article', 'error').show();\n            });\n        }\n    });\n \n    // AJAX refresh\n    $('a#num2,a.usefulbtn').on(\"click\", function refreshArticle() {\n        var $temp = $('<div>');\n        $temp.load(window.location.href + ' #mw-content-text', function() {\n                var $newContent = $temp.children('#mw-content-text');\n                if ($newContent.length) {\n                    $('#mw-content-text').replaceWith($newContent);\n                    mw.util.$content = $newContent;\n \n                }\n            }\n \n        );\n        $temp.remove();\n        new BannerNotification(elementContent.contentRefreshed, 'success').show();\n    });\n \n    // Adding stub template\n    $('a#num3').click(function() {\n            var pagefrom = prompt('\u8981\u91cd\u5b9a\u5411\u5230'+wgPageName+'\u7684\u9875\u9762');\n        new mw.Api().post({\n            action: 'edit',\n            title:pagefrom,\n            summary: \"\u91cd\u5b9a\u5411\u81f3[[\"+wgPageName+\"]]\\/\\/\u4f7f\u7528[[User:\u673a\u667a\u7684\u5c0f\u9c7c\u541b/common.js|\u81ea\u5b9a\u4e49\u811a\u672c]]\u7f16\u8f91\",\n            text: \"#REDIRECT \\[\\[\"+wgPageName+\"\\]\\]\",\n            token: mw.user.tokens.get('editToken')\n        }).done(function(){alert('\u6210\u529f\uff01\uff01\uff01');});\n    });\n \n    // adding deletion template \n    $('a#num4').click(function() {\n        new mw.Api().post({\n            action: 'edit',\n            title: wgPageName,\n            summary: \"Adding to candiates for deletion\",\n            prependtext: \"{{delete}} \\n\",\n            token: mw.user.tokens.get('editToken')\n        }).done(function(d) {\n            if (d.error) {\n                new BannerNotification('Error adding template: ' + d.error.code, 'error').show();\n            } else {\n                new BannerNotification('Successfully added to candidates for deletion!', 'success').show();\n            }\n        }).fail(function() {\n            new BannerNotification('Error while adding template', 'error').show();\n        });\n    });\n \n    //Adding ability to have any other template via an input box.\n \n    // adding deletion template \n    $('a#num5').click(function() {\n        var templatename = prompt('\u6a21\u7248\u7684\u540d\u5b57\uff08\u4e0d\u9700\u8981\\{\\{\\}\\}\u76f4\u63a5\u8f93\u5165\u6a21\u7248\u540d\uff0c\u6bcf\u4e2a\u53c2\u6570\u95f4\u7528\\|\u5206\u9694:');\n        new mw.Api().post({\n            action: 'edit',\n            title: wgPageName,\n            summary: \"\u4f7f\u7528API\u76f4\u63a5\u6267\u884c\u7684\u6dfb\u52a0\u6a21\u7248\u7684\u64cd\u4f5c\uff0c\u5982\u6709\u7591\u95ee\u8bf7\u8054\u7cfb[[User:\u673a\u667a\u7684\u5c0f\u9c7c\u541b|\u673a\u667a\u7684\u5c0f\u9c7c\u541b]]\",\n            prependtext: \"{{\" + templatename + \"}} \\n\",\n            token: mw.user.tokens.get('editToken')\n        }).done(function(d) {\n            if (d.error) {\n                new BannerNotification('Error adding template: ' + d.error.code, 'error').show();\n            } else {\n                new BannerNotification('Successfully added template!', 'success').show();\n            }\n        }).fail(function() {\n            new BannerNotification('Error while adding template', 'error').show();\n        });\n    });\n \n    // Quick Deletion of article\n $('a#num7').click(function() {\n    new mw.Api().post({\n        action: 'delete',\n        title: wgPageName, \n        reason: \"\u4f7f\u7528API\u76f4\u63a5\u6267\u884c\u7684\u7684\u5feb\u901f\u5220\u9664\u64cd\u4f5c\uff0c\u5982\u6709\u7591\u95ee\u8bf7\u8054\u7cfb[[User:\u673a\u667a\u7684\u5c0f\u9c7c\u541b|\u673a\u667a\u7684\u5c0f\u9c7c\u541b]]\",\n        token: mw.user.tokens.get('editToken')\n                    })\n                    .done(function () {\n                        location.reload();\n                    });\n });\n \nwindow.UsefulDropdown = true;\n});"}}}