{"parse":{"title":"User:\u6771\u6771\u541b/vector.js","pageid":231629,"wikitext":{"*":"// Wikiplus\u5feb\u901f\u66ff\u6362\nmw.loader.load('/index.php?title=User:\u6771\u6771\u541b/js/Wikiplus-replace.js&action=raw&ctype=text/javascript')\n// \u67e5\u627e\u4e0e\u66ff\u6362\nmw.loader.load('/index.php?title=User:\u6771\u6771\u541b/js/replace.js&action=raw&ctype=text/javascript')\n// \u6807\u7b7e\u8865\u5168\nmw.loader.load('/index.php?title=User:\u6771\u6771\u541b/js/pair.js&action=raw&ctype=text/javascript')\n// \u5b9e\u65f6\u901a\u77e5\n// mw.loader.load('/index.php?title=User:\u6771\u6771\u541b/js/notification.js&action=raw&ctype=text/javascript')\n// \u4ee3\u7801\u751f\u6210\u6309\u94ae\nmw.loader.load('/index.php?title=User:\u6771\u6771\u541b/js/charinsert.js&action=raw&ctype=text/javascript')\n// \u7f16\u8f91\u5185\u5bb9\u5907\u4efd\nmw.loader.load('/index.php?title=User:\u6771\u6771\u541b/js/contentBackup.js&action=raw&ctype=text/javascript')\n// \u6b4c\u8bcd\u6ce8\u97f3\nmw.loader.load('/index.php?title=User:\u6771\u6771\u541b/js/ruby.js&action=raw&ctype=text/javascript')\n// \u5feb\u901f\u5bf9\u6bd4\u7248\u672c\u5dee\u5f02 By: User:Nzh21\nmw.loader.load('/index.php?title=User:Nzh21/js/QuickDiff.js&action=raw&ctype=text/javascript')\n\n// \u6458\u8981\u9501\n// mw.loader.load('/index.php?title=User:\u6771\u6771\u541b/js/lockSummary.js&action=raw&ctype=text/javascript')\n\n// api\u6d4b\u8bd5\u6c99\u76d2\n// mw.loader.load('/index.php?title=User:\u6771\u6771\u541b/apiTest.js&action=raw&ctype=text/javascript')\n\n// \u4ee3\u7801\u9ad8\u4eae\n// mw.loader.load('//www.mediawiki.org/w/index.php?title=MediaWiki:Gadget-DotsSyntaxHighlighter.js&action=raw&ctype=text/javascript')\n\n$(function(){\t\n\t// \u5c0f\u5934\u50cf\u653e\u5927\u955c\n\tsetTimeout(function(){\n\t\t$('.userlink-avatar').hover(function(){\n\t\t\tvar imgUrl = $(this).find('.userlink-avatar-small:first').attr('src')\n\t\t\tvar container = $('<div id=\"userHeadMagnifier\" style=\"display:inline-block; padding:10px; background:white; border:1px black solid; position:absolute; top:-139px; left:-135px;\">')\n\t\t\t.append('<img src=\"' + imgUrl + '\" width=\"128\">')\n\t\t\t\n\t\t\t$(this).css('position', 'relative').append(container)\n\t\t}, function(){\n\t\t\t$(this).css('position', 'static').find('#userHeadMagnifier').remove()\n\t\t})\t\t\t\n\t}, 1000)\n\t\n\t// \u963b\u6b62\u590d\u5236\u65f6\u6dfb\u52a0\u7248\u6743\u4fe1\u606f\n\t$('#mw-content-text').off('copy')\n\t\n\t// action=purge\u9875\u9762\u81ea\u52a8\u70b9\u51fb\u5237\u65b0\n\tif(! location.search){\n\t\t$(\"#p-cactions ul\").append('<li id=\"btn-renovate\"><a title=\"\u5237\u65b0\u6b64\u9875\">\u5237\u65b0\u6b64\u9875</a></li>')\n\t\t$('#btn-renovate').click(function(){\n\t\t\tmw.notify('\u5237\u65b0\u4e2d...', { type : 'warn' })\n\t\t\tvar url = decodeURIComponent(location.href)\n\t\t\tvar pageName = url.replace(/^https:\\/\\/zh.moegirl.org\\/(.+)$/, '$1')\n\t\t\tvar api = new mw.Api()\n\t\t\tvar deferredTimeoutKey = 0\n\t\t\t$.ajax({\n\t\t\t\turl: 'https://zh.moegirl.org/api.php',\n\t\t\t\ttype: 'post',\n\t\t\t\ttimeout: 10000,\n\t\t\t\tdata: {\n\t\t\t\t\t\"action\": \"purge\",\n\t\t\t\t\t\"format\": \"json\",\n\t\t\t\t\t\"titles\": pageName\n\t\t\t\t}\n\t\t\t}).done(function(){\n\t\t\t\tlocation.reload(true)\n\t\t\t}).fail(function(e){\n\t\t\t\tmw.notify('\u7f51\u7edc\u9519\u8bef\uff0c\u5237\u65b0\u5931\u8d25\uff01', { type : 'error' })\n\t\t\t})\n\t\t})\n\t}\n\t\n\t// tab\u952e\u6539\u4e3a\u8f93\u51fa2\u4e2a\u7a7a\u683c\n\t$('#wpTextbox1').keydown(function(e){\n\t\tif(e.keyCode == 9){\n\t\t\te.preventDefault()\n\t\t\tvar position = this.selectionStart,\n\t\t\tleft = this.value.substring(0, position),\n\t\t\tright = this.value.substring(position),\n\t\t\tcode = left + '  ' + right\n\t\t\tthis.value = code\n\t\t\tthis.selectionStart = this.selectionEnd = position + 2\n\t\t}\n\t})\n\t\n\t// AJAX\u7f16\u8f91\u9884\u89c8\u4ee3\u66ff\u65b9\u6848\uff08\u5feb\u6377\u952e\u4e3a\uff1actrl + shift + s\uff09\n\tif(/((?!\\.css|\\.js|\u6a21\u5757|module).+)action=(edit|submit)/.test(location.href)){\n\t\tsetTimeout(function(){\n\t\t\t$('#wikiEditor-ui-toolbar .tabs').append($('<span id=\"edit-ajaxPreviewBtn\" class=\"tab\"><a href=\"#\" role=\"button\" aria-pressed=\"false\">\u9884\u89c8</a></span>'))\n\t\t\t$('#edit-ajaxPreviewBtn').click(foo)\n\t\t}, 3000)\n\t\tvar removeBtn = $('<div id=\"edit-ajaxPreviewRm\" style=\"width:43px; height:30px; text-align:center; line-height:30px; color:black; font-size:26px; background:white; box-shadow:0 0 5px black; opacity:0.8; position:fixed; top:20px; right:0; cursor:pointer; display:none; z-index:1001;\">\u00d7</div>')\n\t\t.click(function(){\n\t\t\tviewHide()\n\t\t})\n\t\t$('body').append(removeBtn)\n\t\t\n\t\tvar saveBtn = $('<div id=\"edit-ajaxPreviewSave\" style=\"width:43px; height:30px; text-align:center; line-height:30px; color:black; font-size:26px; background:white; box-shadow:0 0 5px black; opacity:0.8; position:fixed; top:73px; right:0; cursor:pointer; display:none; z-index:1001;\">\u221a</div>')\n\t\t.click(function(){\n\t\t\t$('#wpSave').click()\n\t\t})\n\t\t$('body').append(saveBtn)\n\n\t\tvar requestTimeoutKey = 0,\n\t\tdeferred = null\n\t\tfunction viewHide(){\n\t\t\tdeferred && deferred.abort()\n\t\t\tclearTimeout(requestTimeoutKey)\n\t\t\t$('#edit-ajaxPreview').remove()\n\t\t\t$('#edit-ajaxPreviewRm').hide()\n\t\t\t$('#edit-ajaxPreviewSave').hide()\n\t\t\t$('body').css('overflow', 'visible')\n\t\t}\n\t\n\t\t$(window).keydown(function(e){\n\t\t\tif(e.ctrlKey && e.keyCode == 83){\n\t\t\t\tif($('#edit-ajaxPreview').length){\n\t\t\t\t\tviewHide()\n\t\t\t\t}else{\n\t\t\t\t\tfoo(e)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t\n\t\tvar api = new mw.Api()\n\t\tfunction foo(e){\n\t\t\tvar previewElement = $('<div id=\"edit-ajaxPreview\" style=\"width:90%; min-width:800px; height:90%; min-height:400px; padding:15px; background:white; box-shadow:0 0 15px #666; overflow:auto; position:fixed; margin:auto; top:0; left:0; right:0; bottom:0; z-index:1000;\">').append('<span id=\"edit-ajaxPreview-LoadingMsg\" style=\"font-size:30px; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);\">\u83b7\u53d6\u9884\u89c8\u4e2d...</span>')\n\t\t\t$('body').append(previewElement)\n\n\t\t\tvar wikiText = $('#wpTextbox1').val(),\n\t\t\ttitleName = decodeURIComponent(location.href.replace(/^.+[?&]title=([^&]+)&.+$/, '$1'))\n\t\t\t$('#edit-ajaxPreviewRm').show()\n\t\t\t$('#edit-ajaxPreviewSave').show()\n\t\t\t$('body').css('overflow', 'hidden')\n\t\t\tdeferred = api.post({\n\t\t\t\t\"action\": \"parse\",\n\t\t\t\t\"format\": \"json\",\n\t\t\t\t\"text\": wikiText,\n\t\t\t\t\"title\": titleName,\n\t\t\t\t\"contentmodel\": \"wikitext\"\n\t\t\t}).done(function(data){\n\t\t\t\t$('#edit-ajaxPreview').html($(data.parse.text['*']).addClass('mw-body-content'))\n\t\t\t})\n\t\t\trequestTimeoutKey = setTimeout(function(){\n\t\t\t\tif(deferred.state() != 'resolved'){\n\t\t\t\t\tviewHide()\n\t\t\t\t\tfoo(e)\n\t\t\t\t}\n\t\t\t}, 8000)\n\t\t\treturn false\n\t\t}\n\t}\n\t\n\t// ctrl + alt\u5feb\u901f\u6dfb\u52a0\u53d8\u91cf\u547d\u540d\u7a7a\u95f4\n\tif (mw.config.values.wgAction == \"edit\" || mw.config.values.wgAction == \"submit\"){\n\t\tvar editor = $('#wpTextbox1')\n\t\tvar title = mw.config.values.wgTitle.replace(/./, function(s){\n\t\t\treturn s.toLowerCase()\n\t\t})\n\t\teditor.keydown(function(e){\n\t\t\tif(e.ctrlKey && e.altKey){\n\t\t\t\teditor.val(editor.val().replace(/(\\{\\{#var(define|):)([^\\|\\}]+)/g, function(s, s1, s2, s3){\n\t\t\t\t\tif(!new RegExp('^' + title + '\\\\.').test(s3)){\n\t\t\t\t\t\tif(['num', 'key', 'value', 'time', 'times'].includes(s3)){ return s }\n\t\t\t\t\t\treturn s1 + title + '.' + s3 \n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn s\n\t\t\t\t}))\n\t\t\t\t\n\t\t\t\tmw.notify('\u5df2\u6dfb\u52a0\u53d8\u91cf\u547d\u540d\u7a7a\u95f4\u3002')\n\t\t\t}\n\t\t})\n\t}\n})\n\n// $.getScript(\"/User:Imbushuo/MonacoEditor/MediaWikiTokenizer.js\u200e?action=raw&ctype=text/javascript\",\n// function (data, textStatus, jqxhr) {\n//     $.getScript(\"/User:imbushuo/MediaWikiLint.js\u200e?action=raw&ctype=text/javascript\", \n//     function (data, textStatus, jqxhr) {\n//         // Loader for Monaco editor\n//         mw.loader.load('https://zh.moegirl.org/User:Imbushuo/MonacoEditor.js?action=raw&ctype=text/javascript');\n//     });\n// });\n\n\n// \u641c\u7d22\u5f15\u64ce\u4ee3\u66ff\u65b9\u6848\n/*\n$(function(){\n\tvar input = $('#searchInput').attr('placeholder', '\u641c\u7d22\u840c\u5a18\u767e\u79d1')\n\t$('#searchButton').off().on('click', function() {\n\t    var keyword = input.val();\n\t    if (!keyword) window.alert('\u8bf7\u8f93\u5165\u5173\u952e\u8bcd\u540e\u518d\u884c\u641c\u7d22\uff01');\n\t    else {\n\t        var self = $(this),\n\t            check_url = 'https://zh.moegirl.org/' + keyword,\n\t            open_url = 'https://www.bing.com/search?q=' + encodeURIComponent(keyword) + '+site%3Azh.moegirl.org&ie=UTF-8';\n\t        self[0].disabled = true;\n\t        self.data({\n\t            'background-image': self.css('background-image'),\n\t            'background-size': self.css('background-size')\n\t        });\n\t        self.css({\n\t            'background-image': 'url(https://static.mengniang.org/common/d/d1/Windows_10_loading.gif)',\n\t            'background-size': '80%'\n\t        });\n\t        $.ajax({\n\t            url: check_url,\n\t            type: 'HEAD',\n\t            success: function(_, __, response) {\n\t                if (response.status < 400) location.href = check_url;\n\t                else this.error();\n\t            },\n\t            error: function() {\n\t                location.href = open_url\n\t            },\n\t            complete: function() {\n\t                self[0].disabled = false;\n\t                self.css(self.data());\n\t            }\n\t        });\n\t    }\n\t    return false;\n\t});\n})\n*/\n\n//\u4ee3\u7801\u6ce8\u5165\u5de5\u5177  by:\u3010User:\u4e5d\u6c5f\u6708\u3011\n$(\"#p-cactions ul\").append('<li id=\"btn-ioctool\" onclick=\"createioc()\"><a title=\"\u6ce8\u5165\u5de5\u5177\">\u6ce8\u5165\u5de5\u5177</a></li>');\nfunction createioc(){var parent = document.getElementById('content');if(!parent){parent=document.getElementById('main');};var div = document.createElement('div');div.setAttribute('id','tools');var tools = document.getElementById('tools');if(tools){tools.parentNode.removeChild(tools)};var phase = document.createElement('textarea');phase.setAttribute('id','my-code');var btn = document.createElement('input');btn.setAttribute('type','button');btn.setAttribute('value','execute');btn.setAttribute('onclick','javascript:(function(){var txt = document.getElementById(\"my-code\").value;eval(txt);})();');div.appendChild(phase);div.appendChild(btn);parent.insertBefore(div,parent.firstChild);}"}}}