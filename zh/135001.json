{"parse":{"title":"\u6a21\u5757:ReplacePlus","pageid":305668,"wikitext":{"*":"local module = {}\n\nlocal getArgs = require('Module:Arguments').getArgs\n\nfunction _main(args, frame)\n\tlocal str = args['str'] or args[1] or ''\n\tlocal ptn = args['ptn'] or args[2] or ''\n\tptn = mw.text.decode(mw.text.unstripNoWiki(ptn))\n\tlocal replace = args['rep'] or args[3] or ''\n\tlocal split = args['spl'] or args[4] or '\u3001'\n\tlocal limit = args['lim'] or args[5] or 'false'\n\tlocal origin = tonumber(args['ori'] or args[6] or 1)\n\tlocal noprint = args['noprint'] or false\n\t\n\tstr = mw.ustring.sub(str, origin)\n\t\n\tlocal captures = {}\n\tlocal result, count = ''\n\t\n\tif string.find(limit, '%d+') then\n\t\tlimit = tonumber(limit)\n\t\tresult, count = mw.ustring.gsub(str, ptn, function(s)\n\t\t\tcaptures[#captures + 1] = s\n\t\t\treturn s\n\t\tend, limit)\n\t\tresult = mw.ustring.gsub(str, ptn, replace, limit)\t\t\n\telse\n\t\tresult, count = mw.ustring.gsub(str, ptn, function(s)\n\t\t\tcaptures[#captures + 1] = s\n\t\t\treturn s\n\t\tend)\n\t\tresult = mw.ustring.gsub(str, ptn, replace)\t\t\n\tend\n\t\n\tlocal capture = ''\n\tfor i, v in ipairs(captures) do\n\t\tcapture = capture..v..split\n\tend\n\n\tsplit = mw.ustring.gsub(split, '([%%%(%)%.%+%-%*%?%[%]%^%$])', '%%%1')\t\n\tcapture = mw.ustring.gsub(capture, '^(.*)'..split..'$', '%1')\n\t\n\tframe:callParserFunction('#vardefine', 'result.capture', capture)\n\tframe:callParserFunction('#vardefine', 'result.count', count)\n\t\n\tif noprint ~= 'true' then\n\t\treturn result\t\t\n\telse\n\t\tframe:callParserFunction('#vardefine', 'result', result)\n\t\treturn ''\n\tend\nend\n\nfunction module.main(frame)\n\tlocal args = getArgs(frame)\n\treturn _main(args, frame)\nend\n\nreturn module"}}}