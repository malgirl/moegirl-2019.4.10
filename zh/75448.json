{"parse":{"title":"User:\u6771\u6771\u541b/common.js","pageid":255747,"wikitext":{"*":"/*\n\t\u76ee\u524d\u8fd9\u91cc\u7684\u9879\u76ee\u5904\u4e8e\u534a\u5e9f\u5f03\u7684\u72b6\u6001...\n*/\n\nif(/action=(edit|submit)/.test(location.href)){\n    $(function(){\n        var root = function(){\n            var obj = {}\n            obj.spread = function(){\n                $('head').append($('<style id=\"myWidget\">'))\n                var tool = $('<div id=\"tool\">')\n                $(document.body).append(tool)\n                var myMessage = $('<div id=\"tool-message\" style=\"width:300px; background:#F0F0F0; color:black; font-size:18px; border :5px #666 solid; border-radius:10px; text-align:center; word-wrap:break-word; padding:30px 10px; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); display:none; -webkit-user-select:none; -moz-user-select:none; -o-user-select:none; user-select:none; z-index:12000;\"><span></span></div>')\n                $(document.body).append(myMessage)\n\n                var tools = $('<div style=\"width:20px; padding:5px 0; background:black; color:white; font-family:Microsoft Yahei; font-size:12px; text-align:center; position:fixed; right:0; bottom:250px; opacity:0.6; -webkit-user-select:none; -moz-user-select:none; -o-user-select:none; user-select:none; z-index:11000;\">\u5c0f\u5de5\u5177</div><div id=\"tools-menu\" style=\"width:100px; padding:5px 0; background:white; font-family:Microsoft Yahei; border:3px #EEEEE7 solid; position:fixed; right:20px; bottom:250px; z-index:11000; display:none;\"></div><div id=\"curtain\" style=\"width:calc(100% - 11rem); height:100%; background:#A19EE2; position:fixed; top:0; right:0; z-index:10000; opacity:0.8; display:none;\"></div>') //\u4fa7\u8fb9\u6309\u94ae\n                $('#tool').append(tools)\n                tools.hover(function(){\n                    $('#tools-menu').show()\n                },function(){\n                    $('#tools-menu').hide()\n                })\n            }\n            obj.styleLoad = function(){\n                //\u5c0f\u5de5\u5177\u6309\u94ae\n                $('.menu-button').css({\n                    margin : '5px',\n                    padding : '5px 0',\n                    textAlign : 'center',\n                    border : '1px #EEEEE7 solid',\n                    boxShadow : '1px 1px 1px #666',\n                    cursor: 'pointer',\n                    userSelect : 'none'\n                }).mousedown(function(){\n                    $(this).css('box-shadow','0 0 1.5px #666')\n                }).mouseup(function(){\n                    $(this).css('box-shadow','1px 1px 1px #666')\n                })\n            \n                //\u5c0f\u5de5\u5177\u7a97\u53e3\n                $('.toolsWindow').css({\n                    width : 'calc(100% - 11rem)',\n                    height : $(window).height(),\n                    fontFamily : 'Microsoft Yahei',\n                    color : 'white',\n                    position : 'fixed',\n                    top : '0',\n                    right : '0',\n                    zIndex : '10001',\n                    display : 'none',\n                })\n                $(window).resize(function(){\n                    $('.toolsWindow').css('height',$(window).height())\n                })                    \n            }\n            obj.shade = function(action){     \n                if(action){\n                    $('#curtain').show()\n                }else{\n                    $('#curtain').hide()\n                }\n            }\n            obj.message = function(text){\n                var mes = $('#tool-message')\n                mes.stop(false,true).text(text).show().fadeOut(1750)\n            }\n            obj.addStyle = function(screen, css){\n                var cssText = screen + '{'\n                for(var key in css){\n                    if(/[A-Z]/.test(key)){\n                        var attr = key.replace(/([A-Z])/g, '-$1').toLowerCase()\n                    }\n                    cssText += (attr || key) + ':' + css[key] + ';'\n                    var attr = null\n                }\n                cssText += '}'\n                $('#myWidget').text($('#myWidget').text() + cssText)\n                return $(screen)\n            }\n            obj.addStyles = function(styles){\n                for(var i=0; i < styles.length; i++){\n                    var screen = styles[i].screen\n                    var css = styles[i].css\n                    obj.addStyle(screen, css)\n                }\n            }\n            obj.Widget = function(html,id,name,style,event,initial){\n                $('#tool').append($(html))\n                $('#tools-menu').prepend('<div id=\"button-' + id + '\" class=\"menu-button\">' + name + '</div>')\n                $('#button-' + id).click(function(){\n                    if($('#' + id).css('display') == 'none')\n                    {\n                        $('.toolsWindow:visible').hide()\n                        obj.shade(true)\n                        $('#' + id).show()\n                    }else{\n                        obj.shade(false)\n                        $('#' + id).hide()\n                    }\n                })\n                this.publicStyle = function(){      //\u4fdd\u5b58\u516c\u7528\u6837\u5f0f\n                    $('.button').css({\n                        width : '100px',\n                        height : '50px',\n                        background : '#6B69D6',\n                        border : '3px #F0F0F0 solid',\n                        borderRadius : '5px',\n                        boxShadow : '2px 2px 5px #666',\n                        color : '#fff',\n                        fontSize : '20px',\n                        fontWeight : 'bold',\n                        textAlign : 'center',\n                        lineHeight : '50px',\n                        display : 'inline-block',\n                        margin : '5px',\n                        cursor: 'pointer'\n                    }).mousedown(function(){\n                        $(this).css('box-shadow','0 0 5px #666')\n                    }).mouseup(function(){\n                        $(this).css('box-shadow','2px 2px 5px #666')\n                    })\n                    for(var i=0;i < $('.button').length;i++){\n                        $('.button').get(i).style.cssText += '-webkit-user-select:none !important; -moz-user-select:none !important; -o-user-select:none !important; user-select:none !important;'\n                    }\n\n                    $('.checkbox').css({\n                        display : 'inline-block',\n                        margin : '10px'\n                    })\n                    $('.checkbox input').css({\n                        marginLeft : '5px',\n                        verticalAlign : 'middle'\n                    })\n\n                    $('.clear:after').css({\n                        display : 'block',\n                        content : '\".\"',\n                        height : '0',\n                        opacity : '0',\n                        claer : 'both',\n                    })\n                }\n                this.styleLoad = style\n                this.eventLoad = event\n                this.initial = initial\n                this.allLoad = function(){\n                    this.publicStyle()\n                    this.styleLoad()\n                    this.eventLoad()\n                    this.initial()\n                }\n            }\n            return obj\n        }()\n\n        root.spread()\n        //\u6dfb\u52a0\u7684\u5c0f\u5de5\u5177\u5199\u5728\u8fd9\u91cc\n        //root.Widget(html,id\u540d,\u5de5\u5177\u540d,\u6837\u5f0f,\u4e8b\u4ef6\u7ed1\u5b9a,\u521d\u59cb\u5316)\n        /*\n        \n        var \u63d2\u4ef6html\u4ee3\u7801 = '<div id=\"\u63d2\u4ef6id\" class=\"toolsWindow\">\u5177\u4f53\u4ee3\u7801</div>'\n        var \u63d2\u4ef6\u540d = new root.Widget(\u63d2\u4ef6html\u4ee3\u7801,'\u63d2\u4ef6id','\u663e\u793a\u540d\u79f0',\n        function(){\n            //\u6837\u5f0f\n        },   \n        function({\n            //\u4e8b\u4ef6\u7ed1\u5b9a\n        }),   \n        function(){\n            //\u521d\u59cb\u5316\n        })\n\n        */\n\n        var yanbiaoliHTML = '<div id=\"yanbiaoli\" class=\"toolsWindow\"><div class=\"ybl-box\" style=\"width:20%; height:100%;\"><div id=\"kyaralist\" style=\"width:250px; height:230px; min-height:45px; margin-left:5px; overflow: auto;\"><p>\u89d2\u82721\uff1a<input type=\"text\" class=\"kyaralist-member\"></p><p>\u89d2\u82722\uff1a<input type=\"text\" class=\"kyaralist-member\"></p><p>\u89d2\u82723\uff1a<input type=\"text\" class=\"kyaralist-member\"></p><p>\u89d2\u82724\uff1a<input type=\"text\" class=\"kyaralist-member\"></p><p>\u89d2\u82725\uff1a<input type=\"text\" class=\"kyaralist-member\"></p></div><div style=\"width: 250px;\"><div id=\"kyara-push\" class=\"button\" title=\"\u6dfb\u52a0\u4e00\u4e2a\u89d2\u8272\u680f\uff0c\u7528\u4e8e\u52a0\u5165\u5bf9\u5e94\u989c\u8272\">\u6dfb\u52a0\u89d2\u8272</div><div id=\"wikicode\" class=\"button\" title=\"\u5c06\u6839\u636e\u5de6\u680f\u989c\u8868\u7acb\u8bed\u6cd5\u751f\u6210wiki\u4ee3\u7801\">\u751f\u6210\u4ee3\u7801</div><br><br><div id=\"filterjp\" class=\"button\" title=\"\u8fc7\u6ee4\u6389\u65e5\u6587\u6b4c\u8bcd\uff0c\u7559\u4e0b\u7684\u7ffb\u8bd1\u5c06\u5728\u53f3\u680f\u4e2d\u5c55\u73b0\">\u8fc7\u6ee4\u6b4c\u8bcd</div><div id=\"filterch\" class=\"button\" title=\"\u8fc7\u6ee4\u6389\u7ffb\u8bd1\uff0c\u7559\u4e0b\u7684\u65e5\u6587\u6b4c\u8bcd\u5c06\u5728\u5de6\u680f\u4e2d\u5c55\u73b0\">\u8fc7\u6ee4\u7ffb\u8bd1</div></div><div style=\"width:250px\"><p style=\"width:236px; font-size:18px; color:white; text-align:center; margin-bottom:-10px;\">\u989c\u8272\u5b58\u50a8</p><div id=\"colorsave\" style=\"width:220px; height:70px; border:3px #F0F0F0 solid;overflow:hidden; margin:15px 0; padding:5px;\"><div class=\"colorsave-data\"></div><div class=\"colorsave-data\"></div><div class=\"colorsave-data\"></div></div><div id=\"colorsave-button\" class=\"button\" title=\"\u4fdd\u5b58\u5f53\u524d\u7684\u989c\u8272\u914d\u7f6e\">\u4fdd\u5b58\u914d\u7f6e</div><div id=\"colorsave-remove\" class=\"button\" title=\"\u6e05\u9664\u6240\u6709\u914d\u7f6e\">\u6e05\u7a7a\u914d\u7f6e</div></div></div><div style=\"width:77%; height:95%; float:right;\"><div id=\"kashiconsole\" class=\"ybl-box ybl-text\"><textarea id=\"kashi\" style=\"font-family:\u30e1\u30a4\u30ea\u30aa,\u30d2\u30e9\u30ae\u30ce\u89d2\u30b4 Pro W3,Hiragino Kaku Gothic Pro,sans-serif\"></textarea><br><center><div id=\"restorekashi\" class=\"button\" title=\"\u8fd8\u539f\u4e3a\u65e0\u989c\u8868\u7acb\u8bed\u6cd5\u7684\u65e5\u6587\u6b4c\u8bcd\">\u8fd8\u539f\u6b4c\u8bcd</div><div class=\"button yanbiaoli-submit\" data-location=\"left\" title=\"\u6839\u636e\u5de6\u680f\u5185\u5bb9\u81ea\u52a8\u63d0\u4ea4\u5230\u672c\u9875wiki\u4ee3\u7801\u4e2d\">\u63d0\u4ea4\u5185\u5bb9</div></div></center><div id=\"outputconsole\" class=\"ybl-box ybl-text\"><textarea id=\"code\" style=\"font-family:Microsoft YaHei,arial,sans-serif\"></textarea><br><center><div id=\"restoretranslate\" class=\"button\" title=\"\u8fd8\u539f\u4e3a\u901a\u8fc7\u201c\u8fc7\u6ee4\u6b4c\u8bcd\u201d\u6240\u5f97\u5230\u7684\u7ffb\u8bd1\">\u8fd8\u539f\u7ffb\u8bd1</div><div class=\"button yanbiaoli-submit\" data-location=\"right\" title=\"\u6839\u636e\u53f3\u680f\u5185\u5bb9\u81ea\u52a8\u63d0\u4ea4\u5230\u672c\u9875wiki\u4ee3\u7801\u4e2d\">\u63d0\u4ea4\u5185\u5bb9</div></center></div><div style=\"clear:both\"></div></div></div>'\n        //\u5c0f\u5de5\u5177\u6839\u8282\u70b9\u7684id\u8981\u4e0eroot.Widget\u4f20\u5165\u7684id\u4fdd\u6301\u4e00\u81f4\n        var yanbiaoli = new root.Widget(yanbiaoliHTML,'yanbiaoli','\u989c\u8868\u7acb',\n        function(){\n            $('.ybl-box').css({\n                float : 'left',\n                margin : '10px'\n            })\n            $('#kyaralist').height($(window).height() - 390)\n            $(window).resize(function(){\n                $('#kyaralist').height($(window).height() - 390)\n            })\n            $('.kyaralist-member').css({\n                width : '150px',\n                height: '30px',\n                fontSize: '18px',\n                border : '1px black solid',\n                textIndent : '5px'\n            })\n            $('.colorsave-data').css({\n                width : '200px',\n                height : '20px',\n                background : 'white',\n                color : '#6B69D6',\n                margin : '3px',\n                textIndent : '5px',\n                cursor : 'pointer'\n            })\n            $('.ybl-text').css({\n                width : '45%',\n                height : '100%'\n            })\n            $('#yanbiaoli textarea').css({\n                width : '100%',                   \n                height : '82%',\n                background : '#6B69D6',\n                border : '5px #F0F0F0 solid',\n                borderRadius : '10px',\n                outline : 'none',\n                fontSize : '14px',\n                color : '#fff',\n                margin : '10px',\n                padding : '10px',\n                overflow : 'auto',\n            })      //\u754c\u9762\u6837\u5f0f\u521d\u59cb\u5316\u5b8c\u6bd5\n        },\n        function(){\n            var dataSave = []\n            $('#kyara-push').click(function(){\n                if($('.kyaralist-member').length >= 99){\n                     root.message('\u4e0d\u80fd\u518d\u6dfb\u52a0\u66f4\u591a\u89d2\u8272\u4e86\uff01')\n                }else{\n                    var element = $('<p>\u89d2\u8272' + ($('#yanbiaoli input').length + 1) + '\uff1a<input type=\"text\" class=\"kyaralist-member\" style=\"width:150px; height:30px; font-size:18px; border:1px black solid; text-indent:5px;\"></p>')\n                    $('#kyaralist').append(element)\n                }\n            })\n        \n            $('#wikicode').click(function(){\n                var kashi = $('#kashi').val()\n                if(kashi == ''){\n                    root.message('\u8bf7\u8f93\u5165\u6b4c\u8bcd\uff01')\n                }else{\n                    var kyara =  $('.kyaralist-member')\n                    var color = []\n                    var flag = 0\n                    for(var i=0;i < kyara.length;i++){\n                        color.push(kyara.eq(i).val())\n                        if(kyara.eq(i).val() != ''){\n                            flag++\n                        }\n                    }\n                    if(flag < 2){\n                         root.message('\u8bf7\u81f3\u5c11\u8f93\u5165\u4e24\u4e2a\u89d2\u8272\u7684\u989c\u8272\u503c\uff01')\n                    }else{\n                        var kyaraRegExp = /(@[\\d]{1,2})([^@\\'\\n]+)(@(?!\\d{1,2})|)/g\n                        if(! kyaraRegExp.test(kashi)){\n                             root.message('\u8bf7\u8fdb\u884c\u6b4c\u8bcd\u6807\u8bb0\uff01')\n                        }else{\n                            kashi = kashi.replace(/\\$@/g,'%11447').replace(/\\$\\'/g,'%22887').replace(/\\$(\\d)/g,'%zmaall$1')  //\u624b\u52a8\u8f6c\u4e49\n                            var wikiCode = kashi.replace(kyaraRegExp,'{{color|$1|$2}}')\n                            var chorusRegExp1 = /^([^@\\'\\n]+)\\'$/gm\n                            var chorusRegExp2 = /([^'@])\\'([^@\\'\\{\\n]+)(\\'|\\{|)/g\n                            wikiCode = wikiCode.replace(chorusRegExp1,\"'''$1'''\")\n                            wikiCode = wikiCode.replace(chorusRegExp2,\"$1'''$2'''$3\")\n                            for(var i=0;i < color.length;i++){\n                                wikiCode = wikiCode.replace(new RegExp('@' + (i+1) + '(?![0-9])','g'),color[i])\n                            }\n                            wikiCode = wikiCode.replace(/''''/g,\"'''\")\n                            wikiCode = wikiCode.replace(/%11447/g,'@').replace(/%22887/g,\"'\").replace(/%zmaall(\\d)/g,'$1')   //\u8fd8\u539f\u8f6c\u4e49\n                            $('#code').val(wikiCode)\n                        }\n                    }\n                }\n            })\n        \n            $('#filterjp').click(function(){\n                var kashi = $('#kashi').val()\n                var filterJpRegExp = /.*[\u3041-\u3093\u30a1-\u30f6].*\\n?/g \n                var result = kashi.replace(filterJpRegExp,'')\n                if(/^\\s+$/g.test(result)){\n                     root.message('\u8bf7\u786e\u8ba4\u5de6\u680f\u5185\u5bb9\u683c\u5f0f\u662f\u5426\u6b63\u786e\uff0c\u662f\u5426\u9700\u8981\u8fc7\u6ee4\u6389\u65e5\u6587\u6b4c\u8bcd\uff01')\n                }else{\n                    $('#code').val(result)\n                    dataSave['geci'] = result\n                }\n            })\n        \n            $('#filterch').click(function(){\n                var kashi = $('#kashi')\n                var code = $('#code')\n                if(code.val() == ''){\n                    var filterChRegExp = /.*[\\u4e00-\\u9fa5\u300c\u300d\\(\\)\\\uff08\\\uff09\\.\\\u3002\\\u00b7\\!\\\uff01\\\u201c\\\u201d\\\"\\ \\\u3000]{5}[\\u4e00-\\u9fa5].*(\\n|)/g\n                    kashi.val(kashi.val().replace(filterChRegExp,''))\n                    kashi.scrollTop = 0\n                    dataSave['kashi'] = kashi.val()\n                }else{\n                    var sample = code.val().match(/.+(\\n|)/g)\n                    if(! sample){\n                         root.message('\u8bf7\u786e\u8ba4\u53f3\u680f\u662f\u5426\u6709\u5185\u5bb9\uff01')\n                    }else{\n                        for(var i=0; i< sample.length;i++){\n                            var regText = sample[i].replace(/([\\\\\\(\\)\\[\\]\\{\\}\\+\\.\\*\\^\\$\\!\\?\\|])/g,'\\\\$1')\n                            var sampleRegExp = new RegExp(regText)\n                            kashi.val(kashi.val().replace(sampleRegExp,''))\n                            kashi.scrollTop = 0\n                            dataSave['kashi'] = kashi.val()\n                        }\n                    }\n                }\n            })\n        \n            $('#kashi').on('paste', function(e){\n                var clipboardData = e.originalEvent.clipboardData\n                var shearPlatevalValue = clipboardData.getData('Text')\n                if(! /@\\d{1,2}/.test(shearPlatevalValue)){\n                    dataSave['kashi'] = shearPlatevalValue\n                }\n            })\n\n            $('#restorekashi').click(function(){\n                if(dataSave['kashi']){\n                    $('#kashi').val(dataSave['kashi'])\n                    root.message('\u5df2\u6062\u590d\u6b4c\u8bcd')\n                }else{\n                    root.message('\u8bf7\u786e\u8ba4\u662f\u5426\u51fa\u73b0\u8fc7\u6b4c\u8bcd\uff01')\n                }\n            })\n            $('#restoretranslate').click(function(){\n                if(dataSave['geci']){\n                    $('#code').val(dataSave['geci'])\n                    root.message('\u5df2\u6062\u590d\u7ffb\u8bd1')\n                }else{\n                    root.message('\u8bf7\u786e\u8ba4\u662f\u5426\u51fa\u73b0\u8fc7\u7ffb\u8bd1\uff01')\n                }\n            })\n\n            $('#colorsave-button').click(function(){\n                var colorValues = []\n                for(var i=0;i < $('.kyaralist-member').length;i++){\n                    colorValues[i] = $('.kyaralist-member').eq(i).val()\n                }\n                for(var i=0;i < colorValues.length;i++){\n                    if(colorValues[i] != ''){\n                        var flag = true\n                    }  \n                }\n                if(! flag){\n                     root.message('\u8bf7\u8f93\u5165\u989c\u8272\u914d\u7f6e\uff01')\n                }else{\n                    var title = prompt('\u8bf7\u8f93\u5165\u989c\u8272\u914d\u7f6e\u7684\u540d\u79f0\uff1a')\n                    colorValues.splice(0,0,title)\t\t//\u6240\u6709\u6570\u7ec4\u7b2c\u4e00\u4e2a\u503c\u4e3a\u6807\u9898\n                    if(! localStorage.getItem('colorLoad')){\n                        var colorValuesSet = []\n                        colorValuesSet.push(colorValues)\n                        var dataString = JSON.stringify(colorValuesSet)\n                        localStorage.setItem('colorLoad',dataString)\n                         root.message('\u4fdd\u5b58\u6210\u529f\uff01')\n                        yanbiaoli.initial()\n                    }else{\n                        var dataString = localStorage.getItem('colorLoad')\n                        var colorValuesSet = JSON.parse(dataString)\n                        if(colorValuesSet.length >= 3){\n                             root.message('\u5b58\u50a8\u533a\u5df2\u6ee1\uff0c\u8bf7\u5148\u6e05\u7406\uff01')\n                        }else{\n                            colorValuesSet.push(colorValues) \n                            dataString = JSON.stringify(colorValuesSet)\n                            localStorage.setItem('colorLoad',dataString)\n                             root.message('\u4fdd\u5b58\u6210\u529f\uff01')\n                            yanbiaoli.initial()\n                        }\n                    }\n                }\n            })\n        \n            $('#colorsave-remove').click(function(){\n                var loadColor = $('.colorsave-data')\n                if(localStorage.getItem('colorLoad')){\n                    localStorage.removeItem('colorLoad')\n                    loadColor.html('')\n                    loadColor.unbind()\n                     root.message('\u6e05\u7a7a\u6210\u529f\uff01')\n                }\n            })\n\n            $('.yanbiaoli-submit').click(function(){\n                var wikiCode = $('#wpTextbox1').val()\n                var location = $(this).data('location')\n                switch(location){\n                    case 'left' : {\n                        var result = $('#kashi').val()\n                        break\n                    }\n                    case 'right' : {\n                        var result = $('#code').val()\n                        break\n                    }\n                }\n                if(/(\\|original\\=)[\\S\\s]*(\\|translated\\=)/.test(wikiCode)){\n                    if(/(\\{\\{color|[\u3041-\u3093\u30a1-\u30f6])/.test(result)){\n                        wikiCode = wikiCode.replace(/(\\|original\\=)((?!\\|translated\\=)[\\S\\s])*(\\|translated\\=)/,'$1\\n' + result + '\\n\\n$3')\n                        var pos = '\u65e5\u6587\u6b4c\u8bcd\u5904'\n                    }else{\n                        if(/(\\|translated\\=)((?!\\{\\{)[\\S\\s])*(\\}\\})/.test(wikiCode)){\n                            wikiCode = wikiCode.replace(/(\\|translated\\=)((?!\\{\\{)[\\S\\s])*(\\}\\})/,'$1\\n' + result + '\\n\\n$3')\n                            var pos = '\u4e2d\u6587\u7ffb\u8bd1\u5904'\n                        }else{\n                            root.message('LyricsKai\u6a21\u677f\u7684translated\u53c2\u6570\u4e2d\u82e5\u5b58\u5728\u6a21\u677f(\u4f8b\u5982ruby\u3001\u9ed1\u5e55\u7b49)\u5219\u4e0d\u80fd\u6b63\u786e\u63d0\u4ea4\uff0c\u8bf7\u68c0\u67e5\u5e76\u5220\u9664\u6216\u624b\u52a8\u590d\u5236\u7c98\u8d34\u751f\u6210\u7684\u5185\u5bb9\uff01')\n                            return true\n                        }\n                    }\n                    $('#wpTextbox1').val(wikiCode)\n                    root.message('\u63d0\u4ea4\u6210\u529f\uff01\u5df2\u63d0\u4ea4\u81f3\uff1a' + pos)\n                    $('div[rel=wikiEditor-ui-view-preview] a').trigger('click')\n                }else{\n                    root.message('\u8bf7\u786e\u8ba4Wiki\u6e90\u4ee3\u7801\u4e2d\u662f\u5426\u5b58\u5728\u8fd9\u6837\u7684\u6b4c\u8bcd\u6a21\u677f\uff1a\\n\\n{{LyricsKai\\n|original=\\n\\n|translated=\\n\\n}}')\n                }\n            })\n        },\n        function(){\n            if(localStorage.getItem('colorLoad')){       //\u8bfb\u53d6\u989c\u8272\u914d\u7f6e\n                var dataString = localStorage.getItem('colorLoad')\n                var colorValuesSet = JSON.parse(dataString)\n                var loadColor = $('.colorsave-data')\n                var kyaraList = $('#kyaralist')\n                for(var i=0;i < colorValuesSet.length;i++){\n                    (function(i){\n                        loadColor.eq(i).text(colorValuesSet[i][0])\n                        var delButton = $('<span style=\"float:right; -webkit-user-select:none; -moz-user-select:none; -o-user-select:none; user-select:none; display:inline-block; cursor:pointer;\">\u00d7</span>') \n                        loadColor.eq(i).append(delButton)\n                        delButton.one('click',function(e){\n                            e.stopPropagation()\n                            colorValuesSet.splice(i,1)\n                            var dataString = JSON.stringify(colorValuesSet)\n                            localStorage.setItem('colorLoad',dataString)\n                            loadColor.html('')\n                            loadColor.unbind()\n                            yanbiaoli.initial()\n                            root.message('\u5220\u9664\u6210\u529f\uff01')\n                        })\n\n                        loadColor.eq(i).click(function(){\n                            if(localStorage.getItem('colorLoad')){\n                                var colorValuesSet = $.parseJSON(localStorage.getItem('colorLoad'))\n                                var kyaraLists = $('.kyaralist-member')\n                                for(var k=0; k < kyaraLists.length;k++){\n                                    kyaraLists.eq(k).val('')\n                                }\n                            }\n                            var frequency = colorValuesSet[i].length - 1 - kyaraLists.length //\u6570\u7ec4\u91cc\u7684\u6807\u9898\u4e0d\u7b97\u989c\u8272\u6570\u636e\n                            if(frequency > 0){\n                                for(var s=0;s < frequency;s++){\n                                    var p = $('<p>').text('\u89d2\u8272' + ($('.kyaralist-member').length + 1) + '\uff1a')\n                                    var input = $('<input type=\"text\" class=\"kyaralist-member\">')\n                                    p.append(input)\n                                    $('#kyaralist').append(p)\n                                    input.css({\n                                        width : '150px',\n                                        height : '30px',\n                                        fontSize : '18px',\n                                        border : '1px black solid',\n                                        textIndent : '5px'\n                                    })\n                                }\n                            }\n                            kyaraLists = $('.kyaralist-member')\n                            for(var j=1;j < colorValuesSet[i].length;j++){\n                                if(colorValuesSet[i][j]){\n                                    kyaraLists.eq(j-1).val(colorValuesSet[i][j])\n                                }\n                            }\n                        })\n                    }(i))\n                }\n            }\n        })\n        yanbiaoli.allLoad()\n\n        var wikiTableEditHTML = '<div id=\"wikiTableEdit\" class=\"toolsWindow\"><div id=\"wikiTableEdit-top\" class=\"clear\" style=\"padding:10px; min-width:850px;\"><div class=\"clear\" style=\"display:inline-block; width:170px;\"><label for=\"row\" class=\"wikiTable-consoleInput\"><span>\u884c\u6570 : </span><input id=\"row\"></label><label for=\"col\" class=\"wikiTable-consoleInput\"><span>\u5217\u6570 : </span><input id=\"col\"></label></div><div id=\"newTable\" class=\"button\">\u65b0\u5efa\u8868\u683c</div>\\\n        <div id=\"getWikiTableCode\" class=\"button\">\u5199\u5165\u4ee3\u7801</div>\\\n        <div id=\"tableStyle\" class=\"button\" style=\"float:right\">\u63d0\u53d6\u8868\u683c</div>\\\n        <div id=\"delCol\" class=\"button\" style=\"float:right\">\u5220\u9664\u5217</div>\\\n        <div id=\"addCol\" class=\"button\" style=\"float:right\">\u6dfb\u52a0\u5217</div>\\\n        <div class=\"checkbox\"><span>\u6a2a\u5217\u9876\u7aef\u52a0\u7c97</span><input type=\"checkbox\" id=\"rowBold\" checked></div>\\\n        <div class=\"checkbox\"><span>\u7eb5\u5217\u9996\u5217\u52a0\u7c97</span><input type=\"checkbox\" id=\"colBold\"></div>\\\n        <div class=\"checkbox\"><span>\u53ef\u6392\u5e8f</span><input type=\"checkbox\" id=\"sortable\"></div>\\\n        </div>\\\n        <hr style=\"width:95%; background:white; position:relative; left:50%; transform:translateX(-50%);\">\\\n        <div id=\"wikiTableEdit-bottom\" style=\"padding:10px 20px 10px 10px;\"><div style=\"height:100%; overflow:auto;\"><table id=\"wikiTableEdit-body\" class=\"wikitable\" style=\"margin-left:30px;\"><tr><th><div class=\"firstList\"><br></div></th><th><div class=\"lastList\"><br></div></th></tr><tr><td><div class=\"firstList\"><br></div></td><td><div class=\"lastList\"><br></div></td></tr></table></div></div></div>'\n        var wikiTableEdit = new root.Widget(wikiTableEditHTML,'wikiTableEdit','\u53ef\u89c6\u5316\u8868\u683c',\n        function(){\n            root.addStyles([\n                {\n                    screen : '#wikiTableEdit-top > *',\n                    css : {\n                        float : 'left',\n                    }\n                },\n                {\n                    screen : '.wikiTable-consoleInput',\n                    css : {\n                        float : 'left',\n                        padding : '2px',\n                        fontSize : '18px'\n                    }\n                },{\n                    screen : '.wikiTable-consoleInput input',\n                    css : {\n                        width : '100px',\n                        height : '20px',\n                        textIndent : '3px'\n                    }\n                },{            \n                    screen : '.wikitable',\n                    css : {\n                        backgroundColor: '#f8f9fa',\n                        color: '#222',\n                        margin: '1em 0',\n                        border: '1px solid #a2a9b1',\n                        borderCollapse: 'collapse',\n                        lineHeight : '1.6',\n                    }\n                },{                      \n                    screen : '.wikitable > * > tr > th',\n                    css : {\n                        backgroundColor: '#eaecf0',\n                        textAlign: 'center'\n                    }\n                },{                     \n                    screen : '.wikitable > * > tr > td, .wikitable > * > tr > th',\n                    css : {\n                        border: '1px solid #a2a9b1',\n                        padding: '0.2em 0.4em'\n                    }\n                },{\n                    screen : '.wikitable > * > tr > td:last-child, .wikitable > * > tr > th:last-child, .wikitable > * > tr > td:first-child, .wikitable > * > tr > th:first-child',\n                    css : {\n                        padding: '0'\n                    }\n                },{\n                    screen : '.wikitable > * > tr > td:last-child > div, .wikitable > * > tr > th:last-child > div, .wikitable > * > tr > td:first-child > div, .wikitable > * > tr > th:first-child > div',\n                    css : {\n                        padding: '0.2em 0.4em'\n                    }\n                },{\n                    screen : '#wikiTableEdit-body tr *',\n                    css : {\n                        minWidth : '100px',\n                        minHeight : '20px'\n                    }\n                },{\n                    screen : '#wikiTableEdit-body tr > *',\n                    css : {\n                        backgroundClip: 'padding-box',\n                        position : 'relative',\n                        outline : 'none'\n                    }\n                },{\n                    screen : '#wikiTableEdit-body tr > *:first-child:after, #wikiTableEdit-body tr > *:last-child:after',\n                    css : {\n                        display : 'inline-block',\n                        content : '\"+\"',\n                        width : '20px',\n                        height : '20px',\n                        background : 'white',\n                        borderRadius : '50%',\n                        fontFamily : 'Arial, sans-serif',\n                        color : '#6B69D6',\n                        fontSize : '18px',\n                        fontWeight : 'bold',\n                        textAlign : 'center',\n                        lineHeight : '20px',\n                        position : 'absolute',\n                        top : '50%',\n                        right : '-30px',\n                        transform : 'translateY(-50%)',\n                        cursor : 'pointer'\n                    }\n                },{\n                    screen : '#wikiTableEdit-body tr > *:first-child:after',\n                    css : {\n                        content : '\"-\"',\n                        right : '0',\n                        left : '-30px',\n                        lineHeight : '16px'\n                    }\n                },{\n                    screen : '.clear:after',\n                    css : {\n                        display : 'block',\n                        content : '\".\"',\n                        height : '0',\n                        opacity : '0',\n                        clear : 'both',\n                    }\n                }\n            ])\n            var suit = function(){\n                $('#wikiTableEdit-bottom').css('height', document.documentElement.clientHeight - 116 + 'px')\n            }\n            $(window).ready(suit).resize(suit)\n            wikiTableEdit.editable = function(){\n                $('#wikiTableEdit-body tr > *:last-child > div, #wikiTableEdit-body tr > *:first-child > div')\n                .click(function(){return false})    \n                //\u9632\u6b62\u7f16\u8f91\u6700\u540e\u4e00\u4e2a\u548c\u7b2c\u4e00\u4e2a\u65f6\u89e6\u53d1\u6dfb\u52a0\u884c\u4e8b\u4ef6\n\n                $('#wikiTableEdit-body tr *:not(br), .lastList, .first').attr('contenteditable', 'true')\n                $('#wikiTableEdit-body tr > *:last-child, #wikiTableEdit-body tr > *:first-child')\n                .removeAttr('contenteditable')\n            }\n            wikiTableEdit.editable()\n\n            $(window).keyup(function(e){\n                if(e.ctrlKey && e.keyCode == 86){\n                    var editable = $('#wikiTableEdit-body > tbody > tr [contenteditable=\"true\"]')\n                    for(var i=0; i < editable.length; i++){\n                        var handle = editable.eq(i).html().replace(/<\\/?[^>]*>/g, '').replace(/[ | ]*\\n/g, '').replace(/&nbsp;/ig, '') + '<br>'\n                        editable.eq(i).html(handle)\n                    }\n                    \n                }\n            })\n\n        },   \n        function(){\n            var table = $('#wikiTableEdit-body tbody')\n            var revokeData = []\n            function revoke(){\n                revokeData.push(table.html())\n            }\n\n            $('#newTable').click(function(){\n                revoke()\n                var rowNum = parseInt($('#row').val()) < 2 ? 2 : (parseInt($('#row').val()) || 2)\n                var colNum = parseInt($('#col').val()) < 2 ? 2 : (parseInt($('#col').val()) || 2)\n                $('#row').val('')\n                $('#col').val('')\n                table.html('')\n                for(var i=0; i < colNum; i++){\n                    var row = '<tr><td><div class=\"firstList\"><br></div></td>'\n                    for(var j=2; j < rowNum; j++){\n                        row += '<td><br></td>'\n                    }\n                    row += '<td><div class=\"lastList\"><br></div></td></tr>'\n                    table.html(table.html() + row)\n                }\n                $('#rowBold')[0].checked = ! $('#rowBold')[0].checked\n                $('#rowBold').click()\n                $('#colBold')[0].checked = ! $('#colBold')[0].checked\n                $('#colBold').click()\n\n                wikiTableEdit.initial()\n            })\n\n            wikiTableEdit.insertEvent = function(){\n                $('#wikiTableEdit-body tr > *:last-child').click(function (e){\n                    revoke()\n                    var node = e.target\n                    var rowNum = node.parentNode.children.length\n                    var row = '<tr><td><div class=\"lastList\"><br></div></td>'\n                    if($('#colBold')[0].checked){\n                        row = '<tr><th><div class=\"lastList\"><br></div></th>'\n                    }\n                    for(var i=2; i < rowNum; i++){\n                        row += '<td><br></td>'\n                    }\n                    row += '<td><div class=\"lastList\"><br></div></td></tr>'\n                    $(node.parentNode).after(row)\n\n                    wikiTableEdit.initial()\n                })\n            }\n            wikiTableEdit.insertEvent()\n\n            wikiTableEdit.deleteEvent = function(){\n                $('#wikiTableEdit-body tr > *:first-child').click(function (e){\n                    revoke()\n                    var node = e.target.parentNode\n                    if(node.parentNode.children.length <= 2){\n                        root.message('\u8868\u683c\u8bf7\u81f3\u5c11\u4fdd\u7559\u4e24\u884c\uff01')\n                    }else{\n                        $(node).remove()\n                    }\n                })\n            }\n            wikiTableEdit.deleteEvent()\n\n            $('#rowBold').click(function(){\n                revoke()\n                if(this.checked){\n                    var html = table.find('tr:first-child').html().replace(/td(?=>| )/gi, 'th')\n                }else{\n                    var html = table.find('tr:first-child').html().replace(/th(?=>| )/gi, 'td')\n                    if($('#colBold')[0].checked){\n                        var html = html.replace(/td(?=>| )/i, 'th').replace(/td(?=>| )/i, 'th')\n                    }\n                }\n                table.find('tr:first').html(html)\n\n                wikiTableEdit.initial()\n            })\n\n            $('#colBold').click(function(){\n                revoke()\n                var tr = table.find('tr')\n                if(this.checked){\n                    for(var i=0; i < tr.length; i++){\n                        var html = tr.eq(i).html().replace(/td(?=>| )/i, 'th').replace(/td(?=>| )/i, 'th')\n                        tr.eq(i).bind(':first-child').html(html)\n                    }\n                }else{\n                    for(var i=0; i < tr.length; i++){\n                        var html = tr.eq(i).html().replace(/th(?=>| )/i, 'td').replace(/th(?=>| )/i, 'td')\n                        tr.eq(i).bind(':first-child').html(html)\n                    }\n                    if($('#rowBold')[0].checked){\n                        var html = tr.eq(0).html().replace(/td(?=>| )/i, 'th').replace(/td(?=>| )/i, 'th')\n                        tr.eq(0).html(html)\n                    }\n                }\n\n                wikiTableEdit.initial()\n            })\n\n            $('#addCol').click(function(){\n                revoke()\n                var tr = table.find('tr')\n                for(var i=0; i < tr.length; i++){\n                    tr.eq(i).children(':last').html('<br>')\n                    if($('#rowBold')[0].checked && i == 0){\n                        tr.eq(i).append($('<th><div class=\"lastList\"><br></div></th>'))\n                    }else{\n                        tr.eq(i).append($('<td><div class=\"lastList\"><br></div></td>'))\n                    }\n                    $('#wikiTableEdit-body tr > *').unbind()\n                    wikiTableEdit.initial()\n                }\n            })\n            $('#delCol').click(function(){\n                revoke()\n                var tr = table.find('tr')\n                for(var i=0; i < tr.length; i++){\n                    if(tr.eq(i).children().length <= 2){\n                        root.message('\u8868\u683c\u8bf7\u81f3\u5c11\u4fdd\u7559\u4e24\u5217\uff01')\n                    }else{\n                        tr.eq(i).children(':last').remove()\n                        tr.eq(i).children(':last').html('<div class=\"lastList\"><br></div>')\n                    }\n                }\n                $('#wikiTableEdit-body tr > *').unbind()\n                wikiTableEdit.initial()\n            })\n\n            $('#getWikiTableCode').click(function(e){\n                var tableData = []\n                for(var i=0; i < table.find('tr').length; i++){\n                    var trData = []\n                    var list = table.find('tr').eq(i).children()\n                    for(var j=0; j < list.length; j++){\n                        var tab = list.eq(j)[0].tagName == 'TH' ? 'STRONG_' : ''\n                        var value = tab + list.eq(j).text()\n                        trData.push(value)\n                    }\n                    tableData.push(trData)\n                }\n                var wikiCode = '{| class=\"wikitable\"\\n'\n                for(var i=0; i < tableData.length; i++){\n                    for(var j=0; j < tableData[i].length; j++){\n                        var tag = tableData[i][j].slice(0, 7) == 'STRONG_' ? '!' : '|'\n                        var value = tableData[i][j].slice(0, 7) == 'STRONG_' ? tableData[i][j].slice(7) : tableData[i][j]\n                        if(wikiCode.slice(-1) == '\\n'){\n                            var self = tableData[i][j]\n                            var next = tableData[i][j+1] || ''\n                            if((self.slice(0, 7) == 'STRONG_' && next.slice(0, 7) == 'STRONG_') || \n                              (self.slice(0, 7) != 'STRONG_' && next.slice(0, 7) != 'STRONG_')){\n                                wikiCode += tag + ' ' + value + ' '\n                            }else{\n                                wikiCode += tag + ' ' + value + '\\n'\n                            }\n                        }else{\n                            wikiCode += tag + tag + ' ' + value + ' '\n                        }\n                    }\n                    if(tableData[i + 1]){\n                        wikiCode += (wikiCode.slice(-1) == '\\n' ? '' : '\\n') + '|-\\n'\n                    }else{\n                        wikiCode += (wikiCode.slice(-1) == '\\n' ? '' : '\\n') + '|}'\n                    }\n                }\n                $('#wpTextbox1').focus()\n                function insertText(obj,str) {      //\u679c\u7136\u8fd8\u662f\u6284\u4ee3\u7801\u723d\u554a\n                    if (document.selection) {\n                        var sel = document.selection.createRange();\n                        sel.text = str;\n                    } else if (typeof obj.selectionStart === 'number' && typeof obj.selectionEnd === 'number') {\n                        var startPos = obj.selectionStart,\n                            endPos = obj.selectionEnd,\n                            cursorPos = startPos,\n                            tmpStr = obj.value;\n                        obj.value = tmpStr.substring(0, startPos) + str + tmpStr.substring(endPos, tmpStr.length);\n                        cursorPos += str.length;\n                        obj.selectionStart = obj.selectionEnd = cursorPos;\n                    } else {\n                        obj.value += str;\n                    }\n                }\n                insertText($('#wpTextbox1')[0], wikiCode)\n                root.message('wiki\u8868\u683c\u4ee3\u7801\u5df2\u6dfb\u52a0\u81f3\u5149\u6807\u5904\uff01')\n            })\n\n            $(window).keydown(function(e){\n                if(e.ctrlKey && e.keyCode == 90){\n                    table.html(revokeData.pop())\n                    wikiTableEdit.initial()\n                }\n            })\n\n            $('#tableStyle').click(function(){\n                var editBox = $('#wpTextbox1')[0]\n                var start = editBox.selectionStart\n                var end = editBox.selectionEnd\n                var wikiCode = editBox.value.substring(start, end)\n                \n                if(! /\\{\\|[\\s\\S]+\\|\\}/.test(wikiCode)){\n                    if(wikiCode == ''){\n                        root.message('\u60a8\u8fd8\u6ca1\u6709\u9009\u4e2dwiki\u8868\u683c\u4ee3\u7801\uff01')\n                    }else{\n                        root.message('\u8bf7\u6b63\u786e\u5b8c\u6574\u5730\u9009\u62e9\u6709\u6548\u7684wiki\u8868\u683c\u4ee3\u7801\uff01')\n                    }\n                }else{\n                    root.message('\u5e76\u6ca1\u6709\u8fd9\u4e2a\u529f\u80fd\u5462(\u0e51\u2022 . \u2022\u0e51)')\n                    //\u597d\u5427\uff0c\u5f53\u521d\u5c31\u4e0d\u5e94\u8be5\u628a\u62ff\u4f2a\u5143\u7d20\u5f53\u6309\u94ae\uff0c\u8fd9\u4e0b\u6839\u672c\u6ca1\u6cd5\u751f\u6210\u8de8\u884c\u8de8\u5217\u7684\u5217\u8868\u4e86\n                }\n            })\n        }, function(){\n            $('#wikiTableEdit-body tr > *:last-child, #wikiTableEdit-body tr > *:first-child').unbind() \n            wikiTableEdit.editable()\n            wikiTableEdit.insertEvent()\n            wikiTableEdit.deleteEvent()\n        })\n        wikiTableEdit.allLoad()\n\n        root.styleLoad()\n    })\n}"}}}