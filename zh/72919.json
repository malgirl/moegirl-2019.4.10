{"parse":{"title":"User:Nzh21/MonacoEditor.js","pageid":308954,"wikitext":{"*":"!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,\"a\",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p=\"\",t(t.s=0)}([function(e,t,n){\"use strict\";/**\n * @license\n *\n * LoaderBootstrap.ts: Monaco Editor loader for MediaWiki.\n * -----------------------------------------------\n * Copyright (c) 2017 The Little Moe New LLC.\n *\n * Beta technology - no warranty\n *\n */\nObject.defineProperty(t,\"__esModule\",{value:!0});var i=n(1);!function(){window.monacoHost||$.getScript(\"https://imbushuos3.azureedge.net/Monaco/0.10.0-1/vs/loader.js\",function(e,t,n){window.require.config({paths:{vs:\"https://imbushuos3.azureedge.net/Monaco/0.10.0-1/vs\"}}),window.MonacoEnvironment={getWorkerUrl:function(e,t){return\"/User:imbushuo/MonacoProxyStub.js?action=raw&ctype=text/javascript\"}},console.info(\"Monaco bootstrapper has been loaded.\"),window.require([\"vs/editor/editor.main\"],function(){if(i.MonacoEditorHost.isAvailable){var e=new i.MonacoEditorHost(document.getElementById(\"wpTextbox1\"));e.initialize(),window.monacoHost=e,console.info(\"Monaco bootstrapper has been initialized.\")}})})}()},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(2),o=n(3),r=n(4),a=function(){function e(e,t){this.m_textAreaControl=e,this.m_docType=\"markdown\",monaco.languages.register({id:\"mediawiki\"}),window.monacoUserConfig&&(this.m_userOptions=window.monacoUserConfig),t&&t.autoLoad&&this.initialize()}return Object.defineProperty(e,\"isAvailable\",{get:function(){return!!document.getElementById(\"wpTextbox1\")},enumerable:!0,configurable:!0}),e.prototype.checkTitleExtensionAsync=function(){var t=this;return new monaco.Promise(function(n,i,o){mw.loader.using(\"mediawiki.Uri\").then(function(){var o=new mw.Uri;if(o.query.title){var r=o.query.title,a=r.lastIndexOf(\".\"),s=r.indexOf(\":\");t.m_docPrefix=r.substring(0,s),t.m_docExtension=r.substring(a),t.m_title=r,n(e.g_prefixMapping[t.m_docPrefix]?e.g_prefixMapping[t.m_docPrefix]:e.g_extMapping[t.m_docExtension]?e.g_extMapping[t.m_docExtension]:\"mediawiki\")}else i(\"Unable to load title\")})})},e.prototype.createLibraryXhrPromise=function(e){return new monaco.Promise(function(t,n,i){$.ajax({url:e.url,cache:!0}).then(function(n){t({content:n,fileName:e.fileName,url:e.url})}).fail(function(){n(null)})})},e.prototype.loadReferenceLibrariesAsync=function(){var t=this;return new monaco.Promise(function(n,o,r){switch(t.m_docType){case\"javascript\":case\"typescript\":console.info(\"Loading references for script editor.\");var a=[];e.g_commonLibraries.forEach(function(e){return a.push(t.createLibraryXhrPromise(e))}),monaco.Promise.join(a).then(function(e){e.forEach(function(e){console.info(\"Loaded module \"+e.fileName+\".\"),monaco.languages.typescript.typescriptDefaults.addExtraLib(e.content,e.fileName),monaco.languages.typescript.javascriptDefaults.addExtraLib(e.content,e.fileName)}),n(!0)},function(){return n(!1)});break;case\"mediawiki\":t.setupMediaWikiHighlight();var s=new i.TitleAutoCompletionSource,c=new i.TemplateAutoCompletionSource;monaco.languages.registerCompletionItemProvider(\"mediawiki\",{provideCompletionItems:function(e,t){var n=e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column}),i=s.matchRule.exec(n);return i&&i.length>1?s.getCandidateItemsAsync(i[1]):(i=c.matchRule.exec(n))&&i.length>1?c.getCandidateItemsAsync(i[1]):[]}}),n(!0);break;default:n(!0)}})},e.prototype.createEditorHost=function(){var e=document.createElement(\"div\");return e.id=\"editorContainer\",e.style.cssText=\"width:100%;height:500px;\",$(\"#wpTextbox1\").after(e),$(\"#wpTextbox1\").hide(),e},e.prototype.getTheme=function(){return this.m_userOptions&&this.m_userOptions.theme?this.m_userOptions.theme:\"vs\"},e.prototype.getFontFamily=function(){return this.m_userOptions&&this.m_userOptions.fontFamily?this.m_userOptions.fontFamily:\"Iosevka, Consolas, Monaco, 'Source Han Sans SC', 'Source Han Sans', 'Microsoft YaHei', monospace\"},e.prototype.flushEditor=function(){this.m_editorControl&&$(\"#wpTextbox1\").val(this.m_editorControl.getModel().getValue())},e.prototype.setupActions=function(){var e=this;this.m_editorControl.addAction({id:\"save-action\",label:\"Save changes\",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.F7],keybindingContext:null,contextMenuGroupId:\"mediawikiActions\",contextMenuOrder:1,run:function(t){e.flushEditor(),$(\"#editform\").submit()}}),this.m_editorControl.addAction({id:\"diff-toggle-action\",label:\"Compare with current\",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.KEY_D],keybindingContext:null,contextMenuGroupId:\"mediawikiActions\",contextMenuOrder:2,run:function(t){e.initializeDiffEditor()}})},e.prototype.setupDiffActions=function(){var e=this;this.m_diffEditorControl.addAction({id:\"save-action\",label:\"Save changes\",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.F7],keybindingContext:null,contextMenuGroupId:\"mediawikiActions\",contextMenuOrder:1,run:function(t){e.flushEditor(),$(\"#editform\").submit()}})},e.prototype.setupMediaWikiHighlight=function(){monaco.languages.setMonarchTokensProvider(\"mediawiki\",new o.MediaWikiTokenizer),console.info(\"MediaWiki Monarch token provider is set.\")},e.prototype.initialize=function(){var t=this;e.isAvailable&&this.checkTitleExtensionAsync().then(function(e){t.m_docType=e,t.m_hostControl=t.createEditorHost(),t.loadReferenceLibrariesAsync().then(function(){t.m_originalContent=t.m_textAreaControl.value,monaco.editor.defineTheme(\"localTheme\",{base:t.getTheme(),inherit:!0,rules:[{token:\"bold\",fontStyle:\"bold\"},{token:\"bold.quote\",fontStyle:\"bold\"},{token:\"italic\",fontStyle:\"italic\"},{token:\"italic.quote\",fontStyle:\"italic\"}]}),t.m_editorControl=monaco.editor.create(t.m_hostControl,{value:t.m_textAreaControl.value,language:t.m_docType,theme:\"localTheme\",fontFamily:t.getFontFamily(),automaticLayout:!0,wordWrap:\"mediawiki\"===t.m_docType?\"on\":\"off\",folding:!0}),window.setInterval(function(){return t.flushEditor()},5e3),$(\"#editform\").submit(function(e){t.flushEditor()}),t.setupActions(),r.LinkLinter&&\"mediawiki\"===t.m_docType&&(t.m_linter=new r.LinkLinter(t.m_editorControl))})})},e.prototype.initializeDiffEditor=function(){this.m_originalContent&&(this.flushEditor(),this.m_editorControl.dispose(),this.m_editorControl=null,$(this.m_hostControl).empty(),this.m_diffEditorControl=monaco.editor.createDiffEditor(this.m_hostControl,{fontFamily:this.getFontFamily(),automaticLayout:!0,theme:\"localTheme\",wordWrap:\"mediawiki\"===this.m_docType?\"on\":\"off\",folding:!0}),this.m_diffEditorControl.setModel({original:monaco.editor.createModel(this.m_originalContent,this.m_docType),modified:monaco.editor.createModel(this.m_textAreaControl.value,this.m_docType)}),this.m_editorControl=this.m_diffEditorControl.getModifiedEditor(),this.setupDiffActions())},e.g_prefixMapping={Module:\"lua\",\"\u6a21\u5757\":\"lua\"},e.g_extMapping={\".js\":\"javascript\",\".ts\":\"typescript\",\".css\":\"css\",\".less\":\"less\",\".scss\":\"scss\"},e.g_commonLibraries=[{url:\"/User:Imbushuo/MonacoEditor/jquery.d.ts?action=raw&ctype=text/typescript\",fileName:\"jquery.d.ts\"},{url:\"/User:Imbushuo/MonacoEditor/mediawiki.d.ts?action=raw&ctype=text/typescript\",fileName:\"mediawiki.d.ts\"}],e}();t.MonacoEditorHost=a},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(){function e(){this.m_matchRule=/\\[\\[([^|\\n]*)$/}return Object.defineProperty(e.prototype,\"matchRule\",{get:function(){return this.m_matchRule},enumerable:!0,configurable:!0}),e.prototype.getCandidateItemsAsync=function(t){return new monaco.Promise(function(n,i,o){$.ajax({url:e.g_searchService,data:{action:\"opensearch\",search:t},cache:!0,dataType:\"json\"}).then(function(e){var t=e[1],i=e[3],o=[];if(t.length>=i.length)for(var r=0;r<t.length;r++){var a=t[r],s=i[r];o.push({insertText:a,label:a,detail:s,kind:monaco.languages.CompletionItemKind.Field})}n(o)},function(){return n([])})})},e.g_searchService=\"https://misaka.ink.moe/webproxy.php\",e}();t.TitleAutoCompletionSource=i;var o=function(){function e(){this.m_matchRule=/{{(.*)$/,this.m_templateCache={}}return Object.defineProperty(e.prototype,\"matchRule\",{get:function(){return this.m_matchRule},enumerable:!0,configurable:!0}),e.prototype.getTemplateCandidateAsync=function(e){var t=0===e.indexOf(\":\")?0:10;return new monaco.Promise(function(n,i,o){mw.loader.using(\"mediawiki.api\").then(function(){var o=new mw.Api;o.get({action:\"query\",format:\"json\",list:\"allpages\",utf8:1,formatversion:2,apprefix:e,apnamespace:t,aplimit:20}).then(function(e){var i=[];e.query&&e.query.allpages&&(e.query.allpages.forEach(function(e){var n=10==t?e.title.substring(e.title.indexOf(\":\")+1):e.title;i.push({documentation:\"\",label:n,insertText:n,kind:monaco.languages.CompletionItemKind.Class})}),n(i))},function(){i([])})})})},e.prototype.getKeys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},e.prototype.getTemplateParametersAsync=function(t){var n=this;return new monaco.Promise(function(i,o,r){var a=t.substring(0,t.indexOf(e.g_TemplateQualifier)),s=t.substring(t.lastIndexOf(e.g_TemplateQualifier)+1);(s?s.indexOf(\"=\"):-1)>=0?i([]):n.m_templateCache[a]?i(n.m_templateCache[a]):$.ajax({url:e.g_TemplateDataRepo.replace(\"{0}\",encodeURI(a)),cache:!0,dataType:\"json\"}).then(function(e){if(e&&e.params){var t=n.getKeys(e.params),o=[];t.forEach(function(t){var n=e.params[t];n&&o.push({label:t,documentation:n.description,kind:monaco.languages.CompletionItemKind.Property,detail:n.description,insertText:t})}),n.m_templateCache[a]=o,i(o)}else i([])},function(){return i([])})})},e.prototype.getCandidateItemsAsync=function(t){return t&&-1!=t.indexOf(e.g_TemplateQualifier)?this.getTemplateParametersAsync(t):this.getTemplateCandidateAsync(t)},e.g_TemplateQualifier=\"|\",e.g_TemplateDataRepo=\"https://imbushuos3.azureedge.net/Snippets/Moegirlpedia/TemplateData/{0}.json\",e}();t.TemplateAutoCompletionSource=o},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(){function e(){this.ignorecase=!0,this.empty=[\"area\",\"base\",\"basefont\",\"br\",\"col\",\"frame\",\"hr\",\"img\",\"input\",\"isindex\",\"link\",\"meta\",\"param\"],this.escapes=/\\\\(?:[btnfr\\\\\"']|[0-7][0-7]?|[0-3][0-7]{2})/,this.tokenizer={root:[{include:\"@whitespace\"},[/\\[\\[/,{token:\"string.quote\",bracket:\"@open\",next:\"@linkReferenceBlock\"}],[/{{/,{token:\"type.type-$1\",bracket:\"@open\",next:\"@templateBlock.$1\"}],[/}}/,{token:\"type.type-$1\",bracket:\"@close\"}],[/'''/,{token:\"bold.quote\",bracket:\"@open\",next:\"@boldBlock\"}],[/''/,{token:\"italic.quote\",bracket:\"@open\",next:\"@italicBlock\"}],[/<(\\w+)\\/>/,\"tag.tag-$1\"],[/<(\\w+)/,{cases:{\"@empty\":{token:\"tag.tag-$1\",next:\"@tag.$1\",log:\"Push stack to tag.$1\"},\"@default\":{token:\"tag.tag-$1\",bracket:\"@open\",next:\"@tag.$1\",log:\"Push stack to tag.$1, bracket open\"}}}],[/<\\/(\\w+)\\s*>/,{token:\"tag.tag-$1\",bracket:\"@close\",log:\"Close bracket of tag.$1\"}],[/&\\w+;/,\"string.escape\"]],boldBlock:[[/'''/,{token:\"bold.quote\",bracket:\"@close\",next:\"@pop\"}],[/[^''']+/,{token:\"bold\"}],[/''/,{token:\"italic.quote\",bracket:\"@open\",next:\"@italicBlock\"}]],italicBlock:[[/''/,{token:\"italic.quote\",bracket:\"@close\",next:\"@pop\"}],[/[^'']+/,{token:\"italic\"}]],linkReferenceBlock:[[/\\]\\]/,{token:\"string.quote\",bracket:\"@close\",next:\"@pop\"}],[/[^\\]\\]]+/,{token:\"string\"}]],templateBlock:[[/{{/,{token:\"type.type-$1\",bracket:\"@open\",next:\"@templateBlock.$1\"}],[/}}/,{token:\"type.type-$2\",next:\"@pop\"}],[/\\[\\[/,{token:\"string.quote\",bracket:\"@open\",next:\"@linkReferenceBlock\"}],[/'''/,{token:\"bold.quote\",bracket:\"@open\",next:\"@boldBlock\"}],[/''/,{token:\"italic.quote\",bracket:\"@open\",next:\"@italicBlock\"}]],tag:[[/[ \\t\\r\\n]+/,\"white\"],[/(type)(\\s*=\\s*)(\")([^\"]+)(\")/,[\"attribute.name\",\"delimiter\",\"attribute.value\",{token:\"attribute.value\",switchTo:\"@tag.$S2.$4\"},\"attribute.value\"]],[/(type)(\\s*=\\s*)(')([^']+)(')/,[\"attribute.name\",\"delimiter\",\"attribute.value\",{token:\"attribute.value\",switchTo:\"@tag.$S2.$4\"},\"attribute.value\"]],[/(\\w+)(\\s*=\\s*)(\"[^\"]*\"|'[^']*')/,[\"attribute.name\",\"delimiter\",\"attribute.value\"]],[/\\w+/,\"attribute.name\"],[/\\/>/,\"tag.tag-$S2\",\"@pop\"],[/>/,{cases:{\"$S2==style\":{token:\"tag.tag-$S2\",switchTo:\"@inlineStyle.$S2\",nextEmbedded:\"text/css\",log:\"Entering CSS section ($S2)\"},\"$S2==script\":{cases:{$S3:{token:\"tag.tag-$S2\",switchTo:\"@inlineScript.$S2\",nextEmbedded:\"$S3\"},\"@default\":{token:\"tag.tag-$S2\",switchTo:\"@inlineScript.$S2\",nextEmbedded:\"javascript\",log:\"Entering JS section ($S2)\"}}},\"@default\":{token:\"tag.tag-$S2\",next:\"@pop\",log:\"Entering $S2 section\"}}}]],inlineStyle:[[/<\\/style\\s*>/,{token:\"@rematch\",next:\"@pop\",nextEmbedded:\"@pop\",log:\"Pop stack ($S2)\"}]],inlineScript:[[/<\\/script\\s*>/,{token:\"@rematch\",next:\"@pop\",nextEmbedded:\"@pop\",log:\"Pop stack ($S2)\"}]],string:[[/[^\\\\\"']+/,\"string\"],[/@escapes/,\"string.escape\"],[/\\\\./,\"string.escape.invalid\"],[/[\"']/,{cases:{\"$#==$S2\":{token:\"string\",next:\"@pop\"},\"@default\":\"string\"}}]],whitespace:[[/[ \\t\\r\\n]+/,\"white\"],[/<!--/,\"comment\",\"@comment\"]],comment:[[/[^<\\-]+/,\"comment.content\"],[/-->/,\"comment\",\"@pop\"],[/<!--/,\"comment.content.invalid\"],[/[<\\-]/,\"comment.content\"]]},this.tokenPostfix=\"\"}return e}();t.MediaWikiTokenizer=i},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=n(5),o=function(){function e(e){var t=this;if(!e)throw new Error(\"Arg_ArgumentNullException\");this.m_editorModel=e.getModel(),e.onDidChangeModelContent(function(e){clearTimeout(t.m_hTimer),t.m_hTimer=setTimeout(function(){return t.validate()},500)}),this.m_lastPopBlk=null,this.m_stCtrlBlkEnv=[],this.m_validationMarkups=[],this.validate()}return Object.defineProperty(e.prototype,\"currentState\",{get:function(){return this.m_stCtrlBlkEnv?this.m_stCtrlBlkEnv[this.m_stCtrlBlkEnv.length-1]:null},enumerable:!0,configurable:!0}),e.prototype.validate=function(){var e=new i.ControlBlockEnvironment(!1,0);monaco.editor.setModelMarkers(this.m_editorModel,\"LinkLinter\",[]),this.m_validationMarkups=[],this.m_stCtrlBlkEnv=[],this.m_lastPopBlk=null,this.m_stCtrlBlkEnv.push(e);for(var t=1;t<=this.m_editorModel.getLineCount();t++){var n=this.m_editorModel.getLineContent(t);n&&(this.validateMatchInternal(n,t,0),4==this.currentState.lastOpenSection&&(this.m_validationMarkups.push({code:\"MW1004\",message:\"Link reference block is not closed.\",startLineNumber:this.currentState.beginLine,endLineNumber:this.currentState.beginLine,startColumn:this.currentState.beginColumn-1,endColumn:n.length+1,severity:monaco.Severity.Error}),this.m_stCtrlBlkEnv.pop()))}monaco.editor.setModelMarkers(this.m_editorModel,\"LinkLinter\",this.m_validationMarkups)},e.prototype.validateMatchInternal=function(t,n,o){var r=this.currentState;if(r.isNoOpRegion){var a=null;switch(r.lastOpenSection){case 2:a=t.match(e.g_regExpNoOpNoWikiSectionEndIdentifier);break;case 1:a=t.match(e.g_regExpNoOpPreFormattedBlkEndIdentifier)}if(a&&a.length>0){var s=a[0],c=a.index+s.length;this.m_lastPopBlk=this.m_stCtrlBlkEnv.pop(),this.validateMatchInternal(t.substring(c),n,c)}}else{var l=i.Match.convertToMatch(t.match(e.g_regExpNoOpNoWikiSectionBeginIdentifier)),u=i.Match.convertToMatch(t.match(e.g_regExpNoOpPreFormattedBlkBeginIdentifier)),d=i.Match.convertToMatch(t.match(e.g_regExpLinkBlkBeginIdentifier)),m=i.Match.convertToMatch(t.match(e.g_regExpLinkBlkEndIdentifier)),p=[];if(l.success&&p.push([l.index,l,2]),u.success&&p.push([u.index,u,1]),d.success&&p.push([d.index,d,4]),m.success&&p.push([m.index,m,5]),p.sort(function(e,t){return e[0]-t[0]}),p.length<1)return;var h=p[0],f=null;switch(h[2]){case 2:case 1:f=new i.ControlBlockEnvironment(!0,r.depth+1,h[2],n,h[1].index+h[1].length+o);break;case 4:if(4==r.lastOpenSection)return void this.m_validationMarkups.push({severity:monaco.Severity.Error,startLineNumber:n,startColumn:h[1].index+1,endLineNumber:n,endColumn:h[1].index+h[1].length+1,message:\"Cannot include nested link.\",code:\"MW1005\"});f=new i.ControlBlockEnvironment(!1,r.depth+1,h[2],n,h[1].index+h[1].length+o);break;case 5:4==r.lastOpenSection&&(this.m_lastPopBlk=this.m_stCtrlBlkEnv.pop())}f&&this.m_stCtrlBlkEnv.push(f),this.validateMatchInternal(t.substring(h[1].index+h[1].length),n,h[1].index+h[1].length+o)}},e.prototype.dispose=function(){clearTimeout(this.m_hTimer),this.m_editorModel=null},e.g_regExpNoOpNoWikiSectionBeginIdentifier=/<nowiki\\s*>/,e.g_regExpNoOpPreFormattedBlkBeginIdentifier=/<pre\\s*>/,e.g_regExpNoOpNoWikiSectionEndIdentifier=/<\\/nowiki\\s*>/,e.g_regExpNoOpPreFormattedBlkEndIdentifier=/<\\/pre\\s*>/,e.g_regExpLinkBlkBeginIdentifier=/\\[\\[/,e.g_regExpLinkBlkEndIdentifier=/\\]\\]/,e}();t.LinkLinter=o},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=function(){function e(e,t,n){this.success=e,this.index=t,this.length=n}return e.convertToMatch=function(t){if(t&&t.length>0){var n=t[0];return new e(!0,t.index,n.length)}return new e(!1,0,0)},e}();t.Match=i;var o=function(){function e(e,t,n,i,o){this.isNoOpRegion=e,this.depth=t,this.lastOpenSection=n,this.beginLine=i||0,this.beginColumn=o||0}return e}();t.ControlBlockEnvironment=o}]);\n//# sourceMappingURL=http://websymbols.internal.ligstd.com/monaco-editor/LoaderBootstrap.min.8bbcddbdccb2056d2738.js.map"}}}