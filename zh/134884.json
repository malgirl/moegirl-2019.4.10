{"parse":{"title":"Widget:TimeSinceLastEdit/Raw","pageid":227619,"wikitext":{"*":"<noinclude>\u672c Widget \u4e3a [[Widget:TimeSinceLastEdit]] \u7684\u6e90\u4ee3\u7801\uff0c\u5305\u62ec\u5b8c\u6574\u7684\u6ce8\u91ca\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u60a8\u4e0d\u5e94\u8be5\u4f7f\u7528\u8fd9\u4e2a Widget\u3002</noinclude><includeonly><!--{if !isset($wgTimeSinceLastEditRaw) || !$wgTimeSinceLastEditRaw}--><!--{assign var=\"wgTimeSinceLastEditRaw\" value=true scope=\"global\"}-->\n<script>\nwindow.RLQ = window.RLQ || [];\nwindow.RLQ.push(function(){\n    mw.loader.implement(\"widgetTimeSinceLastEdit\",function($, jQuery){\n        mw.loader.using(\"moment\").then(function () {\n\n            /**\n             * Refresh duration.\n             */ \n            function tsRefreshDuration() {\n                $('.lastEditTime').each(function() {\n                    // Sanity check\n                    if (!this.dataset || !this.dataset.lastEditTime) return;\n                    // FIX BY CASE: In Moegirlpedia's deployment, the Epoch timestamp is incorrect (with 8 hours' difference)\n                    // We will fix this by subtract 8 hours (28800 seconds)\n                    var lastEditTime = moment.unix(this.dataset.lastEditTime - 28800);\n                    if (!lastEditTime || !lastEditTime.isValid()) return;\n\n                    // Diff and sanity check\n                    var editTimeDiff = moment.duration(moment().diff(lastEditTime));\n                    if (!editTimeDiff || editTimeDiff.asMilliseconds() < 0) {\n                        // FIX BY CASE (@Yurin Jasmine): Remind user about local time issue\n                        $(this).text(\"\u672a\u77e5\u65f6\u957f\uff08\u8bf7\u6821\u51c6\u60a8\u7684\u8bbe\u5907\u65f6\u95f4\u518d\u8bd5\uff09\");\n                        return;\n                    }\n\n                    // Set time\n                    var localizedTimeString = editTimeDiff.humanize();\n                    $(this).text(localizedTimeString);\n                });\n            }\n\n            // Fire event every 16 seconds to save power\n            window.setInterval(function() { tsRefreshDuration(); }, 16000);\n\n            // First call\n            tsRefreshDuration();\n        });\n    });\n});\n</script><!--{/if}--></includeonly>"}}}