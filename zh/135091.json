{"parse":{"title":"\u6a21\u5757:\u957f\u6807\u9898","pageid":321212,"wikitext":{"*":"local module = {}\n\nlocal array = require('Module:var-array')\n\nfunction module.main(frame)\n\tlocal data = array.get('\u957f\u6807\u9898');\n\t-- mw.logObject(data[0])\n\t\n\t\n\tlocal item = {};\n\tfunction len(a)\n\t\tlocal rlt = 0;\n\t\tfor i = 1, mw.ustring.len(a) do\n\t\t\tlocal char = mw.ustring.sub(a, i, i);\n\t\t\tlocal charnum = mw.ustring.byte(char);\n\t\t\tif (charnum > 33 and charnum < 126) \n\t\t\t\t\tor char == '\u2018'\n\t\t\t\t\tor char == '\u2019'\n\t\t\t\t\tor char == '\u201c'\n\t\t\t\t\tor char == '\u201d'\n\t\t\t\t\tor char == '\u300c'\n\t\t\t\t\tor char == '\u300d'\n\t\t\t\t\tor char == '\u300a'\n\t\t\t\t\tor char == '\u300b'\n\t\t\t\t\tor char == '\uff08'\n\t\t\t\t\tor char == '\uff09'\n\t\t\t\t\tor char == '\u3010'\n\t\t\t\t\tor char == '\u3011'\n\t\t\t\t\tor char == '{'\n\t\t\t\t\tor char == '}' then\n\t\t\t\trlt = rlt + 0.5;\n\t\t\telseif char == ' '\n\t\t\t\t\tor char == '\u3000'\n\t\t\t\t\tor char == '\\n'\n\t\t\t\t\tor char == '\\t' then\n\t\t\t\t-- do nothing\n\t\t\telse\n\t\t\t\trlt = rlt + 1;\n\t\t\tend\n\t\tend\n\t\treturn rlt;\n\tend\n\tfunction cmp (a, b)\n\t\treturn a.len > b.len;\n\tend\n\tfor i = 1, #data do\n\t\tlocal sort_key = data[i][1]:gsub('<%s-/?del.->', ''):gsub('<%s-/?span.->', '');\n\t\tif (string.match(sort_key, '^%[%[.-%|(.-)%]%]$')) then\n\t\t\tsort_key = string.match(sort_key, '%[%[.-%|(.-)%]%]');\n\t\telseif (string.match(sort_key, '^%[%[(.-)%]%]$')) then\n\t\t\tsort_key = string.match(sort_key, '^%[%[(.-)%]%]$');\n\t\tend\n\t\t-- mw.log(sort_key);\n\t\tlocal length;\n\t\tif (data[i][5] ~= nil and data[i][5] ~= '') then\n\t\t\tlength = tonumber(data[i][5]);\n\t\telse\n\t\t\tlength = len(sort_key);\n\t\tend\n\t\t-- mw.log(data[i][5]);\n\t\ttable.insert(item, {\n\t\t\tname=data[i][1],\n\t\t\tshort=data[i][2],\n\t\t\ttheme=data[i][3],\n\t\t\toriginal_number=data[i][4],\n\t\t\tlen=length\n\t\t})\n\tend\n\t\n\ttable.sort(item, cmp)\n\t\n\tlocal rlt = '';\n\tfor i = 1, #item do\n\t\trlt = rlt..'|-\\n|'..item[i].name..'||'..item[i].short..'||'..item[i].theme..'||'..item[i].original_number..'||'..item[i].len..'\\n'\n\tend\n\treturn rlt..'\\n|}';\nend\n\nreturn module"}}}