{"parse":{"title":"MediaWiki:Gadget-twinklexfd.js","pageid":164874,"wikitext":{"*":"//\u672cjs\u5f15\u81ea\u4e2d\u6587\u7ef4\u57fa\u767e\u79d1[[zhwiki:Special:Permalink/37459157]]\n!function(){Twinkle.xfd=function(){mw.config.get(\"wgNamespaceNumber\")<0||!mw.config.get(\"wgArticleId\")||6===mw.config.get(\"wgNamespaceNumber\")&&(document.getElementById(\"mw-sharedupload\")||!document.getElementById(\"mw-imagepage-section-filehistory\")&&!Morebits.wiki.isPageRedirect())||Twinkle.addPortletLink(Twinkle.xfd.callback,\"\u63d0\u5220\",\"tw-xfd\",\"\u63d0\u4ea4\u5220\u9664\u8ba8\u8bba\")},Twinkle.xfd.currentRationale=null,Twinkle.xfd.printRationale=function(){Twinkle.xfd.currentRationale&&(Morebits.status.printUserText(Twinkle.xfd.currentRationale,\"\u60a8\u7684\u7406\u7531\u5df2\u5728\u4e0b\u65b9\u63d0\u4f9b\uff0c\u5982\u679c\u60a8\u60f3\u91cd\u65b0\u63d0\u4ea4\uff0c\u8bf7\u5c06\u5176\u590d\u5236\u5230\u4e00\u65b0\u7a97\u53e3\u4e2d\uff1a\"),Twinkle.xfd.currentRationale=null)},Twinkle.xfd.callback=function(){var b,c,d,e,a=new Morebits.simpleWindow(600,350);a.setTitle(\"\u63d0\u4ea4\u5b58\u5e9f\u8ba8\u8bba\"),a.setScriptName(\"Twinkle\"),a.addFooterLink(\"\u5173\u4e8e\u5b58\u5e9f\u8ba8\u8bba\",\"WP:XFD\"),a.addFooterLink(\"Twinkle\u5e2e\u52a9\",\"WP:TW/DOC#xfd\"),b=new Morebits.quickForm(Twinkle.xfd.callback.evaluate),c=b.append({type:\"select\",name:\"category\",label:\"\u63d0\u4ea4\u7c7b\u578b\uff1a\",event:Twinkle.xfd.callback.change_category}),c.append({type:\"option\",label:\"\u9875\u9762\u5b58\u5e9f\u8ba8\u8bba\",selected:0===mw.config.get(\"wgNamespaceNumber\"),value:\"afd\"}),c.append({type:\"option\",label:\"\u6587\u4ef6\u5b58\u5e9f\u8ba8\u8bba\",selected:6===mw.config.get(\"wgNamespaceNumber\"),value:\"ffd\"}),b.append({type:\"checkbox\",list:[{label:\"\u5982\u53ef\u80fd\uff0c\u901a\u77e5\u9875\u9762\u521b\u5efa\u8005\",value:\"notify\",name:\"notify\",tooltip:\"\u5728\u9875\u9762\u521b\u5efa\u8005\u5bf9\u8bdd\u9875\u4e0a\u653e\u7f6e\u4e00\u901a\u77e5\u6a21\u677f\u3002\",checked:!0}]}),b.append({type:\"field\",label:\"\u5de5\u4f5c\u533a\",name:\"work_area\"}),b.append({type:\"submit\"}),d=b.render(),a.setContent(d),a.display(),e=document.createEvent(\"Event\"),e.initEvent(\"change\",!0,!0),d.category.dispatchEvent(e)},Twinkle.xfd.previousNotify=!0,Twinkle.xfd.callback.change_category=function(a){var i,b=a.target.value,c=a.target.form,d=Morebits.quickForm.getElements(a.target.form,\"work_area\")[0],e=null,f=c.getElementsByTagName(\"textarea\")[0],g=f?f.value:\"\",h=function(){e.append({type:\"textarea\",name:\"xfdreason\",label:\"\u7406\u7531\uff1a\",value:g,tooltip:\"\u60a8\u53ef\u4ee5\u4f7f\u7528\u7ef4\u57fa\u683c\u5f0f\uff0cTwinkle\u5c06\u81ea\u52a8\u4e3a\u60a8\u52a0\u5165\u7b7e\u540d\u3002\"})};switch(b){case\"afd\":e=new Morebits.quickForm.element({type:\"field\",label:\"\u9875\u9762\u5b58\u5e9f\u8ba8\u8bba\",name:\"work_area\"}),e.append({type:\"checkbox\",list:[{label:\"\u4f7f\u7528<noinclude>\u5305\u88f9\u6a21\u677f\",value:\"noinclude\",name:\"noinclude\",checked:10===mw.config.get(\"wgNamespaceNumber\"),tooltip:\"\u4f7f\u5176\u4e0d\u4f1a\u5728\u88ab\u5305\u542b\u65f6\u51fa\u73b0\u3002\"}]}),i=e.append({type:\"select\",name:\"xfdcat\",label:\"\u9009\u62e9\u63d0\u5220\u7c7b\u522b\uff1a\",event:Twinkle.xfd.callback.change_afd_category}),i.append({type:\"option\",label:\"\u5220\u9664\",value:\"delete\",selected:!0}),i.append({type:\"option\",label:\"\u5408\u5e76\",value:\"merge\"}),i.append({type:\"option\",label:\"\u79fb\u52a8\u5230\u7ef4\u57fa\u8f9e\u5178\",value:\"vmd\"}),i.append({type:\"option\",label:\"\u79fb\u52a8\u5230\u7ef4\u57fa\u6587\u5e93\",value:\"vms\"}),i.append({type:\"option\",label:\"\u79fb\u52a8\u5230\u7ef4\u57fa\u6559\u79d1\u4e66\",value:\"vmb\"}),i.append({type:\"option\",label:\"\u79fb\u52a8\u5230\u7ef4\u57fa\u8bed\u5f55\",value:\"vmq\"}),i.append({type:\"option\",label:\"\u79fb\u52a8\u5230\u7ef4\u57fa\u5bfc\u6e38\",value:\"vmvoy\"}),Morebits.userIsInGroup(\"sysop\")&&i.append({type:\"option\",label:\"\u8f6c\u4ea4\u81ea\u5feb\u901f\u5220\u9664\u5019\u9009\",value:\"fwdcsd\"}),e.append({type:\"input\",name:\"mergeinto\",label:\"\u5408\u5e76\u5230\uff1a\",disabled:!0}),h(),e=e.render(),d.parentNode.replaceChild(e,d);break;case\"ffd\":e=new Morebits.quickForm.element({type:\"field\",label:\"\u6587\u4ef6\u5b58\u5e9f\u8ba8\u8bba\",name:\"work_area\"}),h(),e=e.render(),d.parentNode.replaceChild(e,d);break;default:e=new Morebits.quickForm.element({type:\"field\",label:\"\u672a\u5b9a\u4e49\",name:\"work_area\"}),e=e.render(),d.parentNode.replaceChild(e,d)}\"cfds\"===b?(Twinkle.xfd.previousNotify=c.notify.checked,c.notify.checked=!1,c.notify.disabled=!0):(c.notify.checked=Twinkle.xfd.previousNotify,c.notify.disabled=!1)},Twinkle.xfd.callback.change_afd_category=function(a){\"merge\"===a.target.value?(a.target.form.mergeinto.disabled=!1,a.target.form.mergeinto.previousElementSibling.innerHTML=\"\u5408\u5e76\u5230\uff1a\"):\"fwdcsd\"===a.target.value?(a.target.form.mergeinto.disabled=!1,a.target.form.mergeinto.previousElementSibling.innerHTML=\"\u63d0\u4ea4\u4eba\uff1a\"):a.target.form.mergeinto.disabled=!0},Twinkle.xfd.callbacks={afd:{main:function(a){var c,d,e,b=a.getCallbackParameters();if(wikipedia_page=new Morebits.wiki.page(b.logpage,\"\u6dfb\u52a0\u8ba8\u8bba\u5230\u5f53\u65e5\u5217\u8868\"),wikipedia_page.setFollowRedirect(!0),wikipedia_page.setCallbackParameters(b),wikipedia_page.load(Twinkle.xfd.callbacks.afd.todaysList),b.usertalk){if(c=a.getCreator(),c===mw.config.get(\"wgUserName\"))return a.getStatusElement().warn(\"\u60a8\uff08\"+c+\"\uff09\u521b\u5efa\u4e86\u8be5\u9875\uff0c\u8df3\u8fc7\u901a\u77e5\"),void 0;switch(d=new Morebits.wiki.page(\"User talk:\"+c,\"\u901a\u77e5\u9875\u9762\u521b\u5efa\u8005\uff08\"+c+\"\uff09\"),e=\"\\n{{subst:AFDNote|\"+Morebits.pageNameNorm+\"}}--~~\"+\"~~\",d.setAppendText(e),d.setEditSummary(\"\u901a\u77e5\uff1a\u9875\u9762[[\"+Morebits.pageNameNorm+\"]]\u5b58\u5e9f\u8ba8\u8bba\u63d0\u540d\"+Twinkle.getPref(\"summaryAd\")),d.setCreateOption(\"recreate\"),Twinkle.getPref(\"xfdWatchUser\")){case\"yes\":d.setWatchlist(!0);break;case\"no\":d.setWatchlistFromPreferences(!1);break;default:d.setWatchlistFromPreferences(!0)}d.setFollowRedirect(!0),d.append()}},taggingArticle:function(a){var b,c,d,e;if(!a.exists())return statelem.error(\"\u9875\u9762\u4e0d\u5b58\u5728\uff0c\u53ef\u80fd\u5df2\u88ab\u5220\u9664\"),void 0;switch(b=a.getPageText(),c=a.getCallbackParameters(),d=\"{{vfd|\"+Morebits.string.formatReasonText(c.reason),c.xfdcat){case\"vmd\":d+=\"|wikt\";break;case\"vms\":d+=\"|s\";break;case\"vmb\":d+=\"|b\";break;case\"vmq\":d+=\"|q\";break;case\"vmvoy\":d+=\"|voy\"}switch(Morebits.wiki.isPageRedirect()&&(d+=\"|r\"),d+=\"|date=2016/04/13}}\",c.noinclude?d=\"<noinclude>\"+d+\"</noinclude>\":d+=\"\\n\",e=b.replace(/\\{\\{\\s*(db(-\\w*)?|d|delete|(?:hang|hold)[\\- ]?on)\\s*(\\|(?:\\{\\{[^{}]*\\}\\}|[^{}])*)?\\}\\}\\s*/gi,\"\"),b!==e&&confirm(\"\u5728\u9875\u9762\u4e0a\u627e\u5230\u5feb\u901f\u5220\u9664\u6a21\u677f\uff0c\u8981\u79fb\u9664\u5417\uff1f\")&&(b=e),Twinkle.getPref(\"markXfdPagesAsPatrolled\")&&a.patrol(),a.setPageText(d+b),a.setEditSummary(\"\u9875\u9762\u5b58\u5e9f\u8ba8\u8bba\uff1a[[\"+c.logpage+\"#\"+Morebits.pageNameNorm+\"]]\"+Twinkle.getPref(\"summaryAd\")),Twinkle.getPref(\"xfdWatchPage\")){case\"yes\":a.setWatchlist(!0);break;case\"no\":a.setWatchlistFromPreferences(!1);break;default:a.setWatchlistFromPreferences(!0)}a.save(),Twinkle.getPref(\"markXfdPagesAsPatrolled\")&&a.patrol()},todaysList:function(a){var c,d,e;switch(a.getPageText(),c=a.getCallbackParameters(),d=\"\",e=\"\",c.xfdcat){case\"vmd\":case\"vms\":case\"vmb\":case\"vmq\":case\"vmvoy\":d=\"vm\",e=c.xfdcat;break;case\"fwdcsd\":case\"merge\":e=c.mergeinto;default:d=c.xfdcat}switch(a.setAppendText(\"\\n{{subst:DRItem|Type=\"+d+\"|DRarticles=\"+Morebits.pageNameNorm+\"|Reason=\"+Morebits.string.formatReasonText(c.reason)+\"|To=\"+e+\"}~~\"+\"~~\"),a.setEditSummary(\"\u6dfb\u52a0[[\"+Morebits.pageNameNorm+\"]]\"+Twinkle.getPref(\"summaryAd\")),Twinkle.getPref(\"xfdWatchDiscussion\")){case\"yes\":a.setWatchlist(!0);break;case\"no\":a.setWatchlistFromPreferences(!1);break;default:a.setWatchlistFromPreferences(!0)}a.setCreateOption(\"recreate\"),a.append(),Twinkle.xfd.currentRationale=null}},ffd:{main:function(a){var d,e,b=a.getCallbackParameters(),c=a.getCreator();if(b.uploader=c,wikipedia_page=new Morebits.wiki.page(b.logpage,\"\u6dfb\u52a0\u8ba8\u8bba\u5230\u5f53\u65e5\u5217\u8868\"),wikipedia_page.setFollowRedirect(!0),wikipedia_page.setCallbackParameters(b),wikipedia_page.load(Twinkle.xfd.callbacks.ffd.todaysList),b.usertalk){if(c===mw.config.get(\"wgUserName\"))return a.getStatusElement().warn(\"\u60a8\uff08\"+c+\"\uff09\u521b\u5efa\u4e86\u8be5\u9875\uff0c\u8df3\u8fc7\u901a\u77e5\"),void 0;switch(d=new Morebits.wiki.page(\"User talk:\"+c,\"\u901a\u77e5\u9875\u9762\u521b\u5efa\u8005\uff08\"+c+\"\uff09\"),e=\"\\n{{subst:idw|File:\"+mw.config.get(\"wgTitle\")+\"}}--~~\"+\"~~\",d.setAppendText(e),d.setEditSummary(\"\u901a\u77e5\uff1a\u6587\u4ef6[[\"+Morebits.pageNameNorm+\"]]\u5b58\u5e9f\u8ba8\u8bba\u63d0\u540d\"+Twinkle.getPref(\"summaryAd\")),d.setCreateOption(\"recreate\"),Twinkle.getPref(\"xfdWatchUser\")){case\"yes\":d.setWatchlist(!0);break;case\"no\":d.setWatchlistFromPreferences(!1);break;default:d.setWatchlistFromPreferences(!0)}d.setFollowRedirect(!0),d.append()}},taggingImage:function(a){var b=a.getPageText(),c=a.getCallbackParameters();switch(a.setPageText(\"{{ifd|\"+Morebits.string.formatReasonText(c.reason)+\"|date=2016-04-13T11:22:15+00:00}}\\n\"+b),a.setEditSummary(\"\u6587\u4ef6\u5b58\u5e9f\u8ba8\u8bba\uff1a[[\"+c.logpage+\"#\"+Morebits.pageNameNorm+\"]]\"+Twinkle.getPref(\"summaryAd\")),Twinkle.getPref(\"xfdWatchPage\")){case\"yes\":a.setWatchlist(!0);break;case\"no\":a.setWatchlistFromPreferences(!1);break;default:a.setWatchlistFromPreferences(!0)}a.setCreateOption(\"recreate\"),a.save()},todaysList:function(a){a.getPageText();var c=a.getCallbackParameters();switch(a.setAppendText(\"\\n{{subst:IfdItem|Filename=\"+mw.config.get(\"wgTitle\")+\"|Uploader=\"+c.uploader+\"|Reason=\"+Morebits.string.formatReasonText(c.reason)+\"}}--~~\"+\"~~\"),a.setEditSummary(\"\u6dfb\u52a0[[\"+Morebits.pageNameNorm+\"]]\"+Twinkle.getPref(\"summaryAd\")),Twinkle.getPref(\"xfdWatchDiscussion\")){case\"yes\":a.setWatchlist(!0);break;case\"no\":a.setWatchlistFromPreferences(!1);break;default:a.setWatchlistFromPreferences(!0)}a.setCreateOption(\"recreate\"),a.append(function(){Twinkle.xfd.currentRationale=null})}}},Twinkle.xfd.callback.evaluate=function(a){function n(a){return 10>a?\"0\"+a:a}var e,f,g,i,k,l,m,o,b=a.target.category.value,c=a.target.notify.checked,d=a.target.xfdreason.value;if(\"afd\"===b&&(g=a.target.noinclude.checked,e=a.target.xfdcat.value,f=a.target.mergeinto.value),Morebits.simpleWindow.setButtonsEnabled(!1),Morebits.status.init(a.target),Twinkle.xfd.currentRationale=d,Morebits.status.onError(Twinkle.xfd.printRationale),!b)return Morebits.status.error(\"\u9519\u8bef\",\"\u672a\u5b9a\u4e49\u7684\u52a8\u4f5c\"),void 0;switch(m=new Date,b){case\"afd\":o=m.getUTCFullYear()+\"/\"+n(m.getUTCMonth()+1)+\"/\"+n(m.getUTCDate()),k=\"Wikipedia:\u9801\u9762\u5b58\u5ee2\u8a0e\u8ad6/\u8a18\u9304/\"+o,l={usertalk:c,xfdcat:e,mergeinto:f,noinclude:g,reason:d,logpage:k},Morebits.wiki.addCheckpoint(),Morebits.wiki.actionCompleted.redirect=k,Morebits.wiki.actionCompleted.notice=\"\u63d0\u540d\u5b8c\u6210\uff0c\u91cd\u5b9a\u5411\u5230\u8ba8\u8bba\u9875\",i=new Morebits.wiki.page(mw.config.get(\"wgPageName\"),\"\u6dfb\u52a0\u5b58\u5e9f\u8ba8\u8bba\u6a21\u677f\u5230\u9875\u9762\"),i.setFollowRedirect(!1),i.setCallbackParameters(l),i.load(Twinkle.xfd.callbacks.afd.taggingArticle),i=new Morebits.wiki.page(mw.config.get(\"wgPageName\")),i.setCallbackParameters(l),i.lookupCreator(Twinkle.xfd.callbacks.afd.main),Morebits.wiki.removeCheckpoint();break;case\"ffd\":o=m.getUTCFullYear()+\"/\"+n(m.getUTCMonth()+1)+\"/\"+n(m.getUTCDate()),k=\"Wikipedia:\u6a94\u6848\u5b58\u5ee2\u8a0e\u8ad6/\u8a18\u9304/\"+o,l={usertalk:c,reason:d,logpage:k},Morebits.wiki.addCheckpoint(),Morebits.wiki.actionCompleted.redirect=k,Morebits.wiki.actionCompleted.notice=\"\u63d0\u540d\u5b8c\u6210\uff0c\u91cd\u5b9a\u5411\u5230\u8ba8\u8bba\u9875\",i=new Morebits.wiki.page(mw.config.get(\"wgPageName\"),\"\u6dfb\u52a0\u5b58\u5e9f\u8ba8\u8bba\u6a21\u677f\u5230\u6587\u4ef6\u63cf\u8ff0\u9875\"),i.setFollowRedirect(!1),i.setCallbackParameters(l),i.load(Twinkle.xfd.callbacks.ffd.taggingImage),i=new Morebits.wiki.page(mw.config.get(\"wgPageName\")),i.setCallbackParameters(l),i.lookupCreator(Twinkle.xfd.callbacks.ffd.main),Morebits.wiki.removeCheckpoint();break;default:alert(\"twinklexfd\uff1a\u672a\u5b9a\u4e49\u7684\u7c7b\u522b\")}}}(jQuery);"}}}