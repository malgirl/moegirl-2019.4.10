{"parse":{"title":"User:Nzh21/js/QuickDiff.js","pageid":307076,"wikitext":{"*":"/* \u672a\u538b\u7f29\u7684\u7248\u672c\u5728 Special:Permanentlink/2405668 */\n$(function(){var a,b;$(\"a\").on(\"mouseover\",function(d){var c=this;if(/((Special|%E7%89%B9%E6%AE%8A):(Diff|%E5%B7%AE%E5%BC%82|%E5%B7%AE%E7%95%B0))|[?&]diff=/i.test(c.href)&&(!/#/.test(c.href))){clearTimeout(b);clearTimeout(a);a=setTimeout(function(){if(!$(\"#quickdiff\")[0]){$(\"body\").append('<div id=\"quickdiff\" style=\"border: 1px solid #a7d7f9; padding: 16px 24px 16px 24px; background-color: #ffffff; '+'color: #222222; position: absolute; left: 20px; right: 20px; font-size: 14px; margin-bottom: 10px; display: none; z-index:20;\">'+'<div style=\"cursor: pointer; position: absolute; top: 0px; right: 0px; margin: -2px 7px; font-size: 20px;\" onClick=\"$(\\'#quickdiff\\').hide();\">x</div>'+'<style type=\"text/css\">@import \"'+mw.config.get(\"wgScriptPath\")+'/load.php?debug=false&modules=mediawiki.diff.styles&only=styles\"</style>'+'<div id=\"quickdiffarrow\" style=\"position:absolute; height:0px; width:0px; border:6px solid transparent;\"></div>'+'<div id=\"quickdiffcontent\" style=\"overflow: auto; height: 100%;\"></div></div>')\n}var j=0,i=0;var h=c;while(h!==null){j+=h.offsetTop;i+=h.offsetLeft;h=h.offsetParent}if(d.clientY<document.body.clientHeight/2){$(\"#quickdiff\").css({\"top\":j+c.offsetHeight+6,\"bottom\":\"\",\"max-height\":\"300px\",\"display\":\"block\"});$(\"#quickdiffarrow\").css({\"top\":\"-13px\",\"bottom\":\"\",\"border-top-color\":\"transparent\",\"border-bottom-color\":\"#a7d7f9\",\"left\":i+c.offsetWidth/2-20-6})}else{$(\"#quickdiff\").css({\"top\":\"\",\"bottom\":$(\"body\")[0].offsetHeight-(j+6),\"max-height\":\"300px\",\"display\":\"block\"});$(\"#quickdiffarrow\").css({\"top\":\"\",\"bottom\":\"-13px\",\"border-top-color\":\"#a7d7f9\",\"border-bottom-color\":\"transparent\",\"left\":i+c.offsetWidth/2-20-6})\n}$(\"#quickdiffcontent\").css(\"max-height\",\"300px\");$(\"#quickdiffcontent\").html('<div style=\"text-align: center;\">Loading...</div>');var g=(c.href.match(/[?&]oldid=(\\d*)/i)||[\"\",null])[1];if(!g){g=(c.href.match(/(?:Special|%E7%89%B9%E6%AE%8A):(?:Diff|%E5%B7%AE%E5%BC%82|%E5%B7%AE%E7%95%B0)\\/(\\d+)\\/\\d+/i)||[null,null])[1]}var e=(c.href.match(/[?&]diff=([^&]*)/i)||[null,null])[1];if(!e){e=(c.href.match(/(?:Special|%E7%89%B9%E6%AE%8A):(?:Diff|%E5%B7%AE%E5%BC%82|%E5%B7%AE%E7%95%B0)\\/\\d+\\/(\\d+)/i)||[null,null])[1];\nif(!e){e=(c.href.match(/(?:Special|%E7%89%B9%E6%AE%8A):(?:Diff|%E5%B7%AE%E5%BC%82|%E5%B7%AE%E7%95%B0)\\/(\\d+)/i)||[null,null])[1]}}var f={action:\"compare\",format:\"json\",utf8:1,};if(jQuery.isNumeric(g)&&jQuery.isNumeric(e)){if(e==\"0\"){f.torelative=\"cur\";f.fromrev=g}else{f.fromrev=g;f.torev=e}}else{if(g){f.torelative=e;f.fromrev=g}else{f.torelative=\"prev\";f.fromrev=e}}$.ajax({type:\"GET\",url:mw.config.get(\"wgScriptPath\")+\"/api.php\",data:f,timeout:3000,success:function(k){if(k.compare&&k.compare[\"*\"]!=null){$(\"#quickdiffcontent\").html('<table class=\"diff diff-contentalign-left\" data-mw=\"interface\"><colgroup>'+'<col class=\"diff-marker\"><col class=\"diff-content\"><col class=\"diff-marker\"><col class=\"diff-content\"></colgroup><tbody>'+(k.compare[\"*\"]===\"\"?'<div style=\"text-align: center;\">\uff08\u6ca1\u6709\u5dee\u5f02\uff09</div>':k.compare[\"*\"])+\"</tbody></table>\");\n$.each(window.QucikDiffExtension||[],function(l,m,n){if(typeof m==\"function\"){m($(\"#quickdiff\")[0],k)}})}else{$(\"#quickdiffcontent\").html('<div>\u51fa\u73b0\u672a\u77e5\u9519\u8bef\uff0c\u4ee5\u4e0b\u662f\u9519\u8bef\u4fe1\u606f\uff0c\u8bf7<a href=\"/User_talk:Nzh21\">\u53cd\u9988\u7ed9Nzh21</a></div>'+JSON.stringify(k))}},error:function(){$(\"#quickdiffcontent\").html('<div style=\"text-align: center; color: red; font-size: larger;\">\u7f51\u7edc\u8fde\u63a5\u51fa\u9519</div>')}})},300)}});$(document).on(\"mouseout\",function(){clearTimeout(a);clearTimeout(b);b=setTimeout(function(){$(\"#quickdiff\").hide()},500)});$(document).on(\"mouseover\",\"#quickdiff\",function(){clearTimeout(b)\n});$(document).on(\"mouseout\",\"#quickdiff\",function(){clearTimeout(b);b=setTimeout(function(){$(\"#quickdiff\").hide()},500)})});"}}}