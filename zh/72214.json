{"parse":{"title":"User:Imbushuo/MonacoEditor/MediaWikiIntelliSense.min.js","pageid":221909,"wikitext":{"*":"var MwMonacoExtension;(function(MwMonacoExtension){var TitleAutoCompletionSource=function(){function TitleAutoCompletionSource(){this.m_matchRule=/\\[\\[([^|\\n]*)$/}return Object.defineProperty(TitleAutoCompletionSource.prototype,\"matchRule\",{get:function(){return this.m_matchRule},enumerable:!0,configurable:!0}),TitleAutoCompletionSource.prototype.getCandidateItemsAsync=function(input){return new monaco.Promise(function(complete){$.ajax({url:TitleAutoCompletionSource.g_searchService,data:{action:\"opensearch\",search:input},cache:!0,dataType:\"json\"}).then(function(data){var arrCandidates=data[1],arrCandidateLinks=data[3],autoCompletionItems=[],i,candidate,link;if(arrCandidates.length>=arrCandidateLinks.length)for(i=0;i<arrCandidates.length;i++)candidate=arrCandidates[i],link=arrCandidateLinks[i],autoCompletionItems.push({insertText:candidate,label:candidate,detail:link,kind:monaco.languages.CompletionItemKind.Field});complete(autoCompletionItems)},function(){return complete([])})})},TitleAutoCompletionSource}(),TemplateAutoCompletionSource;TitleAutoCompletionSource.g_searchService=\"https://misaka.ink.moe/webproxy.php\";MwMonacoExtension.TitleAutoCompletionSource=TitleAutoCompletionSource;TemplateAutoCompletionSource=function(){function TemplateAutoCompletionSource(){this.m_matchRule=/{{(.*)$/;this.m_templateCache={}}return Object.defineProperty(TemplateAutoCompletionSource.prototype,\"matchRule\",{get:function(){return this.m_matchRule},enumerable:!0,configurable:!0}),TemplateAutoCompletionSource.prototype.getTemplateCandidateAsync=function(templateName){var queryNamespace=templateName.indexOf(\":\")===0?0:10;return new monaco.Promise(function(complete,error){mw.loader.using(\"mediawiki.api\").then(function(){var apiQuery=new mw.Api,pageResults=apiQuery.get({action:\"query\",format:\"json\",list:\"allpages\",utf8:1,formatversion:2,apprefix:templateName,apnamespace:queryNamespace,aplimit:20}).then(function(response){var completionItems=[];response.query&&response.query.allpages&&(response.query.allpages.forEach(function(p){var itemDisplayName=queryNamespace==10?p.title.substring(p.title.indexOf(\":\")+1):p.title;completionItems.push({documentation:\"\",label:itemDisplayName,insertText:itemDisplayName,kind:monaco.languages.CompletionItemKind.Class})}),complete(completionItems))},function(){error([])})})})},TemplateAutoCompletionSource.prototype.getKeys=function(obj){var ret=[];for(var key in obj)obj.hasOwnProperty(key)&&ret.push(key);return ret},TemplateAutoCompletionSource.prototype.getTemplateParametersAsync=function(input){var _this=this;return new monaco.Promise(function(complete){var templateName=input.substring(0,input.indexOf(TemplateAutoCompletionSource.g_TemplateQualifier)),currParamInput=input.substring(input.lastIndexOf(TemplateAutoCompletionSource.g_TemplateQualifier)+1),paramOpIdx=currParamInput?currParamInput.indexOf(\"=\"):-1;paramOpIdx>=0?complete([]):_this.m_templateCache[templateName]?complete(_this.m_templateCache[templateName]):$.ajax({url:TemplateAutoCompletionSource.g_TemplateDataRepo.replace(\"{0}\",encodeURI(templateName)),cache:!0,dataType:\"json\"}).then(function(data){if(data&&data.params){var keys=_this.getKeys(data.params),fields_1=[];keys.forEach(function(key){var d=data.params[key];d&&fields_1.push({label:key,documentation:d.description,kind:monaco.languages.CompletionItemKind.Property,detail:d.description,insertText:key})});_this.m_templateCache[templateName]=fields_1;complete(fields_1)}else complete([])},function(){return complete([])})})},TemplateAutoCompletionSource.prototype.getCandidateItemsAsync=function(input){return input&&input.indexOf(TemplateAutoCompletionSource.g_TemplateQualifier)!=-1?this.getTemplateParametersAsync(input):this.getTemplateCandidateAsync(input)},TemplateAutoCompletionSource}();TemplateAutoCompletionSource.g_TemplateQualifier=\"|\";TemplateAutoCompletionSource.g_TemplateDataRepo=\"https://imbushuos3.azureedge.net/Snippets/Moegirlpedia/TemplateData/{0}.json\";MwMonacoExtension.TemplateAutoCompletionSource=TemplateAutoCompletionSource})(MwMonacoExtension||(MwMonacoExtension={}));\n//# sourceMappingURL=MediaWikiIntelliSense.min.js.map"}}}