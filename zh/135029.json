{"parse":{"title":"\u6a21\u5757:Side box/sandbox","pageid":268570,"wikitext":{"*":"--\u672c\u6a21\u584a\u5d4c\u5165{{side box}}\n\nlocal yesno = require('Module:Yesno')\n\nlocal p = {}\n\nfunction p.main(frame)\n\tlocal origArgs = frame:getParent().args\n\tlocal args = {}\n\tfor k, v in pairs(origArgs) do\n\t\tv = v:match('%s*(.-)%s*$')\n\t\tif v ~= '' then\n\t\t\targs[k] = v\n\t\tend\n\tend\n\treturn p._main(args)\nend\n\nfunction p._main(args)\n\tlocal data = p.makeData(args)\n\treturn p.renderSidebox(data)\nend\n\nfunction p.makeData(args)\n\tlocal data = {}\n\n\t-- Main table classes\n\tdata.classes = {}\n\t--Main table classes\n\t\n\tif yesno(args.metadata) ~= false then\n\t\ttable.insert(data.classes, 'metadata')\n\tend\n\tif (args.position and args.position:lower() == 'left') or (args.position and args.position:lower() == '\u5de6') then\n\t\ttable.insert(data.classes, 'mbox-small-left')\n\telse\n\t\ttable.insert(data.classes, 'mbox-small')\n\tend\n\ttable.insert(data.classes, args.class)\n\t\n\t-- Image\n\tif args.image and args.image ~= 'none' then\n\t\tdata.image = args.image\n\tend\n\n\t-- Copy over data that doesn't need adjusting\n\tlocal argsToCopy = {\n\t\t-- Styles\n\t\t'style',\n\t\t'textstyle',\n\n\t\t-- Above row\n\t\t'above',\n\t\t'abovestyle',\n\n\t\t-- Body row\n\t\t'text',\n\t\t'imageright',\n\n\t\t-- Below row\n\t\t'below',\n\t}\n\tfor i, key in ipairs(argsToCopy) do\n\t\tdata[key] = args[key]\n\tend\n\n\treturn data\nend\n\nfunction p.renderSidebox(data)\n\t--Style of the mbox-small\n    local rootstyle = mw.html.create('style')\n\t-- Renders the sidebox HTML.\n\t-- Table root\n\tlocal root = mw.html.create('table')\n\tfor i, class in ipairs(data.classes or {}) do\n\t\troot:addClass(class)\n\tend\n\troot:css{border = '1px solid #aaa', ['background-color'] = '#f9f9f9'}\n\tif data.style then\n\t\troot:cssText(data.style)\n\tend\n\n\t-- The \"above\" row\n\tif data.above then\n\t\tlocal aboveCell = root:newline():tag('tr'):tag('td')\n\t\taboveCell\n\t\t\t:attr('colspan', data.imageright and 3 or 2)\n\t\t\t:addClass('mbox-text')\n\t\tif data.textstyle then\n\t\t\taboveCell:cssText(data.textstyle)\n\t\tend\n\t\tif data.abovestyle then\n\t\t\taboveCell:cssText(data.abovestyle)\n\t\tend\n\t\taboveCell\n\t\t\t:newline()\n\t\t\t:wikitext(data.above)\n\tend\n\n\t-- The body row\n\tlocal bodyRow = root:newline():tag('tr'):newline()\n\tif data.image then\n\t\tbodyRow:tag('td')\n\t\t\t:addClass('mbox-image')\n\t\t\t:wikitext(data.image)\n\telse\n\t\tbodyRow:tag('td'):css('width', '1px')\n\tend\n\tlocal textCell = bodyRow:newline():tag('td')\n\ttextCell:addClass('mbox-text plainlist')\n\tif data.textstyle then\n\t\ttextCell:cssText(data.textstyle)\n\tend\n\ttextCell:wikitext(data.text)\n\tif data.imageright then\n\t\tbodyRow:newline():tag('td')\n\t\t\t:addClass('mbox-imageright')\n\t\t\t:wikitext(data.imageright)\n\tend\n\n\t-- The below row\n\tif data.below then\n\t\tlocal belowCell = root:newline():tag('tr'):tag('td')\n\t\tbelowCell\n\t\t\t:attr('colspan', data.imageright and 3 or 2)\n\t\t\t:addClass('mbox-text')\n\t\tif data.textstyle then\n\t\t\tbelowCell:cssText(data.textstyle)\n\t\tend\n\t\tbelowCell:wikitext(data.below)\n\tend\n\treturn tostring(root)\nend\n\nreturn p"}}}