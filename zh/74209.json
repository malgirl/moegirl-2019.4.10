{"parse":{"title":"User:\u4e5d\u6c5f\u6708/common.js","pageid":198701,"wikitext":{"*":"if (window.location.href.indexOf(\"action=edit\")!= -1){\nwindow.onbeforeunload = function(){\n      return \"Leaving this page may cause loss of your code!\";\n   };\n}\nwindow.onload=function(){\n    moedomain.init();\n    setclock();\n\treturn false;\n}\n//\u8bbe\u7f6e\u65f6\u949f\nfunction setclock(){\n\tif(!window.clockthread){\n\t\twindow.clockthread={};\n\t\twindow.clockthread.step=0;\n\t\twindow.clockthread.targetx=0;\n\t\twindow.clockthread.targety=0;\n\t\twindow.clockthread.flag = $('.moe-clock').length>0?true:false;\n\t\twindow.clockthread.func = window.clockthread.flag?setInterval(function(){ moeclock() }, 500):new function(){};\n\t\twindow.clockthread.func2 = window.clockthread.flag?setInterval(function(){ anime3dRotate() }, 500):new function(){};\n\t\t$(\"#btn-clock a\").html('The World!');\n\t}else{\n\t\tif(window.clockthread.flag){\n\t\t\tclearInterval(window.clockthread.func);\n\t\t\tclearInterval(window.clockthread.func2);\n\t\t\twindow.clockthread.func={};\n\t\t\twindow.clockthread.func2={};\n\t\t\twindow.clockthread.step=0;\n\t\t\twindow.clockthread.targetx=0;\n\t\t\twindow.clockthread.targety=0;\n\t\t\twindow.clockthread.flag = false;\n\t\t\t$(\"#btn-clock a\").html('\u542f\u52a8\u65f6\u949f');\n\t\t}else{\n\t\t\twindow.clockthread.step=0;\n\t\t\twindow.clockthread.targetx=0;\n\t\t\twindow.clockthread.targety=0;\n\t\t    window.clockthread.flag = $('.moe-clock').length>0?true:false;\n\t\t    window.clockthread.func = window.clockthread.flag?setInterval(function(){ moeclock() }, 500):new function(){};\t\n\t\t    window.clockthread.func2 = window.clockthread.flag?setInterval(function(){ anime3dRotate() }, 500):new function(){};\n\t\t    $(\"#btn-clock a\").html('The World!');\n\t\t}\n\t}\n}\n//\u7b80\u5355\u52a8\u753b\nfunction anime3dRotate(){\nvar step = window.clockthread.step>=25?50 - (window.clockthread.step):window.clockthread.step;\nif(window.clockthread.step>=50){\nwindow.clockthread.step=0; \nvar tgx = Math.random()*(Math.random()>0.5?1:-1);\nvar tgy =Math.random()*(Math.random()>0.5?1:-1);\nwindow.clockthread.ag = 50 * Math.PI / 180;\nwindow.clockthread.sc =Math.sin(window.clockthread.ag/2)*Math.cos(window.clockthread.ag/2);\nwindow.clockthread.sq =Math.sin(window.clockthread.ag/2)*Math.sin(window.clockthread.ag/2);\nwindow.clockthread.targetx= tgx>0?(tgx<0.5?tgx+0.5:tgx):(tgx>-0.5?tgx-0.5:tgx);\nwindow.clockthread.targety= tgy>0?(tgy<0.5?tgy+0.5:tgy):(tgy>-0.5?tgy-0.5:tgy);\nreturn;\n}\nvar x =step * window.clockthread.targetx / 20;\nvar y =step * window.clockthread.targety / 20;\nvar z = 0;\nvar ag = window.clockthread.ag;\nvar sc =window.clockthread.sc;\nvar sq =window.clockthread.sq;\nvar tsf = \"matrix3d(\";\ntsf+=(1-2*(y*y+z*z)*sq)+\",\"+2*(x*y*sq-z*sc)+\",\"+2*(x*z*sq+y*sc)+\",0,\";\ntsf+=2*(x*y*sq+z*sc)+\",\"+(1-2*(x*x+z*z)*sq)+\",\"+2*(y*z*sq-x*sc)+\",0,\";\ntsf+=2*(x*z*sq-y*sc)+\",\"+2*(y*z*sq+x*sc)+\",\"+(1-2*(x*x+y*y)*sq)+\",0,\";\ntsf+=\"0,0,0,1)\";\n$('.moe-clock-main').css(\"transform\",tsf);\nwindow.clockthread.step++;\n}\n//\u8c03\u6574\u65f6\u523b\nfunction moeclock(){\nif(!window.clockthread.flag){return;}\n$('.moe-clock-hands-hour').each(function(){\nvar mydate = new Date();\nvar deg = mydate.getHours()*30 + mydate.getMinutes()*0.5;\n$(this).css('transform',setRotate(deg));\n});\n\n$('.moe-clock-hands-minute').each(function(){\nvar mydate = new Date();\nvar deg = mydate.getMinutes()*6 +  mydate.getSeconds()*0.1;\n$(this).css('transform',setRotate(deg));\n});\n\n$('.moe-clock-hands-second').each(function(){\nvar mydate = new Date();\nvar deg = mydate.getSeconds()*6;\n$(this).css('transform',setRotate(deg));\n});\n}\n//\u8bbe\u7f6e\u77e9\u9635\nfunction setRotate(deg){\nvar cosv = Math.cos(deg * Math.PI / 180)\nvar sinv = Math.sin(deg * Math.PI / 180);\nvar tsf = 'matrix(';\ntsf +=cosv.toFixed(6)+\",\";\ntsf +=sinv.toFixed(6)+\",\";\ntsf +=(-1 * sinv).toFixed(6)+\",\";\ntsf +=cosv.toFixed(6)+\",\";\ntsf +=\"0,0)\";\nreturn tsf;\n}\n\n\nfunction iFunc(){\nthis.main=function(methodName){this.data=methodName;\nif(typeof this[methodName]==\"function\"){\n  this.func=eval(\"this.\"+methodName+\"()\");\n}else{console.log('\u4e0d\u5b58\u5728\u7684\u65b9\u6cd5\u3002');}};\nthis.text=function(){console.log('text');};\n}\n\nfunction mycode(){\n  this.data=\"data:null;\";\n  this.getdata=function(){return this.data;}\n  this.setdata=function(data){this.data=data;}\n  this.type=function(){console.log(this.getdata());}\n  this.main=function(index){\n    this.data[index].getmore(index);\n  };\n  this.getmore=function(index,e){\n    $.ajax( {\n    url: 'https://zh.moegirl.org/api.php',\n    data: {action: 'parse',format: 'json',title:'\u9884\u89c8',text:this.data},\n    dataType: 'json',\n    type: 'POST',\n    headers: { 'Api-User-Agent': 'Example/1.0' },\n    success: function(data) {\n        var req = data.parse.text['*'].replace(/\\n<!--((.*)|(\\n))*?-->\\n/g,'');\n        $('.moe-domain:eq('+index+')').append(req);\n        //$(req).insertBefore(e);\n        //console.log(e);\n        //console.log(req);\n        if ($('.mw-collapsible')[0]) mw.loader.using('jquery.makeCollapsible').then(function() {\n            //console.debug('jquery.makeCollapsible is loaded.');\n            $('.mw-collapsible').makeCollapsible();\n        });\n    },\n    error: function( xhr ) {\n        alert( 'Error: Request failed.' );\n    }\n  });}\n}\n\nfunction codedomain(){\nthis.data=[];\nthis.init=function(){\n  var pickdata=this.data;\n  $('.moe-domain .moe-content').each(function(index,obj){\n    var item = new mycode();\n    item.setdata($(obj).html().replace(/&lt;/g,'<').replace(/&gt;/g,'>'));//no\"//\"surport\n    pickdata[pickdata.length]=item;\n    $(obj).parent().append(newitem('input','button','\u67e5\u770b\u66f4\u591a','moedomain.main('+index+')'));\n  });\n};\nthis.main=function(index){\n    this.data[index].getmore(index,event.target);\n};\n}\n\nfunction newitem(type1,type2,name,func){\nvar item = document.createElement(type1);\nitem.setAttribute('type',type2);\nitem.setAttribute('value',name);\nitem.setAttribute('onclick',func);\nreturn item;\n}\n\nwindow.moedomain=new codedomain();"}}}