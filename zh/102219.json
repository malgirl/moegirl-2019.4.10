{"parse":{"title":"MediaWiki:Gadget-twinklediff.js","pageid":164867,"wikitext":{"*":"//\u672cjs\u5f15\u81ea\u4e2d\u6587\u7ef4\u57fa\u767e\u79d1[[zhwiki:Special:Permalink/27649938]]\n!function(a){Twinkle.diff=function(){var b,c;mw.config.get(\"wgNamespaceNumber\")<0||!mw.config.get(\"wgArticleId\")||(b={title:mw.config.get(\"wgPageName\"),diff:\"cur\",oldid:\"prev\"},Twinkle.addPortletLink(mw.util.wikiScript(\"index\")+\"?\"+a.param(b),\"\u6700\u540e\",\"tw-lastdiff\",\"\u663e\u793a\u6700\u540e\u4fee\u6539\"),Morebits.queryString.exists(\"diff\")&&(Twinkle.addPortletLink(function(){Twinkle.diff.evaluate(!1)},\"\u81ea\u4e0a\",\"tw-since\",\"\u663e\u793a\u4e0e\u4e0a\u4e00\u4fee\u8ba2\u7248\u672c\u95f4\u7684\u5dee\u5f02\"),Twinkle.addPortletLink(function(){Twinkle.diff.evaluate(!0)},\"\u81ea\u6211\",\"tw-sincemine\",\"\u663e\u793a\u4e0e\u6211\u505a\u51fa\u7684\u4fee\u8ba2\u7248\u672c\u7684\u5dee\u5f02\"),c=/oldid=(.+)/.exec(a(\"#mw-diff-ntitle1\").find(\"strong a\").first().attr(\"href\"))[1],b={title:mw.config.get(\"wgPageName\"),diff:\"cur\",oldid:c},Twinkle.addPortletLink(mw.util.wikiScript(\"index\")+\"?\"+a.param(b),\"\u5f53\u524d\",\"tw-curdiff\",\"\u663e\u793a\u4e0e\u5f53\u524d\u7248\u672c\u95f4\u7684\u5dee\u5f02\")))},Twinkle.diff.evaluate=function(b){var c,d,e,f;if(b)c=mw.config.get(\"wgUserName\");else{if(d=document.getElementById(\"mw-diff-ntitle2\"),!d)return;c=a(d).find(\"a\").first().text()}e={prop:\"revisions\",action:\"query\",titles:mw.config.get(\"wgPageName\"),rvlimit:1,rvprop:[\"ids\",\"user\"],rvstartid:mw.config.get(\"wgCurRevisionId\")-1,rvuser:c},Morebits.status.init(document.getElementById(\"mw-content-text\")),f=new Morebits.wiki.api(\"\u6293\u53d6\u6700\u521d\u8d21\u732e\u8005\u4fe1\u606f\",e,Twinkle.diff.callbacks.main),f.params={user:c},f.post()},Twinkle.diff.callbacks={main:function(b){var e,c=b.responseXML,d=a(c).find(\"rev\").attr(\"revid\");return d?(e={title:mw.config.get(\"wgPageName\"),oldid:d,diff:mw.config.get(\"wgCurRevisionId\")},window.location=mw.util.wikiScript(\"index\")+\"?\"+Morebits.queryString.create(e),void 0):(b.statelem.error(\"\u672a\u627e\u5230\u5408\u9002\u7684\u65e9\u671f\u7248\u672c\uff0c\u6216 \"+b.params.user+\" \u662f\u552f\u4e00\u8d21\u732e\u8005\u3002\u53d6\u6d88\u3002\"),void 0)}}}(jQuery);"}}}