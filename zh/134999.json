{"parse":{"title":"\u6a21\u5757:Rainbow","pageid":285922,"wikitext":{"*":"local module = {}\n\nlocal getArgs = require('Module:Arguments').getArgs\n\nfunction module._main(colors, material)\n\tlocal rubySave = {}\n\tmaterial = mw.ustring.gsub(material, '(<ruby[^>]*>.-</ruby>)', function(str)\n\t\trubySave[#rubySave + 1] = str\n\t\treturn '\u0178'\n\tend)\n\t\n\tfunction lang(ptns)\n\t\tfor i, v in ipairs(ptns) do\n\t\t\tmaterial = mw.ustring.gsub(material, '(.*%-{)\u1fe7?(.-)(;?%s-'..v..':)(.-}%-)', function(str0, str1, str2, str3)\n\t\t\t\t-- \u4f7f\u7528\u1fe7\u6307\u793a\u4fdd\u6301\u5f53\u524d\u989c\u8272\n\t\t\t\t-- \u4f7f\u7528\u1fec\u6307\u793a\u8fd9\u662f\u4e0b\u4e00\u4e2a\u8bed\u8a00\u53d8\u79cd\u7684\u5f00\u59cb\uff0c\u8bfb\u53d6\u989c\u8272\n\t\t\t\treturn str0..'\u1fe7'..str1..mw.ustring.gsub(str2, '(.)', '\u2021%1')..'\u1fec'..str3\n\t\t\tend)\n\t\tend\n\tend\n\t\n\tlang({\n\t\t'zh%-hans', 'zh%-hant', 'zh%-cn', 'zh%-tw', 'zh%-hk', 'zh%-sg', 'zh%-mo', 'zh%-my', 'zh'\n\t})\n\t\n\tfunction flee(ptns)\n\t\tfor i, v in ipairs(ptns) do\n\t\t\tmaterial = mw.ustring.gsub(material, '('..v..')', function(str)\n\t\t\t\treturn mw.ustring.gsub(str, '(.)', '\u2021%1')\n\t\t\tend)\n\t\tend\n\tend\n\t\n\tflee({\n\t\t'<.->', '%-{', '}%-', '/.-/'\n\t})\n\t\n\tlocal flag = 1            -- \u53d8\u8272\u8ba1\u6570\n\tlocal ZhConverter_old_flag = 1\t-- \u5b57\u8bcd\u8f6c\u6362\u4e2d\u4e0a\u4e00\u4e2a\u8bed\u8a00\u53d8\u79cd\u7684flag\n\tlocal ruby = 1            -- ruby\u8ba1\u6570\n\tlocal mark = false        -- \u6807\u7b7e\u8df3\u8fc7\n\tlocal rainbow = mw.ustring.gsub(material, '[^%s]', function(str1)\n\t\tif str1 == '\u1fe7' then\n\t\t\tZhConverter_old_flag = flag\n\t\t\treturn ''\n\t\tend\n\t\tif str1 == '\u1fec' then\n\t\t\tflag = ZhConverter_old_flag\n\t\t\treturn ''\n\t\tend\n\t\tif str1 == '\u2021' then\n\t\t\tmark = true\n\t\t\treturn ''\n\t\tend\n\t\tif mark then\n\t\t\tmark = false\n\t\t\treturn str1\n\t\tend\n\t\t\n\t\tlocal colour = ''\n\t\tif str1 ~= '\u0178' then\n\t\t\tcolour = '<span style=\"color:'..colors[flag]..'\">'..str1..'</span>'\n\t\telse\n\t\t\tcolour = string.gsub(rubySave[ruby], '<ruby([^>]*)>', function(str2)\n\t\t\t\tif string.find(str2, 'style=\".-\"') then\n\t\t\t\t\treturn '<ruby '..string.gsub(str2, 'style=\"(.-)\"', function(str3)\n\t\t\t\t\t\treturn 'style=\"'..str3..'; color:'..colors[flag]..'\"'\n\t\t\t\t\tend)..'>'\n\t\t\t\telse\n\t\t\t\t\treturn '<ruby'..str2..' style=\"color:'..colors[flag]..'\">'\n\t\t\t\tend\n\t\t\tend)\n\t\t\truby = ruby + 1\n\t\tend\n\t\t\n\t\tif flag < #colors then\n\t\t\tflag = flag + 1\t\t\n\t\telse\n\t\t\tflag = 1\n\t\tend\n\t\t\n\t\treturn colour\t    \t\t\n\tend)\n\t\n\treturn rainbow\nend\n\nfunction module.main(frame)\n\tlocal args = getArgs(frame, {wrappers='Template:\u4ea4\u53c9\u989c\u8272F'})\n\tlocal colorStr = args.c or args[1]\n\tlocal material = args.s or args[2]\n\tlocal colors = mw.text.split(colorStr, ',')\n\treturn module._main(colors, material)\nend\n\nreturn module"}}}