{"parse":{"title":"Widget:KancolleFloatingMap","pageid":192548,"wikitext":{"*":"<noinclude>\u672c\u5de5\u5177\u662f\u7528\u4e8e\u8230C\u533a\u6d77\u57df\u5730\u56fe\u3002\u5728\u9002\u5f53\u7684\u6d4f\u89c8\u4f4d\u7f6e\uff0c\u9875\u9762\u53f3\u4e0b\u89d2\u5c06\u4f1a\u60ac\u6d6e\u76f8\u5e94\u7684\u6d77\u57df\u5730\u56fe\uff0c\u4ee5\u4fbf\u5bf9\u5e94\u67e5\u627e\u5730\u56fe\u8def\u5f84\u70b9\u3002\n\n\u9e23\u8c22[[User:AnnAngela]]\u64b0\u5199\u672c\u5de5\u5177\u3002\n\n\u5df2\u77e5Bug\uff1a\u5feb\u901f\u62d6\u52a8\u9875\u9762\uff0c\u4f1a\u5bfc\u81f4\u60ac\u6d6e\u5730\u56fe\u53cd\u590d\u95ea\u52a8\u3002\n\n</noinclude><includeonly><!--{if !isset($wgKancolleFloatingMap) || !$wgKancolleFloatingMap}--><!--{assign var=\"wgKancolleFloatingMap\" value=true scope=\"global\"}--><style type=\"text/css\">\n.floatTopRight {\n    position:fixed;\n    right: 1.5em;\n    bottom: 0em;\n    display: none;\n    clear: right;\n}\n#closeKCMap {\n    transition: all .37s ease-in-out;\n}\n</style><script>\nfunction kancolleFloatingMap() {\n    var floatElm = $('<div class=\"floatTopRight\"><div class=\"thumb tnone\"><div class=\"thumbinner\"><div class=\"KCMap\"></div><div class=\"thumbcaption\"><div id=\"closeKCMap\" style=\"float:right;cursor:pointer;font-size: x-large;\" title=\"\u5173\u95ed\u6d6e\u52a8\u5730\u56fe\">\u00d7</div><div style=\"text-align:center\">\u5f53\u524d\u6d77\u57df\u5730\u56fe\uff08<span id=\"KCMapName\"></span>\uff09</div></div></div></div></div>').appendTo(document.body),\n        maps = $('.KCmap').map(function() {\n            return $(this).parent().data('randomID', window.parseInt(Math.random() * 1e7))[0];\n        }),\n        global_lock = -1;\n    jQuery.fn.extend({\n        top: function top() {\n            if (!this.position() || !this.offset()) return -1;\n            return (this.position().top + this.offset().top) / 2;\n        }\n    });\n    $('#closeKCMap').on('click', function() {\n        if (sessionStorage.getItem('KCMapClose') === '1') {\n            floatElm.find('.KCMap').slideDown(370);\n            sessionStorage.setItem('KCMapClose', '0');\n            $(this).css('transform', 'rotate(0)');\n        } else {\n            floatElm.find('.KCMap').slideUp(370);\n            sessionStorage.setItem('KCMapClose', '1');\n            $(this).css('transform', 'rotate(-225deg)');\n        }\n    });\n    if (sessionStorage.getItem('KCMapClose') === '1') {\n        floatElm.find('.KCMap').hide();\n        $('#closeKCMap').css('transform', 'rotate(-225deg)');\n    }\n    $(window).on('scroll', function() {\n        var top = $(this).scrollTop(),\n            flag = true;\n        maps.each(function() {\n            var self = $(this),\n                nextHL = self.closest('#mw-content-text > .mw-parser-output > *').nextAll('h2').first(),\n                prevHL = self.closest('#mw-content-text > .mw-parser-output > *').prevAll('h2').first(); // \u8fd9\u6392\u5e8f\u2026\u2026\n            if (nextHL.length === 0) nextHL = $('#mw-content-text').nextAll(':visible').first();\n            if (self.top() + self.height() < top && //\u8fd9\u91cc\u4e0d\u7528self.children('img')\u662f\u4e00\u4e2aworkaround\uff0c\u66f4\u7b26\u5408\u7528\u6237\u4e60\u60ef\n                top + $(window).height() / 3 < nextHL.top() && floatElm.children().data('randomID') !== self.data('randomID')) {\n                if (!floatElm.is(':animated')) global_lock = self.data('randomID');\n                if ([-1, self.data('randomID')].indexOf(global_lock) === -1) floatElm.stop(true, true);\n                global_lock = self.data('randomID');\n                floatElm.find('#KCMapName').text(prevHL.find('.mw-headline').clone().find('.mw-headline-number').remove().end().text().trim());\n                floatElm.find('.thumbinner').width(self.width());\n                floatElm.fadeIn(370);\n                floatElm.find('.KCMap').empty().append(self.clone());\n                floatElm.find('img').off('click').on('click', function() {\n                    self.find('img').click();\n                    return false;\n                });\n                flag = false;\n            }\n        });\n        if (flag) floatElm.fadeOut(370, function() {\n            global_lock = -1;\n        });\n    }).scroll();\n}\nwindow.RLQ = window.RLQ || [];\nwindow.RLQ.push(kancolleFloatingMap.bind(window));\n</script><!--{/if}--></includeonly>"}}}