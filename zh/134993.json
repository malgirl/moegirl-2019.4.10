{"parse":{"title":"\u6a21\u5757:NoteTA","pageid":295630,"wikitext":{"*":"local z = {}\nlocal WikitextLC = require( 'Module:WikitextLC' )\n\nfunction Tcode( args )\n\tif args.T == nil or args.T == '' then\n\t\treturn ''\n\tend\n\tlocal div = mw.html.create( 'div' )\n\t\t:attr( 'class', 'noteTA-title' )\n\t\t:attr( 'data-noteta-code', args.T )\n\t\t:wikitext( WikitextLC.title( args.T ) )\n\tif args.dt ~= nil and args.dt ~= '' then\n\t\tdiv:attr( 'data-noteta-desc', args.dt )\n\tend\n\treturn tostring( div )\nend\n\nfunction group( name, frame )\n\tif name == nil or name == '' then\n\t\treturn ''\n\tend\n\tlocal moduleTitle = mw.title.makeTitle( 'Module', 'CGroup/' .. name )\n\tif moduleTitle and moduleTitle.exists then\n\t\tlocal data = require( 'Module:CGroup/' .. name )\n\t\tlocal pieces = {}\n\t\tif data.content then\n\t\t\tfor i, v in ipairs( data.content ) do\n\t\t\t\tif v.type == 'item' and v.rule then\n\t\t\t\t\ttable.insert( pieces, '-{H|' .. v.rule .. '}-' )\n\t\t\t\tend\n\t\t\tend\n\t\t\treturn tostring( mw.html.create( 'div' )\n\t\t\t\t:attr( 'data-noteta-group-source', 'module' )\n\t\t\t\t:attr( 'data-noteta-group', data.name or name )\n\t\t\t\t:wikitext( table.concat( pieces ) ) )\n\t\tend\n\tend\n\tlocal templateTitle = mw.title.makeTitle( 'Template', 'CGroup/' .. name )\n\tif templateTitle and templateTitle.exists then\n\t\treturn frame:expandTemplate{ title = templateTitle }\n\tend\n\treturn tostring( mw.html.create( 'div' )\n\t\t\t-- :attr( 'id', 'noteTA-group-' .. mw.uri.anchorEncode( name ) )\n\t\t\t:attr( 'data-noteta-group-source', 'none' )\n\t\t\t:attr( 'data-noteta-group', name ) )\nend\n\nfunction Gcode( args, frame )\n\tlocal code = {}\n\tfor i = 1, 30 do\n\t\ttable.insert( code, group( args['G' .. i], frame ) )\n\tend\n\tcode = table.concat( code )\n\tif code ~= '' then\n\t\tcode = tostring( mw.html.create( 'div' )\n\t\t\t\t:attr( 'class', 'noteTA-group' )\n\t\t\t\t:wikitext( code ) )\n\t\tif args.G31 ~= nil then\n\t\t\tcode = code .. '[[Category:NoteTA\u6a21\u677f\u53c2\u6570\u4f7f\u7528\u6570\u91cf\u8d85\u8fc7\u9650\u5236\u7684\u9875\u9762|G]]'\n\t\tend\n\tend\n\treturn code\nend\n\nfunction local_( i, code, desc )\n\tif code == nil or code == '' then\n\t\treturn ''\n\tend\n\tlocal div = mw.html.create( 'div' )\n\t\t-- :attr( 'id', 'noteTA-local-' .. i )\n\t\t:attr( 'data-noteta-code', code )\n\t\t:wikitext( WikitextLC.hidden( code ) )\n\tif desc ~= nil and desc ~= '' then\n\t\tdiv:attr( 'data-noteta-desc', desc )\n\tend\n\treturn tostring( div )\nend\n\nfunction Lcode( args )\n\tlocal code = {}\n\tfor i = 1, 30 do\n\t\ttable.insert( code, local_( i, args[i], args['d' .. i] ) )\n\tend\n\tcode = table.concat( code )\n\tif code ~= '' then\n\t\tcode = tostring( mw.html.create( 'div' )\n\t\t\t\t:attr( 'class', 'noteTA-local' )\n\t\t\t\t:wikitext( code ) )\n\t\tif args[31] ~= nil then\n\t\t\tcode = code .. '[[Category:NoteTA\u6a21\u677f\u53c2\u6570\u4f7f\u7528\u6570\u91cf\u8d85\u8fc7\u9650\u5236\u7684\u9875\u9762|L]]'\n\t\tend\n\tend\n\treturn code\nend\n\nfunction z.main( frame )\n\tlocal args\n\tif frame == mw.getCurrentFrame() then\n\t\t-- Being called from {{noteTA}}\n\t\targs = frame:getParent().args\n\telse\n\t\t-- Being called from another module\n\t\targs = frame\n\t\tframe = mw.getCurrentFrame()\n\tend\n\tlocal Tc = Tcode( args )\n\tlocal Gc = Gcode( args, frame )\n\tlocal Lc = Lcode( args )\n\tlocal code = Tc .. Gc .. Lc\n\tif code ~= '' then\n\t\tlocal hash = require( 'Module:Crc32lua' ).crc32( mw.dumpObject( args ) )\n\t\tcode = frame:extensionTag{\n\t\t\tname = 'indicator',\n\t\t\tcontent = '[[File:Zh conversion icon m.svg|35px|\u672c\u9875\u4f7f\u7528\u4e86\u6807\u9898\u6216\u5168\u6587\u624b\u5de5\u8f6c\u6362|link=]]',\n\t\t\targs = { name = string.format( 'noteTA-%x', hash ) },\n\t\t} .. tostring( mw.html.create( 'div' )\n\t\t\t\t:attr( 'id', string.format( 'noteTA-%x', hash ) )\n\t\t\t\t:attr( 'class', 'noteTA' )\n\t\t\t\t:wikitext( code ) )\n\t\tif mw.title.getCurrentTitle():inNamespace( 'Template' ) then\n\t\t\tcode = code .. '[[Category:\u653e\u7f6e\u4e8e\u6a21\u677f\u7684noteTA]]'\n\t\tend\n\tend\n\treturn code\nend\n\nreturn z"}}}