{"parse":{"title":"User:\u6771\u6771\u541b/js/replace.js","pageid":269740,"wikitext":{"*":"/*\n\t\u8fd9\u4e2ajs\u6587\u4ef6\u5c06\u8f7d\u5165\u4e00\u4e2a\u67e5\u627e\u4e0e\u66ff\u6362\u7684\u5de5\u5177\u3002\n\t\u840c\u767e\u672c\u8eab\u6709\u67e5\u627e\u4e0e\u66ff\u6362\u5de5\u5177\u7684\uff0c\u4e0d\u77e5\u4e3a\u4f55\u83ab\u540d\u5176\u5999\u5730\u6d88\u5931\u4e86\uff0c\u4e8e\u662f\u5c31\u81ea\u5df1\u9020\u4e86\u4e00\u4e2a\u3002\n\t\u6ce8\u610f\uff1a\u5f00\u542f\u6bb5\u843d\u6a21\u5f0f\u540e\uff0c\u4e0b\u6b21\u5339\u914d\u7684\u8303\u56f4\u5c06\u88ab\u9650\u5236\u5728\u6700\u8fd1\u4e00\u6b21\u9009\u4e2d\u7684\u4ee3\u7801\u8303\u56f4\u4e2d\u3002\n\t      \u5728\u66ff\u6362\u680f\u4e2d\u53ef\u4ee5\u4f7f\u7528\u201c_@br_\u201d\u6765\u6307\u4ee3\u6362\u884c\uff0c\u65e0\u8bba\u662f\u5426\u4e3a\u6b63\u5219\u6a21\u5f0f\uff0c\u5982\u679c\u4f60\u8981\u66ff\u6362\u7684\u5185\u5bb9\u91cc\u5c31\u6709\u8fd9\u4e2a\u5b57\u7b26\u4e32...\u4f60\u5230\u5e95\u5199\u662f\u4ec0\u4e48\u5185\u5bb9\u554a\uff0c\u4f1a\u5199\u8fd9\u4e2a\n\t      \u82e5\u547c\u51fa\u754c\u9762\u7684\u6309\u94ae\u6ca1\u6709\u52a0\u8f7d\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528ctrl + shift + \u7a7a\u683c\u547c\u51fa\u6216\u5173\u95ed \uff0c\u5982\u679c\u8fd8\u4e0d\u884c\u8bf7\u4fdd\u5b58\u7f16\u8f91\u5185\u5bb9\u5e76\u5237\u65b0\n*/\n\n$(function(){\n    if(/action=(edit|submit)/.test(location.href)){\n    \tsetTimeout(function(){\n\t        var widgetHTML = '\\\n\t            <div id=\"widget-RegExp\" style=\"width:400px; background:#FAFCFE; border:1px #666 solid; border-radius:5px; font-size:80%; overflow:hidden; padding:5px; position:fixed; top:50%; left:50%; -webkit-user-select:none; -moz-user-select:none; -o-user-select:none; user-select:none; display:none; z-index:10000;\">\\\n\t            <div id=\"widgetTop\" style=\"background:linear-gradient(white,#E8F2F8); padding:10px; cursor:move;\">\u67e5\u627e\u4e0e\u66ff\u6362<div id=\"widget-RegExpHide\" style=\"float:right; font-size:26px; font-weight:bold; margin-top:-8px; -webkit-user-select:none; -moz-user-select:none; -o-user-select:none; user-select:none; cursor:pointer\">\u00d7</div></div>\\\n\t            <div style=\"height:150px; border-radius:3px; padding:10px;\">\\\n\t                <p>\u67e5\u627e\uff1a<input id=\"widgetLookup\" style=\"width:300px; height:25px; text-indent:3px; border-radius:3px;\"></p>\\\n\t                <p>\u66ff\u6362\uff1a<input id=\"widgetReplace\" style=\"width:300px; height:25px; text-indent:3px; border-radius:3px;\"></p>\\\n\t                <p id=\"widget-RegExpMessage\">&emsp;</p>\\\n\t                <p>\u6b63\u5219\u6a21\u5f0f\uff1a<input type=\"checkbox\" id=\"widget-RegExpFlag\" value=\"reg\" style=\"width:16px; height:16px; position:relative; top:3px; margin-right:10px;\">\u8303\u56f4\u6a21\u5f0f\uff1a<input type=\"checkbox\" id=\"widget-RegExpSec\" value=\"set\" style=\"width:16px; height:16px; position:relative; top:3px;\"></p>\\\n\t                <p><input id=\"widget-RegExpRevoke\" type=\"button\" value=\"\u64a4\u9500\" style=\"float:right; width:50px; height:25px; background:linear-gradient(white,#E8F2F8); border-radius:3px; border-radius:3px; -webkit-user-select:none; -moz-user-select:none; -o-user-select:none; user-select:none; margin:0 5px;\"></p>\\\n\t            <p><input id=\"widget-RegExpAction\" type=\"button\" value=\"\u66ff\u6362\" style=\"float:right; width:50px; height:25px; background:linear-gradient(white,#E8F2F8); border-radius:3px; border-radius:3px; -webkit-user-select:none; -moz-user-select:none; -o-user-select:none; user-select:none; margin:0 5px;\"></p>\\\n\t            </div>\\\n\t            </div>'\n\t        var shade = '<div id=\"widget-RegExp-shade\" style=\"width:100%; height:100%; position:fixed; top:0; left:0; z-index:9999;\"></div>'\n\t        $('body').append($(widgetHTML))\n\t        $('#wikiEditor-ui-toolbar .tabs').append($('<span id=\"widget-RegExpShow\" class=\"tab\"><a href=\"#\" role=\"button\" aria-pressed=\"false\">\u67e5\u627e\u4e0e\u66ff\u6362</a></span>'))\n\t\n\t\t\tfunction windowReset(){\n\t\t\t\t$('#widget-RegExp').css({\n\t\t            top : $(window).outerHeight() / 2 - $('#widget-RegExp').outerHeight() / 2 + 'px',\n\t\t            left : $(window).outerWidth() / 2 - $('#widget-RegExp').outerWidth() / 2 + 'px'\n\t\t        })\n\t\t\t}\n\t\t\twindowReset()\n\t\n\t        var move = false\n\t        var distanceX = 0\n\t        var distanceY = 0\n\t        $('#widgetTop').mousedown(function(e){\n\t            move = true\n\t            this.setCapture && this.setCapture()\n\t            var location = $('#widget-RegExp').offset()\n\t            distanceX = e.clientX - location.left;\n\t            distanceY = e.clientY - location.top;\n\t            $('body').append(shade)\n\t        })\n\t        $(window).mousemove(function(e){\n\t            if(move){\n\t\t            $('#widget-RegExp').offset({\n\t\t                left : e.clientX - distanceX,\n\t\t                top : e.clientY - distanceY\n\t\t            })\n\t            }\n\t        }).mouseup(function(){\n\t            move = false\n\t            this.releaseCapture && this.releaseCapture()\n\t            $('#widget-RegExp-shade').remove()\n\t        })\n\t\n\t\t\tfunction windowSwitch(){\n\t            if($('#widget-RegExp:hidden').length){\n\t\t            $('#widget-RegExp').show()\n\t\t            windowReset()\n\t            }else{\n\t            \t$('#widget-RegExp').hide()\n\t            }\n\t\t\t}\n\t\t\t\n\t        $('#widget-RegExpShow').click(function(){\n\t\t\t\twindowSwitch()\n\t            return false\n\t        })\n\t        $('#widget-RegExpHide').click(function(){\n\t        \twindowSwitch()\n\t        })\n\t        $(window).keydown(function(e){\n\t            if(e.ctrlKey && e.keyCode == 32){\n\t            \te.preventDefault()\n\t        \t\twindowSwitch()\n\t            }\n\t        })\n\t        \n\t        $('#widget-RegExpAction').click(function(){\n\t            var pattren = $('#widgetLookup').val()\n\t            var replace = $('#widgetReplace').val()\n\t            var regFlag = $('#widget-RegExpFlag:checked').length\n\t            var secFlag = $('#widget-RegExpSec:checked').length\n\t            var wikiCode = $('#wpTextbox1').val()\n\t\n\t            var editBox = $('#wpTextbox1')[0]\n\t            var start = editBox.selectionStart\n\t            var end = editBox.selectionEnd\n\t            var paraWikiCode = editBox.value.substring(start, end)               \n\t            if(secFlag && paraWikiCode && (paraWikiCode != wikiCode)){\n\t                var paraReplace = true\n\t            }\n\t\n\t            if(pattren){      \n\t                try{\n\t                    if(! regFlag){\n\t                        var pattren = pattren.replace(/([\\\\\\(\\)\\[\\]\\{\\}\\+\\.\\*\\^\\$\\!\\?\\|])/g,'\\\\$1')\n\t                    }\n\t                    var pattren = new RegExp(pattren,'gm')\n\t                }catch(e){\n\t                    $('#widget-RegExpMessage').text('\u8868\u8fbe\u5f0f\u6709\u8bef\uff01')\n\t                    return false\n\t                }\n\t                if(paraReplace){\t\t\t//\u9009\u4e2d\u67d0\u5904\u540e\u518d\u6267\u884c\u66ff\u6362\uff0c\u53ea\u64cd\u4f5c\u9009\u4e2d\u7684\u6587\u5b57\n\t                    var workedWikiCode = paraWikiCode.replace(pattren,replace)\n\t                    var left = wikiCode.substring(0, start)\n\t                    var right = wikiCode.substring(end, wikiCode.length)\n\t                    workedWikiCode = left + workedWikiCode + right\n\t                    $('#wpTextbox1').val(workedWikiCode)\n\t                }else{\n\t                    $('#wpTextbox1').val(wikiCode.replace(pattren,replace))\n\t                }\n\t                var br = '\\n'\n\t                $('#wpTextbox1').val($('#wpTextbox1').val().replace(/_@br_/g,br))     //\u5728\u66ff\u6362\u680f\u4e2d\u4f7f\u7528\u201c_@br_\u201d\u6307\u4ee3\u6362\u884c\n\t\n\t                var prompt = paraReplace ? '<strong>\u8303\u56f4\u5339\u914d\uff1a</strong>' : ''\n\t                if($('#wpTextbox1').val() == wikiCode){\n\t                    $('#widget-RegExpMessage').html(prompt + '\u5339\u914d\u7ed3\u679c\u4e3a\u7a7a\uff01')\n\t                }else{\n\t                    $('#widget-RegExpRevoke').one('click',function(){\n\t                        $('#wpTextbox1').val(wikiCode)\n\t                        if(paraReplace){\n\t                            editBox.selectionStart = start\n\t                            editBox.selectionEnd = end\n\t                        }\n\t                    })\n\t                    $('#widget-RegExpMessage').html(prompt + '\u5df2\u5b8c\u6210\u66ff\u6362\uff01')\n\t                }  \n\t            }else{\n\t                $('#widget-RegExpMessage').text('\u8868\u8fbe\u5f0f\u4e0d\u80fd\u4e3a\u7a7a\uff01')\n\t            }\n\t        })\n    \t}, 1000)\n    }\n})"}}}