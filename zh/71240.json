{"parse":{"title":"User:AnnAngela/js/navbox-link.js","pageid":100499,"wikitext":{"*":"/**\n   Author: ZUO Haocheng [[zhwiki:User:zuohaocheng]]\n   Explanations for this javaScript code in http://zh.moegirl.org/User:AnnAngela/js\n*/\n(function(mw) {\n    var apiURIprefix = '//zh.moegirl.org/api.php',\n        pageName = encodeURIComponent(mediaWiki.config.get('wgPageName')),\n        navboxLinksGet = function() {\n            //\u83b7\u53d6\u672c\u6a21\u7248\u94fe\u63a5\u5230\u7684\u6761\u76ee\u4e2d\u662f\u5426\u5305\u542b\u4e86\u672c\u6a21\u677f\n            var linksURI = apiURIprefix + '?action=query&format=xml&redirects=true&generator=links&gplnamespace=0&gpllimit=500&prop=templates&tllimit=500&tlnamespace=10&tltemplates=' + pageName + '&titles=' + pageName,\n                fGetLink = function(result) {\n                    var targetLoc, targetUl, targetLocFunc = function() { // \u6dfb\u52a0\u76ee\u6807\u4f4d\u7f6e\n                        var nla = $('<div></div>', {\n                                id: 'not-listed-articles',\n                            }),\n                            nla_refresh = $('<a></a>', {\n                                href: '#',\n                                title: '\u5f3a\u5236\u5237\u65b0',\n                                id: \"nla-refresh\",\n                                text: \"\u672a\u6dfb\u52a0\u672c\u6a21\u7248\u7684\u6761\u76ee\"\n                            }),\n                            seperator = $('<div></div>').css({\n                                height: '1px',\n                                'margin-top': '0.5em',\n                                'margin-bottom': '0.5em',\n                                'background-color': '#aaa'\n                            });\n                        nla.append(nla_refresh).append(': ');\n                        $('#catlinks').append(seperator).append(nla);\n                        nla_refresh.click(function(event) {\n                            event.preventDefault();\n                            var d = new Date();\n                            var requestid = d.getTime();\n                            var rLinksURI = linksURI + '&requestid=' + requestid;\n                            $.get(rLinksURI, function(result) {\n                                seperator.remove();\n                                nla.remove();\n                                fGetLink(result);\n                            });\n                        });\n                        return nla;\n                    };\n                    var redirects = {};\n                    $(result).find('redirects r').each(function() {\n                        var item = $(this);\n                        redirects[item.attr('to')] = item.attr('from');\n                    });\n                    $(result).find(\"pages page\").each(function() {\n                        //\u5224\u65ad\u5df2\u5305\u542b && \u7ea2\u94fe\n                        if ($(this).find(\"templates\").length === 0 && typeof($(this).attr(\"missing\")) === 'undefined') {\n                            var pageTitle = $(this).attr('title');\n                            if (typeof(targetLoc) === 'undefined') {\n                                targetLoc = targetLocFunc();\n                                targetUl = $('<ul></ul>');\n                                targetLoc.append(targetUl);\n                            }\n                            var link = $('<a></a>', {\n                                'title': pageTitle,\n                                'text': pageTitle,\n                                'href': '//zh.moegirl.org/' + encodeURIComponent(pageTitle)\n                            });\n                            $('<li>').append(link).appendTo(targetUl);\n                            var linksToChange = $('a[title=\"' + pageTitle + '\"], a[title=\"' + redirects[pageTitle] + '\"]');\n                            link.mouseenter(function() {\n                                linksToChange.css('background-color', 'yellow');\n                            });\n                            link.mouseleave(function() {\n                                linksToChange.css('background-color', '');\n                            });\n                        }\n                    });\n                };\n            $.get(linksURI, fGetLink);\n            if ($('#not-listed-articles').length == -1) $('#catlinks').append('<div id=\"non-not-listed-article\">\u672c\u6a21\u677f\u6240\u6709\u8bcd\u6761\u5747\u6dfb\u52a0\u4e86\u672c\u6a21\u677f</div>');\n            else if ($('#not-listed-articles').prev().text()) $('#not-listed-articles').css({\n                'border-top': '1px solid #E2E2E2',\n                'padding-top': '3px',\n                'margin-top': '3px'\n            });\n        };\n    // \u5224\u65ad\u662f\u5426\u5c5e\u4e8eTemplate && \u662f\u5426\u5305\u542bnavbox\n    if (mediaWiki.config.get('wgNamespaceNumber') === 10) {\n        var temp = $(\".mw-parser-output\").clone();\n        temp.find('.template-documentation').remove();\n        if (temp.find(\"table.navbox\").length !== 0) navboxLinksGet();\n    }\n})(mediaWiki);"}}}