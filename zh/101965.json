{"parse":{"title":"MediaWiki:Common.js","pageid":134288,"wikitext":{"*":"/* eslint-disable comma-dangle */\n// <nowiki>\n/* \u8fd9\u91cc\u7684\u4efb\u4f55JavaScript\u5c06\u5728\u5168\u7ad9\u52a0\u8f7d\n * \u8bf7\u5c0a\u91cd\u840c\u5a18\u767e\u79d1\u7248\u6743\uff0c\u4ee5\u4e0b\u4ee3\u7801\u590d\u5236\u9700\u8981\u6ce8\u660e\u539f\u81ea\u840c\u5a18\u767e\u79d1\uff0c\u5e76\u4e14\u9644\u4e0aURL\u5730\u5740http://zh.moegirl.org/MediaWiki:Common.js\n * \u7248\u6743\u534f\u5b9a\uff1a\u77e5\u8bc6\u5171\u4eab \u7f72\u540d-\u975e\u5546\u4e1a\u6027\u4f7f\u7528-\u76f8\u540c\u65b9\u5f0f\u5171\u4eab 3.0\n \n *  loader\u6a21\u5757 \u5199\u6cd5\u53c2\u89c1 https://www.mediawiki.org/wiki/ResourceLoader/Modules#mw.loader.load\n */\n(function ($, mw) { //\u4f7f\u7528\u533f\u540d\u51fd\u6570\u9632\u6b62\u6c61\u67d3\u9876\u7ea7\u53d8\u91cf\n    /* Polyfill */\n    // Production steps of ECMA-262, Edition 6, 22.1.2.1\n    // Reference: https://people.mozilla.org/~jorendorff/es6-draft.html#sec-array.from\n    /* eslint-disable eqeqeq */\n    if (!Array.from) {\n        Array.from = (function () {\n            var toStr = Object.prototype.toString;\n            var isCallable = function (fn) {\n                return typeof fn === 'function' || toStr.call(fn) === '[object Function]';\n            };\n            var toInteger = function (value) {\n                var number = Number(value);\n                if (isNaN(number)) { return 0; }\n                if (number === 0 || !isFinite(number)) { return number; }\n                return (number > 0 ? 1 : -1) * Math.floor(Math.abs(number));\n            };\n            var maxSafeInteger = Math.pow(2, 53) - 1;\n            var toLength = function (value) {\n                var len = toInteger(value);\n                return Math.min(Math.max(len, 0), maxSafeInteger);\n            };\n\n            // The length property of the from method is 1.\n            return function from(arrayLike /*, mapFn, thisArg */) {\n                // 1. Let C be the this value.\n                var C = this;\n                // 2. Let items be ToObject(arrayLike).\n                var items = Object(arrayLike);\n                // 3. ReturnIfAbrupt(items).\n                if (arrayLike == null) { // jshint ignore:line\n                    throw new TypeError(\"Cannot convert undefined or null to object\");\n                }\n                // 4. If mapfn is undefined, then let mapping be false.\n                var mapFn = arguments.length > 1 ? arguments[1] : void undefined;\n                var T;\n                if (typeof mapFn !== 'undefined') {\n                    // 5. else      \n                    // 5. a If IsCallable(mapfn) is false, throw a TypeError exception.\n                    if (!isCallable(mapFn)) {\n                        throw new TypeError(mapFn + \" is not a function\");\n                    }\n                    // 5. b. If thisArg was supplied, let T be thisArg; else let T be undefined.\n                    if (arguments.length > 2) {\n                        T = arguments[2];\n                    }\n                }\n                // 10. Let lenValue be Get(items, \"length\").\n                // 11. Let len be ToLength(lenValue).\n                var len = toLength(items.length);\n                // 13. If IsConstructor(C) is true, then\n                // 13. a. Let A be the result of calling the [[Construct]] internal method \n                // of C with an argument list containing the single item len.\n                // 14. a. Else, Let A be ArrayCreate(len).\n                var A = isCallable(C) ? Object(new C(len)) : new Array(len);\n                // 16. Let k be 0.\n                var k = 0;\n                // 17. Repeat, while k < len\u2026 (also steps a - h)\n                var kValue;\n                while (k < len) {\n                    kValue = items[k];\n                    if (mapFn) {\n                        A[k] = typeof T === 'undefined' ? mapFn(kValue, k) : mapFn.call(T, kValue, k);\n                    } else {\n                        A[k] = kValue;\n                    }\n                    k += 1;\n                }\n                // 18. Let putStatus be Put(A, \"length\", len, true).\n                A.length = len;\n                // 20. Return A.\n                return A;\n            };\n        }());\n    }\n    /* eslint-enable eqeqeq */\n    /* \u53cd\u5d4c\u5165\u53cd\u53cd\u4ee3 */\n    (function () {\n        if (top !== window && !['translate.google.com', 'www.microsofttranslator.com'].includes(top.location.host)) {\n            top.location.replace('https://zh.moegirl.org/' + mw.config.get('wgPageName'));\n        } else if (!/\\.moegirl\\.org$/i.test(location.host)) {\n            var reverseProxyhostAlerted = [];\n            if (sessionStorage.getItem('reverse proxy alerted') !== null) {\n                try {\n                    reverseProxyhostAlerted = JSON.parse(sessionStorage.getItem('reverse proxy alerted'));\n                    if (!Array.isArray(reverseProxyhostAlerted)) reverseProxyhostAlerted = [];\n                } catch (e) {\n                    reverseProxyhostAlerted = [];\n                }\n            }\n            if (!reverseProxyhostAlerted.includes(location.host)) {\n                reverseProxyhostAlerted.push(location.host);\n                alert('\u8bf7\u6ce8\u610f\u60a8\u5f53\u524d\u662f\u5728\u975e\u840c\u767e\u57df\u540d\u8bbf\u95ee\u840c\u767e\u7f51\u9875\uff0c\u8bf7\u60a8\u4e0d\u8981\u5728\u6b64\u57df\u540d\u8f93\u5165\u60a8\u7684\u7528\u6237\u540d\u6216\u5bc6\u7801\uff0c\u4ee5\u7b56\u5b89\u5168\uff01\\n\u5f53\u524d\u57df\u540d\u4e3a ' + location.host + '\\n\u840c\u767e\u57df\u540d\u662f\u4ee5 .moegirl.org \u7ed3\u5c3e\u7684\u3002');\n            }\n            sessionStorage.setItem('reverse proxy alerted', JSON.stringify(reverseProxyhostAlerted));\n        }\n    })();\n    /* \u51fd\u6570\u5b9a\u4e49\u4f53 */\n    //\u6eda\u52a8\u516c\u544a\n    function AutoScroll(obj) {\n        $(obj).animate({\n            \"height\": \"show\",\n            \"paddingTop\": \"show\",\n            \"marginTop\": \"show\",\n            \"paddingBottom\": \"show\",\n            \"marginBottom\": \"show\"\n        });\n        var isFrozen = false;\n        setInterval(function () {\n            if (!isFrozen) {\n                $(obj).find(\"ul:first\").animate({\n                    marginTop: \"-25px\"\n                }, 500, function () {\n                    $(this).css({\n                        marginTop: \"0px\"\n                    }).find(\"li:first\").appendTo(this);\n                });\n            }\n        }, 5000);\n        $(window).on({\n            blur: function () {\n                isFrozen = true;\n            },\n            focus: function () {\n                isFrozen = false;\n            }\n        });\n    }\n    //Extension:MultimediaViewer\u7684\u534a\u900f\u660e\u5316\u4fee\u6539\uff0c\u7528\u4e8e\u4fdd\u6301\u80cc\u666f\u6587\u5b57\u5904\u4e8e\u539f\u4f4d\uff0c\u672c\u5e94\u4fee\u6539\u63d2\u4ef6\u8fbe\u6210\u7684\uff0c\u6682\u65f6\u5148\u7528JavaScript\u5e94\u6025\u5904\u7406\u4e0b\n    function multimediaViewer() {\n        var _scrollTo = window.scrollTo;\n        var flag = location.hash !== \"\";\n        window.scrollTo = function scrollTo(x_option, y) {\n            if (flag) {\n                console.info('Prevent multimediaViewer called');\n            } else {\n                if (y === undefined) _scrollTo(x_option);\n                else _scrollTo(x_option, y);\n            }\n        };\n        setInterval(function () {\n            $('a.image img[data-file-width], a.image img[data-file-height], .mw-mmv-filepage-buttons a.mw-mmv-view-expanded').not('.multimediaViewerScrollSet').each(function () {\n                this.addEventListener('click', function (e) {\n                    if ($(e.target).closest('.TabLabelText')[0] || $(e.target).closest('a').closest('.mw-customtoggle')[0]) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        e.stopImmediatePropagation();\n                        return false;\n                    }\n                    flag = true;\n                }, {\n                        capture: true\n                    });\n                $(this).addClass('multimediaViewerScrollSet');\n            });\n            if ($('.mw-mmv-close')[0]) {\n                if (mw.config.get('wgMultimediaViewer') !== 'on') {\n                    mw.config.set('wgMultimediaViewer', 'on');\n                    $('.mw-mmv-image').off('click')[0].addEventListener('click', function (e) {\n                        if ($(e.target).is('img')) {\n                            window.open($(e.target).attr('src').replace(/(img\\.moegirl\\.org\\/common\\/)thumb\\/([a-z\\d]+\\/[a-z\\d]+\\/)([^\\/]+)\\/\\d+px-\\3/i, \"$1$2$3\"), '_blank').focus();\n                            e.preventDefault();\n                            e.stopPropagation();\n                            e.stopImmediatePropagation();\n                            return false;\n                        } else if ($(e.target).closest('.error-box')[0]) return;\n                        else $('.mw-mmv-close').click();\n                    }, {\n                            capture: true\n                        });\n                }\n            } else if (mw.config.get('wgMultimediaViewer') === 'on') {\n                flag = false;\n                mw.config.set('wgMultimediaViewer', 'off');\n            }\n        }, 137);\n    }\n    //Tabs\n    function tabs() {\n        var defaultStyle = {\n            purple: {\n                labelColor: ' ', //anti check\n                labelBackgroundColor: '#9070c0',\n                labelBorderColor: '#b090e0 #7050a0 #9070c0 #b090e0',\n                labelPadding: '.2em .3em .2em .3em',\n                textBorderColor: '#9070c0',\n                textBackgroundColor: '#f0edf5',\n                textPadding: '1em'\n            },\n            green: {\n                labelColor: ' ',\n                labelBackgroundColor: '#75c045',\n                labelBorderColor: '#90d060 #60b030 #75c045 #90d060',\n                labelPadding: '.2em .3em .2em .3em',\n                textBorderColor: '#75c045 #60b030 #60b030 #75c045',\n                textBackgroundColor: '#f5fffa',\n                textPadding: '1em'\n            },\n            red: {\n                labelColor: ' ',\n                labelBackgroundColor: '#FF0000',\n                labelBorderColor: '#FF8888 #CC0000 #FF0000 #FF8888',\n                labelPadding: '.2em .3em .2em .3em',\n                textBorderColor: '#FF0000 #CC0000 #CC0000 #FF0000',\n                textBackgroundColor: '#fffafa',\n                textPadding: '1em'\n            },\n            blue: {\n                labelColor: ' ',\n                labelBackgroundColor: '#5b8dd6',\n                labelBorderColor: '#88abde #3379de #5b8dd6 #88abde',\n                labelPadding: '.2em .3em .2em .3em',\n                textBackgroundColor: '#f0f8ff',\n                textBorderColor: '#5b8dd6 #3379de #3379de #5b8dd6',\n                textPadding: '1em'\n            },\n            yellow: {\n                labelColor: ' ',\n                labelBackgroundColor: '#ffe147',\n                labelBorderColor: '#ffe977 #ffd813 #ffe147 #ffe977',\n                labelPadding: '.2em .3em .2em .3em',\n                textBackgroundColor: '#fffce8',\n                textBorderColor: '#ffe147 #ffd813 #ffd813 #ffe147',\n                textPadding: '1em'\n            },\n            orange: {\n                labelColor: ' ',\n                labelBackgroundColor: '#ff9d42',\n                labelBorderColor: '#ffac5d #ff820e #ff9d42 #ffac5d',\n                labelPadding: '.2em .3em .2em .3em',\n                textBackgroundColor: '#ffeedd',\n                textBorderColor: '#ff9d42 #ff820e #ff820e #ff9d42',\n                textPadding: '1em'\n            },\n            black: {\n                labelColor: ' ',\n                labelBackgroundColor: '#7f7f7f',\n                labelBorderColor: '#999999 #4c4c4c #7f7f7f #999999',\n                labelPadding: '.2em .3em .2em .3em',\n                textBackgroundColor: '#e5e5e5',\n                textBorderColor: '#7f7f7f #4c4c4c #4c4c4c #7f7f7f',\n                textPadding: '1em'\n            }\n        };\n        $('body').addClass('tab');\n        // A Class\n        function StyleSheet() { }\n        StyleSheet.prototype.getOwnPropertyNamesLength = function getOwnPropertyNamesLength() {\n            return Object.getOwnPropertyNames(this).length;\n        };\n        String.prototype.toLowerFirstCase = function toLowerFirstCase() {\n            return this[0].toLowerCase() + this.substring(1);\n        };\n        $('.Tabs').each(function (i) {\n            if ($(this).children('.TabLabel')[0]) return true;\n            var self = $(this),\n                classList = Array.from(this.classList).filter(function (n) { return n in defaultStyle; }),\n                data = $.extend({\n                    labelPadding: null,\n                    labelBorderColor: null,\n                    labelColor: null,\n                    labelBackgroundColor: $('#content').css('background-color'),\n                    textPadding: null,\n                    textBorderColor: null,\n                    textBackgroundColor: null,\n                    defaultTab: 1,\n                }, classList[0] ? defaultStyle[classList[0]] || {} : {}, this.dataset || {}),\n                tabLabel = self.append('<div class=\"TabLabel\"></div>').children('.TabLabel'),\n                tabContent = self.append('<div class=\"TabContent\"></div>').children('.TabContent'),\n                labelPadding = data.labelPadding,\n                labelColor = data.labelColor,\n                styleSheet = {\n                    label: new StyleSheet(),\n                    text: new StyleSheet()\n                },\n                defaultTab = parseInt(data.defaultTab);\n            self.children('.Tab').each(function () {\n                if ($(this).children('.TabLabelText').text().replace(/\\s/g, '').length || $(this).children('.TabLabelText').children().length) {\n                    $(this).children('.TabLabelText').appendTo(tabLabel);\n                    $(this).children('.TabContentText').appendTo(self.children('.TabContent'));\n                }\n                $(this).remove();\n            });\n            if (isNaN(defaultTab) || defaultTab <= 0 || defaultTab > tabLabel.children('.TabLabelText').length) defaultTab = 1;\n            tabLabel.children('.TabLabelText').on('click', function () {\n                var label = $(this);\n                label.addClass('selected').siblings().removeClass('selected').css({\n                    'border-color': '#aaa',\n                    'background-color': 'inherit'\n                });\n                tabContent.children('.TabContentText').eq(tabLabel.children('.TabLabelText').index(label)).addClass('selected').siblings().removeClass('selected').removeAttr('style');\n                if (styleSheet.label.getOwnPropertyNamesLength()) label.css(styleSheet.label);\n                if (label.is(':visible')) tabLabel.height(label.outerHeight(true));\n                else tabLabel.removeAttr('style');\n            }).eq(defaultTab - 1).click();\n            if (labelPadding) tabLabel.children('.TabLabelText').css('padding', labelPadding);\n            ['labelBorderColor', 'labelBackgroundColor', 'textPadding', 'textBorderColor', 'textBackgroundColor'].forEach(function (n) {\n                var target = /^label/.test(n) ? 'label' : 'text',\n                    key = n.replace(target, '').toLowerFirstCase();\n                styleSheet[target][key] = data[n];\n            });\n            if (labelColor) styleSheet.label.borderTopColor = labelColor;\n            else if (styleSheet.label.borderColor) styleSheet.label.borderTopColor = 'green';\n            tabLabel.find('.selected').click();\n            if (styleSheet.text.getOwnPropertyNamesLength()) tabContent.css(styleSheet.text);\n            if (data.autoWidth === 'yes') self.css('display', 'inline-block');\n        });\n    }\n    //\u5b50\u9875\u9762\u9875\u9876\u94fe\u63a5\n    function subpage_links() {\n        var links = mw.config.get('wgPageName').split('/'),\n            link = '',\n            subpages = $('.subpages')[0] ? $('.subpages').remove().empty().text('<') : $('<span class=\"subpages\"/>').text('<'),\n            length = links.length - 1,\n            index;\n        if (mw.config.get('wgPageName').indexOf('Special:\u79fb\u52a8\u9875\u9762') !== -1) links.splice(0, 1);\n        for (index = 0; index < length; index++) {\n            link += '/' + links[index];\n            subpages.append($('<a/>', {\n                text: ' ' + links[index],\n                href: link\n            }));\n            if (length - index > 1) subpages.append(\" |\");\n        }\n        if (subpages.find('a')[0]) $('#contentSub').prepend(subpages);\n    }\n    //\u91cd\u590d\u6587\u4ef6\u5217\u8868\u51fd\u6570\n    function duplicatedFileList() {\n        if (window.location.href.indexOf(\"title\") === -1) window.location.replace(\"http://zh.moegirl.org/index.php?title=Special:ListDuplicatedFiles&limit=500&offset=0\");\n        $('#mw-content-text .mw-spcontent ol').attr(\"id\",\n            \"picOl\");\n        $('#picOl').before('<p id=\"picOlTitle\">\u56fe\u7247\u5217\u8868\uff1a</p>').after('<p id=\"MP3OlTitle\">MP3\u5217\u8868\uff1a</p><ol start=\"1\" id=\"MP3Ol\"></ol>');\n        $(\"#picOlTitle, #MP3OlTitle\").hide();\n        $(\"#picOl\").find(\"[href$='.mp3'], [href$='.ogg']\").parent().appendTo(\"#MP3Ol\");\n        if ($(\"#picOl\").find(\"li\").length) $(\"#picOlTitle\").show();\n        if ($(\"#MP3Ol\").find(\"li\").length) $(\"#MP3OlTitle\").show();\n        $(\".mw-spcontent > p:nth-child(1), .mw-spcontent > p:nth-child(2), .mw-spcontent > p:nth-child(7)\").hide();\n    }\n    //\u590d\u5236\u4fee\u6539\u5185\u5bb9\n    function copyRights() {\n        var div = $('<div>', {\n            css: {\n                position: 'absolute',\n                left: '-99999px',\n                'z-index': '-99999'\n            },\n            html: '<pre></pre><br>\\n\u9605\u8bfb\u66f4\u591a\uff1a' + (/%/.test(mw.util.wikiUrlencode(mw.config.get('wgPageName'))) ? mw.config.get('wgPageName') + '\uff08https://zh.moegirl.org/' + encodeURIComponent(mw.config.get('wgPageName')) + '\uff09' : 'https://zh.moegirl.org/' + mw.config.get('wgPageName')) + '<br>\\n\u672c\u6587\u5f15\u81ea\u840c\u5a18\u767e\u79d1\uff08https://zh.moegirl.org/\uff09\uff0c\u6587\u5b57\u5185\u5bb9\u9075\u5b88\u3010\u77e5\u8bc6\u5171\u4eab \u7f72\u540d-\u975e\u5546\u4e1a\u6027\u4f7f\u7528-\u76f8\u540c\u65b9\u5f0f\u5171\u4eab 3.0\u3011\u534f\u8bae\u3002'\n        }).appendTo('body'),\n            valueNode = div.find('pre');\n        $('#mw-content-text').on('copy', function (e) {\n            var selection = window.getSelection(),\n                value = selection.toString(),\n                range = selection.getRangeAt(0);\n            if (!value.length || value.length < 128 || //\u5f53\u590d\u5236\u5185\u5bb9\u4e3a\u7a7a\u6216\u957f\u5ea6\u5c0f\u4e8e\u5b9a\u503c\u65f6\u4e0d\u6dfb\u52a0\u58f0\u660e\n                $(selection.anchorNode).add(selection.basenode).add(selection.focusNode).closest('.Wikiplus-InterBox')[0]) //\u5982\u679c\u9009\u4e2d\u4e86wikiplus\u7684\u5185\u5bb9\n                return;\n            valueNode.text(value);\n            /* if (e.originalEvent.clipboardData && e.originalEvent.clipboardData.setData) {\n                e.originalEvent.clipboardData.setData(\"text/plain\", div.text());\n                e.originalEvent.clipboardData.setData(\"text/html\", div.html());\n            } else { */\n            selection.selectAllChildren(div[0]);\n            window.setTimeout(function () { //\u4ee5\u4e0b\u5c06\u8fd8\u539f\u9009\u533a\n                selection.removeAllRanges();\n                selection.addRange(range);\n                valueNode.empty();\n            }, 0);\n            // }\n        });\n    }\n    //\u7f16\u8f91\u8bf7\u6c42\n    function editRequest() {\n        var nsIds = mw.config.get('wgNamespaceIds'),\n            nsId = mw.config.get('wgNamespaceNumber'),\n            ns = [];\n        for (var i in nsIds) {\n            if (nsIds[i] === nsId) ns.push(i);\n        }\n        if (!ns[0]) return;\n        var user = mw.config.get('wgUserName'),\n            usergroup = mw.config.get('wgUserGroups'),\n            page = mw.config.get('wgPageName');\n        for (var j = 0, l = ns.length; j < l; j++) {\n            if (/^[A-Za-z0-9]+[ _]talk$/i.test(ns[j])) return;\n            if (/^[a-zA-Z0-9]+$/.test(ns[j])) var talkns = ns[j] + '_talk:';\n            page = page.replace(new RegExp('^' + ns[j] + ':', 'i'), '');\n        }\n        var talkpage = talkns + page;\n        if (!$('.permissions-errors')) return;\n        var container = $('<div/>', {\n            class: 'editRequest'\n        });\n        container.append('\u60a8\u867d\u7136\u65e0\u6743\u7f16\u8f91\u672c\u9875\u9762\uff0c\u4f46\u60a8\u53ef\u4ee5\u70b9\u51fb\u53f3\u4fa7\u6309\u94ae\u5728\u672c\u9875\u7684\u8ba8\u8bba\u9875\u63d0\u51fa\u7f16\u8f91\u8bf7\u6c42\uff0c\u8ba9\u53ef\u4ee5\u7f16\u8f91\u7684\u4eba\u4ee3\u4e3a\u7f16\u8f91\uff1a');\n        $('<span/>').addClass(\"newComment\").text('\u63d0\u51fa\u7f16\u8f91\u8bf7\u6c42').on('click', function () {\n            window.open('https://zh.moegirl.org/index.php?action=edit&preload=Template:\u7f16\u8f91\u8bf7\u6c42/comment&preloadtitle=\u7f16\u8f91\u8bf7\u6c42 - ' + mw.config.get(\"wgUserName\") + '&section=new&title=' + talkpage, '_blank');\n        }).appendTo(container);\n        $('#mw-content-text').children('.wikiEditor-ui:first, textarea[readonly]:first').before('<hr>').before(container);\n    }\n    //\u9632\u6ee5\u7528\u5373\u5c06\u5220\u9664\u6a21\u677f\n    function antiAbuseListener(textarea, event) {\n        var filters = [\n            \"{{\u5373\u5c06\u5220\u9664\",\n            \"{{\u5373\u5c07\u522a\u9664\",\n            \"{{\u6302\u5220\",\n            \"{{\u6a21\u677f:\u5373\u5c06\u5220\u9664\",\n            \"{{\u6a21\u677f:\u5373\u5c07\u522a\u9664\",\n            \"{{template:\u5373\u5c06\u5220\u9664\",\n            \"{{template:\u5373\u5c07\u522a\u9664\",\n            \"[[\u5206\u7c7b:\u5373\u5c06\u5220\u9664\u7684\u9875\u9762\",\n            \"[[\u5206\u985e:\u5373\u5c07\u522a\u9664\u7684\u9801\u9762\",\n            \"[[category:\u5373\u5c06\u5220\u9664\u7684\u9875\u9762\",\n            \"[[category:\u5373\u5c07\u522a\u9664\u7684\u9801\u9762\",\n            \"{{\u6587\u4ef6\u8f6c\u79fb\u5230\u840c\u5a18\u5171\u4eab\",\n            \"{{\u6587\u4ef6\u8f49\u79fb\u5230\u840c\u5a18\u5171\u4eab\",\n            \"{{\u6a21\u677f:\u6587\u4ef6\u8f6c\u79fb\u5230\u840c\u5a18\u5171\u4eab\",\n            \"{{\u6a21\u677f:\u6587\u4ef6\u8f49\u79fb\u5230\u840c\u5a18\u5171\u4eab\",\n            \"{{template:\u6587\u4ef6\u8f6c\u79fb\u5230\u840c\u5a18\u5171\u4eab\",\n            \"{{template:\u6587\u4ef6\u8f49\u79fb\u5230\u840c\u5a18\u5171\u4eab\",\n            \"[[\u5206\u7c7b:\u9700\u8981\u5220\u9664\u6267\u884c\u5458\u5220\u9664\u7684\u9875\u9762\",\n            \"[[\u5206\u985e:\u9700\u8981\u522a\u9664\u57f7\u884c\u54e1\u522a\u9664\u7684\u9801\u9762\",\n            \"[[category:\u9700\u8981\u5220\u9664\u6267\u884c\u5458\u5220\u9664\u7684\u9875\u9762\",\n            \"[[category:\u9700\u8981\u522a\u9664\u57f7\u884c\u54e1\u522a\u9664\u7684\u9801\u9762\"\n        ];\n        var text1 = textarea.value;\n        text1 = text1.replace(/\\<\\/?(?:nowiki|noinclude)\\>/g, '');\n        text1 = text1.replace(/\\<(onlyinclude|includeonly)\\>.*?\\<\\/\\1\\>/g, '');\n        var text2 = textarea.value;\n        text2 = text2.replace(/\\<\\/?(?:onlyinclude|includeonly)\\>/g, '');\n        text2 = text2.replace(/\\<(nowiki|noinclude)\\>.*?\\<\\/\\1\\>/g, '');\n        var results = [];\n        for (var i = 0, l = filters.length; i < l; i++) {\n            var regExp = new RegExp(filters[i].replace(/\\[/g, '\\\\['), \"i\");\n            if (regExp.test(text1) || regExp.test(text2)) results.push(filters[i]);\n        }\n        if (results.length > 0) {\n            var messageDialog = new OO.ui.MessageDialog();\n            var windowManager = new OO.ui.WindowManager();\n            $(\"body\").append(windowManager.$element);\n            windowManager.addWindows([messageDialog]);\n            messageDialog.title.$label.html(\"\u840c\u5a18\u767e\u79d1\u63d0\u9192\u60a8<br>\u60a8\u7684\u7f16\u8f91\u5305\u542b\u7981\u6b62\u5185\u5bb9\uff01\");\n            messageDialog.message.$label.html(\"<br>\u60a8\u63d0\u4ea4\u7684\u5185\u5bb9\u5305\u542b\u4ee5\u4e0b\u90e8\u5206\uff0c\u88ab\u7981\u6b62\u63d0\u4ea4\uff1a<br><br><ul>\" + results.map(function (result) {\n                return \"<li>\" + result + \"</li>\";\n            }).join(\"\") + '</ul><br><br>\u5982\u679c\u60a8\u8ba4\u4e3a\u60a8\u7684\u7f16\u8f91\u65e0\u8bef\uff0c\u8bf7\u5728\u81ea\u884c\u4fdd\u5b58\u7f16\u8f91\u5185\u5bb9\u540e\u5230<a target=\"_blank\" rel=\"nofollow noreferrer noopener\" class=\"external text\" href=\"https://zh.moegirl.org/Talk:%E6%8F%90%E9%97%AE%E6%B1%82%E5%8A%A9%E5%8C%BA\">\u63d0\u95ee\u6c42\u52a9\u533a</a>\u63d0\u95ee\u3002');\n            windowManager.openWindow(messageDialog, {\n                actions: [{\n                    action: 'accept',\n                    label: '\u6211\u77e5\u9053\u4e86',\n                    flags: 'primary'\n                }]\n            });\n            event.preventDefault();\n            event.stopImmediatePropagation();\n            event.stopPropagation();\n            return false;\n        }\n    }\n\n    function antiAbuse(textarea, submitButton, form) {\n        mw.loader.using([\"oojs-ui\"]).then(function () {\n            var captureSupported = false;\n            try {\n                var options = Object.defineProperty({}, \"capture\", {\n                    get: function () {\n                        captureSupported = true;\n                    }\n                });\n                window.addEventListener(\"test\", null, options);\n            } catch (err) { /* */ }\n            if (submitButton) {\n                submitButton.addEventListener(\"click\", function (e) {\n                    antiAbuseListener(textarea, e);\n                }, captureSupported ? {\n                    capture: true,\n                } : undefined);\n            }\n            if (form) {\n                form.addEventListener(\"submit\", function (e) {\n                    antiAbuseListener(textarea, e);\n                }, captureSupported ? {\n                    capture: true,\n                } : undefined);\n            }\n        });\n    }\n    /* \u51fd\u6570\u6267\u884c\u4f53 */\n    $(function () {\n        //Template:heimu\u5728safari\u4e0a\u7684\u66b4\u529bworkaround\n        mw.loader.using('jquery.client', function () {\n            if ($.client.profile().name === 'safari') $('.heimu').on('click', function () {\n                $(this).toggleClass('off');\n            });\n        });\n        var copyRightsNameSpaces = [ // \u4ee5\u4e0b\u4e3a\u5141\u8bb8\u6dfb\u52a0\u7248\u6743\u58f0\u660e\u7684\u540d\u5b57\u7a7a\u95f4\u5217\u8868\n            0, // \uff08\u4e3b\uff09\n            4, // \u840c\u5a18\u767e\u79d1\n            8, // MediaWiki\n            10, // Template\n            12, // Help\n            614 // R18\n        ];\n        //\u6eda\u52a8\u516c\u544a\n        AutoScroll(\"#scrollDiv\");\n        //Extension:MultimediaViewer\u7684\u534a\u900f\u660e\u5316\u4fee\u6539\n        if ($('img[srcset][data-file-width][data-file-height]')[0]) multimediaViewer();\n        // Add \"mainpage\" class to the body element\n        if (mw.config.get('wgMainPageTitle') === mw.config.get('wgPageName') && mw.config.get('wgAction') === 'view') $('body').addClass('mainpage');\n        //\u91cd\u590d\u6587\u4ef6\u5217\u8868\u533a\u5206\u56fe\u7247\u548c\u97f3\u9891\n        if ($(\".mw-special-ListDuplicatedFiles\").length && $('.mw-spcontent > p').length > 1) duplicatedFileList();\n        //\u9700\u8981\u65f6\u8f7d\u5165\u5bf9\u5e94\u7684 scripts\n        if (mw.config.get('wgAction') === \"edit\" || mw.config.get('wgAction') === \"submit\" || mw.config.get('wgCanonicalSpecialPageName') === 'Search')\n            mw.loader.load('/index.php?title=MediaWiki:Common.js/edit.js&action=raw&ctype=text/javascript');\n        // Tabs\u6267\u884c\n        if ($('.Tabs')[0]) tabs();\n        //\u5b50\u9875\u9762\u9875\u9876\u94fe\u63a5\n        if (mw.config.get('wgPageName').indexOf('/') !== -1 && (mw.config.get('wgNamespaceIds').special !== mw.config.get('wgNamespaceNumber') || mw.config.get('wgPageName').indexOf('Special:\u79fb\u52a8\u9875\u9762') !== -1) && !window._unsubpage)\n            subpage_links();\n        //\u590d\u5236\u5185\u5bb9\u7248\u6743\u58f0\u660e\n        if (window.getSelection && mw.config.get('wgUserGroups').indexOf('sysop') + mw.config.get('wgUserGroups').indexOf('patroller') === -2 && ['edit', 'submit'].indexOf(mw.config.get('wgAction')) === -1 && copyRightsNameSpaces.indexOf(mw.config.get('wgNamespaceNumber')) !== -1)\n            copyRights();\n        //\u7f16\u8f91\u8bf7\u6c42\n        if (['edit', 'submit'].indexOf(mw.config.get('wgAction')) !== -1 && !mw.config.get('wgIsProbablyEditable') && mw.config.get('wgUserName')) editRequest();\n        //\u4fee\u590d\u4ee3\u7801\u7f16\u8f91\u5668$.ucFirst\u5f15\u7528\u9519\u8bef\n        jQuery.extend({\n            ucFirst: function (s) {\n                s += '';\n                return s.charAt(0).toUpperCase() + s.substring(1);\n            }\n        });\n        //\u6ce8\u91ca\u5185\u5217\u8868\n        $('.reference-text > ul,.reference-text > ol').each(function () {\n            if (this.parentElement.childNodes[0] === this) $(this).addClass('listInRef');\n        });\n        //\u5217\u8868\u4fa7\u8fb9\u8ddd\n        setInterval(function () {\n            $('.mw-parser-output ul, .mw-parser-output ol').not('.margin-left-set').each(function () {\n                if (/^none.+none$/i.test($(this).css('list-style')) || $(this).is('.gallery')) {\n                    if ($(this).parent().is('li') && $(this).parent().parent().is('ul,ol')) $(this).css('margin-left', '1.2em');\n                    else $(this).css('margin-left', '0.2em');\n                } else if ($(this).is('ol')) {\n                    var l = $(this).children('li').length;\n                    if ($(this).attr('start')) l += parseInt($(this).attr('start'));\n                    $(this).css('margin-left', (l + '').length * 0.5 + 1.2 + 'em');\n                } else $(this).css('margin-left', '1.2em');\n                $(this).addClass('margin-left-set');\n            });\n        }, 200);\n        //\u4fee\u6b63hash\u8df3\u8f6c\u9519\u8bef\n        if ($('.mw-collapsible')[0]) mw.loader.using('jquery.makeCollapsible', function () {\n            $('.mw-collapsible').makeCollapsible();\n            var hash = location.hash;\n            location.hash = '';\n            location.hash = hash;\n        });\n        //\u9632\u6ee5\u7528\u5373\u5c06\u5220\u9664\n        if (!mw.config.get('wgUserGroups').includes('sysop') && !mw.config.get('wgUserGroups').includes('patroller')) {\n            setInterval(function () {\n                if ($('.Wikiplus-InterBox')[0]) {\n                    var target = $('.Wikiplus-InterBox');\n                    if (target.data('isTrusted') !== true) {\n                        target.data('isTrusted', true);\n                        target.css('z-index', 100);\n                        antiAbuse($('#Wikiplus-Quickedit')[0], $('#Wikiplus-Quickedit-Submit')[0], undefined);\n                        var events = $._data($('#Wikiplus-Quickedit')[0], 'events');\n                        if (events && events.keydown) {\n                            events.keydown.sort(function (a, b) {\n                                return a.guid - b.guid;\n                            });\n                            events.keydown[0].handler = function (e) {\n                                if (e.ctrlKey && e.which === 83) {\n                                    if (e.shiftKey) {\n                                        $('#Wikiplus-Quickedit-MinorEdit').click();\n                                    }\n                                    if (antiAbuseListener($('#Wikiplus-Quickedit')[0], e) !== false) {\n                                        $('#Wikiplus-Quickedit-Submit').click();\n                                        e.preventDefault();\n                                        e.stopPropagation();\n                                    }\n                                }\n                            };\n                        }\n                    }\n                }\n                if ($('form#editform')[0]) {\n                    target = $('form#editform');\n                    if (target.data('isTrusted') !== true) {\n                        target.data('isTrusted', true);\n                        antiAbuse($('#wpTextbox1')[0], $('#wpSave')[0], target[0]);\n                    }\n                }\n            }, 1000);\n        }\n        //\u4ee5\u4e0b\u4ee3\u7801\u5fc5\u987b\u5728\u5168\u90e8\u5185\u5bb9\u52a0\u8f7d\u5b8c\u6210\u540e\u624d\u80fd\u6b63\u5e38\u5de5\u4f5c\n        $(window).on('load', function () {\n            //\u8bed\u8a00\u5bf9\u5e94\n            $('.mw-helplink').each(function () {\n                var linkHref = this.href;\n                if (linkHref.indexOf('/zh') !== linkHref.length - 3) this.href += '/zh';\n            });\n        });\n    });\n})(jQuery, mediaWiki); //\u7acb\u5373\u6267\u884c\u533f\u540d\u51fd\u6570\u5e76\u4f20\u9012\u539f\u59cb\u53d8\u91cf\u4ee5\u9632\u6b62\u51b2\u7a81\n// </nowiki>"}}}