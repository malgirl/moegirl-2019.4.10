{"parse":{"title":"MediaWiki:Gadget-registerToDelete.js","pageid":194502,"wikitext":{"*":"// <pre>\n$(function() {\n    var self = $('#p-cactions .menu ul');\n    if (!self.find('li')[0] || $('.willBeDeleted')[0] || mw.config.get('wgUserGroups').indexOf('patroller') === -1) return;\n    $('<a/>', {\n        attr: {\n            href: \"#\",\n            title: \"\u6302\u5220\u672c\u9875[alt-shift-d]\",\n            accesskey: 'd'\n        },\n        text: '\u6302\u5220'\n    }).on('click', function() {\n        var reason = prompt('\u6302\u5220\u7684\u7406\u7531\u3010\u5c06\u4f1a\u66ff\u6362\u5168\u6587\u5185\u5bb9\u3011\\n\u3010\u7a7a\u767d\u5219\u4f7f\u7528\u9ed8\u8ba4\u7406\u7531\uff08\u4e0d\u5728\u6536\u5f55\u8303\u56f4\u5185\u6216\u6f5c\u5728\u4ef7\u503c\u8f83\u4f4e\uff09\u3011\\n\u3010\u53d6\u6d88\u5219\u4e0d\u8fdb\u884c\u6302\u5220\u3011\uff1a'),\n            self = $(this);\n        if (reason === null) return;\n        if (reason === '') reason = '\u4e0d\u5728\u6536\u5f55\u8303\u56f4\u5185\u6216\u6f5c\u5728\u4ef7\u503c\u8f83\u4f4e';\n        var loadingBox = $('<div/>', {\n                css: {\n                    position: 'fixed',\n                    top: '0',\n                    left: '0',\n                    height: '100vh',\n                    width: '100vw',\n                    transition: 'opacity .73s linear',\n                    color: 'black',\n                    'padding-top': '49vh',\n                    'background-color': 'rgba(255,255,255,0.73)',\n                    'text-align': 'center'\n                }\n            }).append('<img src=\"https://static.mengniang.org/common/d/d1/Windows_10_loading.gif\" style=\"height: 1em; margin-top: -.25em;\">\u6b63\u5728\u6302\u5220\u4e2d\u2026\u2026'),\n            reasonText = reason ? '|' + reason : '',\n            api = new mw.Api();\n        loadingBox.endOut = function endOut() {\n            this.css('color', 'red').text('\u6302\u5220\u5931\u8d25\u2026\u2026').delay(1000).queue(function() {\n                $(this).css('opacity', '0').delay(730).queue(function() {\n                    $(this).remove();\n                    $(document.body).css('overflow', 'auto');\n                    $(this).dequeue();\n                });\n                $(this).dequeue();\n            });\n        };\n        $(document.body).append(loadingBox).css('overflow', 'hidden');\n        api.postWithToken('csrf', {\n            action: 'edit',\n            format: 'json',\n            title: mw.config.get('wgPageName'),\n            text: '<noinclude>{{\u5373\u5c06\u5220\u9664' + reasonText + '}}</noinclude>',\n            summary: '\u6302\u5220\uff1a' + reason,\n            nocreate: true,\n            watchlist: 'preferences'\n        }).then(function(d) {\n            if (d.error) return loadingBox.endOut();\n            loadingBox.css('color', 'green').text('\u6302\u5220\u6210\u529f\uff01\u5373\u5c06\u5237\u65b0\u2026\u2026');\n            window.setTimeout(function() {\n                window.location.reload();\n            }, 730)\n        }, loadingBox.endOut.bind(loadingBox));\n    }).appendTo($('<li/>', {\n        attr: {\n            id: 'ca-registerToDelete'\n        }\n    }).prependTo(self));\n});\n// </pre>"}}}