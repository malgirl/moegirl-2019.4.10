{"parse":{"title":"\u6a21\u5757:FormatString/doc","pageid":309064,"wikitext":{"*":"\u8fd9\u662f\u4e00\u4e2a\u8fdb\u884c\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u7684\u6a21\u5757\uff0c\u91c7\u7528AC\u81ea\u52a8\u673a\u4f5c\u4e3a\u5b57\u7b26\u4e32\u5339\u914d\u7b97\u6cd5\u3002\n\n\u4e0estring.format\u76f8\u6bd4\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u5360\u4f4d\u7b26\u3002\u4e0e\u4f7f\u7528string.gsub\u8fdb\u884c\u5339\u914d\u4e0e\u66ff\u6362\u76f8\u6bd4\uff0c\u5728\u6a21\u5f0f\u4e32\u8f83\u591a\u65f6\u6709\u901f\u5ea6\u4f18\u52bf\u3002\n\n== \u65b9\u6cd5 ==\n=== buildTrie''(format)'' ===\n==== \u529f\u80fd ====\n\u5c06\u683c\u5f0f\u5316\u53c2\u6570\u5217\u8868\u8f6c\u5316\u4e3a\u4e00\u4e2a\u5b57\u5178\u6811\u3002\u8fd9\u4e2a\u5b57\u5178\u6811\u53ef\u4ee5\u53cd\u590d\u4f7f\u7528\u3002\n\n==== \u53c2\u6570 ====\n#<code>format</code>\uff1a\u683c\u5f0f\u5316\u53c2\u6570\u5217\u8868\uff0c\u662f\u4e00\u4e2aLua\u7684table\uff0c\u5e76\u5177\u6709\u5982\u4e0b\u5f62\u5f0f\uff1a\n<pre>\n{\n    {\n        format = \"%d\",\n        callback = function(matched_times, extras) \n            mw.log('%d matched')\n            return tostring(extras[matched_times]) \n        end\n    },\n    {\n        format = \"%f\",\n        callback = function(matched_times, extras) \n            mw.log('%f matched')\n            return tostring(extras[matched_times]) \n        end\n    },\n    ...,\n    {\n        format = \"%s\",\n        callback = function(matched_times, extras) \n            mw.log('%s matched')\n            return tostring(extras[matched_times]) \n        end\n    }\n}\n</pre>\n\u5176\u4e2d\uff0c<code>format</code>\u4ee3\u8868\u5f85\u5339\u914d\u7684\u5360\u4f4d\u7b26\u3002\n\n\u5f53\u5339\u914d\u5230\u67d0\u4e00\u4e2a\u5360\u4f4d\u7b26\u65f6\uff0c\u5bf9\u5e94\u7684<code>callback</code>\u51fd\u6570\u5c06\u4f1a\u88ab\u8c03\u7528\u3002\u6b64\u51fd\u6570\u5e94\u8be5\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u539f\u5148\u7684\u5360\u4f4d\u7b26\u5c06\u88ab\u8fd9\u4e2a\u5b57\u7b26\u4e32\u66ff\u6362\u3002\n\n<code>callback</code>\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570<code>matched_times</code>\u8868\u793a\u8fd9\u662f\u7b2c\u51e0\u6b21\u5339\u914d\u5230\u5360\u4f4d\u7b26\uff1b\u7b2c\u4e8c\u4e2a\u53c2\u6570<code>extras</code>\u4e3a\u9644\u52a0\u6570\u636e\uff0c\u901a\u5e38\u662f\u5f85\u586b\u5145\u7684\u771f\u5b9e\u503c\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u67d0\u4e00\u4e2a\u5360\u4f4d\u7b26\u4e0d\u5e94\u8be5\u662f\u53e6\u4e00\u4e2a\u5360\u4f4d\u7b26\u7684\u524d\u7f00\uff0c\u5982\u4ee5\u4e0b\u5199\u6cd5\u662f\u4e0d\u5408\u6cd5\u7684\uff1a\n<pre>\n{\n    {\n        format = \"her\",\n        callback = ...\n    },\n    {\n        format = \"he\",      -- he\u662fher\u7684\u4e00\u4e2a\u524d\u7f00\n        callback = ...\n    }\n}\n</pre>\n==== \u8fd4\u56de\u503c ====\n\u5efa\u7acb\u7684\u5b57\u5178\u6811\u3002\n\n=== replaceStr''(str, trie, extras)'' ===\n==== \u529f\u80fd ====\n\u5bf9\u5b57\u7b26\u4e32<code>str</code>\u8fdb\u884c\u683c\u5f0f\u5316\u3002\n\n==== \u53c2\u6570 ====\n#<code>str</code>\uff1a\u5f85\u683c\u5f0f\u5316\u7684\u5b57\u7b26\u4e32\u3002\n#<code>trie</code>\uff1a\u5efa\u7acb\u7684\u5b57\u5178\u6811\u3002\n#<code>extras</code>\uff1a\u9644\u52a0\u6570\u636e\uff0c\u901a\u5e38\u662f\u5f85\u586b\u5145\u7684\u771f\u5b9e\u503c\u3002{{\u9ed1\u5e55|\u4f60\u975e\u8981\u7528\u5168\u5c40\u53d8\u91cf\u6211\u4e5f\u6ca1\u529e\u6cd5\u3002}}\n\n==== \u8fd4\u56de\u503c ====\n\u683c\u5f0f\u5316\u5b8c\u6210\u540e\u7684\u7684\u5b57\u7b26\u4e32\u3002\n\n== \u4f8b\u5b50 ==\n<pre>\nlocal FormatString = require(\"Module:FormatString\")\nlocal formatList = {\n    {\n        format = \"%d\",\n        callback = function(matched_times, extras) \n            return tostring(extras[matched_times]) \n        end\n    },\n    {\n        format = \"%f\",\n        callback = function(matched_times, extras) \n            return tostring(extras[matched_times]) \n        end\n    },\n    {\n        format = \"%X\",\n        callback = function(matched_times, extras) \n            return string.format('%X', extras[matched_times])\n        end\n    }\n}\nlocal trie = FormatString.buildTrie(formatList)\nmw.log(FormatString.replaceStr('%d %f', trie, { 1, 0.25 }))\nmw.log(FormatString.replaceStr('%d,%X,%f', trie, { 5, 10, 2.33 }))\n</pre>\n\u9884\u671f\u8f93\u51fa\uff1a\n<pre>\n1 0.25\n5,A,2.33\n</pre>\n\n== [[\u6709\u751f\u4e4b\u5e74|\u672a\u5b9e\u73b0]]\u7684\u529f\u80fd ==\n#\u5360\u4f4d\u7b26\u4e2d\u5305\u542b\u7edf\u914d\u7b26\u6216\u6b63\u5219\u8868\u8fbe\u5f0f\u4ee5\u5339\u914d\u53c2\u6570\u3002"}}}