{"parse":{"title":"MediaWiki:Gadget-rollback-summary.js","pageid":97733,"wikitext":{"*":"$(function() {\n    mw.config.set({\n        'wgRollbacking': false,\n        'wgRollbackTool': 'inited'\n    });\n    $.fn.extend({\n        getParamValue: function getParamValue(param) {\n            var href = this.data('href');\n            if (!href) return undefined;\n            return mw.util.getParamValue(param, href);\n        }\n    });\n    $('.mw-rollback-link a').each(loop);\n    $(document.body).on('click', function(event) {\n        if (!$(event.target).is('.mw-rollback-link a')) return true;\n        var self = $(event.target),\n            parent = self.parent();\n        if (!self.data('href')) loop.bind(event.target)();\n        if (!parent.find(self)[0]) return false;\n        if (mw.config.get('wgRollbacking')) return true;\n        var rollbackSummary = prompt('\u56de\u9000\u64cd\u4f5c\u7684\u7f16\u8f91\u6458\u8981\u3010xxx//Rollback\u3011\\n\u3010\u7a7a\u767d\u5219\u4f7f\u7528\u9ed8\u8ba4\u56de\u9000\u6458\u8981\u3011\\n\u3010\u53d6\u6d88\u5219\u4e0d\u8fdb\u884c\u56de\u9000\u3011\uff1a');\n        if (rollbackSummary !== null) $.ajax({\n            type: 'POST',\n            url: 'https://zh.moegirl.org/api.php',\n            beforeSend: function() {\n                self.replaceWith('<span id=\"rbing\"><img src=\"https://static.mengniang.org/common/d/d1/Windows_10_loading.gif\" style=\"height: 1em; margin-top: -.25em;\">\u6b63\u5728\u56de\u9000\u4e2d\u2026\u2026</span>');\n                self = $('#rbing');\n                $('.mw-rollback-link a').not(self).css({\n                    color: '#aaa',\n                    \"text-decoration\": 'none'\n                });\n                mw.config.set('wgRollbacking', true);\n            },\n            data: {\n                title: self.getParamValue('title'),\n                user: self.getParamValue('from'),\n                summary: rollbackSummary ? rollbackSummary + ' //Rollback' : '//Rollback',\n                token: self.getParamValue('token'),\n                action: 'rollback',\n                format: 'json'\n            },\n            error: function(eO, eM, eC) {\n                eC = eM ? eC + '\uff08' + eM + '\uff09' : eC;\n                self.css('color', 'red').html('\u9519\u8bef\uff1a' + eC + '\u3002\u5c06\u5728<span id=\"rbcount\">3</span>\u79d2\u5185\u5237\u65b0');\n                exit();\n            },\n            success: function(d) {\n                if (d.error) self.css('color', 'red').html('\u9519\u8bef\uff1a\u5df2\u88ab\u56de\u9000\u3002\u5c06\u5728<span id=\"rbcount\">3</span>\u79d2\u5185\u5237\u65b0');\n                else self.css('color', 'green').html('\u6210\u529f\uff01\u5c06\u5728<span id=\"rbcount\">3</span>\u79d2\u5185\u5237\u65b0');\n                exit();\n            }\n        });\n        return false;\n    });\n    function exit() {\n        window.setInterval(function() {\n            var count = +$('#rbcount').text();\n            if (count-- == 1) window.location.reload();\n            $('#rbcount').text(count > 0 ? count : '0');\n        }, 1000);\n    }\n    function loop() {\n        var self = $(this);\n        self.data('href', self.attr('href')).removeAttr('href') //\u53d6\u6d88\u62d6\u52a8\u94fe\u63a5\u56de\u9000\n            .attr('title', this.title + '\uff08\u542f\u7528\u81ea\u5b9a\u4e49\u6458\u8981\uff09').css('cursor', 'pointer').append('<sup>+</sup>');\n        if ($('.ns-special')[0] && self.text().indexOf('10') != -1) self.parent().text('[\u8d85\u8fc710\u6b21\u7684\u7f16\u8f91]').attr('title', '\u8d85\u8fc710\u6b21\u7684\u7f16\u8f91\u8bf7\u4f7f\u7528\u64a4\u9500\u529f\u80fd\uff0c\u4ee5\u4fbf\u68c0\u67e5\u5dee\u5f02\uff08\u81ea\u5b9a\u4e49\u6458\u8981\u5c0f\u5de5\u5177\uff09');\n    }\n});"}}}