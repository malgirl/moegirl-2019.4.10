<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8" />
<title>View source for 经验:Visualeditor安装方法 - Moegirlsaikou Foundation</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"经验:Visualeditor安装方法","wgTitle":"经验:Visualeditor安装方法","wgCurRevisionId":37,"wgRevisionId":0,"wgArticleId":12,"wgIsArticle":false,"wgIsRedirect":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"经验:Visualeditor安装方法","wgRelevantArticleId":12,"wgRequestId":"a2805cc0259a7bcf6e10751f","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","site":"ready","user.options":"ready","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.tokens@0g4oyza",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["mediawiki.action.edit.collapsibleFooter","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","skins.vector.js"]);});</script>
<link rel="stylesheet" href="/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector" />
<script async="" src="/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector" />
<meta name="generator" content="MediaWiki 1.31.1" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="Moegirlsaikou Foundation (en)" />
<link rel="alternate" type="application/atom+xml" title="Moegirlsaikou Foundation Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="canonical" href="https://moegirl.org/%E7%BB%8F%E9%AA%8C:Visualeditor%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95" />
<!--[if lt IE 9]><script src="/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=vector&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-经验_Visualeditor安装方法 rootpage-经验_Visualeditor安装方法 skin-vector action-edit"> <div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body" role="main">
<a id="top"></a>
<div id="siteNotice" class="mw-body-content">
<div class='please-donate'>
<div class='ads-main'>

<script>
		(function() {
			var s = '_' + Math.random().toString(36).slice(2);
			document.write('<div id="' + s + '"></div>');
			(window.slotbydup=window.slotbydup || []).push({
				id: '3876343',
				container: s,
				size: '728,90',
				display: 'inlay-fix'
			});
		})();
		</script>
</div>
</div></div><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">View source for 经验:Visualeditor安装方法</h1> <div id="bodyContent" class="mw-body-content">
<div id="contentSub">← <a href="/%E7%BB%8F%E9%AA%8C:Visualeditor%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95" title="经验:Visualeditor安装方法">经验:Visualeditor安装方法</a></div>
<div id="jump-to-nav" class="mw-jump">
Jump to: <a href="#mw-head">navigation</a>, <a href="#p-search">search</a>
</div>
<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reasons:
</p>
<ul class="permissions-errors">
<li>The action you have requested is limited to users in one of the groups: developer, staff.</li>
<li>You must confirm your email address before editing pages.
Please set and validate your email address through your <a href="/Special:Preferences" title="Special:Preferences">user preferences</a>.</li>
</ul>
<hr />
<p>You can view and copy the source of this page.
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" class="mw-editfont-monospace" lang="en" dir="ltr" name="wpTextbox1">{{info|此篇文章是写给其他mediawiki站长用于安装VisualEditor的步骤说明。成文时间是2013年7月14日。请务必注意这个插件仍在不断高速更新之中，因此请以mediawiki官方页面为准。}}

VisualEditor是维基媒体基金会在如同憋大便一般的终于在2013年整出来beta版的官方所见即所得编辑器。

插件地址是：http://www.mediawiki.org/wiki/Extension:VisualEditor

配合的服务器端程序是：http://www.mediawiki.org/wiki/Parsoid

由于这个插件还在快速更新（比如说一个月之前Parsoid的配置里还没有localsettings.js，2013年7月14日开始已经有了）这里的这份安装说明可能会很快变得过时，请以官方最新版说明为准。

这篇步骤说明假设你已经熟悉ssh怎么操作，你是用的是linux类系统。

这个玩意设置起来相当麻烦，并且耗费很多性能。可以考虑将内容托管给我们或一起合租服务器。

== 安装方法 ==

=== 先装node.js0.8.22 ===
Parsoid依赖node.js运作，官方说[http://nodejs.org/dist/v0.8.22/docs/ 0.8.22]最好（works best）

Ubuntu之类能用apt-get好说直接用下方的官方给出的方法就装完了。如果你跟我一样用的centos就麻烦，直接configure&amp;make&amp;make install通常会失败。我这边最后是直接装二进制包装上的。由于环境千差万别，而且这篇文章的重点不是node.js怎么装，于是请读者自行搜索适合你的环境的安装方法吧。
 apt-get install nodejs nodejs-legacy npm

=== 装Parsoid ===
ssh里输入：
 git clone https://gerrit.wikimedia.org/r/p/mediawiki/extensions/Parsoid.git
然后
 cd Parsoid/js
 npm install

这时要看你是否要远程使用Parsoid（即把Parsoid放到别的服务器去，因为这玩意相当耗费内存和cpu。512mbVPS开了数据库直接自动关闭。2G内存开都很勉强）。如果答案肯定，打开&lt;code>Parsoid/js/api&lt;/code>目录，复制localsettings.js.example到本地用Notepad++之类的编辑器打开，设置&lt;code>localsettings.js.example&lt;/code> 然后 保存为 &lt;code>localsettings.js&lt;/code> 上传回&lt;code>Parsoid/js/api&lt;/code>。

这是萌百所用的 &lt;code>localsettings.js&lt;/code> 供'''参考'''。请按照自己的实际情况设置
&lt;pre>
/*
 * This is a sample configuration file.
 *
 * Copy this file to localsettings.js and edit that file to fit your needs.
 *
 * Also see the file ParserService.js for more information.
 */

exports.setup = function( parsoidConfig ) {
	// The URL here is supposed to be your MediaWiki installation root
	//parsoidConfig.setInterwiki( 'localhost', 'http://localhost/api.php' );
	parsoidConfig.setInterwiki( 'ustest', 'http://ustest.moegirl.org/wiki/api.php' );
	parsoidConfig.setInterwiki( 'zh', 'http://zh.moegirl.org/api.php' );
	parsoidConfig.setInterwiki( 'jp', 'http://jp.moegirl.org/api.php' );
	parsoidConfig.setInterwiki( 'en', 'http://en.moegirl.org/api.php' );
	parsoidConfig.setInterwiki( 'bili', 'http://biliwiki.org/api.php' );

	// Enable debug mode (prints extra debugging messages)
	// parsoidConfig.debug = true;

	// Use the PHP preprocessor to expand templates via the MW API (default true)
	//parsoidConfig.usePHPPreProcessor = false;

	// Use selective serialization (default false)
	//parsoidConfig.useSelser = true;

	// allow cross-domain requests to the API (default disallowed)
	//parsoidConfig.allowCORS = '*';
};
&lt;/pre>

设置完成后测试运行
 cd Parsoid/js
 '''node api/server.js'''
理论上此时访问 http://你的域名:8000 会显示类似这个网页的 http://parsoid.wmflabs.org 的界面。点击 Example: Main Page 如果看到的是英文维基的界面说明Parsoid可以正常工作。

=== 升级mediawiki ===
虽然VisualEditor声称1.22/wmf4+版本都能运行，但实际上这个插件的兼容性几乎为0。先前下载的Parsoid是最新版，绝大多数情况下，你得用与中文维基相同的基金会版wiki才能正常工作。

维基用的版本可以在这里看到：http://zh.wikipedia.org/wiki/Special:version 

你会看到类似
 产品		版本
 MediaWiki	1.22wmf9 (f0f11ee)
点击那串乱码进入维基的git页面，点 【| zip | gz | bzip2】中你喜欢的任意一种压缩格式下载mediawiki，覆盖你当前的wiki然后 php update.php (强烈建议你先找个测试环境测试，不要直接升级)

=== 安装VisualEditor ===
从 http://www.mediawiki.org/wiki/Extension:VisualEditor 下载最新版。复制到extensions目录下面去

把这段加入localsetting.php里
&lt;pre>
require_once("$IP/extensions/VisualEditor/VisualEditor.php");

//如果需要在其他名字空间开启VisualEditor，请用下面的代码设置。默认只有主空间和user启用
//$wgVisualEditorNamespaces[] = NS_PROJECT;

//默认对所有人启用
$wgDefaultUserOptions['visualeditor-enable'] = 1;

//默认不允许用户禁用VisualEditor
$wgHiddenPrefs[] = 'visualeditor-enable';

//开启实验功能（不建议）
//$wgVisualEditorEnableExperimentalCode = true;
&lt;/pre>

&lt;pre>
// 到Parsoid的URL。因为有bug，所以不能以/结尾（本机的话下面这个默认即可）
$wgVisualEditorParsoidURL = 'http://localhost:8000';
&lt;/pre>

&lt;pre>
//链接到远程服务器上的Parsoid时使用前缀(Prefix)告诉服务器返回地址
//这里填入的就是一开始localsettings.js里设置的内容了，以萌娘百科中文版举例，这里写zh即可。
$wgVisualEditorParsoidPrefix = 'localhost';
&lt;/pre>

完成后再任意文章上点编辑，应当能进入VisualEditor。尝试编辑，保存，插入，等操作。没有问题就完全能正常工作了。

=== Parsoid自动启动 ===
先前的Parsoid安装步骤，通过SSH启动，只要一关窗口Parsoid立马关闭。因此需要加到自动启动项目里。 （PS下面这个方法不是每个VPS都能用，比如萌百主站就用不了。只能另想办法）

 vi /etc/rc.local
 按Insert键
 按↓键不放
 到底之后按End键
 按Enter新建一行
 node /home/Parsoid/js/api/server.js （请根据自己安装的路径设置！）
如果没有exit 0，自己写上。 然后按键盘ESC，光标不闪动之后输入:wq

退出之后输入reboot 重启，完成后 http://你的域名:8000 能访问即代表成功。
</textarea><div class="templatesUsed"><div class="mw-templatesUsedExplanation"><p>Template used on this page:
</p></div><ul>
<li><a href="/Template:Info" title="Template:Info">Template:Info</a> (<a href="/index.php?title=Template:Info&amp;action=edit" title="Template:Info">view source</a>) </li></ul></div><p id="mw-returnto">Return to <a href="/%E7%BB%8F%E9%AA%8C:Visualeditor%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95" title="经验:Visualeditor安装方法">经验:Visualeditor安装方法</a>.</p>
</div> <div class="printfooter">
Retrieved from "<a dir="ltr" href="https://moegirl.org/经验:Visualeditor安装方法">https://moegirl.org/经验:Visualeditor安装方法</a>" </div>
<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div><div id='mw-data-after-content'>
<div class='please-donate'>
<div class='ads-main'>

<script>
		(function() {
			var s = '_' + Math.random().toString(36).slice(2);
			document.write('<div id="' + s + '"></div>');
			(window.slotbydup=window.slotbydup || []).push({
				id: '3876346',
				container: s,
				size: '728,90',
				display: 'inlay-fix'
			});
		})();
		</script>
</div>
</div>
</div>
<div class="visualClear"></div>
</div>
</div>
<div id="mw-navigation">
<h2>Navigation menu</h2>
<div id="mw-head">
<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
<h3 id="p-personal-label">Personal tools</h3>
<ul>
<li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=%E7%BB%8F%E9%AA%8C%3AVisualeditor%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95&amp;returntoquery=action%3Dedit" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li> </ul>
</div>
<div id="left-navigation">
<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
<h3 id="p-namespaces-label">Namespaces</h3>
<ul>
<li id="ca-nstab-main" class="selected"><span><a href="/%E7%BB%8F%E9%AA%8C:Visualeditor%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk" class="new"><span><a href="/index.php?title=Talk:%E7%BB%8F%E9%AA%8C:Visualeditor%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [t]" accesskey="t">Discussion</a></span></li> </ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-variants-label" />
<h3 id="p-variants-label">
<span>Variants</span>
</h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
</div>
<div id="right-navigation">
<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
<h3 id="p-views-label">Views</h3>
<ul>
<li id="ca-view" class="collapsible"><span><a href="/%E7%BB%8F%E9%AA%8C:Visualeditor%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95">Read</a></span></li><li id="ca-viewsource" class="collapsible selected"><span><a href="/index.php?title=%E7%BB%8F%E9%AA%8C:Visualeditor%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="/index.php?title=%E7%BB%8F%E9%AA%8C:Visualeditor%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li> </ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
<input type="checkbox" class="vectorMenuCheckbox" aria-labelledby="p-cactions-label" />
<h3 id="p-cactions-label"><span>More</span></h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
<div id="p-search" role="search">
<h3>
<label for="searchInput">Search</label>
</h3>
<form action="/index.php" id="searchform">
<div id="simpleSearch">
<input type="search" name="search" placeholder="Search Moegirlsaikou Foundation" title="Search Moegirlsaikou Foundation [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton" /> </div>
</form>
</div>
</div>
</div>
<div id="mw-panel">
<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="/Mainpage" title="Visit the main page"></a></div>
<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
<h3 id="p-navigation-label">Navigation</h3>
<div class="body">
<ul>
<li id="n-mainpage-description"><a href="/Mainpage" title="Visit the main page [z]" accesskey="z">Main page</a></li><li id="n-recentchanges"><a href="/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" target="_blank" title="The place to find out">Help</a></li> </ul>
</div>
</div>
<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
<h3 id="p-tb-label">Tools</h3>
<div class="body">
<ul>
<li id="t-whatlinkshere"><a href="/Special:WhatLinksHere/%E7%BB%8F%E9%AA%8C:Visualeditor%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="/Special:RecentChangesLinked/%E7%BB%8F%E9%AA%8C:Visualeditor%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-info"><a href="/index.php?title=%E7%BB%8F%E9%AA%8C:Visualeditor%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95&amp;action=info" title="More information about this page">Page information</a></li> </ul>
</div>
</div>
<div class="portal" role="navigation" id="p-" aria-labelledby="p--label">
<h3 id="p--label"></h3>
<div class="body">
</div>
</div>
</div>
</div>
<div id="footer" role="contentinfo">
<ul id="footer-places">
<li id="footer-places-privacy"><a href="/Moegirlsaikou_Foundation:Privacy_policy" title="Moegirlsaikou Foundation:Privacy policy">Privacy policy</a></li>
<li id="footer-places-about"><a href="/Moegirlsaikou_Foundation:About" title="Moegirlsaikou Foundation:About">About Moegirlsaikou Foundation</a></li>
<li id="footer-places-disclaimer"><a href="/Moegirlsaikou_Foundation:General_disclaimer" title="Moegirlsaikou Foundation:General disclaimer">Disclaimers</a></li>
</ul>
<ul id="footer-icons" class="noprint">
<li id="footer-poweredbyico">
<a href="//www.mediawiki.org/" target="_blank"><img src="/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a> </li>
</ul>
<div style="clear: both;"></div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-18669495-4', 'moegirl.org');
  ga('send', 'pageview');

</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":184});});</script>
</body>
</html>
